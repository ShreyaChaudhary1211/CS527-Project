[<Line: +import org.mp4parser.streaming.extensions.CompositionTimeSampleExtension;
>, <Line: +import org.mp4parser.streaming.extensions.CompositionTimeTrackExtension;
>, <Line: +import static org.mp4parser.tools.CastUtils.l2i;
>, <Line: +    public StandardMp4Writer(List<StreamingTrack> source, WritableByteChannel sink) {
>, <Line: +                    throw new RuntimeException("There may not be two tracks with the same trackID within one file");
>, <Line: +        SampleTableBox stbl = Path.getPath(tb, "mdia[0]/minf[0]/stbl[0]");
>, <Line: +        assert stbl != null;
>, <Line: +        SampleToChunkBox stsc = Path.getPath(stbl, "stsc[0]");
>, <Line: +        SampleSizeBox stsz = Path.getPath(stbl, "stsz[0]");
>, <Line: +        TimeToSampleBox stts = Path.getPath(stbl, "stts[0]");
>, <Line: +        SyncSampleBox stss = Path.getPath(stbl, "stss[0]");
>, <Line: +        CompositionTimeToSample ctts = Path.getPath(stbl, "ctts[0]");
>, <Line: +        if (streamingTrack.getTrackExtension(CompositionTimeTrackExtension.class) != null) {
>, <Line: +            if (ctts == null) {
>, <Line: +                ctts = new CompositionTimeToSample();
>, <Line: +                ctts.setEntries(new ArrayList<CompositionTimeToSample.Entry>());
>, <Line: +                ArrayList<Box> bs = new ArrayList<Box>(stbl.getBoxes());
>, <Line: +                bs.add(bs.indexOf(stts), ctts);
>, <Line: +            }
>, <Line: +        }
>, <Line: +            if (ctts != null) {
>, <Line: +                ctts.getEntries().add(
>, <Line: +                        new CompositionTimeToSample.Entry(1, l2i(sample.getSampleExtension(CompositionTimeSampleExtension.class).getCompositionTimeOffset())));
>, <Line: +            }
>, <Line: +        System.err.println("CC created. mdat size: " + cc.mdat.size);
>, <Line: +                writableByteChannel.write((ByteBuffer) sample.getContent().rewind());
>]
[<Line: -    public StandardMp4Writer(List<StreamingTrack> source, WritableByteChannel sink) throws IOException {
>, <Line: -                    throw new IOException("There may not be two tracks with the same trackID within one file");
>, <Line: -        SampleToChunkBox stsc = Path.getPath(tb, "mdia[0]/minf[0]/stbl[0]/stsc[0]");
>, <Line: -        SampleSizeBox stsz = Path.getPath(tb, "mdia[0]/minf[0]/stbl[0]/stsz[0]");
>, <Line: -        TimeToSampleBox stts = Path.getPath(tb, "mdia[0]/minf[0]/stbl[0]/stts[0]");
>, <Line: -        SyncSampleBox stss = Path.getPath(tb, "mdia[0]/minf[0]/stbl[0]/stss[0]");
>, <Line: -                    SampleTableBox stbl = Path.getPath(tb, "mdia[0]/minf[0]/stbl[0]");
>, <Line: -                    assert stbl != null;
>, <Line: -                writableByteChannel.write(sample.getContent());
>]