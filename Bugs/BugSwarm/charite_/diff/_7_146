[]
[<Line: -package de.charite.compbio.jped;
>, <Line: -import java.io.PrintWriter;
>, <Line: -import org.apache.commons.cli.CommandLine;
>, <Line: -import org.apache.commons.cli.CommandLineParser;
>, <Line: -import org.apache.commons.cli.DefaultParser;
>, <Line: -import org.apache.commons.cli.HelpFormatter;
>, <Line: -import org.apache.commons.cli.Option;
>, <Line: -import org.apache.commons.cli.Options;
>, <Line: -import org.apache.commons.cli.ParseException;
>, <Line: -import com.google.common.collect.ImmutableSet;
>, <Line: -import de.charite.compbio.jannovar.pedigree.ModeOfInheritance;
>, <Line: -/**
>, <Line: - * Command line parser for the jped-cli application for the pedigree-based filtration of VCF.
>, <Line: - */
>, <Line: -public class JPedCommandLineParser {
>, <Line: -	/** options representation for the Apache commons command line parser */
>, <Line: -	protected Options options;
>, <Line: -	protected Options helpOptions;
>, <Line: -	/** the Apache commons command line parser */
>, <Line: -	protected CommandLineParser parser;
>, <Line: -	/**
>, <Line: -	 * Calls initializeParser().
>, <Line: -	 */
>, <Line: -	public JPedCommandLineParser() {
>, <Line: -		initializeParser();
>, <Line: -	}
>, <Line: -	public JPedOptions parse(String[] argv) throws ParseException, HelpRequestedException {
>, <Line: -		CommandLine cmd = parser.parse(helpOptions, argv, true);
>, <Line: -		printHelpIfOptionIsSet(cmd);
>, <Line: -		// Parse the command line.
>, <Line: -		cmd = parser.parse(options, argv);
>, <Line: -		printHelpIfOptionIsSet(cmd);
>, <Line: -		// Fill the resulting JannovarOptions.
>, <Line: -		JPedOptions result = new JPedOptions();
>, <Line: -		if (cmd.hasOption("help")) {
>, <Line: -			printHelp();
>, <Line: -			throw new HelpRequestedException();
>, <Line: -		}
>, <Line: -		if (cmd.hasOption("verbose"))
>, <Line: -			result.verbosity = 2;
>, <Line: -		if (cmd.hasOption("very-verbose"))
>, <Line: -			result.verbosity = 3;
>, <Line: -		ImmutableSet.Builder<ModeOfInheritance> inheritanceBuilder = new ImmutableSet.Builder<ModeOfInheritance>();
>, <Line: -		for (String modeString : cmd.getOptionValues("inheritance-mode")) {
>, <Line: -			ModeOfInheritance mode = ModeOfInheritance.valueOf(ModeOfInheritance.class, modeString);
>, <Line: -			inheritanceBuilder.add(mode);
>, <Line: -		}
>, <Line: -		ImmutableSet<ModeOfInheritance> inheritances = inheritanceBuilder.build();
>, <Line: -		if (!inheritances.isEmpty())
>, <Line: -			result.modeOfInheritances = inheritances;
>, <Line: -		result.geneWise = cmd.hasOption("gene-wise");
>, <Line: -		result.jannovarDB = cmd.getOptionValue("database");
>, <Line: -		result.pedPath = cmd.getOptionValue("ped");
>, <Line: -		result.inputPath = cmd.getOptionValue("vcf-in");
>, <Line: -		result.outputPath = cmd.getOptionValue("vcf-out");
>, <Line: -		return result;
>, <Line: -	}
>, <Line: -	private void printHelpIfOptionIsSet(CommandLine cmd) throws HelpRequestedException {
>, <Line: -		if (cmd.hasOption("help")) {
>, <Line: -			printHelp();
>, <Line: -			throw new HelpRequestedException();
>, <Line: -		}
>, <Line: -	}
>, <Line: -	protected void initializeParser() {
>, <Line: -		options = new Options();
>, <Line: -		helpOptions = new Options();
>, <Line: -		Option helpOption = Option.builder("h").desc("show this help").longOpt("help").build();
>, <Line: -		helpOptions.addOption(helpOption);
>, <Line: -		options.addOption(helpOption);
>, <Line: -		options.addOption(new Option("v", "verbose", false, "enable verbose output"));
>, <Line: -		options.addOption(new Option("vv", "very-verbose", false, "enable very verbose output"));
>, <Line: -		options.addOption(Option.builder("m").hasArgs()
>, <Line: -				.desc("Check for the given inheritance mode(s) (can be multiple)").longOpt("inheritance-mode").build());
>, <Line: -		options.addOption(new Option("g", "gene-wise", false,
>, <Line: -				"gene-wise instead of variant-wise processing (required for compound heterozygous filtration)"));
>, <Line: -		options.addOption(Option.builder("d").longOpt("database").required().hasArg().desc("Jannovar database")
>, <Line: -				.argName("database.ser").build());
>, <Line: -		options.addOption(Option.builder("i").longOpt("vcf-in").required().hasArgs()
>, <Line: -				.desc("VCF file to annotate (.vcf/.gz)").argName("IN.vcf").build());
>, <Line: -		options.addOption(Option.builder("o").longOpt("vcf-out").required().hasArg()
>, <Line: -				.desc("VCF output file").argName("OUT.vcf").build());
>, <Line: -		options.addOption(Option.builder("p").longOpt("ped").required().hasArg()
>, <Line: -				.desc("Pedigree file in ped format containing all samples of the input vcf").argName("FAM.ped").build());
>, <Line: -		parser = new DefaultParser();
>, <Line: -	}
>, <Line: -	public void printHelp() {
>, <Line: -		final String HEADER = new StringBuilder().append("Jannovar Filter Tool")
>, <Line: -				.append("Use this command to filter VCF files.\n\n")
>, <Line: -				.append("Usage: java -jar jped-cli.jar -d <DB.ser> -p <PED.ped> -v <IN.vcf> -o <OUT.vcf>\n\n").toString();
>, <Line: -		final String FOOTER = new StringBuilder()
>, <Line: -				.append("\n\nExample: java -jar jped-cli.jar -m AUTOSOMAL_DOMINANT -d data/hg19_ucsc.ser -p fam.ped -i 123.vcf -o 123.filtered.vcf\n")
>, <Line: -				.append("         java -jar jped-cli.jar -g -m AUTOSOMAL_RECESSIVE -d data/hg19_ucsc.ser -p fam.ped -i 123.vcf -o 123.filtered.vcf\n\n")
>, <Line: -				.append("Diseases\n\n")
>, <Line: -				.append("The --inheritance-mode parameter can take one of the following values. When given")
>, <Line: -				.append("then the variants will be filtered to those being compatible with the given mode")
>, <Line: -				.append("of inheritance.\n\n").append("  AUTOSOMAL_DOMINANT\n").append("  AUTOSOMAL_RECESSIVE\n")
>, <Line: -				.append("  X_RECESSIVE\n").append("  X_DOMINANT\n").append("  UNINITIALIZED (no filtration)\n")
>, <Line: -				.toString();
>, <Line: -		System.err.print(HEADER);
>, <Line: -		HelpFormatter hf = new HelpFormatter();
>, <Line: -		PrintWriter pw = new PrintWriter(System.err, true);
>, <Line: -		hf.printOptions(pw, 78, options, 2, 2);
>, <Line: -		System.err.print(FOOTER);
>, <Line: -	}
>, <Line: -}
>]