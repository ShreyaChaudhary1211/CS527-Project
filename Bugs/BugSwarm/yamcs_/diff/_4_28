[<Line: +import org.yamcs.YConfiguration;
>, <Line: +import org.yamcs.web.ServiceUnavailableException;
>, <Line: +    private static int MAX_CONCURRENT_REPLAYS = YConfiguration.getConfiguration("yamcs").getInt("WebConfig", "maxConcurrentReplays", 2*Runtime.getRuntime().availableProcessors());
>, <Line: +    static AtomicInteger concurrentCount = new AtomicInteger();
>, <Line: +        int n = concurrentCount.incrementAndGet();
>, <Line: +        if(n>MAX_CONCURRENT_REPLAYS) {
>, <Line: +            concurrentCount.decrementAndGet();
>, <Line: +            throw new ServiceUnavailableException("Maximum number of concurrent replays has been reached");
>, <Line: +        }
>]
[<Line: -    public static void replayAndWait(String instance, AuthenticationToken token, ReplayRequest replayRequest, RestReplayListener l) throws HttpException {
>, <Line: -        replay(instance, token, replayRequest, l).await();
>, <Line: -    }
>, <Line: -        public void await() throws InternalServerErrorException {
>, <Line: -           yproc.awaitTerminated();
>, <Line: -        }
>]