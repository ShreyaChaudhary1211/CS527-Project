[]
[<Line: -package org.yamcs;
>, <Line: -import static org.junit.Assert.assertNotNull;
>, <Line: -import static org.junit.Assert.assertTrue;
>, <Line: -import java.io.ObjectInputStream;
>, <Line: -import org.apache.activemq.artemis.api.core.client.ClientMessage;
>, <Line: -import org.apache.activemq.artemis.core.server.embedded.EmbeddedActiveMQ;
>, <Line: -import org.apache.activemq.artemis.utils.ActiveMQBufferInputStream;
>, <Line: -import org.junit.AfterClass;
>, <Line: -import org.junit.BeforeClass;
>, <Line: -import org.junit.Test;
>, <Line: -import org.yamcs.api.artemis.Protocol;
>, <Line: -import org.yamcs.api.artemis.YamcsClient;
>, <Line: -import org.yamcs.api.artemis.YamcsSession;
>, <Line: -import org.yamcs.artemis.ArtemisServer;
>, <Line: -import org.yamcs.management.ManagementService;
>, <Line: -import org.yamcs.protobuf.YamcsManagement.MissionDatabaseRequest;
>, <Line: -import org.yamcs.xtce.XtceDb;
>, <Line: -public class YamcsServerArtemisTest {
>, <Line: -    static EmbeddedActiveMQ artemisServer;
>, <Line: -    @BeforeClass
>, <Line: -    public static void setupYamcs() throws Exception {
>, <Line: -        YConfiguration.setup("YamcsServer");
>, <Line: -        ManagementService.setup(false);
>, <Line: -        org.yamcs.yarch.management.JMXService.setup(false);
>, <Line: -        artemisServer = ArtemisServer.setupArtemis();
>, <Line: -        YamcsServer.setupYamcsServer();
>, <Line: -    }
>, <Line: -    @AfterClass
>, <Line: -    public static void shutDownYamcs()  throws Exception {
>, <Line: -        artemisServer.stop();
>, <Line: -    }
>, <Line: -    @Test
>, <Line: -    public void testRetrieveMdb() throws Exception {
>, <Line: -        YamcsSession ys = YamcsSession.newBuilder().build();
>, <Line: -        YamcsClient yc = ys.newClientBuilder().setRpc(true).setDataConsumer(null, null).build();
>, <Line: -        MissionDatabaseRequest mdr = MissionDatabaseRequest.newBuilder().setDbConfigName("refmdb").build();
>, <Line: -        yc.executeRpc(Protocol.YAMCS_SERVER_CONTROL_ADDRESS, "getMissionDatabase", mdr, null);
>, <Line: -        ClientMessage msg=yc.dataConsumer.receive(5000);
>, <Line: -        assertNotNull(msg);
>, <Line: -        ObjectInputStream ois=new ObjectInputStream(new ActiveMQBufferInputStream(msg.getBodyBuffer()));
>, <Line: -        Object o=ois.readObject();
>, <Line: -        assertTrue(o instanceof XtceDb);
>, <Line: -        XtceDb xtcedb=(XtceDb) o;
>, <Line: -        assertNotNull(xtcedb.getSequenceContainer("/REFMDB/SUBSYS1/PKT1_1"));
>, <Line: -        ois.close();
>, <Line: -        yc.close();
>, <Line: -        ys.close();
>, <Line: -    }
>, <Line: -}>]