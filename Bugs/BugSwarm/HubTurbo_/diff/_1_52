[]
[<Line: -package command;
>, <Line: -import java.io.IOException;
>, <Line: -import java.net.SocketTimeoutException;
>, <Line: -import java.net.UnknownHostException;
>, <Line: -import java.util.List;
>, <Line: -import javafx.application.Platform;
>, <Line: -import model.Model;
>, <Line: -import model.TurboIssue;
>, <Line: -import model.TurboLabel;
>, <Line: -import org.eclipse.egit.github.core.Label;
>, <Line: -import org.eclipse.egit.github.core.client.RequestException;
>, <Line: -import service.ServiceManager;
>, <Line: -import util.CollectionUtilities;
>, <Line: -import util.DialogMessage;
>, <Line: -/**
>, <Line: - * Adds given list of labels to the issue on github. Also adds labels to the given TurboIssue object
>, <Line: - * */
>, <Line: -public class TurboIssueAddLabels extends TurboIssueCommand{
>, <Line: -	private List<TurboLabel> addedLabels;
>, <Line: -	public TurboIssueAddLabels(Model model, TurboIssue issue, List<TurboLabel> labels){
>, <Line: -		super(model, issue);
>, <Line: -		this.addedLabels = labels;
>, <Line: -	}
>, <Line: -	private void logAddOperation(List<TurboLabel> original, List<TurboLabel> edited){
>, <Line: -		String changeLog = IssueChangeLogger.logLabelsChange(model.get(), issue, original, edited);
>, <Line: -		lastOperationExecuted = changeLog;
>, <Line: -	}
>, <Line: -	private boolean setLabelsForIssueInGithub() throws IOException{
>, <Line: -		List<Label> issueLabels = CollectionUtilities.getGithubLabelList(issue.getLabels());
>, <Line: -		//Use setLabelsForIssue instead of addLabels to enforce label group exclusivity
>, <Line: -		List<Label> resLabels = ServiceManager.getInstance().setLabelsForIssue(issue.getId(), issueLabels);
>, <Line: -		boolean result =  resLabels.containsAll(issueLabels);
>, <Line: -		if(result){
>, <Line: -			updateGithubIssueState();
>, <Line: -		}
>, <Line: -		return result;
>, <Line: -	}
>, <Line: -	@Override
>, <Line: -	protected boolean performExecuteAction() {
>, <Line: -		List<TurboLabel> original = issue.getLabels();
>, <Line: -		issue.addLabels(addedLabels);
>, <Line: -		try {
>, <Line: -			isSuccessful = setLabelsForIssueInGithub();
>, <Line: -			if(isSuccessful){
>, <Line: -				logAddOperation(original, issue.getLabels());
>, <Line: -			}
>, <Line: -		} catch (IOException e) {
>, <Line: -			issue.removeLabels(addedLabels);
>, <Line: -			isSuccessful = false;
>, <Line: -			if(e instanceof SocketTimeoutException){
>, <Line: -				Platform.runLater(()->{
>, <Line: -					DialogMessage.showWarningDialog("Internet Connection Timeout", 
>, <Line: -							"Timeout adding label(s) to issue in GitHub, please check your internet connection.");
>, <Line: -				});
>, <Line: -				logger.info("Failed to add label to issue on GitHub: " + e.getLocalizedMessage());
>, <Line: -			}else if(e instanceof RequestException){
>, <Line: -				Platform.runLater(()->{
>, <Line: -					DialogMessage.showWarningDialog("No repository permissions", 
>, <Line: -							"Cannot add label(s) to issue.");
>, <Line: -				});
>, <Line: -				logger.info("Failed to add label to issue on GitHub: " + e.getLocalizedMessage());
>, <Line: -			}else{
>, <Line: -				logger.error(e.getLocalizedMessage(), e);
>, <Line: -			}
>, <Line: -		}
>, <Line: -		return isSuccessful;
>, <Line: -	}
>, <Line: -	@Override
>, <Line: -	protected boolean performUndoAction() {
>, <Line: -		List<TurboLabel> original = issue.getLabels();
>, <Line: -		issue.removeLabels(addedLabels);
>, <Line: -		try {
>, <Line: -			boolean result = setLabelsForIssueInGithub();
>, <Line: -			if(result){
>, <Line: -				logAddOperation(original, issue.getLabels());
>, <Line: -			}
>, <Line: -			isUndone = result;
>, <Line: -		} catch (IOException e) {
>, <Line: -			issue.addLabels(addedLabels);
>, <Line: -			isUndone = false;
>, <Line: -			if(e instanceof SocketTimeoutException | e instanceof UnknownHostException){
>, <Line: -				Platform.runLater(()->{
>, <Line: -					DialogMessage.showWarningDialog("Internet Connection Timeout", 
>, <Line: -							"Timeout modifying label(s) for issue in GitHub, please check your internet connection.");
>, <Line: -				});
>, <Line: -				logger.info("Could not modify labels of issue on GitHub: " + e.getLocalizedMessage());
>, <Line: -			}else if(e instanceof RequestException){
>, <Line: -				Platform.runLater(()->{
>, <Line: -					DialogMessage.showWarningDialog("No repository permissions", 
>, <Line: -							"Cannot modify issue labels.");
>, <Line: -				});
>, <Line: -				logger.info("Could not modify labels of issue on GitHub (repository permission): " + e.getLocalizedMessage());
>, <Line: -			}else{
>, <Line: -				logger.error(e.getLocalizedMessage(), e);
>, <Line: -			}
>, <Line: -		}
>, <Line: -		return isUndone;
>, <Line: -	}
>, <Line: -}
>]