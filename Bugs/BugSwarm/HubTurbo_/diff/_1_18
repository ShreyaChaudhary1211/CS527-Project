[<Line: +package backend.github;
>, <Line: +import backend.interfaces.Repo;
>, <Line: +import backend.interfaces.TaskRunner;
>, <Line: +import backend.resource.Model;
>, <Line: +import backend.resource.TurboMilestone;
>, <Line: +import org.apache.commons.lang3.tuple.ImmutablePair;
>, <Line: +import org.apache.logging.log4j.Logger;
>, <Line: +import util.HTLog;
>, <Line: +import java.util.ArrayList;
>, <Line: +import java.util.List;
>, <Line: +public class UpdateMilestonesTask extends GitHubRepoTask<GitHubRepoTask.Result<TurboMilestone>> {
>, <Line: +	private static final Logger logger = HTLog.get(UpdateMilestonesTask.class);
>, <Line: +	private final Model model;
>, <Line: +	public UpdateMilestonesTask(TaskRunner taskRunner, Repo repo, Model model) {
>, <Line: +		super(taskRunner, repo);
>, <Line: +		this.model = model;
>, <Line: +	}
>, <Line: +	@Override
>, <Line: +	public void run() {
>, <Line: +		ImmutablePair<List<TurboMilestone>, String> changes = repo.getUpdatedMilestones(model.getRepoId(),
>, <Line: +			model.getUpdateSignature().milestonesETag);
>, <Line: +		List<TurboMilestone> changed = changes.left;
>, <Line: +		logger.info(HTLog.format(model.getRepoId(), "%s milestone(s)) changed%s",
>, <Line: +			changed.size(), changed.isEmpty() ? "" : ": " + changed));
>, <Line: +		List<TurboMilestone> updated = changed.isEmpty()
>, <Line: +			? model.getMilestones()
>, <Line: +			: new ArrayList<>(changed);
>, <Line: +		response.complete(new Result<>(updated, changes.right));
>, <Line: +	}
>, <Line: +}
>]
[]