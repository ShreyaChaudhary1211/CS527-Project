


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > JSONB</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.alibaba.fastjson2</a>
</div>

<h1>Coverage Summary for Class: JSONB (com.alibaba.fastjson2)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">JSONB</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/60)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/578)
  </span>
</td>
</tr>
  <tr>
    <td class="name">JSONB$Constants</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/60)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/578)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.alibaba.fastjson2;
&nbsp;
&nbsp;import com.alibaba.fastjson2.filter.Filter;
&nbsp;import com.alibaba.fastjson2.reader.ObjectReader;
&nbsp;import com.alibaba.fastjson2.reader.ObjectReaderBean;
&nbsp;import com.alibaba.fastjson2.reader.ObjectReaderProvider;
&nbsp;import com.alibaba.fastjson2.util.*;
&nbsp;import com.alibaba.fastjson2.writer.ObjectWriter;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.io.InputStream;
&nbsp;import java.io.OutputStream;
&nbsp;import java.lang.reflect.Type;
&nbsp;import java.nio.charset.Charset;
&nbsp;import java.nio.charset.StandardCharsets;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import static com.alibaba.fastjson2.JSONB.Constants.*;
&nbsp;import static com.alibaba.fastjson2.JSONFactory.*;
&nbsp;import static com.alibaba.fastjson2.util.JDKUtils.*;
&nbsp;
&nbsp;/**
&nbsp; * x90          # type_char int
&nbsp; * x91          # binary len_int32 bytes
&nbsp; * x92          # type [str] symbol_int32 jsonb
&nbsp; * x93          # reference
&nbsp; * &lt;p&gt;
&nbsp; * x94 - xa3    # array_0 - array_15
&nbsp; * xa4          # array len_int32 item*
&nbsp; * &lt;p&gt;
&nbsp; * xa5          # object_end
&nbsp; * xa6          # object_start
&nbsp; * &lt;p&gt;
&nbsp; * xa7          # local time b0 b1 b2
&nbsp; * xa8          # local datetime b0 b1 b2 b3 b4 b5 b6
&nbsp; * xa9          # local date b0 b1 b2 b3
&nbsp; * xab          # timestamp millis b0 b1 b2 b3 b4 b5 b6 b7
&nbsp; * xac          # timestamp seconds b0 b1 b2 b3
&nbsp; * xad          # timestamp minutes b0 b1 b2 b3
&nbsp; * xae          # timestamp b0 b1 b2 b3 b4 b5 b6 b7 nano_int32
&nbsp; * &lt;p&gt;
&nbsp; * xaf          # null
&nbsp; * xb0          # boolean false
&nbsp; * xb1          # boolean true
&nbsp; * xb2          # double 0
&nbsp; * xb3          # double 1
&nbsp; * xb4          # double_long
&nbsp; * xb5          # double
&nbsp; * xb6          # float_int
&nbsp; * xb7          # float
&nbsp; * xb8          # decimal_long
&nbsp; * xb9          # decimal
&nbsp; * xba          # bigint_long
&nbsp; * xbb          # bigint
&nbsp; * xbc          # short
&nbsp; * xbd          # byte
&nbsp; * xbe          # long
&nbsp; * xbf          # long encoded as 32-bit int
&nbsp; * xc0 - xc7    # three-octet compact long (-x40000 to x3ffff)
&nbsp; * xc8 - xd7    # two-octet compact long (-x800 to x7ff, xd0 is 0)
&nbsp; * xd8 - xef    # one-octet compact long (-x8 to xf, xe0 is 0)
&nbsp; * &lt;p&gt;
&nbsp; * xf0 - xff    # one-octet compact int
&nbsp; * x00 - x2f    # one-octet compact int
&nbsp; * &lt;p&gt;
&nbsp; * x30 - x3f    # two-octet compact int (-x800 to x7ff)
&nbsp; * x40 - x47    # three-octet compact int (-x40000 to x3ffff)
&nbsp; * x48          # 32-bit signed integer (&#39;I&#39;)
&nbsp; * &lt;p&gt;
&nbsp; * x49 - x78    # ascii string length 0-47
&nbsp; * x79          # ascii-8 string variable-length
&nbsp; * x7a          # utf-8 string variable-length
&nbsp; * x7b          # utf-16 string variable-length
&nbsp; * x7c          # utf-16LE string variable-length
&nbsp; * x7d          # utf-16BE string variable-length
&nbsp; * x7e          # gb18030 string variable-length
&nbsp; * x7f          # symbol
&nbsp; */
&nbsp;public interface JSONB {
&nbsp;    static void dump(byte[] jsonbBytes) {
<b class="nc">&nbsp;        System.out.println(</b>
<b class="nc">&nbsp;                JSONB.toJSONString(jsonbBytes, true)</b>
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    static void dump(byte[] jsonbBytes, SymbolTable symbolTable) {
<b class="nc">&nbsp;        JSONBDump dump = new JSONBDump(jsonbBytes, symbolTable, true);</b>
<b class="nc">&nbsp;        String str = dump.toString();</b>
<b class="nc">&nbsp;        System.out.println(str);</b>
&nbsp;    }
&nbsp;
&nbsp;    interface Constants {
&nbsp;        byte BC_CHAR = -112;                    // 0x90
&nbsp;        byte BC_BINARY = -111;                  // 0x91
&nbsp;        byte BC_TYPED_ANY = -110;               // 0x92
&nbsp;        byte BC_REFERENCE = -109;               // 0x93
&nbsp;
&nbsp;        int ARRAY_FIX_LEN = 15;
&nbsp;        byte BC_ARRAY_FIX_0 = -108;             // 0x94
&nbsp;        byte BC_ARRAY_FIX_MIN = BC_ARRAY_FIX_0;
&nbsp;        byte BC_ARRAY_FIX_MAX = BC_ARRAY_FIX_MIN + ARRAY_FIX_LEN; // -105
&nbsp;        byte BC_ARRAY = -92;                    // 0xa4 len_int32 item*
&nbsp;
&nbsp;        byte BC_OBJECT_END = -91;               // 0xa5
&nbsp;        byte BC_OBJECT = -90;                   // 0xa6
&nbsp;
&nbsp;        byte BC_LOCAL_TIME = -89;               // 0xa7 b0 b1 b2 nano_int32
&nbsp;        byte BC_LOCAL_DATETIME = -88;           // 0xa8 b0 b1 b2 b3 b4 b5 b6 nano_int32
&nbsp;        byte BC_LOCAL_DATE = -87;               // 0xa9 b0 b1 b2 b3
&nbsp;        byte BC_TIMESTAMP_WITH_TIMEZONE = -86;  // 0xaa b0 b1 b2 b3 b4 b5 b6 b7 str_zone
&nbsp;        byte BC_TIMESTAMP_MILLIS = -85;         // 0xab b0 b1 b2 b3 b4 b5 b6 b7
&nbsp;        byte BC_TIMESTAMP_SECONDS = -84;        // 0xac b0 b1 b2 b3
&nbsp;        byte BC_TIMESTAMP_MINUTES = -83;        // 0xad b0 b1 b2 b3
&nbsp;        byte BC_TIMESTAMP = -82;                // 0xae millis_8 + nano_int32
&nbsp;
&nbsp;        byte BC_NULL = -81;             // 0xaf
&nbsp;        byte BC_FALSE = -80;            // 0xb0
&nbsp;        byte BC_TRUE = -79;             // 0xb1
&nbsp;        byte BC_DOUBLE_NUM_0 = -78;     // 0xb2
&nbsp;        byte BC_DOUBLE_NUM_1 = -77;     // 0xb3
&nbsp;        byte BC_DOUBLE_LONG = -76;      // 0xb4
&nbsp;        byte BC_DOUBLE = -75;           // 0xb5
&nbsp;        byte BC_FLOAT_INT = -74;        // 0xb6
&nbsp;        byte BC_FLOAT = -73;            // 0xb7
&nbsp;        byte BC_DECIMAL_LONG = -72;     // 0xb8
&nbsp;        byte BC_DECIMAL = -71;          // 0xb9
&nbsp;        byte BC_BIGINT_LONG = -70;      // 0xba
&nbsp;        byte BC_BIGINT = -69;           // 0xbb
&nbsp;        byte BC_INT16 = -68;            // 0xbc b0 b1
&nbsp;        byte BC_INT8 = -67;             // 0xbd b0
&nbsp;        byte BC_INT64 = -66;            // 0xbe b0 b1 b2 b3 b4 b5 b6 b7
&nbsp;        byte BC_INT64_INT = -65;        // 0xbf b0 b1 b2 b3
&nbsp;
&nbsp;        int INT64_SHORT_MIN = -0x40000; // -262144
&nbsp;        int INT64_SHORT_MAX = 0x3ffff;  // 262143
&nbsp;
&nbsp;        int INT64_BYTE_MIN = -0x800;    // -2048
&nbsp;        int INT64_BYTE_MAX = 0x7ff;     // 2047
&nbsp;
&nbsp;        byte BC_INT64_SHORT_MIN = -64;  // 0xc0
&nbsp;        byte BC_INT64_SHORT_ZERO = -60; //
&nbsp;        byte BC_INT64_SHORT_MAX = -57;  // 0xc7
&nbsp;
&nbsp;        byte BC_INT64_BYTE_MIN = -56;   // 0xc8
&nbsp;        byte BC_INT64_BYTE_ZERO = -48;
&nbsp;        byte BC_INT64_BYTE_MAX = -41;   // 0xd7
&nbsp;
&nbsp;        byte BC_INT64_NUM_MIN = -40;    // 0xd8 -8
&nbsp;        byte BC_INT64_NUM_MAX = -17;    // 0xef 15
&nbsp;
&nbsp;        int INT64_NUM_LOW_VALUE = -8;  // -8
&nbsp;        int INT64_NUM_HIGH_VALUE = 15; // 15
&nbsp;
&nbsp;        byte BC_INT32_NUM_0 = 0;
&nbsp;        byte BC_INT32_NUM_1 = 1;
&nbsp;        byte BC_INT32_NUM_16 = 16;
&nbsp;
&nbsp;        byte BC_INT32_NUM_MIN = -16; // 0xf0
&nbsp;        byte BC_INT32_NUM_MAX = 47;  // 0x2f
&nbsp;
&nbsp;        byte BC_INT32_BYTE_MIN = 48;    // 0x30
&nbsp;        byte BC_INT32_BYTE_ZERO = 56;
&nbsp;        byte BC_INT32_BYTE_MAX = 63;
&nbsp;
&nbsp;        byte BC_INT32_SHORT_MIN = 64; // 0x40
&nbsp;        byte BC_INT32_SHORT_ZERO = 68;
&nbsp;        byte BC_INT32_SHORT_MAX = 71; // 0x47
&nbsp;        byte BC_INT32 = 72; // 0x48
&nbsp;
&nbsp;        int INT32_BYTE_MIN = -0x800; // -2048
&nbsp;        int INT32_BYTE_MAX = 0x7ff;  // 2047
&nbsp;
&nbsp;        int INT32_SHORT_MIN = -0x40000; // -262144
&nbsp;        int INT32_SHORT_MAX = 0x3ffff;  // 262143
&nbsp;
&nbsp;        byte BC_STR_ASCII_FIX_0 = 73;
&nbsp;        byte BC_STR_ASCII_FIX_1 = 74;
&nbsp;        byte BC_STR_ASCII_FIX_4 = 77;
&nbsp;        byte BC_STR_ASCII_FIX_5 = 78;
&nbsp;
&nbsp;        byte BC_STR_ASCII_FIX_32 = 105;
&nbsp;        byte BC_STR_ASCII_FIX_36 = 109;
&nbsp;
&nbsp;        int STR_ASCII_FIX_LEN = 47;
&nbsp;
&nbsp;        byte BC_STR_ASCII_FIX_MIN = 73; // 0x49
&nbsp;        byte BC_STR_ASCII_FIX_MAX = BC_STR_ASCII_FIX_MIN + STR_ASCII_FIX_LEN; // 120 0x78
&nbsp;        byte BC_STR_ASCII = 121;
&nbsp;        byte BC_STR_UTF8 = 122;
&nbsp;        byte BC_STR_UTF16 = 123;
&nbsp;        byte BC_STR_UTF16LE = 124;
&nbsp;        byte BC_STR_UTF16BE = 125;
&nbsp;        byte BC_STR_GB18030 = 126;
&nbsp;        byte BC_SYMBOL = 127;
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(boolean v) {
<b class="nc">&nbsp;        return new byte[]{v ? BC_TRUE : BC_FALSE};</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(int i) {
<b class="nc">&nbsp;        if (i &gt;= BC_INT32_NUM_MIN &amp;&amp; i &lt;= BC_INT32_NUM_MAX) {</b>
<b class="nc">&nbsp;            return new byte[]{(byte) i};</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        try (JSONWriter jsonWriter = JSONWriter.ofJSONB()) {</b>
<b class="nc">&nbsp;            jsonWriter.writeInt32(i);</b>
<b class="nc">&nbsp;            return jsonWriter.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(byte i) {
<b class="nc">&nbsp;        try (JSONWriter jsonWriter = JSONWriter.ofJSONB()) {</b>
<b class="nc">&nbsp;            jsonWriter.writeInt8(i);</b>
<b class="nc">&nbsp;            return jsonWriter.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(short i) {
<b class="nc">&nbsp;        try (JSONWriter jsonWriter = JSONWriter.ofJSONB()) {</b>
<b class="nc">&nbsp;            jsonWriter.writeInt16(i);</b>
<b class="nc">&nbsp;            return jsonWriter.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(long i) {
<b class="nc">&nbsp;        if (i &gt;= INT64_NUM_LOW_VALUE &amp;&amp; i &lt;= INT64_NUM_HIGH_VALUE) {</b>
<b class="nc">&nbsp;            return new byte[]{</b>
&nbsp;                    (byte) (BC_INT64_NUM_MIN + (i - INT64_NUM_LOW_VALUE))
&nbsp;            };
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        try (JSONWriter jsonWriter = JSONWriter.ofJSONB()) {</b>
<b class="nc">&nbsp;            jsonWriter.writeInt64(i);</b>
<b class="nc">&nbsp;            return jsonWriter.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static int writeInt(byte[] bytes, int off, int i) {
<b class="nc">&nbsp;        if (i &gt;= BC_INT32_NUM_MIN &amp;&amp; i &lt;= BC_INT32_NUM_MAX) {</b>
<b class="nc">&nbsp;            bytes[off++] = (byte) i;</b>
<b class="nc">&nbsp;            return 1;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (i &gt;= INT32_BYTE_MIN &amp;&amp; i &lt;= INT32_BYTE_MAX) {</b>
<b class="nc">&nbsp;            bytes[off++] = (byte) (BC_INT32_BYTE_ZERO + (i &gt;&gt; 8));</b>
<b class="nc">&nbsp;            bytes[off++] = (byte) i;</b>
<b class="nc">&nbsp;            return 2;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (i &gt;= INT32_SHORT_MIN &amp;&amp; i &lt;= INT32_SHORT_MAX) {</b>
<b class="nc">&nbsp;            bytes[off++] = (byte) (BC_INT32_SHORT_ZERO + (i &gt;&gt; 16));</b>
<b class="nc">&nbsp;            bytes[off++] = (byte) (i &gt;&gt; 8);</b>
<b class="nc">&nbsp;            bytes[off++] = (byte) i;</b>
<b class="nc">&nbsp;            return 3;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        bytes[off++] = BC_INT32;</b>
<b class="nc">&nbsp;        bytes[off++] = (byte) (i &gt;&gt;&gt; 24);</b>
<b class="nc">&nbsp;        bytes[off++] = (byte) (i &gt;&gt;&gt; 16);</b>
<b class="nc">&nbsp;        bytes[off++] = (byte) (i &gt;&gt;&gt; 8);</b>
<b class="nc">&nbsp;        bytes[off++] = (byte) i;</b>
<b class="nc">&nbsp;        return 5;</b>
&nbsp;    }
&nbsp;
&nbsp;    static Object parse(byte[] jsonbBytes, JSONReader.Feature... features) {
<b class="nc">&nbsp;        JSONReader reader = JSONReader.ofJSONB(jsonbBytes, 0, jsonbBytes.length);</b>
<b class="nc">&nbsp;        reader.getContext().config(features);</b>
<b class="nc">&nbsp;        ObjectReader objectReader = reader.getObjectReader(Object.class);</b>
&nbsp;
<b class="nc">&nbsp;        Object object = objectReader.readJSONBObject(reader, null, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static Object parse(byte[] jsonbBytes, SymbolTable symbolTable, JSONReader.Feature... features) {
<b class="nc">&nbsp;        JSONReader reader = JSONReader.ofJSONB(jsonbBytes, 0, jsonbBytes.length, symbolTable);</b>
<b class="nc">&nbsp;        reader.getContext().config(features);</b>
<b class="nc">&nbsp;        ObjectReader objectReader = reader.getObjectReader(Object.class);</b>
&nbsp;
<b class="nc">&nbsp;        Object object = objectReader.readJSONBObject(reader, null, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static JSONObject parseObject(byte[] jsonbBytes) {
<b class="nc">&nbsp;        JSONReader.Context context = new JSONReader.Context(JSONFactory.getDefaultObjectReaderProvider());</b>
&nbsp;        JSONReader reader;
<b class="nc">&nbsp;        if (UNSAFE_SUPPORT) {</b>
<b class="nc">&nbsp;            reader = new JSONReaderJSONBUF(</b>
&nbsp;                    context,
&nbsp;                    jsonbBytes,
&nbsp;                    0,
&nbsp;                    jsonbBytes.length);
&nbsp;        } else {
<b class="nc">&nbsp;            reader = new JSONReaderJSONB(</b>
&nbsp;                    context,
&nbsp;                    jsonbBytes,
&nbsp;                    0,
&nbsp;                    jsonbBytes.length);
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        JSONObject object = (JSONObject) reader.readObject();</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static JSONObject parseObject(byte[] jsonbBytes, JSONReader.Feature... features) {
<b class="nc">&nbsp;        JSONReader.Context context = new JSONReader.Context(JSONFactory.getDefaultObjectReaderProvider());</b>
<b class="nc">&nbsp;        context.config(features);</b>
&nbsp;
<b class="nc">&nbsp;        JSONReader reader = new JSONReaderJSONB(</b>
&nbsp;                context,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length);
&nbsp;
<b class="nc">&nbsp;        JSONObject object = (JSONObject) reader.readObject();</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static JSONArray parseArray(byte[] jsonbBytes) {
<b class="nc">&nbsp;        JSONReader.Context context = new JSONReader.Context(JSONFactory.getDefaultObjectReaderProvider());</b>
<b class="nc">&nbsp;        JSONReader reader = new JSONReaderJSONB(</b>
&nbsp;                context,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length);
<b class="nc">&nbsp;        JSONArray array = (JSONArray) reader.readArray();</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(array);</b>
&nbsp;        }
<b class="nc">&nbsp;        return array;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; List&lt;T&gt; parseArray(byte[] jsonbBytes, Type type) {
<b class="nc">&nbsp;        if (jsonbBytes == null || jsonbBytes.length == 0) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Type paramType = new ParameterizedTypeImpl(</b>
&nbsp;                new Type[]{type}, null, List.class
&nbsp;        );
&nbsp;
<b class="nc">&nbsp;        try (JSONReader reader = JSONReader.ofJSONB(jsonbBytes)) {</b>
<b class="nc">&nbsp;            List&lt;T&gt; list = reader.read(paramType);</b>
<b class="nc">&nbsp;            if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                reader.handleResolveTasks(list);</b>
&nbsp;            }
<b class="nc">&nbsp;            return list;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; List&lt;T&gt; parseArray(byte[] jsonbBytes, Type type, JSONReader.Feature... features) {
<b class="nc">&nbsp;        if (jsonbBytes == null || jsonbBytes.length == 0) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Type paramType = new ParameterizedTypeImpl(</b>
&nbsp;                new Type[]{type}, null, List.class
&nbsp;        );
&nbsp;
<b class="nc">&nbsp;        try (JSONReader reader = JSONReader.ofJSONB(jsonbBytes, features)) {</b>
<b class="nc">&nbsp;            reader.context.config(features);</b>
<b class="nc">&nbsp;            List&lt;T&gt; list = reader.read(paramType);</b>
<b class="nc">&nbsp;            if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                reader.handleResolveTasks(list);</b>
&nbsp;            }
<b class="nc">&nbsp;            return list;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; List&lt;T&gt; parseArray(byte[] jsonbBytes, Type... types) {
<b class="nc">&nbsp;        if (jsonbBytes == null || jsonbBytes.length == 0) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        try (JSONReader reader = JSONReader.ofJSONB(jsonbBytes)) {</b>
<b class="nc">&nbsp;            List&lt;T&gt; list = reader.readList(types);</b>
<b class="nc">&nbsp;            if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                reader.handleResolveTasks(list);</b>
&nbsp;            }
<b class="nc">&nbsp;            return list;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; List&lt;T&gt; parseArray(byte[] jsonbBytes, Type[] types, JSONReader.Feature... features) {
<b class="nc">&nbsp;        if (jsonbBytes == null || jsonbBytes.length == 0) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        try (JSONReader reader = JSONReader.ofJSONB(jsonbBytes, features)) {</b>
<b class="nc">&nbsp;            reader.context.config(features);</b>
<b class="nc">&nbsp;            List&lt;T&gt; list = reader.readList(types);</b>
<b class="nc">&nbsp;            if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                reader.handleResolveTasks(list);</b>
&nbsp;            }
<b class="nc">&nbsp;            return list;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, Class&lt;T&gt; objectClass) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider);</b>
<b class="nc">&nbsp;        try (JSONReader jsonReader = UNSAFE_SUPPORT</b>
&nbsp;                ? new JSONReaderJSONBUF(
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;                : new JSONReaderJSONB(
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;        ) {
&nbsp;            Object object;
<b class="nc">&nbsp;            if (objectClass == Object.class) {</b>
<b class="nc">&nbsp;                object = jsonReader.readAny();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                ObjectReader objectReader = provider.getObjectReader(objectClass);</b>
<b class="nc">&nbsp;                object = objectReader.readJSONBObject(jsonReader, objectClass, null, 0);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                jsonReader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return (T) object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, Type objectType) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider);</b>
<b class="nc">&nbsp;        JSONReader jsonReader = new JSONReaderJSONB(</b>
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length);
&nbsp;
<b class="nc">&nbsp;        ObjectReader objectReader = provider.getObjectReader(objectType);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(jsonReader, objectType, null, 0);</b>
<b class="nc">&nbsp;        if (jsonReader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            jsonReader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, Type... types) {
<b class="nc">&nbsp;        return parseObject(jsonbBytes, new MultiType(types));</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, Type objectType, SymbolTable symbolTable) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider, symbolTable);</b>
<b class="nc">&nbsp;        JSONReader reader = new JSONReaderJSONB(</b>
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length);
&nbsp;
<b class="nc">&nbsp;        ObjectReader objectReader = provider.getObjectReader(objectType);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, objectType, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            byte[] jsonbBytes,
&nbsp;            Type objectType,
&nbsp;            SymbolTable symbolTable,
&nbsp;            JSONReader.Feature... features) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider, symbolTable);</b>
&nbsp;
<b class="nc">&nbsp;        try (JSONReader reader = UNSAFE_SUPPORT</b>
&nbsp;                ? new JSONReaderJSONBUF(
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;                : new JSONReaderJSONB(
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)) {
<b class="nc">&nbsp;            for (JSONReader.Feature feature : features) {</b>
<b class="nc">&nbsp;                ctx.features |= feature.mask;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            boolean fieldBased = (ctx.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;            ObjectReader objectReader = provider.getObjectReader(objectType, fieldBased);</b>
&nbsp;
<b class="nc">&nbsp;            T object = (T) objectReader.readJSONBObject(reader, objectType, null, 0);</b>
<b class="nc">&nbsp;            if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                reader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            byte[] jsonbBytes,
&nbsp;            Class&lt;T&gt; objectClass,
&nbsp;            Filter filter,
&nbsp;            JSONReader.Feature... features) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
<b class="nc">&nbsp;        JSONReader.Context context = new JSONReader.Context(provider);</b>
<b class="nc">&nbsp;        context.config(filter, features);</b>
&nbsp;
<b class="nc">&nbsp;        try (JSONReader jsonReader = new JSONReaderJSONB(</b>
&nbsp;                context,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;        ) {
<b class="nc">&nbsp;            for (JSONReader.Feature feature : features) {</b>
<b class="nc">&nbsp;                context.features |= feature.mask;</b>
&nbsp;            }
&nbsp;
&nbsp;            Object object;
<b class="nc">&nbsp;            if (objectClass == Object.class) {</b>
&nbsp;                ObjectReader autoTypeObjectReader;
<b class="nc">&nbsp;                byte type = jsonReader.getType();</b>
<b class="nc">&nbsp;                if (type == BC_TYPED_ANY) {</b>
<b class="nc">&nbsp;                    autoTypeObjectReader = jsonReader.checkAutoType(Object.class, 0, 0);</b>
<b class="nc">&nbsp;                    object = autoTypeObjectReader.readJSONBObject(jsonReader, objectClass, null, context.features);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    object = jsonReader.readAny();</b>
&nbsp;                }
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                boolean fieldBased = (context.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;                ObjectReader objectReader = provider.getObjectReader(objectClass, fieldBased);</b>
<b class="nc">&nbsp;                object = objectReader.readJSONBObject(jsonReader, objectClass, null, 0);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                jsonReader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return (T) object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            byte[] jsonbBytes,
&nbsp;            Type objectType,
&nbsp;            SymbolTable symbolTable,
&nbsp;            Filter[] filters,
&nbsp;            JSONReader.Feature... features) {
<b class="nc">&nbsp;        if (jsonbBytes == null || jsonbBytes.length == 0) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
<b class="nc">&nbsp;        JSONReader.Context context = new JSONReader.Context(provider, symbolTable);</b>
<b class="nc">&nbsp;        context.config(filters, features);</b>
&nbsp;
<b class="nc">&nbsp;        try (JSONReader jsonReader = new JSONReaderJSONB(</b>
&nbsp;                context,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;        ) {
<b class="nc">&nbsp;            for (JSONReader.Feature feature : features) {</b>
<b class="nc">&nbsp;                context.features |= feature.mask;</b>
&nbsp;            }
&nbsp;
&nbsp;            Object object;
<b class="nc">&nbsp;            if (objectType == Object.class) {</b>
&nbsp;                ObjectReader autoTypeObjectReader;
<b class="nc">&nbsp;                byte type = jsonReader.getType();</b>
<b class="nc">&nbsp;                if (type == BC_TYPED_ANY) {</b>
<b class="nc">&nbsp;                    autoTypeObjectReader = jsonReader.checkAutoType(Object.class, 0, 0);</b>
<b class="nc">&nbsp;                    object = autoTypeObjectReader.readJSONBObject(jsonReader, objectType, null, context.features);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    object = jsonReader.readAny();</b>
&nbsp;                }
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                boolean fieldBased = (context.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;                ObjectReader objectReader = provider.getObjectReader(objectType, fieldBased);</b>
<b class="nc">&nbsp;                object = objectReader.readJSONBObject(jsonReader, objectType, null, 0);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                jsonReader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return (T) object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @since 2.0.30
&nbsp;     */
&nbsp;    static &lt;T&gt; T copy(T object, JSONWriter.Feature... features) {
<b class="nc">&nbsp;        return JSON.copy(object, features);</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, TypeReference typeReference, JSONReader.Feature... features) {
<b class="nc">&nbsp;        return parseObject(jsonbBytes, typeReference.getType(), features);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @since 2.0.30
&nbsp;     */
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            InputStream in,
&nbsp;            Class objectClass,
&nbsp;            JSONReader.Feature... features
&nbsp;    ) throws IOException {
<b class="nc">&nbsp;        JSONReader.Context context = JSONFactory.createReadContext(features);</b>
<b class="nc">&nbsp;        return parseObject(in, objectClass, context);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @since 2.0.30
&nbsp;     */
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            InputStream in,
&nbsp;            Type objectType,
&nbsp;            JSONReader.Feature... features
&nbsp;    ) throws IOException {
<b class="nc">&nbsp;        JSONReader.Context context = JSONFactory.createReadContext(features);</b>
<b class="nc">&nbsp;        return parseObject(in, objectType, context);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @since 2.0.30
&nbsp;     */
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            InputStream in,
&nbsp;            Type objectType,
&nbsp;            JSONReader.Context ctx
&nbsp;    ) throws IOException {
<b class="nc">&nbsp;        try (JSONReader jsonReader = UNSAFE_SUPPORT</b>
&nbsp;                ? new JSONReaderJSONBUF(ctx, in)
&nbsp;                : new JSONReaderJSONB(ctx, in)
&nbsp;        ) {
&nbsp;            Object object;
<b class="nc">&nbsp;            if (objectType == Object.class) {</b>
<b class="nc">&nbsp;                object = jsonReader.readAny();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                ObjectReader objectReader = ctx.getObjectReader(objectType);</b>
<b class="nc">&nbsp;                object = objectReader.readJSONBObject(jsonReader, objectType, null, 0);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                jsonReader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return (T) object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @since 2.0.30
&nbsp;     */
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            InputStream in,
&nbsp;            Class objectClass,
&nbsp;            JSONReader.Context ctx
&nbsp;    ) throws IOException {
<b class="nc">&nbsp;        try (JSONReader jsonReader = UNSAFE_SUPPORT</b>
&nbsp;                ? new JSONReaderJSONBUF(ctx, in)
&nbsp;                : new JSONReaderJSONB(ctx, in)
&nbsp;        ) {
&nbsp;            Object object;
<b class="nc">&nbsp;            if (objectClass == Object.class) {</b>
<b class="nc">&nbsp;                object = jsonReader.readAny();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                ObjectReader objectReader = ctx.getObjectReader(objectClass);</b>
<b class="nc">&nbsp;                object = objectReader.readJSONBObject(jsonReader, objectClass, null, 0);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                jsonReader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return (T) object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            InputStream in,
&nbsp;            int length,
&nbsp;            Type objectType,
&nbsp;            JSONReader.Context context
&nbsp;    ) throws IOException {
<b class="nc">&nbsp;        int cacheIndex = System.identityHashCode(Thread.currentThread()) &amp; (CACHE_ITEMS.length - 1);</b>
<b class="nc">&nbsp;        final JSONFactory.CacheItem cacheItem = CACHE_ITEMS[cacheIndex];</b>
<b class="nc">&nbsp;        byte[] bytes = BYTES_UPDATER.getAndSet(cacheItem, null);</b>
<b class="nc">&nbsp;        if (bytes == null) {</b>
<b class="nc">&nbsp;            bytes = new byte[8192];</b>
&nbsp;        }
&nbsp;
&nbsp;        try {
<b class="nc">&nbsp;            if (bytes.length &lt; length) {</b>
<b class="nc">&nbsp;                bytes = new byte[length];</b>
&nbsp;            }
<b class="nc">&nbsp;            int read = in.read(bytes, 0, length);</b>
<b class="nc">&nbsp;            if (read != length) {</b>
<b class="nc">&nbsp;                throw new IllegalArgumentException(&quot;deserialize failed. expected read length: &quot; + length + &quot; but actual read: &quot; + read);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return parseObject(bytes, 0, length, objectType, context);</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            BYTES_UPDATER.lazySet(cacheItem, bytes);</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            InputStream in,
&nbsp;            int length,
&nbsp;            Type objectType,
&nbsp;            JSONReader.Feature... features
&nbsp;    ) throws IOException {
<b class="nc">&nbsp;        int cacheIndex = System.identityHashCode(Thread.currentThread()) &amp; (CACHE_ITEMS.length - 1);</b>
<b class="nc">&nbsp;        final JSONFactory.CacheItem cacheItem = CACHE_ITEMS[cacheIndex];</b>
<b class="nc">&nbsp;        byte[] bytes = BYTES_UPDATER.getAndSet(cacheItem, null);</b>
<b class="nc">&nbsp;        if (bytes == null) {</b>
<b class="nc">&nbsp;            bytes = new byte[8192];</b>
&nbsp;        }
&nbsp;        try {
<b class="nc">&nbsp;            if (bytes.length &lt; length) {</b>
<b class="nc">&nbsp;                bytes = new byte[length];</b>
&nbsp;            }
<b class="nc">&nbsp;            int read = in.read(bytes, 0, length);</b>
<b class="nc">&nbsp;            if (read != length) {</b>
<b class="nc">&nbsp;                throw new IllegalArgumentException(&quot;deserialize failed. expected read length: &quot; + length + &quot; but actual read: &quot; + read);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return parseObject(bytes, 0, length, objectType, features);</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            BYTES_UPDATER.lazySet(cacheItem, bytes);</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, Class&lt;T&gt; objectClass, JSONReader.Feature... features) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider);</b>
&nbsp;
<b class="nc">&nbsp;        try (JSONReader jsonReader = UNSAFE_SUPPORT</b>
&nbsp;                ? new JSONReaderJSONBUF(
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;                : new JSONReaderJSONB(
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;        ) {
<b class="nc">&nbsp;            for (JSONReader.Feature feature : features) {</b>
<b class="nc">&nbsp;                ctx.features |= feature.mask;</b>
&nbsp;            }
&nbsp;
&nbsp;            Object object;
<b class="nc">&nbsp;            if (objectClass == Object.class) {</b>
&nbsp;                ObjectReader autoTypeObjectReader;
<b class="nc">&nbsp;                byte type = jsonReader.getType();</b>
<b class="nc">&nbsp;                if (type == BC_TYPED_ANY) {</b>
<b class="nc">&nbsp;                    autoTypeObjectReader = jsonReader.checkAutoType(Object.class, 0, 0);</b>
<b class="nc">&nbsp;                    object = autoTypeObjectReader.readJSONBObject(jsonReader, objectClass, null, ctx.features);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    object = jsonReader.readAny();</b>
&nbsp;                }
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                boolean fieldBased = (ctx.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;                ObjectReader objectReader = provider.getObjectReader(objectClass, fieldBased);</b>
<b class="nc">&nbsp;                if ((ctx.features &amp; JSONReader.Feature.SupportArrayToBean.mask) != 0</b>
<b class="nc">&nbsp;                        &amp;&amp; jsonReader.isArray()</b>
&nbsp;                        &amp;&amp; objectReader instanceof ObjectReaderBean
&nbsp;                ) {
<b class="nc">&nbsp;                    object = objectReader.readArrayMappingJSONBObject(jsonReader, objectClass, null, 0);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    object = objectReader.readJSONBObject(jsonReader, objectClass, null, 0);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                jsonReader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return (T) object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, Class&lt;T&gt; objectClass, JSONReader.Context context) {
<b class="nc">&nbsp;        try (JSONReader jsonReader = UNSAFE_SUPPORT</b>
&nbsp;                ? new JSONReaderJSONBUF(
&nbsp;                context,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;                : new JSONReaderJSONB(
&nbsp;                context,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length)
&nbsp;        ) {
&nbsp;            Object object;
<b class="nc">&nbsp;            if (objectClass == Object.class) {</b>
&nbsp;                ObjectReader autoTypeObjectReader;
<b class="nc">&nbsp;                byte type = jsonReader.getType();</b>
<b class="nc">&nbsp;                if (type == BC_TYPED_ANY) {</b>
<b class="nc">&nbsp;                    autoTypeObjectReader = jsonReader.checkAutoType(Object.class, 0, 0);</b>
<b class="nc">&nbsp;                    object = autoTypeObjectReader.readJSONBObject(jsonReader, objectClass, null, context.features);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    object = jsonReader.readAny();</b>
&nbsp;                }
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                boolean fieldBased = (context.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;                ObjectReader objectReader = context.provider.getObjectReader(objectClass, fieldBased);</b>
<b class="nc">&nbsp;                if ((context.features &amp; JSONReader.Feature.SupportArrayToBean.mask) != 0</b>
<b class="nc">&nbsp;                        &amp;&amp; jsonReader.isArray()</b>
&nbsp;                        &amp;&amp; objectReader instanceof ObjectReaderBean
&nbsp;                ) {
<b class="nc">&nbsp;                    object = objectReader.readArrayMappingJSONBObject(jsonReader, objectClass, null, 0);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    object = objectReader.readJSONBObject(jsonReader, objectClass, null, 0);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                jsonReader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return (T) object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, Type objectClass, JSONReader.Feature... features) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider);</b>
<b class="nc">&nbsp;        JSONReader reader = new JSONReaderJSONB(</b>
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                0,
&nbsp;                jsonbBytes.length);
&nbsp;
<b class="nc">&nbsp;        for (JSONReader.Feature feature : features) {</b>
<b class="nc">&nbsp;            ctx.features |= feature.mask;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        boolean fieldBased = (ctx.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;        ObjectReader objectReader = provider.getObjectReader(objectClass, fieldBased);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, objectClass, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, int off, int len, Class&lt;T&gt; objectClass) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
&nbsp;
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider);</b>
&nbsp;
<b class="nc">&nbsp;        JSONReader reader = new JSONReaderJSONB(</b>
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                off,
&nbsp;                len);
&nbsp;
<b class="nc">&nbsp;        boolean fieldBased = (ctx.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;        ObjectReader objectReader = provider.getObjectReader(objectClass, fieldBased);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, objectClass, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, int off, int len, Type type) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
&nbsp;
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider);</b>
&nbsp;
<b class="nc">&nbsp;        JSONReader reader = new JSONReaderJSONB(</b>
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                off,
&nbsp;                len);
&nbsp;
<b class="nc">&nbsp;        boolean fieldBased = (ctx.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;        ObjectReader objectReader = provider.getObjectReader(type, fieldBased);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, type, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            byte[] jsonbBytes,
&nbsp;            int off,
&nbsp;            int len,
&nbsp;            Class&lt;T&gt; objectClass,
&nbsp;            JSONReader.Feature... features
&nbsp;    ) {
<b class="nc">&nbsp;        ObjectReaderProvider provider = JSONFactory.getDefaultObjectReaderProvider();</b>
&nbsp;
<b class="nc">&nbsp;        JSONReader.Context ctx = new JSONReader.Context(provider);</b>
&nbsp;
<b class="nc">&nbsp;        for (JSONReader.Feature feature : features) {</b>
<b class="nc">&nbsp;            ctx.features |= feature.mask;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        JSONReader reader = new JSONReaderJSONB(</b>
&nbsp;                ctx,
&nbsp;                jsonbBytes,
&nbsp;                off,
&nbsp;                len);
&nbsp;
<b class="nc">&nbsp;        boolean fieldBased = (ctx.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;        ObjectReader objectReader = provider.getObjectReader(objectClass, fieldBased);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, objectClass, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            byte[] jsonbBytes,
&nbsp;            int off,
&nbsp;            int len,
&nbsp;            Type objectType,
&nbsp;            JSONReader.Context ctx
&nbsp;    ) {
<b class="nc">&nbsp;        try (JSONReader reader = new JSONReaderJSONB(ctx, jsonbBytes, off, len)) {</b>
<b class="nc">&nbsp;            boolean fieldBased = (ctx.features &amp; JSONReader.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;            ObjectReader objectReader = ctx.provider.getObjectReader(objectType, fieldBased);</b>
&nbsp;
<b class="nc">&nbsp;            T object = (T) objectReader.readJSONBObject(reader, objectType, null, 0);</b>
<b class="nc">&nbsp;            if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                reader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, int off, int len, Type objectType, JSONReader.Feature... features) {
<b class="nc">&nbsp;        try (JSONReader reader = JSONReader.ofJSONB(jsonbBytes, off, len)) {</b>
<b class="nc">&nbsp;            reader.getContext().config(features);</b>
<b class="nc">&nbsp;            ObjectReader objectReader = reader.getObjectReader(objectType);</b>
&nbsp;
<b class="nc">&nbsp;            T object = (T) objectReader.readJSONBObject(reader, objectType, null, 0);</b>
<b class="nc">&nbsp;            if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;                reader.handleResolveTasks(object);</b>
&nbsp;            }
<b class="nc">&nbsp;            return object;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, int off, int len, Class&lt;T&gt; objectClass, SymbolTable symbolTable) {
<b class="nc">&nbsp;        JSONReader reader = JSONReader.ofJSONB(jsonbBytes, off, len, symbolTable);</b>
<b class="nc">&nbsp;        ObjectReader objectReader = reader.getObjectReader(objectClass);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, objectClass, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes, int off, int len, Type objectClass, SymbolTable symbolTable) {
<b class="nc">&nbsp;        JSONReader reader = JSONReader.ofJSONB(jsonbBytes, off, len, symbolTable);</b>
<b class="nc">&nbsp;        ObjectReader objectReader = reader.getObjectReader(objectClass);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, objectClass, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(byte[] jsonbBytes,
&nbsp;                             int off,
&nbsp;                             int len,
&nbsp;                             Class&lt;T&gt; objectClass,
&nbsp;                             SymbolTable symbolTable,
&nbsp;                             JSONReader.Feature... features) {
<b class="nc">&nbsp;        JSONReader reader = JSONReader.ofJSONB(jsonbBytes, off, len, symbolTable);</b>
<b class="nc">&nbsp;        reader.getContext().config(features);</b>
<b class="nc">&nbsp;        ObjectReader objectReader = reader.getObjectReader(objectClass);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, objectClass, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static &lt;T&gt; T parseObject(
&nbsp;            byte[] jsonbBytes,
&nbsp;            int off,
&nbsp;            int len,
&nbsp;            Type objectClass,
&nbsp;            SymbolTable symbolTable,
&nbsp;            JSONReader.Feature... features) {
<b class="nc">&nbsp;        JSONReader reader = JSONReader.ofJSONB(jsonbBytes, off, len, symbolTable);</b>
<b class="nc">&nbsp;        reader.getContext().config(features);</b>
<b class="nc">&nbsp;        ObjectReader objectReader = reader.getObjectReader(objectClass);</b>
&nbsp;
<b class="nc">&nbsp;        T object = (T) objectReader.readJSONBObject(reader, objectClass, null, 0);</b>
<b class="nc">&nbsp;        if (reader.resolveTasks != null) {</b>
<b class="nc">&nbsp;            reader.handleResolveTasks(object);</b>
&nbsp;        }
<b class="nc">&nbsp;        return object;</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(String str) {
<b class="nc">&nbsp;        if (str == null) {</b>
<b class="nc">&nbsp;            return new byte[]{BC_NULL};</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (JVM_VERSION == 8) {</b>
<b class="nc">&nbsp;            char[] chars = JDKUtils.getCharArray(str);</b>
<b class="nc">&nbsp;            int strlen = chars.length;</b>
<b class="nc">&nbsp;            if (strlen &lt;= STR_ASCII_FIX_LEN) {</b>
<b class="nc">&nbsp;                boolean ascii = true;</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; strlen; ++i) {</b>
<b class="nc">&nbsp;                    if (chars[i] &gt; 0x007F) {</b>
<b class="nc">&nbsp;                        ascii = false;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (ascii) {</b>
<b class="nc">&nbsp;                    byte[] bytes = new byte[chars.length + 1];</b>
<b class="nc">&nbsp;                    bytes[0] = (byte) (strlen + BC_STR_ASCII_FIX_MIN);</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; strlen; ++i) {</b>
<b class="nc">&nbsp;                        bytes[i + 1] = (byte) chars[i];</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return bytes;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        } else if (STRING_VALUE != null) {</b>
<b class="nc">&nbsp;            int coder = STRING_CODER.applyAsInt(str);</b>
<b class="nc">&nbsp;            if (coder == 0) {</b>
<b class="nc">&nbsp;                byte[] value = STRING_VALUE.apply(str);</b>
<b class="nc">&nbsp;                int strlen = value.length;</b>
<b class="nc">&nbsp;                if (strlen &lt;= STR_ASCII_FIX_LEN) {</b>
<b class="nc">&nbsp;                    byte[] bytes = new byte[value.length + 1];</b>
<b class="nc">&nbsp;                    bytes[0] = (byte) (strlen + BC_STR_ASCII_FIX_MIN);</b>
<b class="nc">&nbsp;                    System.arraycopy(value, 0, bytes, 1, value.length);</b>
<b class="nc">&nbsp;                    return bytes;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        try (JSONWriter writer = new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider),
&nbsp;                null
&nbsp;        )) {
<b class="nc">&nbsp;            writer.writeString(str);</b>
<b class="nc">&nbsp;            return writer.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(String str, Charset charset) {
<b class="nc">&nbsp;        if (str == null) {</b>
<b class="nc">&nbsp;            return new byte[]{BC_NULL};</b>
&nbsp;        }
&nbsp;
&nbsp;        final byte type;
<b class="nc">&nbsp;        if (charset == StandardCharsets.UTF_16) {</b>
<b class="nc">&nbsp;            type = BC_STR_UTF16;</b>
<b class="nc">&nbsp;        } else if (charset == StandardCharsets.UTF_16BE) {</b>
<b class="nc">&nbsp;            type = BC_STR_UTF16BE;</b>
<b class="nc">&nbsp;        } else if (charset == StandardCharsets.UTF_16LE) {</b>
<b class="nc">&nbsp;            type = BC_STR_UTF16LE;</b>
<b class="nc">&nbsp;        } else if (charset == StandardCharsets.UTF_8) {</b>
<b class="nc">&nbsp;            type = BC_STR_UTF8;</b>
<b class="nc">&nbsp;        } else if (charset == StandardCharsets.US_ASCII || charset == StandardCharsets.ISO_8859_1) {</b>
<b class="nc">&nbsp;            type = BC_STR_ASCII;</b>
<b class="nc">&nbsp;        } else if (charset != null &amp;&amp; &quot;GB18030&quot;.equals(charset.name())) { // GraalVM support</b>
<b class="nc">&nbsp;            type = BC_STR_GB18030;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return toBytes(str);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        byte[] utf16 = str.getBytes(charset);</b>
<b class="nc">&nbsp;        int byteslen = 2 + utf16.length;</b>
<b class="nc">&nbsp;        if (utf16.length &lt;= BC_INT32_NUM_MAX) {</b>
<b class="nc">&nbsp;            byteslen += 0;</b>
<b class="nc">&nbsp;        } else if (utf16.length &lt;= INT32_BYTE_MAX) {</b>
<b class="nc">&nbsp;            byteslen += 1;</b>
<b class="nc">&nbsp;        } else if (utf16.length &lt;= INT32_SHORT_MAX) {</b>
<b class="nc">&nbsp;            byteslen += 2;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            byteslen += 4;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        byte[] bytes = new byte[byteslen];</b>
<b class="nc">&nbsp;        bytes[0] = type;</b>
<b class="nc">&nbsp;        int off = 1;</b>
<b class="nc">&nbsp;        off += writeInt(bytes, off, utf16.length);</b>
<b class="nc">&nbsp;        System.arraycopy(utf16, 0, bytes, off, utf16.length);</b>
<b class="nc">&nbsp;        return bytes;</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(Object object) {
<b class="nc">&nbsp;        try (JSONWriter writer = new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider),
&nbsp;                null
&nbsp;        )) {
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                writer.writeNull();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = object.getClass();</b>
<b class="nc">&nbsp;                JSONWriter.Context context = writer.context;</b>
<b class="nc">&nbsp;                boolean fieldBased = (context.features &amp; JSONWriter.Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;                ObjectWriter objectWriter = context.provider.getObjectWriter(valueClass, valueClass, fieldBased);</b>
<b class="nc">&nbsp;                objectWriter.writeJSONB(writer, object, null, null, 0);</b>
&nbsp;            }
<b class="nc">&nbsp;            return writer.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(Object object, JSONWriter.Context context) {
<b class="nc">&nbsp;        if (context == null) {</b>
<b class="nc">&nbsp;            context = JSONFactory.createWriteContext();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        try (JSONWriter writer = new JSONWriterJSONB(context, null)) {</b>
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                writer.writeNull();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                writer.rootObject = object;</b>
<b class="nc">&nbsp;                writer.path = JSONWriter.Path.ROOT;</b>
&nbsp;
<b class="nc">&nbsp;                boolean fieldBased = (context.features &amp; JSONWriter.Feature.FieldBased.mask) != 0;</b>
&nbsp;
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = object.getClass();</b>
<b class="nc">&nbsp;                ObjectWriter objectWriter = context.provider.getObjectWriter(valueClass, valueClass, fieldBased);</b>
<b class="nc">&nbsp;                if ((context.features &amp; JSONWriter.Feature.BeanToArray.mask) != 0) {</b>
<b class="nc">&nbsp;                    objectWriter.writeArrayMappingJSONB(writer, object, null, null, 0);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    objectWriter.writeJSONB(writer, object, null, null, 0);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return writer.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(Object object, SymbolTable symbolTable) {
<b class="nc">&nbsp;        try (JSONWriter writer = new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider),
&nbsp;                symbolTable
&nbsp;        )) {
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                writer.writeNull();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                writer.setRootObject(object);</b>
&nbsp;
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = object.getClass();</b>
<b class="nc">&nbsp;                ObjectWriter objectWriter = writer.getObjectWriter(valueClass, valueClass);</b>
<b class="nc">&nbsp;                objectWriter.writeJSONB(writer, object, null, null, 0);</b>
&nbsp;            }
<b class="nc">&nbsp;            return writer.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(Object object, SymbolTable symbolTable, JSONWriter.Feature... features) {
<b class="nc">&nbsp;        try (JSONWriter writer = new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider, features),
&nbsp;                symbolTable
&nbsp;        )) {
<b class="nc">&nbsp;            JSONWriter.Context ctx = writer.context;</b>
&nbsp;
<b class="nc">&nbsp;            ctx.config(features);</b>
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                writer.writeNull();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                writer.setRootObject(object);</b>
&nbsp;
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = object.getClass();</b>
&nbsp;
<b class="nc">&nbsp;                boolean fieldBased = (ctx.features &amp; JSONWriter.Feature.FieldBased.mask) != 0;</b>
&nbsp;
<b class="nc">&nbsp;                ObjectWriter objectWriter = ctx.provider.getObjectWriter(valueClass, valueClass, fieldBased);</b>
<b class="nc">&nbsp;                if ((ctx.features &amp; JSONWriter.Feature.BeanToArray.mask) != 0) {</b>
<b class="nc">&nbsp;                    objectWriter.writeArrayMappingJSONB(writer, object, null, null, 0);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    objectWriter.writeJSONB(writer, object, null, null, 0);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return writer.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(Object object, SymbolTable symbolTable, Filter[] filters, JSONWriter.Feature... features) {
<b class="nc">&nbsp;        try (JSONWriter writer = new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider, features),
&nbsp;                symbolTable
&nbsp;        )) {
<b class="nc">&nbsp;            JSONWriter.Context ctx = writer.context;</b>
&nbsp;
<b class="nc">&nbsp;            ctx.config(features);</b>
<b class="nc">&nbsp;            ctx.configFilter(filters);</b>
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                writer.writeNull();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                writer.setRootObject(object);</b>
&nbsp;
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = object.getClass();</b>
&nbsp;
<b class="nc">&nbsp;                boolean fieldBased = (ctx.features &amp; JSONWriter.Feature.FieldBased.mask) != 0;</b>
&nbsp;
<b class="nc">&nbsp;                ObjectWriter objectWriter = ctx.provider.getObjectWriter(valueClass, valueClass, fieldBased);</b>
<b class="nc">&nbsp;                if ((ctx.features &amp; JSONWriter.Feature.BeanToArray.mask) != 0) {</b>
<b class="nc">&nbsp;                    objectWriter.writeArrayMappingJSONB(writer, object, null, null, 0);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    objectWriter.writeJSONB(writer, object, null, null, 0);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return writer.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] toBytes(Object object, JSONWriter.Feature... features) {
<b class="nc">&nbsp;        try (JSONWriter writer = new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider, features),
&nbsp;                null
&nbsp;        )) {
<b class="nc">&nbsp;            JSONWriter.Context context = writer.context;</b>
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                writer.writeNull();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                writer.rootObject = object;</b>
<b class="nc">&nbsp;                writer.path = JSONWriter.Path.ROOT;</b>
&nbsp;
<b class="nc">&nbsp;                boolean fieldBased = (context.features &amp; JSONWriter.Feature.FieldBased.mask) != 0;</b>
&nbsp;
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = object.getClass();</b>
<b class="nc">&nbsp;                ObjectWriter objectWriter = context.provider.getObjectWriter(valueClass, valueClass, fieldBased);</b>
<b class="nc">&nbsp;                if ((context.features &amp; JSONWriter.Feature.BeanToArray.mask) != 0) {</b>
<b class="nc">&nbsp;                    objectWriter.writeArrayMappingJSONB(writer, object, null, null, 0);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    objectWriter.writeJSONB(writer, object, null, null, 0);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return writer.getBytes();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    static SymbolTable symbolTable(String... names) {
<b class="nc">&nbsp;        return new JSONFactory.SymbolTableImpl(names);</b>
&nbsp;    }
&nbsp;
&nbsp;    static String toJSONString(byte[] jsonbBytes) {
<b class="nc">&nbsp;        return new JSONBDump(jsonbBytes, false)</b>
<b class="nc">&nbsp;                .toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @since 2.0.28
&nbsp;     */
&nbsp;    static String toJSONString(byte[] jsonbBytes, boolean raw) {
<b class="nc">&nbsp;        return new JSONBDump(jsonbBytes, raw)</b>
<b class="nc">&nbsp;                .toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    static String toJSONString(byte[] jsonbBytes, SymbolTable symbolTable) {
<b class="nc">&nbsp;        return new JSONBDump(jsonbBytes, symbolTable, false)</b>
<b class="nc">&nbsp;                .toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    static int writeTo(
&nbsp;            OutputStream out,
&nbsp;            Object object,
&nbsp;            JSONWriter.Feature... features) {
<b class="nc">&nbsp;        try (JSONWriter writer = JSONWriter.ofJSONB()) {</b>
<b class="nc">&nbsp;            writer.config(features);</b>
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                writer.writeNull();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                writer.setRootObject(object);</b>
&nbsp;
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = object.getClass();</b>
<b class="nc">&nbsp;                ObjectWriter objectWriter = writer.getObjectWriter(valueClass, valueClass);</b>
<b class="nc">&nbsp;                objectWriter.writeJSONB(writer, object, null, null, 0);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int len = writer.flushTo(out);</b>
<b class="nc">&nbsp;            return len;</b>
<b class="nc">&nbsp;        } catch (IOException e) {</b>
<b class="nc">&nbsp;            throw new JSONException(&quot;writeJSONString error&quot;, e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static byte[] fromJSONString(String str) {
<b class="nc">&nbsp;        return JSONB.toBytes(JSON.parse(str));</b>
&nbsp;    }
&nbsp;
&nbsp;    static byte[] fromJSONBytes(byte[] jsonUtf8Bytes) {
<b class="nc">&nbsp;        JSONReader reader = JSONReader.of(jsonUtf8Bytes);</b>
<b class="nc">&nbsp;        ObjectReader objectReader = reader.getObjectReader(Object.class);</b>
<b class="nc">&nbsp;        Object object = objectReader.readObject(reader, null, null, 0);</b>
<b class="nc">&nbsp;        return JSONB.toBytes(object);</b>
&nbsp;    }
&nbsp;
&nbsp;    static String typeName(byte type) {
<b class="nc">&nbsp;        switch (type) {</b>
&nbsp;            case BC_OBJECT:
<b class="nc">&nbsp;                return &quot;OBJECT &quot; + Integer.toString(type);</b>
&nbsp;            case BC_OBJECT_END:
<b class="nc">&nbsp;                return &quot;OBJECT_END &quot; + Integer.toString(type);</b>
&nbsp;            case BC_REFERENCE:
<b class="nc">&nbsp;                return &quot;REFERENCE &quot; + Integer.toString(type);</b>
&nbsp;            case BC_SYMBOL:
<b class="nc">&nbsp;                return &quot;SYMBOL &quot; + Integer.toString(type);</b>
&nbsp;            case BC_NULL:
<b class="nc">&nbsp;                return &quot;NULL &quot; + Integer.toString(type);</b>
&nbsp;            case BC_TRUE:
<b class="nc">&nbsp;                return &quot;TRUE &quot; + Integer.toString(type);</b>
&nbsp;            case BC_FALSE:
<b class="nc">&nbsp;                return &quot;FALSE &quot; + Integer.toString(type);</b>
&nbsp;            case BC_STR_UTF8:
<b class="nc">&nbsp;                return &quot;STR_UTF8 &quot; + Integer.toString(type);</b>
&nbsp;            case BC_STR_UTF16:
<b class="nc">&nbsp;                return &quot;STR_UTF16 &quot; + Integer.toString(type);</b>
&nbsp;            case BC_STR_UTF16LE:
<b class="nc">&nbsp;                return &quot;STR_UTF16LE &quot; + Integer.toString(type);</b>
&nbsp;            case BC_STR_UTF16BE:
<b class="nc">&nbsp;                return &quot;STR_UTF16BE &quot; + Integer.toString(type);</b>
&nbsp;            case BC_INT8:
<b class="nc">&nbsp;                return &quot;INT8 &quot; + Integer.toString(type);</b>
&nbsp;            case BC_INT16:
<b class="nc">&nbsp;                return &quot;INT16 &quot; + Integer.toString(type);</b>
&nbsp;            case BC_INT32:
<b class="nc">&nbsp;                return &quot;INT32 &quot; + Integer.toString(type);</b>
&nbsp;            case BC_INT64:
&nbsp;            case BC_INT64_INT:
<b class="nc">&nbsp;                return &quot;INT64 &quot; + Integer.toString(type);</b>
&nbsp;            case BC_FLOAT:
&nbsp;            case BC_FLOAT_INT:
<b class="nc">&nbsp;                return &quot;FLOAT &quot; + Integer.toString(type);</b>
&nbsp;            case BC_DOUBLE:
&nbsp;            case BC_DOUBLE_LONG:
&nbsp;            case BC_DOUBLE_NUM_0:
&nbsp;            case BC_DOUBLE_NUM_1:
<b class="nc">&nbsp;                return &quot;DOUBLE &quot; + Integer.toString(type);</b>
&nbsp;            case BC_BIGINT:
&nbsp;            case BC_BIGINT_LONG:
<b class="nc">&nbsp;                return &quot;BIGINT &quot; + Integer.toString(type);</b>
&nbsp;            case BC_DECIMAL:
&nbsp;            case BC_DECIMAL_LONG:
<b class="nc">&nbsp;                return &quot;DECIMAL &quot; + Integer.toString(type);</b>
&nbsp;            case Constants.BC_LOCAL_TIME:
<b class="nc">&nbsp;                return &quot;LOCAL_TIME &quot; + Integer.toString(type);</b>
&nbsp;            case BC_BINARY:
<b class="nc">&nbsp;                return &quot;BINARY &quot; + Integer.toString(type);</b>
&nbsp;            case Constants.BC_LOCAL_DATETIME:
<b class="nc">&nbsp;                return &quot;LOCAL_DATETIME &quot; + Integer.toString(type);</b>
&nbsp;            case BC_TIMESTAMP:
<b class="nc">&nbsp;                return &quot;TIMESTAMP &quot; + Integer.toString(type);</b>
&nbsp;            case BC_TIMESTAMP_MINUTES:
<b class="nc">&nbsp;                return &quot;TIMESTAMP_MINUTES &quot; + Integer.toString(type);</b>
&nbsp;            case BC_TIMESTAMP_SECONDS:
<b class="nc">&nbsp;                return &quot;TIMESTAMP_SECONDS &quot; + Integer.toString(type);</b>
&nbsp;            case BC_TIMESTAMP_MILLIS:
<b class="nc">&nbsp;                return &quot;TIMESTAMP_MILLIS &quot; + Integer.toString(type);</b>
&nbsp;            case BC_TIMESTAMP_WITH_TIMEZONE:
<b class="nc">&nbsp;                return &quot;TIMESTAMP_WITH_TIMEZONE &quot; + Integer.toString(type);</b>
&nbsp;            case Constants.BC_LOCAL_DATE:
<b class="nc">&nbsp;                return &quot;LOCAL_DATE &quot; + Integer.toString(type);</b>
&nbsp;            case BC_TYPED_ANY:
<b class="nc">&nbsp;                return &quot;TYPED_ANY &quot; + Integer.toString(type);</b>
&nbsp;            default:
<b class="nc">&nbsp;                if (type &gt;= BC_ARRAY_FIX_MIN &amp;&amp; type &lt;= BC_ARRAY) {</b>
<b class="nc">&nbsp;                    return &quot;ARRAY &quot; + Integer.toString(type);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (type &gt;= BC_STR_ASCII_FIX_MIN &amp;&amp; type &lt;= BC_STR_ASCII) {</b>
<b class="nc">&nbsp;                    return &quot;STR_ASCII &quot; + Integer.toString(type);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (type &gt;= BC_INT32_NUM_MIN &amp;&amp; type &lt;= BC_INT32_NUM_MAX) {</b>
<b class="nc">&nbsp;                    return &quot;INT32 &quot; + Integer.toString(type);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (type &gt;= BC_INT32_BYTE_MIN &amp;&amp; type &lt;= BC_INT32_BYTE_MAX) {</b>
<b class="nc">&nbsp;                    return &quot;INT32 &quot; + Integer.toString(type);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (type &gt;= BC_INT32_SHORT_MIN &amp;&amp; type &lt;= BC_INT32_SHORT_MAX) {</b>
<b class="nc">&nbsp;                    return &quot;INT32 &quot; + Integer.toString(type);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (type &gt;= BC_INT64_NUM_MIN &amp;&amp; type &lt;= BC_INT64_NUM_MAX) {</b>
<b class="nc">&nbsp;                    return &quot;INT64 &quot; + Integer.toString(type);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (type &gt;= BC_INT64_BYTE_MIN &amp;&amp; type &lt;= BC_INT64_BYTE_MAX) {</b>
<b class="nc">&nbsp;                    return &quot;INT64 &quot; + Integer.toString(type);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (type &gt;= BC_INT64_SHORT_MIN &amp;&amp; type &lt;= BC_INT64_SHORT_MAX) {</b>
<b class="nc">&nbsp;                    return &quot;INT64 &quot; + Integer.toString(type);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return Integer.toString(type);</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-09 21:33</div>
</div>
</body>
</html>
