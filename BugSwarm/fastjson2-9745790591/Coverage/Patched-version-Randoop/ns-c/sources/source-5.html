


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TypeUtils</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.alibaba.fastjson.util</a>
</div>

<h1>Coverage Summary for Class: TypeUtils (com.alibaba.fastjson.util)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TypeUtils</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/55)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/792)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TypeUtils$MethodInheritanceComparator</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/57)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/805)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright 1999-2017 Alibaba Group.
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *      http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package com.alibaba.fastjson.util;
&nbsp;
&nbsp;import com.alibaba.fastjson.JSON;
&nbsp;import com.alibaba.fastjson.JSONException;
&nbsp;import com.alibaba.fastjson.JSONObject;
&nbsp;import com.alibaba.fastjson.PropertyNamingStrategy;
&nbsp;import com.alibaba.fastjson.annotation.JSONField;
&nbsp;import com.alibaba.fastjson.annotation.JSONType;
&nbsp;import com.alibaba.fastjson.parser.Feature;
&nbsp;import com.alibaba.fastjson.parser.ParserConfig;
&nbsp;import com.alibaba.fastjson.serializer.SerializerFeature;
&nbsp;import com.alibaba.fastjson2.JSONFactory;
&nbsp;import com.alibaba.fastjson2.reader.ObjectReader;
&nbsp;
&nbsp;import java.io.InputStream;
&nbsp;import java.io.Reader;
&nbsp;import java.lang.annotation.Annotation;
&nbsp;import java.lang.reflect.*;
&nbsp;import java.math.BigDecimal;
&nbsp;import java.sql.Timestamp;
&nbsp;import java.util.*;
&nbsp;import java.util.concurrent.ConcurrentHashMap;
&nbsp;import java.util.concurrent.ConcurrentMap;
&nbsp;
&nbsp;/**
&nbsp; * @author wenshao[szujobs@hotmail.com]
&nbsp; */
<b class="nc">&nbsp;public class TypeUtils {</b>
&nbsp;    static final long FNV1A_64_MAGIC_HASHCODE = 0xcbf29ce484222325L;
&nbsp;    static final long FNV1A_64_MAGIC_PRIME = 0x100000001b3L;
&nbsp;
<b class="nc">&nbsp;    private static boolean setAccessibleEnable = true;</b>
&nbsp;    public static boolean compatibleWithJavaBean;
&nbsp;    public static boolean compatibleWithFieldName;
&nbsp;
&nbsp;    private static volatile Class kotlin_metadata;
&nbsp;    private static volatile boolean kotlin_metadata_error;
&nbsp;    private static volatile boolean kotlin_class_klass_error;
&nbsp;    private static volatile Constructor kotlin_kclass_constructor;
&nbsp;    private static volatile Method kotlin_kclass_getConstructors;
&nbsp;    private static volatile Method kotlin_kfunction_getParameters;
&nbsp;    private static volatile Method kotlin_kparameter_getName;
&nbsp;    private static volatile boolean kotlin_error;
&nbsp;    private static volatile Map&lt;Class, String[]&gt; kotlinIgnores;
&nbsp;    private static volatile boolean kotlinIgnores_error;
<b class="nc">&nbsp;    private static ConcurrentMap&lt;String, Class&lt;?&gt;&gt; mappings = new ConcurrentHashMap&lt;String, Class&lt;?&gt;&gt;(256, 0.75f, 1);</b>
&nbsp;    private static Class&lt;?&gt; pathClass;
&nbsp;    private static boolean PATH_CLASS_ERROR;
&nbsp;
&nbsp;    private static boolean transientClassInited;
&nbsp;    private static Class&lt;? extends Annotation&gt; transientClass;
&nbsp;
&nbsp;    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
&nbsp;    public static &lt;T&gt; T cast(Object obj, Class&lt;T&gt; clazz, ParserConfig config) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.cast(obj, clazz, config.getProvider());</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressWarnings(&quot;unchecked&quot;)
&nbsp;    public static &lt;T&gt; T cast(Object obj, Type type, ParserConfig mapping) {
<b class="nc">&nbsp;        if (obj == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (obj instanceof String) {</b>
<b class="nc">&nbsp;            String strVal = (String) obj;</b>
<b class="nc">&nbsp;            if (strVal.length() == 0 //</b>
<b class="nc">&nbsp;                    || &quot;null&quot;.equals(strVal) //</b>
<b class="nc">&nbsp;                    || &quot;NULL&quot;.equals(strVal)) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (type instanceof Class) {</b>
<b class="nc">&nbsp;            return cast(obj, (Class&lt;T&gt;) type, mapping);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (type instanceof ParameterizedType) {</b>
<b class="nc">&nbsp;            return cast(obj, (ParameterizedType) type, mapping);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (type instanceof TypeVariable) {</b>
<b class="nc">&nbsp;            return (T) obj;</b>
&nbsp;        }
<b class="nc">&nbsp;        throw new JSONException(&quot;can not cast to : &quot; + type);</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
&nbsp;    public static &lt;T&gt; T cast(Object obj, ParameterizedType type, ParserConfig mapping) {
<b class="nc">&nbsp;        Type rawTye = type.getRawType();</b>
&nbsp;
<b class="nc">&nbsp;        if (rawTye == List.class || rawTye == ArrayList.class) {</b>
<b class="nc">&nbsp;            Type itemType = type.getActualTypeArguments()[0];</b>
<b class="nc">&nbsp;            if (obj instanceof List) {</b>
<b class="nc">&nbsp;                List listObj = (List) obj;</b>
<b class="nc">&nbsp;                List arrayList = new ArrayList(listObj.size());</b>
&nbsp;
<b class="nc">&nbsp;                for (int i = 0; i &lt; listObj.size(); i++) {</b>
<b class="nc">&nbsp;                    Object item = listObj.get(i);</b>
&nbsp;
&nbsp;                    Object itemValue;
<b class="nc">&nbsp;                    if (itemType instanceof Class) {</b>
<b class="nc">&nbsp;                        if (item != null &amp;&amp; item.getClass() == JSONObject.class) {</b>
<b class="nc">&nbsp;                            itemValue = ((JSONObject) item).toJavaObject((Class&lt;T&gt;) itemType, mapping, 0);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            itemValue = cast(item, (Class&lt;T&gt;) itemType, mapping);</b>
&nbsp;                        }
&nbsp;                    } else {
<b class="nc">&nbsp;                        itemValue = cast(item, itemType, mapping);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    arrayList.add(itemValue);</b>
&nbsp;                }
<b class="nc">&nbsp;                return (T) arrayList;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (rawTye == Set.class || rawTye == HashSet.class //</b>
&nbsp;                || rawTye == TreeSet.class //
&nbsp;                || rawTye == Collection.class //
&nbsp;                || rawTye == List.class //
&nbsp;                || rawTye == ArrayList.class) {
<b class="nc">&nbsp;            Type itemType = type.getActualTypeArguments()[0];</b>
<b class="nc">&nbsp;            if (obj instanceof Iterable) {</b>
&nbsp;                Collection collection;
<b class="nc">&nbsp;                if (rawTye == Set.class || rawTye == HashSet.class) {</b>
<b class="nc">&nbsp;                    collection = new HashSet();</b>
<b class="nc">&nbsp;                } else if (rawTye == TreeSet.class) {</b>
<b class="nc">&nbsp;                    collection = new TreeSet();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    collection = new ArrayList();</b>
&nbsp;                }
<b class="nc">&nbsp;                for (Iterator it = ((Iterable) obj).iterator(); it.hasNext(); ) {</b>
<b class="nc">&nbsp;                    Object item = it.next();</b>
&nbsp;
&nbsp;                    Object itemValue;
<b class="nc">&nbsp;                    if (itemType instanceof Class) {</b>
<b class="nc">&nbsp;                        if (item != null &amp;&amp; item.getClass() == JSONObject.class) {</b>
<b class="nc">&nbsp;                            itemValue = ((JSONObject) item).toJavaObject((Class&lt;T&gt;) itemType, mapping, 0);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            itemValue = cast(item, (Class&lt;T&gt;) itemType, mapping);</b>
&nbsp;                        }
&nbsp;                    } else {
<b class="nc">&nbsp;                        itemValue = cast(item, itemType, mapping);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    collection.add(itemValue);</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                return (T) collection;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (rawTye == Map.class || rawTye == HashMap.class) {</b>
<b class="nc">&nbsp;            Type keyType = type.getActualTypeArguments()[0];</b>
<b class="nc">&nbsp;            Type valueType = type.getActualTypeArguments()[1];</b>
<b class="nc">&nbsp;            if (obj instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = new HashMap();</b>
<b class="nc">&nbsp;                for (Map.Entry entry : ((Map&lt;?, ?&gt;) obj).entrySet()) {</b>
<b class="nc">&nbsp;                    Object key = cast(entry.getKey(), keyType, mapping);</b>
<b class="nc">&nbsp;                    Object value = cast(entry.getValue(), valueType, mapping);</b>
<b class="nc">&nbsp;                    map.put(key, value);</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                return (T) map;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (obj instanceof String) {</b>
<b class="nc">&nbsp;            String strVal = (String) obj;</b>
<b class="nc">&nbsp;            if (strVal.length() == 0) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (type.getActualTypeArguments().length == 1) {</b>
<b class="nc">&nbsp;            Type argType = type.getActualTypeArguments()[0];</b>
<b class="nc">&nbsp;            if (argType instanceof WildcardType) {</b>
<b class="nc">&nbsp;                return cast(obj, rawTye, mapping);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (rawTye == Map.Entry.class &amp;&amp; obj instanceof Map &amp;&amp; ((Map) obj).size() == 1) {</b>
<b class="nc">&nbsp;            Map.Entry entry = (Map.Entry) ((Map) obj).entrySet().iterator().next();</b>
<b class="nc">&nbsp;            return (T) entry;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (rawTye instanceof Class) {</b>
<b class="nc">&nbsp;            if (mapping == null) {</b>
<b class="nc">&nbsp;                mapping = ParserConfig.global;</b>
&nbsp;            }
&nbsp;//            ObjectDeserializer deserializer = mapping.getDeserializer(rawTye);
&nbsp;//            if (deserializer != null) {
&nbsp;//                String str = JSON.toJSONString(obj);
&nbsp;//                DefaultJSONParser parser = new DefaultJSONParser(str, mapping);
&nbsp;//                return (T) deserializer.deserialze(parser, type, null);
&nbsp;//            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO : &quot; + type); // TOD: cast</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        throw new JSONException(&quot;can not cast to : &quot; + type);</b>
&nbsp;    }
&nbsp;
&nbsp;    @SuppressWarnings(&quot;unchecked&quot;)
&nbsp;    public static &lt;T&gt; T castToJavaBean(Map&lt;String, Object&gt; map, Class&lt;T&gt; clazz, ParserConfig config) {
&nbsp;        try {
<b class="nc">&nbsp;            if (clazz == StackTraceElement.class) {</b>
<b class="nc">&nbsp;                String declaringClass = (String) map.get(&quot;className&quot;);</b>
<b class="nc">&nbsp;                String methodName = (String) map.get(&quot;methodName&quot;);</b>
<b class="nc">&nbsp;                String fileName = (String) map.get(&quot;fileName&quot;);</b>
&nbsp;                int lineNumber;
&nbsp;                {
<b class="nc">&nbsp;                    Number value = (Number) map.get(&quot;lineNumber&quot;);</b>
<b class="nc">&nbsp;                    if (value == null) {</b>
<b class="nc">&nbsp;                        lineNumber = 0;</b>
<b class="nc">&nbsp;                    } else if (value instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                        lineNumber = ((BigDecimal) value).intValueExact();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        lineNumber = value.intValue();</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                return (T) new StackTraceElement(declaringClass, methodName, fileName, lineNumber);</b>
&nbsp;            }
&nbsp;
&nbsp;            {
<b class="nc">&nbsp;                Object iClassObject = map.get(JSON.DEFAULT_TYPE_KEY);</b>
<b class="nc">&nbsp;                if (iClassObject instanceof String) {</b>
<b class="nc">&nbsp;                    String className = (String) iClassObject;</b>
&nbsp;                    Class&lt;?&gt; loadClazz;
<b class="nc">&nbsp;                    if (config == null) {</b>
<b class="nc">&nbsp;                        config = ParserConfig.global;</b>
&nbsp;                    }
&nbsp;//                    loadClazz = config.checkAutoType(className, null);
&nbsp;//                    if(loadClazz == null){
&nbsp;//                        throw new ClassNotFoundException(className + &quot; not found&quot;);
&nbsp;//                    }
&nbsp;//                    if(!loadClazz.equals(clazz)){
&nbsp;//                        return (T) castToJavaBean(map, loadClazz, config);
&nbsp;//                    }
<b class="nc">&nbsp;                    throw new JSONException(&quot;TODO&quot;); // TODO : castToJavaBean</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (clazz.isInterface()) {</b>
&nbsp;                JSONObject object;
<b class="nc">&nbsp;                if (map instanceof JSONObject) {</b>
<b class="nc">&nbsp;                    object = (JSONObject) map;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    object = new JSONObject(map);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (config == null) {</b>
<b class="nc">&nbsp;                    config = ParserConfig.getGlobalInstance();</b>
&nbsp;                }
&nbsp;//                ObjectDeserializer deserializer = config.getDeserializers().get(clazz);
&nbsp;//                if(deserializer != null){
&nbsp;//                    String json = JSON.toJSONString(object);
&nbsp;//                    return (T) JSON.parseObject(json, clazz);
&nbsp;//                }
&nbsp;//                return (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),
&nbsp;//                        new Class&lt;?&gt;[]{clazz}, object);
<b class="nc">&nbsp;                throw new JSONException(&quot;TODO&quot;); // TODO : castToJavaBean</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (clazz == Locale.class) {</b>
<b class="nc">&nbsp;                Object arg0 = map.get(&quot;language&quot;);</b>
<b class="nc">&nbsp;                Object arg1 = map.get(&quot;country&quot;);</b>
<b class="nc">&nbsp;                if (arg0 instanceof String) {</b>
<b class="nc">&nbsp;                    String language = (String) arg0;</b>
<b class="nc">&nbsp;                    if (arg1 instanceof String) {</b>
<b class="nc">&nbsp;                        String country = (String) arg1;</b>
<b class="nc">&nbsp;                        return (T) new Locale(language, country);</b>
<b class="nc">&nbsp;                    } else if (arg1 == null) {</b>
<b class="nc">&nbsp;                        return (T) new Locale(language);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (clazz == String.class &amp;&amp; map instanceof JSONObject) {</b>
<b class="nc">&nbsp;                return (T) map.toString();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (clazz == LinkedHashMap.class &amp;&amp; map instanceof JSONObject) {</b>
<b class="nc">&nbsp;                JSONObject jsonObject = (JSONObject) map;</b>
<b class="nc">&nbsp;                Map innerMap = jsonObject.getInnerMap();</b>
<b class="nc">&nbsp;                if (innerMap instanceof LinkedHashMap) {</b>
<b class="nc">&nbsp;                    return (T) innerMap;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    LinkedHashMap linkedHashMap = new LinkedHashMap();</b>
<b class="nc">&nbsp;                    linkedHashMap.putAll(innerMap);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectReader objectReader = JSONFactory.getDefaultObjectReaderProvider().getObjectReader(clazz);</b>
<b class="nc">&nbsp;            return (T) objectReader.createInstance(map, 0L);</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
<b class="nc">&nbsp;            throw new JSONException(e.getMessage(), e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static Type checkPrimitiveArray(GenericArrayType genericArrayType) {
<b class="nc">&nbsp;        Type clz = genericArrayType;</b>
<b class="nc">&nbsp;        Type genericComponentType = genericArrayType.getGenericComponentType();</b>
&nbsp;
<b class="nc">&nbsp;        String prefix = &quot;[&quot;;</b>
<b class="nc">&nbsp;        while (genericComponentType instanceof GenericArrayType) {</b>
<b class="nc">&nbsp;            genericComponentType = ((GenericArrayType) genericComponentType)</b>
<b class="nc">&nbsp;                    .getGenericComponentType();</b>
<b class="nc">&nbsp;            prefix += prefix;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (genericComponentType instanceof Class&lt;?&gt;) {</b>
<b class="nc">&nbsp;            Class&lt;?&gt; ck = (Class&lt;?&gt;) genericComponentType;</b>
<b class="nc">&nbsp;            if (ck.isPrimitive()) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    if (ck == boolean.class) {</b>
<b class="nc">&nbsp;                        clz = Class.forName(prefix + &quot;Z&quot;);</b>
<b class="nc">&nbsp;                    } else if (ck == char.class) {</b>
<b class="nc">&nbsp;                        clz = Class.forName(prefix + &quot;C&quot;);</b>
<b class="nc">&nbsp;                    } else if (ck == byte.class) {</b>
<b class="nc">&nbsp;                        clz = Class.forName(prefix + &quot;B&quot;);</b>
<b class="nc">&nbsp;                    } else if (ck == short.class) {</b>
<b class="nc">&nbsp;                        clz = Class.forName(prefix + &quot;S&quot;);</b>
<b class="nc">&nbsp;                    } else if (ck == int.class) {</b>
<b class="nc">&nbsp;                        clz = Class.forName(prefix + &quot;I&quot;);</b>
<b class="nc">&nbsp;                    } else if (ck == long.class) {</b>
<b class="nc">&nbsp;                        clz = Class.forName(prefix + &quot;J&quot;);</b>
<b class="nc">&nbsp;                    } else if (ck == float.class) {</b>
<b class="nc">&nbsp;                        clz = Class.forName(prefix + &quot;F&quot;);</b>
<b class="nc">&nbsp;                    } else if (ck == double.class) {</b>
<b class="nc">&nbsp;                        clz = Class.forName(prefix + &quot;D&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (ClassNotFoundException e) {</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return clz;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean isProxy(Class&lt;?&gt; clazz) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.isProxy(clazz);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean isGenericParamType(Type type) {
<b class="nc">&nbsp;        if (type instanceof ParameterizedType) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (type instanceof Class) {</b>
<b class="nc">&nbsp;            Type superType = ((Class&lt;?&gt;) type).getGenericSuperclass();</b>
<b class="nc">&nbsp;            return superType != Object.class &amp;&amp; isGenericParamType(superType);</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Type getGenericParamType(Type type) {
<b class="nc">&nbsp;        if (type instanceof ParameterizedType) {</b>
<b class="nc">&nbsp;            return type;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (type instanceof Class) {</b>
<b class="nc">&nbsp;            return getGenericParamType(((Class&lt;?&gt;) type).getGenericSuperclass());</b>
&nbsp;        }
<b class="nc">&nbsp;        return type;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean isTransient(Method method) {
<b class="nc">&nbsp;        if (method == null) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!transientClassInited) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                transientClass = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;java.beans.Transient&quot;);</b>
<b class="nc">&nbsp;            } catch (Exception e) {</b>
&nbsp;                // skip
&nbsp;            } finally {
<b class="nc">&nbsp;                transientClassInited = true;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (transientClass != null) {</b>
<b class="nc">&nbsp;            Annotation annotation = TypeUtils.getAnnotation(method, transientClass);</b>
<b class="nc">&nbsp;            return annotation != null;</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String castToString(Object value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        return value.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static long fnv1a_64_lower(String key) {
<b class="nc">&nbsp;        long hashCode = FNV1A_64_MAGIC_HASHCODE;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; key.length(); ++i) {</b>
<b class="nc">&nbsp;            char ch = key.charAt(i);</b>
<b class="nc">&nbsp;            if (ch &gt;= &#39;A&#39; &amp;&amp; ch &lt;= &#39;Z&#39;) {</b>
<b class="nc">&nbsp;                ch = (char) (ch + 32);</b>
&nbsp;            }
<b class="nc">&nbsp;            hashCode ^= ch;</b>
<b class="nc">&nbsp;            hashCode *= FNV1A_64_MAGIC_PRIME;</b>
&nbsp;        }
<b class="nc">&nbsp;        return hashCode;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static long fnv1a_64(String key) {
<b class="nc">&nbsp;        long hashCode = FNV1A_64_MAGIC_HASHCODE;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; key.length(); ++i) {</b>
<b class="nc">&nbsp;            char ch = key.charAt(i);</b>
<b class="nc">&nbsp;            hashCode ^= ch;</b>
<b class="nc">&nbsp;            hashCode *= FNV1A_64_MAGIC_PRIME;</b>
&nbsp;        }
<b class="nc">&nbsp;        return hashCode;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static long fnv1a_64_extract(String key) {
<b class="nc">&nbsp;        long hashCode = FNV1A_64_MAGIC_HASHCODE;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; key.length(); ++i) {</b>
<b class="nc">&nbsp;            char ch = key.charAt(i);</b>
<b class="nc">&nbsp;            if (ch == &#39;_&#39; || ch == &#39;-&#39;) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (ch &gt;= &#39;A&#39; &amp;&amp; ch &lt;= &#39;Z&#39;) {</b>
<b class="nc">&nbsp;                ch = (char) (ch + 32);</b>
&nbsp;            }
<b class="nc">&nbsp;            hashCode ^= ch;</b>
<b class="nc">&nbsp;            hashCode *= FNV1A_64_MAGIC_PRIME;</b>
&nbsp;        }
<b class="nc">&nbsp;        return hashCode;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Long castToLong(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toLong(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Integer castToInt(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toInteger(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Boolean castToBoolean(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toBoolean(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static long longExtractValue(Number number) {
<b class="nc">&nbsp;        if (number == null) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (number instanceof BigDecimal) {</b>
<b class="nc">&nbsp;            return ((BigDecimal) number).longValueExact();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return number.longValue();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;A extends Annotation&gt; A getAnnotation(Class&lt;?&gt; targetClass, Class&lt;A&gt; annotationClass) {
<b class="nc">&nbsp;        A targetAnnotation = targetClass.getAnnotation(annotationClass);</b>
&nbsp;
<b class="nc">&nbsp;        Class&lt;?&gt; mixInClass = null;</b>
<b class="nc">&nbsp;        Type type = JSON.getMixInAnnotations(targetClass);</b>
<b class="nc">&nbsp;        if (type instanceof Class&lt;?&gt;) {</b>
<b class="nc">&nbsp;            mixInClass = (Class&lt;?&gt;) type;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (mixInClass != null) {</b>
<b class="nc">&nbsp;            A mixInAnnotation = mixInClass.getAnnotation(annotationClass);</b>
<b class="nc">&nbsp;            Annotation[] annotations = mixInClass.getAnnotations();</b>
<b class="nc">&nbsp;            if (mixInAnnotation == null &amp;&amp; annotations.length &gt; 0) {</b>
<b class="nc">&nbsp;                for (Annotation annotation : annotations) {</b>
<b class="nc">&nbsp;                    mixInAnnotation = annotation.annotationType().getAnnotation(annotationClass);</b>
<b class="nc">&nbsp;                    if (mixInAnnotation != null) {</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (mixInAnnotation != null) {</b>
<b class="nc">&nbsp;                return mixInAnnotation;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Annotation[] targetClassAnnotations = targetClass.getAnnotations();</b>
<b class="nc">&nbsp;        if (targetAnnotation == null &amp;&amp; targetClassAnnotations.length &gt; 0) {</b>
<b class="nc">&nbsp;            for (Annotation annotation : targetClassAnnotations) {</b>
<b class="nc">&nbsp;                targetAnnotation = annotation.annotationType().getAnnotation(annotationClass);</b>
<b class="nc">&nbsp;                if (targetAnnotation != null) {</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return targetAnnotation;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;A extends Annotation&gt; A getAnnotation(Field field, Class&lt;A&gt; annotationClass) {
<b class="nc">&nbsp;        A targetAnnotation = field.getAnnotation(annotationClass);</b>
&nbsp;
<b class="nc">&nbsp;        Class&lt;?&gt; clazz = field.getDeclaringClass();</b>
&nbsp;        A mixInAnnotation;
<b class="nc">&nbsp;        Class&lt;?&gt; mixInClass = null;</b>
<b class="nc">&nbsp;        Type type = JSON.getMixInAnnotations(clazz);</b>
<b class="nc">&nbsp;        if (type instanceof Class&lt;?&gt;) {</b>
<b class="nc">&nbsp;            mixInClass = (Class&lt;?&gt;) type;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (mixInClass != null) {</b>
<b class="nc">&nbsp;            Field mixInField = null;</b>
<b class="nc">&nbsp;            String fieldName = field.getName();</b>
&nbsp;            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<b class="nc">&nbsp;            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class; currClass = currClass.getSuperclass()) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    mixInField = currClass.getDeclaredField(fieldName);</b>
<b class="nc">&nbsp;                    break;</b>
<b class="nc">&nbsp;                } catch (NoSuchFieldException e) {</b>
&nbsp;                    // skip
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (mixInField == null) {</b>
<b class="nc">&nbsp;                return targetAnnotation;</b>
&nbsp;            }
<b class="nc">&nbsp;            mixInAnnotation = mixInField.getAnnotation(annotationClass);</b>
<b class="nc">&nbsp;            if (mixInAnnotation != null) {</b>
<b class="nc">&nbsp;                return mixInAnnotation;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return targetAnnotation;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;A extends Annotation&gt; A getAnnotation(Method method, Class&lt;A&gt; annotationClass) {
<b class="nc">&nbsp;        A targetAnnotation = method.getAnnotation(annotationClass);</b>
&nbsp;
<b class="nc">&nbsp;        Class&lt;?&gt; clazz = method.getDeclaringClass();</b>
&nbsp;        A mixInAnnotation;
<b class="nc">&nbsp;        Class&lt;?&gt; mixInClass = null;</b>
<b class="nc">&nbsp;        Type type = JSON.getMixInAnnotations(clazz);</b>
<b class="nc">&nbsp;        if (type instanceof Class&lt;?&gt;) {</b>
<b class="nc">&nbsp;            mixInClass = (Class&lt;?&gt;) type;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (mixInClass != null) {</b>
<b class="nc">&nbsp;            Method mixInMethod = null;</b>
<b class="nc">&nbsp;            String methodName = method.getName();</b>
<b class="nc">&nbsp;            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</b>
&nbsp;            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<b class="nc">&nbsp;            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class; currClass = currClass.getSuperclass()) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    mixInMethod = currClass.getDeclaredMethod(methodName, parameterTypes);</b>
<b class="nc">&nbsp;                    break;</b>
<b class="nc">&nbsp;                } catch (NoSuchMethodException e) {</b>
&nbsp;                    // skip
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (mixInMethod == null) {</b>
<b class="nc">&nbsp;                return targetAnnotation;</b>
&nbsp;            }
<b class="nc">&nbsp;            mixInAnnotation = mixInMethod.getAnnotation(annotationClass);</b>
<b class="nc">&nbsp;            if (mixInAnnotation != null) {</b>
<b class="nc">&nbsp;                return mixInAnnotation;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return targetAnnotation;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Double castToDouble(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toDouble(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; T castToJavaBean(Object obj, Class&lt;T&gt; clazz) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.cast(obj, clazz);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Class&lt;?&gt; getClass(Type type) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.getClass(type);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static BigDecimal castToBigDecimal(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toBigDecimal(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Timestamp castToTimestamp(final Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.cast(value, Timestamp.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static java.sql.Date castToSqlDate(final Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.cast(value, java.sql.Date.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static byte byteValue(BigDecimal decimal) {
<b class="nc">&nbsp;        if (decimal == null) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int scale = decimal.scale();</b>
<b class="nc">&nbsp;        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</b>
<b class="nc">&nbsp;            return decimal.byteValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return decimal.byteValueExact();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static short shortValue(BigDecimal decimal) {
<b class="nc">&nbsp;        if (decimal == null) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int scale = decimal.scale();</b>
<b class="nc">&nbsp;        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</b>
<b class="nc">&nbsp;            return decimal.shortValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return decimal.shortValueExact();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static int intValue(BigDecimal decimal) {
<b class="nc">&nbsp;        if (decimal == null) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int scale = decimal.scale();</b>
<b class="nc">&nbsp;        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</b>
<b class="nc">&nbsp;            return decimal.intValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return decimal.intValueExact();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static long longValue(BigDecimal decimal) {
<b class="nc">&nbsp;        if (decimal == null) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int scale = decimal.scale();</b>
<b class="nc">&nbsp;        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</b>
<b class="nc">&nbsp;            return decimal.longValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return decimal.longValueExact();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Character castToChar(Object value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (value instanceof Character) {</b>
<b class="nc">&nbsp;            return (Character) value;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (value instanceof String) {</b>
<b class="nc">&nbsp;            String strVal = (String) value;</b>
<b class="nc">&nbsp;            if (strVal.length() == 0) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (strVal.length() != 1) {</b>
<b class="nc">&nbsp;                throw new JSONException(&quot;can not cast to char, value : &quot; + value);</b>
&nbsp;            }
<b class="nc">&nbsp;            return strVal.charAt(0);</b>
&nbsp;        }
<b class="nc">&nbsp;        throw new JSONException(&quot;can not cast to char, value : &quot; + value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Short castToShort(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toShort(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Byte castToByte(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toByte(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Float castToFloat(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toFloat(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Date castToDate(Object value) {
<b class="nc">&nbsp;        return com.alibaba.fastjson2.util.TypeUtils.toDate(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static byte[] castToBytes(Object value) {
<b class="nc">&nbsp;        if (value instanceof byte[]) {</b>
<b class="nc">&nbsp;            return (byte[]) value;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (value instanceof String) {</b>
<b class="nc">&nbsp;            return IOUtils.decodeBase64((String) value);</b>
&nbsp;        }
<b class="nc">&nbsp;        throw new JSONException(&quot;can not cast to byte[], value : &quot; + value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String, String&gt; aliasMap) {
<b class="nc">&nbsp;        return computeGetters(clazz, aliasMap, true);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String, String&gt; aliasMap, boolean sorted) {
<b class="nc">&nbsp;        JSONType jsonType = TypeUtils.getAnnotation(clazz, JSONType.class);</b>
<b class="nc">&nbsp;        Map&lt;String, Field&gt; fieldCacheMap = new HashMap&lt;String, Field&gt;();</b>
<b class="nc">&nbsp;        ParserConfig.parserAllFieldToCache(clazz, fieldCacheMap);</b>
<b class="nc">&nbsp;        return computeGetters(clazz, jsonType, aliasMap, fieldCacheMap, sorted, PropertyNamingStrategy.CamelCase);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, //
&nbsp;                                                 JSONType jsonType, //
&nbsp;                                                 Map&lt;String, String&gt; aliasMap, //
&nbsp;                                                 Map&lt;String, Field&gt; fieldCacheMap, //
&nbsp;                                                 boolean sorted, //
&nbsp;                                                 PropertyNamingStrategy propertyNamingStrategy //
&nbsp;    ) {
<b class="nc">&nbsp;        Map&lt;String, FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String, FieldInfo&gt;();</b>
<b class="nc">&nbsp;        boolean kotlin = TypeUtils.isKotlin(clazz);</b>
&nbsp;        // for kotlin
<b class="nc">&nbsp;        Constructor[] constructors = null;</b>
<b class="nc">&nbsp;        Annotation[][] paramAnnotationArrays = null;</b>
<b class="nc">&nbsp;        String[] paramNames = null;</b>
<b class="nc">&nbsp;        short[] paramNameMapping = null;</b>
<b class="nc">&nbsp;        Method[] methods = clazz.getMethods();</b>
&nbsp;        try {
<b class="nc">&nbsp;            Arrays.sort(methods, new MethodInheritanceComparator());</b>
<b class="nc">&nbsp;        } catch (Throwable ignored) {</b>
&nbsp;            // ignored
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        for (Method method : methods) {</b>
<b class="nc">&nbsp;            String methodName = method.getName();</b>
<b class="nc">&nbsp;            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</b>
<b class="nc">&nbsp;            String label = null;</b>
<b class="nc">&nbsp;            if (Modifier.isStatic(method.getModifiers())) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Class&lt;?&gt; returnType = method.getReturnType();</b>
<b class="nc">&nbsp;            if (returnType.equals(Void.TYPE)) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (method.getParameterTypes().length != 0) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (returnType == ClassLoader.class</b>
&nbsp;                    || returnType == InputStream.class
&nbsp;                    || returnType == Reader.class) {
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (methodName.equals(&quot;getMetaClass&quot;)</b>
<b class="nc">&nbsp;                    &amp;&amp; returnType.getName().equals(&quot;groovy.lang.MetaClass&quot;)) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (methodName.equals(&quot;getSuppressed&quot;)</b>
<b class="nc">&nbsp;                    &amp;&amp; method.getDeclaringClass() == Throwable.class) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (kotlin &amp;&amp; isKotlinIgnore(clazz, methodName)) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;            /**
&nbsp;             *  如果在属性或者方法上存在JSONField注解，并且定制了name属性，不以类上的propertyNamingStrategy设置为准，以此字段的JSONField的name定制为准。
&nbsp;             */
<b class="nc">&nbsp;            Boolean fieldAnnotationAndNameExists = false;</b>
<b class="nc">&nbsp;            JSONField annotation = TypeUtils.getAnnotation(method, JSONField.class);</b>
<b class="nc">&nbsp;            if (annotation == null) {</b>
<b class="nc">&nbsp;                annotation = getSuperMethodAnnotation(clazz, method);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (annotation == null &amp;&amp; kotlin) {</b>
<b class="nc">&nbsp;                if (constructors == null) {</b>
<b class="nc">&nbsp;                    constructors = clazz.getDeclaredConstructors();</b>
<b class="nc">&nbsp;                    Constructor creatorConstructor = TypeUtils.getKotlinConstructor(constructors);</b>
<b class="nc">&nbsp;                    if (creatorConstructor != null) {</b>
<b class="nc">&nbsp;                        paramAnnotationArrays = TypeUtils.getParameterAnnotations(creatorConstructor);</b>
<b class="nc">&nbsp;                        paramNames = TypeUtils.getKoltinConstructorParameters(clazz);</b>
<b class="nc">&nbsp;                        if (paramNames != null) {</b>
<b class="nc">&nbsp;                            String[] paramNames_sorted = new String[paramNames.length];</b>
<b class="nc">&nbsp;                            System.arraycopy(paramNames, 0, paramNames_sorted, 0, paramNames.length);</b>
&nbsp;
<b class="nc">&nbsp;                            Arrays.sort(paramNames_sorted);</b>
<b class="nc">&nbsp;                            paramNameMapping = new short[paramNames.length];</b>
<b class="nc">&nbsp;                            for (short p = 0; p &lt; paramNames.length; p++) {</b>
<b class="nc">&nbsp;                                int index = Arrays.binarySearch(paramNames_sorted, paramNames[p]);</b>
<b class="nc">&nbsp;                                paramNameMapping[index] = p;</b>
&nbsp;                            }
<b class="nc">&nbsp;                            paramNames = paramNames_sorted;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (paramNames != null &amp;&amp; paramNameMapping != null &amp;&amp; methodName.startsWith(&quot;get&quot;)) {</b>
<b class="nc">&nbsp;                    String propertyName = decapitalize(methodName.substring(3));</b>
<b class="nc">&nbsp;                    int p = Arrays.binarySearch(paramNames, propertyName);</b>
<b class="nc">&nbsp;                    if (p &lt; 0) {</b>
<b class="nc">&nbsp;                        for (int i = 0; i &lt; paramNames.length; i++) {</b>
<b class="nc">&nbsp;                            if (propertyName.equalsIgnoreCase(paramNames[i])) {</b>
<b class="nc">&nbsp;                                p = i;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                    if (p &gt;= 0) {</b>
<b class="nc">&nbsp;                        short index = paramNameMapping[p];</b>
<b class="nc">&nbsp;                        Annotation[] paramAnnotations = paramAnnotationArrays[index];</b>
<b class="nc">&nbsp;                        if (paramAnnotations != null) {</b>
<b class="nc">&nbsp;                            for (Annotation paramAnnotation : paramAnnotations) {</b>
<b class="nc">&nbsp;                                if (paramAnnotation instanceof JSONField) {</b>
<b class="nc">&nbsp;                                    annotation = (JSONField) paramAnnotation;</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                }
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                        if (annotation == null) {</b>
<b class="nc">&nbsp;                            Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</b>
<b class="nc">&nbsp;                            if (field != null) {</b>
<b class="nc">&nbsp;                                annotation = TypeUtils.getAnnotation(field, JSONField.class);</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (annotation != null) {</b>
<b class="nc">&nbsp;                if (!annotation.serialize()) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                ordinal = annotation.ordinal();</b>
<b class="nc">&nbsp;                serialzeFeatures = SerializerFeature.of(annotation.serialzeFeatures());</b>
<b class="nc">&nbsp;                parserFeatures = Feature.of(annotation.parseFeatures());</b>
<b class="nc">&nbsp;                if (annotation.name().length() != 0) {</b>
<b class="nc">&nbsp;                    String propertyName = annotation.name();</b>
<b class="nc">&nbsp;                    if (aliasMap != null) {</b>
<b class="nc">&nbsp;                        propertyName = aliasMap.get(propertyName);</b>
<b class="nc">&nbsp;                        if (propertyName == null) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                    FieldInfo fieldInfo = new FieldInfo(propertyName, method, null, clazz, null, ordinal,</b>
&nbsp;                            serialzeFeatures, parserFeatures, annotation, null, label);
<b class="nc">&nbsp;                    fieldInfoMap.put(propertyName, fieldInfo);</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (annotation.label().length() != 0) {</b>
<b class="nc">&nbsp;                    label = annotation.label();</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (methodName.startsWith(&quot;get&quot;)) {</b>
<b class="nc">&nbsp;                if (methodName.length() &lt; 4) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (methodName.equals(&quot;getClass&quot;)) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (methodName.equals(&quot;getDeclaringClass&quot;) &amp;&amp; clazz.isEnum()) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                char c3 = methodName.charAt(3);</b>
&nbsp;                String propertyName;
<b class="nc">&nbsp;                Field field = null;</b>
<b class="nc">&nbsp;                if (Character.isUpperCase(c3) //</b>
&nbsp;                        || c3 &gt; 512 // for unicode method name
&nbsp;                ) {
<b class="nc">&nbsp;                    if (compatibleWithJavaBean) {</b>
<b class="nc">&nbsp;                        propertyName = decapitalize(methodName.substring(3));</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        propertyName = TypeUtils.getPropertyNameByMethodName(methodName);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 3);</b>
<b class="nc">&nbsp;                } else if (c3 == &#39;_&#39;) {</b>
<b class="nc">&nbsp;                    propertyName = methodName.substring(3);</b>
<b class="nc">&nbsp;                    field = fieldCacheMap.get(propertyName);</b>
<b class="nc">&nbsp;                    if (field == null) {</b>
<b class="nc">&nbsp;                        String temp = propertyName;</b>
<b class="nc">&nbsp;                        propertyName = methodName.substring(4);</b>
<b class="nc">&nbsp;                        field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</b>
<b class="nc">&nbsp;                        if (field == null) {</b>
<b class="nc">&nbsp;                            propertyName = temp; //减少修改代码带来的影响</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                } else if (c3 == &#39;f&#39;) {</b>
<b class="nc">&nbsp;                    propertyName = methodName.substring(3);</b>
<b class="nc">&nbsp;                } else if (methodName.length() &gt;= 5 &amp;&amp; Character.isUpperCase(methodName.charAt(4))) {</b>
<b class="nc">&nbsp;                    propertyName = decapitalize(methodName.substring(3));</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    propertyName = methodName.substring(3);</b>
<b class="nc">&nbsp;                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</b>
<b class="nc">&nbsp;                    if (field == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</b>
<b class="nc">&nbsp;                if (ignore) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (field == null) {</b>
&nbsp;                    // 假如bean的field很多的情况一下，轮询时将大大降低效率
<b class="nc">&nbsp;                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (field == null &amp;&amp; propertyName.length() &gt; 1) {</b>
<b class="nc">&nbsp;                    char ch = propertyName.charAt(1);</b>
<b class="nc">&nbsp;                    if (ch &gt;= &#39;A&#39; &amp;&amp; ch &lt;= &#39;Z&#39;) {</b>
<b class="nc">&nbsp;                        String javaBeanCompatiblePropertyName = decapitalize(methodName.substring(3));</b>
<b class="nc">&nbsp;                        field = ParserConfig.getFieldFromCache(javaBeanCompatiblePropertyName, fieldCacheMap);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                JSONField fieldAnnotation = null;</b>
<b class="nc">&nbsp;                if (field != null) {</b>
<b class="nc">&nbsp;                    fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</b>
<b class="nc">&nbsp;                    if (fieldAnnotation != null) {</b>
<b class="nc">&nbsp;                        if (!fieldAnnotation.serialize()) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        ordinal = fieldAnnotation.ordinal();</b>
<b class="nc">&nbsp;                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</b>
<b class="nc">&nbsp;                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</b>
<b class="nc">&nbsp;                        if (fieldAnnotation.name().length() != 0) {</b>
<b class="nc">&nbsp;                            fieldAnnotationAndNameExists = true;</b>
<b class="nc">&nbsp;                            propertyName = fieldAnnotation.name();</b>
<b class="nc">&nbsp;                            if (aliasMap != null) {</b>
<b class="nc">&nbsp;                                propertyName = aliasMap.get(propertyName);</b>
<b class="nc">&nbsp;                                if (propertyName == null) {</b>
<b class="nc">&nbsp;                                    continue;</b>
&nbsp;                                }
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                        if (fieldAnnotation.label().length() != 0) {</b>
<b class="nc">&nbsp;                            label = fieldAnnotation.label();</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (aliasMap != null) {</b>
<b class="nc">&nbsp;                    propertyName = aliasMap.get(propertyName);</b>
<b class="nc">&nbsp;                    if (propertyName == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (propertyNamingStrategy != null &amp;&amp; !fieldAnnotationAndNameExists) {</b>
<b class="nc">&nbsp;                    propertyName = propertyNamingStrategy.translate(propertyName);</b>
&nbsp;                }
<b class="nc">&nbsp;                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</b>
&nbsp;                        annotation, fieldAnnotation, label);
<b class="nc">&nbsp;                fieldInfoMap.put(propertyName, fieldInfo);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (methodName.startsWith(&quot;is&quot;)) {</b>
<b class="nc">&nbsp;                if (methodName.length() &lt; 3) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (returnType != Boolean.TYPE</b>
&nbsp;                        &amp;&amp; returnType != Boolean.class) {
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                char c2 = methodName.charAt(2);</b>
&nbsp;                String propertyName;
<b class="nc">&nbsp;                Field field = null;</b>
<b class="nc">&nbsp;                if (Character.isUpperCase(c2)) {</b>
<b class="nc">&nbsp;                    if (compatibleWithJavaBean) {</b>
<b class="nc">&nbsp;                        propertyName = decapitalize(methodName.substring(2));</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        propertyName = Character.toLowerCase(methodName.charAt(2)) + methodName.substring(3);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 2);</b>
<b class="nc">&nbsp;                } else if (c2 == &#39;_&#39;) {</b>
<b class="nc">&nbsp;                    propertyName = methodName.substring(3);</b>
<b class="nc">&nbsp;                    field = fieldCacheMap.get(propertyName);</b>
<b class="nc">&nbsp;                    if (field == null) {</b>
<b class="nc">&nbsp;                        String temp = propertyName;</b>
<b class="nc">&nbsp;                        propertyName = methodName.substring(2);</b>
<b class="nc">&nbsp;                        field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</b>
<b class="nc">&nbsp;                        if (field == null) {</b>
<b class="nc">&nbsp;                            propertyName = temp;</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                } else if (c2 == &#39;f&#39;) {</b>
<b class="nc">&nbsp;                    propertyName = methodName.substring(2);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    propertyName = methodName.substring(2);</b>
<b class="nc">&nbsp;                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</b>
<b class="nc">&nbsp;                    if (field == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</b>
<b class="nc">&nbsp;                if (ignore) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (field == null) {</b>
<b class="nc">&nbsp;                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (field == null) {</b>
<b class="nc">&nbsp;                    field = ParserConfig.getFieldFromCache(methodName, fieldCacheMap);</b>
&nbsp;                }
<b class="nc">&nbsp;                JSONField fieldAnnotation = null;</b>
<b class="nc">&nbsp;                if (field != null) {</b>
<b class="nc">&nbsp;                    fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</b>
<b class="nc">&nbsp;                    if (fieldAnnotation != null) {</b>
<b class="nc">&nbsp;                        if (!fieldAnnotation.serialize()) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        ordinal = fieldAnnotation.ordinal();</b>
<b class="nc">&nbsp;                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</b>
<b class="nc">&nbsp;                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</b>
<b class="nc">&nbsp;                        if (fieldAnnotation.name().length() != 0) {</b>
<b class="nc">&nbsp;                            propertyName = fieldAnnotation.name();</b>
<b class="nc">&nbsp;                            if (aliasMap != null) {</b>
<b class="nc">&nbsp;                                propertyName = aliasMap.get(propertyName);</b>
<b class="nc">&nbsp;                                if (propertyName == null) {</b>
<b class="nc">&nbsp;                                    continue;</b>
&nbsp;                                }
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                        if (fieldAnnotation.label().length() != 0) {</b>
<b class="nc">&nbsp;                            label = fieldAnnotation.label();</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (aliasMap != null) {</b>
<b class="nc">&nbsp;                    propertyName = aliasMap.get(propertyName);</b>
<b class="nc">&nbsp;                    if (propertyName == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (propertyNamingStrategy != null) {</b>
<b class="nc">&nbsp;                    propertyName = propertyNamingStrategy.translate(propertyName);</b>
&nbsp;                }
&nbsp;                //优先选择get
<b class="nc">&nbsp;                if (fieldInfoMap.containsKey(propertyName)) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                FieldInfo fieldInfo = new FieldInfo(</b>
&nbsp;                        propertyName,
&nbsp;                        method,
&nbsp;                        field,
&nbsp;                        clazz,
&nbsp;                        null,
&nbsp;                        ordinal,
&nbsp;                        serialzeFeatures,
&nbsp;                        parserFeatures,
&nbsp;                        annotation,
&nbsp;                        fieldAnnotation,
&nbsp;                        label
&nbsp;                );
<b class="nc">&nbsp;                fieldInfoMap.put(propertyName, fieldInfo);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        Field[] fields = clazz.getFields();</b>
<b class="nc">&nbsp;        computeFields(clazz, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</b>
<b class="nc">&nbsp;        return getFieldInfos(clazz, sorted, fieldInfoMap);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static void computeFields(
&nbsp;            Class&lt;?&gt; clazz,
&nbsp;            Map&lt;String, String&gt; aliasMap,
&nbsp;            PropertyNamingStrategy propertyNamingStrategy,
&nbsp;            Map&lt;String, FieldInfo&gt; fieldInfoMap,
&nbsp;            Field[] fields
&nbsp;    ) {
<b class="nc">&nbsp;        for (Field field : fields) {</b>
<b class="nc">&nbsp;            if (Modifier.isStatic(field.getModifiers())) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            JSONField fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</b>
<b class="nc">&nbsp;            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</b>
<b class="nc">&nbsp;            String propertyName = field.getName();</b>
<b class="nc">&nbsp;            String label = null;</b>
<b class="nc">&nbsp;            if (fieldAnnotation != null) {</b>
<b class="nc">&nbsp;                if (!fieldAnnotation.serialize()) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                ordinal = fieldAnnotation.ordinal();</b>
<b class="nc">&nbsp;                serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</b>
<b class="nc">&nbsp;                parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</b>
<b class="nc">&nbsp;                if (fieldAnnotation.name().length() != 0) {</b>
<b class="nc">&nbsp;                    propertyName = fieldAnnotation.name();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (fieldAnnotation.label().length() != 0) {</b>
<b class="nc">&nbsp;                    label = fieldAnnotation.label();</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (aliasMap != null) {</b>
<b class="nc">&nbsp;                propertyName = aliasMap.get(propertyName);</b>
<b class="nc">&nbsp;                if (propertyName == null) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (propertyNamingStrategy != null) {</b>
<b class="nc">&nbsp;                propertyName = propertyNamingStrategy.translate(propertyName);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (!fieldInfoMap.containsKey(propertyName)) {</b>
<b class="nc">&nbsp;                FieldInfo fieldInfo = new FieldInfo(propertyName, null, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</b>
&nbsp;                        null, fieldAnnotation, label);
<b class="nc">&nbsp;                fieldInfoMap.put(propertyName, fieldInfo);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private static List&lt;FieldInfo&gt; getFieldInfos(Class&lt;?&gt; clazz, boolean sorted, Map&lt;String, FieldInfo&gt; fieldInfoMap) {
<b class="nc">&nbsp;        List&lt;FieldInfo&gt; fieldInfoList = new ArrayList&lt;FieldInfo&gt;();</b>
<b class="nc">&nbsp;        String[] orders = null;</b>
<b class="nc">&nbsp;        JSONType annotation = TypeUtils.getAnnotation(clazz, JSONType.class);</b>
<b class="nc">&nbsp;        if (annotation != null) {</b>
<b class="nc">&nbsp;            orders = annotation.orders();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (orders != null &amp;&amp; orders.length &gt; 0) {</b>
<b class="nc">&nbsp;            LinkedHashMap&lt;String, FieldInfo&gt; map = new LinkedHashMap&lt;String, FieldInfo&gt;(fieldInfoMap.size());</b>
<b class="nc">&nbsp;            for (FieldInfo field : fieldInfoMap.values()) {</b>
<b class="nc">&nbsp;                map.put(field.name, field);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (String item : orders) {</b>
<b class="nc">&nbsp;                FieldInfo field = map.get(item);</b>
<b class="nc">&nbsp;                if (field != null) {</b>
<b class="nc">&nbsp;                    fieldInfoList.add(field);</b>
<b class="nc">&nbsp;                    map.remove(item);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            fieldInfoList.addAll(map.values());</b>
<b class="nc">&nbsp;        } else {</b>
<b class="nc">&nbsp;            fieldInfoList.addAll(fieldInfoMap.values());</b>
<b class="nc">&nbsp;            if (sorted) {</b>
<b class="nc">&nbsp;                Collections.sort(fieldInfoList);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return fieldInfoList;</b>
&nbsp;    }
&nbsp;
&nbsp;    static void setAccessible(AccessibleObject obj) {
<b class="nc">&nbsp;        if (!setAccessibleEnable) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        if (obj.isAccessible()) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;        try {
<b class="nc">&nbsp;            obj.setAccessible(true);</b>
<b class="nc">&nbsp;        } catch (Throwable error) {</b>
<b class="nc">&nbsp;            setAccessibleEnable = false;</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean isKotlin(Class clazz) {
<b class="nc">&nbsp;        if (kotlin_metadata == null &amp;&amp; !kotlin_metadata_error) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                kotlin_metadata = Class.forName(&quot;kotlin.Metadata&quot;);</b>
<b class="nc">&nbsp;            } catch (Throwable e) {</b>
<b class="nc">&nbsp;                kotlin_metadata_error = true;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        return kotlin_metadata != null &amp;&amp; clazz.isAnnotationPresent(kotlin_metadata);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Constructor getKotlinConstructor(Constructor[] constructors) {
<b class="nc">&nbsp;        return getKotlinConstructor(constructors, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Constructor getKotlinConstructor(Constructor[] constructors, String[] paramNames) {
<b class="nc">&nbsp;        Constructor creatorConstructor = null;</b>
<b class="nc">&nbsp;        for (Constructor&lt;?&gt; constructor : constructors) {</b>
<b class="nc">&nbsp;            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</b>
<b class="nc">&nbsp;            if (paramNames != null &amp;&amp; parameterTypes.length != paramNames.length) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (parameterTypes.length &gt; 0 &amp;&amp; parameterTypes[parameterTypes.length - 1].getName().equals(&quot;kotlin.jvm.internal.DefaultConstructorMarker&quot;)) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (creatorConstructor != null &amp;&amp; creatorConstructor.getParameterTypes().length &gt;= parameterTypes.length) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            creatorConstructor = constructor;</b>
&nbsp;        }
<b class="nc">&nbsp;        return creatorConstructor;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String[] getKoltinConstructorParameters(Class clazz) {
<b class="nc">&nbsp;        if (kotlin_kclass_constructor == null &amp;&amp; !kotlin_class_klass_error) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</b>
<b class="nc">&nbsp;                kotlin_kclass_constructor = class_kotlin_kclass.getConstructor(Class.class);</b>
<b class="nc">&nbsp;            } catch (Throwable e) {</b>
<b class="nc">&nbsp;                kotlin_class_klass_error = true;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (kotlin_kclass_constructor == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (kotlin_kclass_getConstructors == null &amp;&amp; !kotlin_class_klass_error) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</b>
<b class="nc">&nbsp;                kotlin_kclass_getConstructors = class_kotlin_kclass.getMethod(&quot;getConstructors&quot;);</b>
<b class="nc">&nbsp;            } catch (Throwable e) {</b>
<b class="nc">&nbsp;                kotlin_class_klass_error = true;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (kotlin_kfunction_getParameters == null &amp;&amp; !kotlin_class_klass_error) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Class class_kotlin_kfunction = Class.forName(&quot;kotlin.reflect.KFunction&quot;);</b>
<b class="nc">&nbsp;                kotlin_kfunction_getParameters = class_kotlin_kfunction.getMethod(&quot;getParameters&quot;);</b>
<b class="nc">&nbsp;            } catch (Throwable e) {</b>
<b class="nc">&nbsp;                kotlin_class_klass_error = true;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (kotlin_kparameter_getName == null &amp;&amp; !kotlin_class_klass_error) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Class class_kotlinn_kparameter = Class.forName(&quot;kotlin.reflect.KParameter&quot;);</b>
<b class="nc">&nbsp;                kotlin_kparameter_getName = class_kotlinn_kparameter.getMethod(&quot;getName&quot;);</b>
<b class="nc">&nbsp;            } catch (Throwable e) {</b>
<b class="nc">&nbsp;                kotlin_class_klass_error = true;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (kotlin_error) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
&nbsp;        try {
<b class="nc">&nbsp;            Object constructor = null;</b>
<b class="nc">&nbsp;            Object kclassImpl = kotlin_kclass_constructor.newInstance(clazz);</b>
<b class="nc">&nbsp;            Iterable it = (Iterable) kotlin_kclass_getConstructors.invoke(kclassImpl);</b>
<b class="nc">&nbsp;            for (Iterator iterator = it.iterator(); iterator.hasNext(); iterator.hasNext()) {</b>
<b class="nc">&nbsp;                Object item = iterator.next();</b>
<b class="nc">&nbsp;                List parameters = (List) kotlin_kfunction_getParameters.invoke(item);</b>
<b class="nc">&nbsp;                if (constructor != null &amp;&amp; parameters.size() == 0) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                constructor = item;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (constructor == null) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            List parameters = (List) kotlin_kfunction_getParameters.invoke(constructor);</b>
<b class="nc">&nbsp;            String[] names = new String[parameters.size()];</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; parameters.size(); i++) {</b>
<b class="nc">&nbsp;                Object param = parameters.get(i);</b>
<b class="nc">&nbsp;                names[i] = (String) kotlin_kparameter_getName.invoke(param);</b>
&nbsp;            }
<b class="nc">&nbsp;            return names;</b>
<b class="nc">&nbsp;        } catch (Throwable e) {</b>
<b class="nc">&nbsp;            e.printStackTrace();</b>
<b class="nc">&nbsp;            kotlin_error = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    static boolean isKotlinIgnore(Class clazz, String methodName) {
<b class="nc">&nbsp;        if (kotlinIgnores == null &amp;&amp; !kotlinIgnores_error) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Map&lt;Class, String[]&gt; map = new HashMap&lt;Class, String[]&gt;();</b>
<b class="nc">&nbsp;                Class charRangeClass = Class.forName(&quot;kotlin.ranges.CharRange&quot;);</b>
<b class="nc">&nbsp;                map.put(charRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</b>
<b class="nc">&nbsp;                Class intRangeClass = Class.forName(&quot;kotlin.ranges.IntRange&quot;);</b>
<b class="nc">&nbsp;                map.put(intRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</b>
<b class="nc">&nbsp;                Class longRangeClass = Class.forName(&quot;kotlin.ranges.LongRange&quot;);</b>
<b class="nc">&nbsp;                map.put(longRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</b>
<b class="nc">&nbsp;                Class floatRangeClass = Class.forName(&quot;kotlin.ranges.ClosedFloatRange&quot;);</b>
<b class="nc">&nbsp;                map.put(floatRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</b>
<b class="nc">&nbsp;                Class doubleRangeClass = Class.forName(&quot;kotlin.ranges.ClosedDoubleRange&quot;);</b>
<b class="nc">&nbsp;                map.put(doubleRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</b>
<b class="nc">&nbsp;                kotlinIgnores = map;</b>
<b class="nc">&nbsp;            } catch (Throwable error) {</b>
<b class="nc">&nbsp;                kotlinIgnores_error = true;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (kotlinIgnores == null) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        String[] ignores = kotlinIgnores.get(clazz);</b>
<b class="nc">&nbsp;        return ignores != null &amp;&amp; Arrays.binarySearch(ignores, methodName) &gt;= 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static boolean isJSONTypeIgnore(Class&lt;?&gt; clazz, String propertyName) {
<b class="nc">&nbsp;        JSONType jsonType = TypeUtils.getAnnotation(clazz, JSONType.class);</b>
<b class="nc">&nbsp;        if (jsonType != null) {</b>
&nbsp;            // 1、新增 includes 支持，如果 JSONType 同时设置了includes 和 ignores 属性，则以includes为准。
&nbsp;            // 2、个人认为对于大小写敏感的Java和JS而言，使用 equals() 比 equalsIgnoreCase() 更好，改动的唯一风险就是向后兼容性的问题
&nbsp;            // 不过，相信开发者应该都是严格按照大小写敏感的方式进行属性设置的
<b class="nc">&nbsp;            String[] fields = jsonType.includes();</b>
<b class="nc">&nbsp;            if (fields.length &gt; 0) {</b>
<b class="nc">&nbsp;                for (String field : fields) {</b>
<b class="nc">&nbsp;                    if (propertyName.equals(field)) {</b>
<b class="nc">&nbsp;                        return false;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                return true;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                fields = jsonType.ignores();</b>
<b class="nc">&nbsp;                for (String field : fields) {</b>
<b class="nc">&nbsp;                    if (propertyName.equals(field)) {</b>
<b class="nc">&nbsp;                        return true;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (clazz.getSuperclass() != Object.class &amp;&amp; clazz.getSuperclass() != null) {</b>
<b class="nc">&nbsp;            return isJSONTypeIgnore(clazz.getSuperclass(), propertyName);</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONField getSuperMethodAnnotation(final Class&lt;?&gt; clazz, final Method method) {
<b class="nc">&nbsp;        Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</b>
<b class="nc">&nbsp;        if (interfaces.length &gt; 0) {</b>
<b class="nc">&nbsp;            Class&lt;?&gt;[] types = method.getParameterTypes();</b>
<b class="nc">&nbsp;            for (Class&lt;?&gt; interfaceClass : interfaces) {</b>
<b class="nc">&nbsp;                for (Method interfaceMethod : interfaceClass.getMethods()) {</b>
<b class="nc">&nbsp;                    Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</b>
<b class="nc">&nbsp;                    if (interfaceTypes.length != types.length) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (!interfaceMethod.getName().equals(method.getName())) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    boolean match = true;</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; types.length; ++i) {</b>
<b class="nc">&nbsp;                        if (!interfaceTypes[i].equals(types[i])) {</b>
<b class="nc">&nbsp;                            match = false;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    JSONField annotation = TypeUtils.getAnnotation(interfaceMethod, JSONField.class);</b>
<b class="nc">&nbsp;                    if (annotation != null) {</b>
<b class="nc">&nbsp;                        return annotation;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        Class&lt;?&gt; superClass = clazz.getSuperclass();</b>
<b class="nc">&nbsp;        if (superClass == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (Modifier.isAbstract(superClass.getModifiers())) {</b>
<b class="nc">&nbsp;            Class&lt;?&gt;[] types = method.getParameterTypes();</b>
<b class="nc">&nbsp;            for (Method interfaceMethod : superClass.getMethods()) {</b>
<b class="nc">&nbsp;                Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</b>
<b class="nc">&nbsp;                if (interfaceTypes.length != types.length) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (!interfaceMethod.getName().equals(method.getName())) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                boolean match = true;</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; types.length; ++i) {</b>
<b class="nc">&nbsp;                    if (!interfaceTypes[i].equals(types[i])) {</b>
<b class="nc">&nbsp;                        match = false;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (!match) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                JSONField annotation = TypeUtils.getAnnotation(interfaceMethod, JSONField.class);</b>
<b class="nc">&nbsp;                if (annotation != null) {</b>
<b class="nc">&nbsp;                    return annotation;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static String getPropertyNameByCompatibleFieldName(Map&lt;String, Field&gt; fieldCacheMap, String methodName,
&nbsp;                                                               String propertyName, int fromIdx) {
<b class="nc">&nbsp;        if (compatibleWithFieldName) {</b>
<b class="nc">&nbsp;            if (!fieldCacheMap.containsKey(propertyName)) {</b>
<b class="nc">&nbsp;                String tempPropertyName = methodName.substring(fromIdx);</b>
<b class="nc">&nbsp;                return fieldCacheMap.containsKey(tempPropertyName) ? tempPropertyName : propertyName;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return propertyName;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String decapitalize(String name) {
<b class="nc">&nbsp;        if (name == null || name.length() == 0) {</b>
<b class="nc">&nbsp;            return name;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (name.length() &gt; 1 &amp;&amp; Character.isUpperCase(name.charAt(1)) &amp;&amp; Character.isUpperCase(name.charAt(0))) {</b>
<b class="nc">&nbsp;            return name;</b>
&nbsp;        }
<b class="nc">&nbsp;        char[] chars = name.toCharArray();</b>
<b class="nc">&nbsp;        chars[0] = Character.toLowerCase(chars[0]);</b>
<b class="nc">&nbsp;        return new String(chars);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * resolve property name from get/set method name
&nbsp;     *
&nbsp;     * @param methodName get/set method name
&nbsp;     * @return property name
&nbsp;     */
&nbsp;    public static String getPropertyNameByMethodName(String methodName) {
<b class="nc">&nbsp;        return Character.toLowerCase(methodName.charAt(3)) + methodName.substring(4);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Annotation[][] getParameterAnnotations(Constructor constructor) {
<b class="nc">&nbsp;        Annotation[][] targetAnnotations = constructor.getParameterAnnotations();</b>
&nbsp;
<b class="nc">&nbsp;        Class&lt;?&gt; clazz = constructor.getDeclaringClass();</b>
&nbsp;        Annotation[][] mixInAnnotations;
<b class="nc">&nbsp;        Class&lt;?&gt; mixInClass = null;</b>
<b class="nc">&nbsp;        Type type = JSON.getMixInAnnotations(clazz);</b>
<b class="nc">&nbsp;        if (type instanceof Class&lt;?&gt;) {</b>
<b class="nc">&nbsp;            mixInClass = (Class&lt;?&gt;) type;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (mixInClass != null) {</b>
<b class="nc">&nbsp;            Constructor mixInConstructor = null;</b>
<b class="nc">&nbsp;            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</b>
&nbsp;            // 构建参数列表，因为内部类的构造函数需要传入外部类的引用
<b class="nc">&nbsp;            List&lt;Class&lt;?&gt;&gt; enclosingClasses = new ArrayList&lt;Class&lt;?&gt;&gt;(2);</b>
<b class="nc">&nbsp;            for (Class&lt;?&gt; enclosingClass = mixInClass.getEnclosingClass(); enclosingClass != null; enclosingClass = enclosingClass.getEnclosingClass()) {</b>
<b class="nc">&nbsp;                enclosingClasses.add(enclosingClass);</b>
&nbsp;            }
<b class="nc">&nbsp;            int level = enclosingClasses.size();</b>
&nbsp;            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<b class="nc">&nbsp;            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class; currClass = currClass.getSuperclass()) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    if (level != 0) {</b>
<b class="nc">&nbsp;                        Class&lt;?&gt;[] outerClassAndParameterTypes = new Class[level + parameterTypes.length];</b>
<b class="nc">&nbsp;                        System.arraycopy(parameterTypes, 0, outerClassAndParameterTypes, level, parameterTypes.length);</b>
<b class="nc">&nbsp;                        for (int i = level; i &gt; 0; i--) {</b>
<b class="nc">&nbsp;                            outerClassAndParameterTypes[i - 1] = enclosingClasses.get(i - 1);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        mixInConstructor = mixInClass.getDeclaredConstructor(outerClassAndParameterTypes);</b>
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        mixInConstructor = mixInClass.getDeclaredConstructor(parameterTypes);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    break;</b>
<b class="nc">&nbsp;                } catch (NoSuchMethodException e) {</b>
<b class="nc">&nbsp;                    level--;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (mixInConstructor == null) {</b>
<b class="nc">&nbsp;                return targetAnnotations;</b>
&nbsp;            }
<b class="nc">&nbsp;            mixInAnnotations = mixInConstructor.getParameterAnnotations();</b>
<b class="nc">&nbsp;            if (mixInAnnotations != null) {</b>
<b class="nc">&nbsp;                return mixInAnnotations;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return targetAnnotations;</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    public static class MethodInheritanceComparator</b>
&nbsp;            implements Comparator&lt;Method&gt; {
&nbsp;        public int compare(Method m1, Method m2) {
<b class="nc">&nbsp;            int cmp = m1.getName().compareTo(m2.getName());</b>
<b class="nc">&nbsp;            if (cmp != 0) {</b>
<b class="nc">&nbsp;                return cmp;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Class&lt;?&gt; class1 = m1.getReturnType();</b>
<b class="nc">&nbsp;            Class&lt;?&gt; class2 = m2.getReturnType();</b>
&nbsp;
<b class="nc">&nbsp;            if (class1.equals(class2)) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (class1.isAssignableFrom(class2)) {</b>
<b class="nc">&nbsp;                return -1;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (class2.isAssignableFrom(class1)) {</b>
<b class="nc">&nbsp;                return 1;</b>
&nbsp;            }
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-09 22:08</div>
</div>
</body>
</html>
