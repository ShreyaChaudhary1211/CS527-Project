


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > JSONPath</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.alibaba.fastjson2</a>
</div>

<h1>Coverage Summary for Class: JSONPath (com.alibaba.fastjson2)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">JSONPath</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/40)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/373)
  </span>
</td>
</tr>
  <tr>
    <td class="name">JSONPath$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$AllSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/138)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$BiFunctionAdapter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$Context</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$CycleNameSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/109)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$CycleNameSegment$LoopCallback</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/34)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$CycleNameSegment$LoopSet</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/29)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$CycleNameSegment$MapLoop</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/31)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$EntrySetSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/25)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$EvalSegment</td>
  </tr>
  <tr>
    <td class="name">JSONPath$Feature</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$FilterSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$FunctionSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$GroupFilter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/41)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$IndexSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/282)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$JSONPathParser</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/486)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$KeysSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/17)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$LengthSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$MaxSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/36)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$MinSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/36)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$MultiIndexSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/78)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$MultiNameSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/49)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$MultiSegmentPath</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/201)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameArrayOpSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameDecimalOpSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/24)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameExistsFilter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/29)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameFilter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/114)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameIntBetweenSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/29)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameIntInSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/30)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameIntOpSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/58)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameLongContainsSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/41)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameMatchFilter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/34)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameObjectOpSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameRLikeSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/316)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameStringContainsSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameStringInSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$NameStringOpSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$Operator</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$PreviousPath</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$RandomIndexSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/60)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$RangeIndexSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/104)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$RootPath</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$RootSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$Segment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$SelfSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$Sequence</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$SingleNamePath</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/302)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$SingleSegmentPath</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$SizeFunction</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$StartsWithSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$SumSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/32)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$TwoSegmentPath</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/106)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$TypeFunction</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONPath$ValuesSegment</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/286)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3488)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.alibaba.fastjson2;
&nbsp;
&nbsp;import com.alibaba.fastjson2.function.impl.ToDouble;
&nbsp;import com.alibaba.fastjson2.reader.*;
&nbsp;import com.alibaba.fastjson2.util.Fnv;
&nbsp;import com.alibaba.fastjson2.util.IOUtils;
&nbsp;import com.alibaba.fastjson2.util.TypeUtils;
&nbsp;import com.alibaba.fastjson2.writer.FieldWriter;
&nbsp;import com.alibaba.fastjson2.writer.ObjectWriter;
&nbsp;import com.alibaba.fastjson2.writer.ObjectWriterAdapter;
&nbsp;import com.alibaba.fastjson2.writer.ObjectWriterProvider;
&nbsp;
&nbsp;import java.lang.reflect.Array;
&nbsp;import java.math.BigDecimal;
&nbsp;import java.math.BigInteger;
&nbsp;import java.math.RoundingMode;
&nbsp;import java.nio.charset.StandardCharsets;
&nbsp;import java.util.*;
&nbsp;import java.util.function.BiConsumer;
&nbsp;import java.util.function.BiFunction;
&nbsp;import java.util.function.Consumer;
&nbsp;import java.util.function.Function;
&nbsp;import java.util.regex.Matcher;
&nbsp;import java.util.regex.Pattern;
&nbsp;
&nbsp;import static com.alibaba.fastjson2.JSONB.Constants.BC_OBJECT;
&nbsp;import static com.alibaba.fastjson2.JSONB.Constants.BC_OBJECT_END;
&nbsp;import static com.alibaba.fastjson2.JSONReader.EOI;
&nbsp;import static com.alibaba.fastjson2.util.JDKUtils.LATIN1;
&nbsp;import static com.alibaba.fastjson2.util.JDKUtils.STRING_CREATOR_JDK11;
&nbsp;
&nbsp;public abstract class JSONPath {
<b class="nc">&nbsp;    static final JSONReader.Context PARSE_CONTEXT = JSONFactory.createReadContext();</b>
&nbsp;
&nbsp;    JSONReader.Context readerContext;
&nbsp;    JSONWriter.Context writerContext;
&nbsp;    final String path;
&nbsp;    final long features;
&nbsp;
<b class="nc">&nbsp;    protected JSONPath(String path, Feature... features) {</b>
<b class="nc">&nbsp;        this.path = path;</b>
<b class="nc">&nbsp;        long featuresValue = 0;</b>
<b class="nc">&nbsp;        for (Feature feature : features) {</b>
<b class="nc">&nbsp;            featuresValue |= feature.mask;</b>
&nbsp;        }
<b class="nc">&nbsp;        this.features = featuresValue;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isPrevious() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public final String toString() {
<b class="nc">&nbsp;        return path;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Object extract(String json, String path) {
<b class="nc">&nbsp;        JSONReader jsonReader = JSONReader.of(json);</b>
<b class="nc">&nbsp;        JSONPath jsonPath = JSONPath.of(path);</b>
<b class="nc">&nbsp;        return jsonPath.extract(jsonReader);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Object extract(String json, String path, Feature... features) {
<b class="nc">&nbsp;        JSONReader jsonReader = JSONReader.of(json);</b>
<b class="nc">&nbsp;        JSONPath jsonPath = JSONPath.of(path, features);</b>
<b class="nc">&nbsp;        return jsonPath.extract(jsonReader);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Object eval(String str, String path) {
<b class="nc">&nbsp;        return extract(str, path);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Object eval(Object rootObject, String path) {
<b class="nc">&nbsp;        return JSONPath.of(path)</b>
<b class="nc">&nbsp;                .eval(rootObject);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String set(String json, String path, Object value) {
<b class="nc">&nbsp;        Object object = JSON.parse(json);</b>
<b class="nc">&nbsp;        JSONPath.of(path)</b>
<b class="nc">&nbsp;                .set(object, value);</b>
<b class="nc">&nbsp;        return JSON.toJSONString(object);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean contains(Object rootObject, String path) {
<b class="nc">&nbsp;        if (rootObject == null) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        JSONPath jsonPath = JSONPath.of(path);</b>
<b class="nc">&nbsp;        return jsonPath.contains(rootObject);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Object set(Object rootObject, String path, Object value) {
<b class="nc">&nbsp;        JSONPath.of(path)</b>
<b class="nc">&nbsp;                .set(rootObject, value);</b>
&nbsp;
<b class="nc">&nbsp;        return rootObject;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Object setCallback(Object rootObject, String path, Function callback) {
<b class="nc">&nbsp;        JSONPath.of(path)</b>
<b class="nc">&nbsp;                .setCallback(rootObject, callback);</b>
&nbsp;
<b class="nc">&nbsp;        return rootObject;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Object setCallback(Object rootObject, String path, BiFunction callback) {
<b class="nc">&nbsp;        JSONPath.of(path)</b>
<b class="nc">&nbsp;                .setCallback(rootObject, callback);</b>
&nbsp;
<b class="nc">&nbsp;        return rootObject;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String remove(String json, String path) {
<b class="nc">&nbsp;        Object object = JSON.parse(json);</b>
&nbsp;
<b class="nc">&nbsp;        JSONPath.of(path)</b>
<b class="nc">&nbsp;                .remove(object);</b>
&nbsp;
<b class="nc">&nbsp;        return JSON.toJSONString(object);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static void remove(Object rootObject, String path) {
<b class="nc">&nbsp;        JSONPath.of(path)</b>
<b class="nc">&nbsp;                .remove(rootObject);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Map&lt;String, Object&gt; paths(Object javaObject) {
<b class="nc">&nbsp;        Map&lt;Object, String&gt; values = new IdentityHashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;String, Object&gt; paths = new HashMap&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        RootPath.INSTANCE.paths(values, paths, &quot;$&quot;, javaObject);</b>
<b class="nc">&nbsp;        return paths;</b>
&nbsp;    }
&nbsp;
&nbsp;    void paths(Map&lt;Object, String&gt; values, Map&lt;String, Object&gt; paths, String parent, Object javaObject) {
<b class="nc">&nbsp;        if (javaObject == null) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        String p = values.put(javaObject, parent);</b>
<b class="nc">&nbsp;        if (p != null) {</b>
<b class="nc">&nbsp;            Class&lt;?&gt; type = javaObject.getClass();</b>
<b class="nc">&nbsp;            boolean basicType = type == String.class</b>
&nbsp;                    || type == Boolean.class
&nbsp;                    || type == Character.class
&nbsp;                    || type == UUID.class
&nbsp;                    || javaObject instanceof Enum
&nbsp;                    || javaObject instanceof Number
&nbsp;                    || javaObject instanceof Date;
&nbsp;
<b class="nc">&nbsp;            if (!basicType) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        paths.put(parent, javaObject);</b>
&nbsp;
<b class="nc">&nbsp;        if (javaObject instanceof Map) {</b>
<b class="nc">&nbsp;            Map map = (Map) javaObject;</b>
&nbsp;
<b class="nc">&nbsp;            for (Object entryObj : map.entrySet()) {</b>
<b class="nc">&nbsp;                Map.Entry entry = (Map.Entry) entryObj;</b>
<b class="nc">&nbsp;                Object key = entry.getKey();</b>
&nbsp;
<b class="nc">&nbsp;                if (key instanceof String) {</b>
<b class="nc">&nbsp;                    String path = parent + &quot;.&quot; + key;</b>
<b class="nc">&nbsp;                    paths(values, paths, path, entry.getValue());</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (javaObject instanceof Collection) {</b>
<b class="nc">&nbsp;            Collection collection = (Collection) javaObject;</b>
&nbsp;
<b class="nc">&nbsp;            int i = 0;</b>
<b class="nc">&nbsp;            for (Object item : collection) {</b>
<b class="nc">&nbsp;                String path = parent + &quot;[&quot; + i + &quot;]&quot;;</b>
<b class="nc">&nbsp;                paths(values, paths, path, item);</b>
<b class="nc">&nbsp;                ++i;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Class&lt;?&gt; clazz = javaObject.getClass();</b>
&nbsp;
<b class="nc">&nbsp;        if (clazz.isArray()) {</b>
<b class="nc">&nbsp;            int len = Array.getLength(javaObject);</b>
&nbsp;
<b class="nc">&nbsp;            for (int i = 0; i &lt; len; ++i) {</b>
<b class="nc">&nbsp;                Object item = Array.get(javaObject, i);</b>
&nbsp;
<b class="nc">&nbsp;                String path = parent + &quot;[&quot; + i + &quot;]&quot;;</b>
<b class="nc">&nbsp;                paths(values, paths, path, item);</b>
&nbsp;            }
&nbsp;
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (ObjectWriterProvider.isPrimitiveOrEnum(clazz)) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        ObjectWriter serializer = getWriterContext().getObjectWriter(clazz);</b>
<b class="nc">&nbsp;        if (serializer instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;            ObjectWriterAdapter javaBeanSerializer = (ObjectWriterAdapter) serializer;</b>
&nbsp;
&nbsp;            try {
<b class="nc">&nbsp;                Map&lt;String, Object&gt; fieldValues = javaBeanSerializer.toMap(javaObject);</b>
<b class="nc">&nbsp;                for (Map.Entry&lt;String, Object&gt; entry : fieldValues.entrySet()) {</b>
<b class="nc">&nbsp;                    String key = entry.getKey();</b>
&nbsp;
<b class="nc">&nbsp;                    if (key != null) {</b>
<b class="nc">&nbsp;                        String path = parent + &quot;.&quot; + key;</b>
<b class="nc">&nbsp;                        paths(values, paths, path, entry.getValue());</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            } catch (Exception e) {</b>
<b class="nc">&nbsp;                throw new JSONException(&quot;toJSON error&quot;, e);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public abstract boolean isRef();
&nbsp;
&nbsp;    public void arrayAdd(Object root, Object... values) {
<b class="nc">&nbsp;        Object result = eval(root);</b>
<b class="nc">&nbsp;        if (result == null) {</b>
<b class="nc">&nbsp;            set(root, JSONArray.of(values));</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (result instanceof Collection) {</b>
<b class="nc">&nbsp;            Collection collection = (Collection) result;</b>
<b class="nc">&nbsp;            for (Object value : values) {</b>
<b class="nc">&nbsp;                collection.add(value);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public abstract boolean contains(Object object);
&nbsp;
&nbsp;    public abstract Object eval(Object object);
&nbsp;
&nbsp;    public abstract Object extract(JSONReader jsonReader);
&nbsp;
&nbsp;    public abstract String extractScalar(JSONReader jsonReader);
&nbsp;
&nbsp;    public JSONReader.Context getReaderContext() {
<b class="nc">&nbsp;        if (readerContext == null) {</b>
<b class="nc">&nbsp;            readerContext = JSONFactory.createReadContext();</b>
&nbsp;        }
<b class="nc">&nbsp;        return readerContext;</b>
&nbsp;    }
&nbsp;
&nbsp;    public JSONPath setReaderContext(JSONReader.Context context) {
<b class="nc">&nbsp;        this.readerContext = context;</b>
<b class="nc">&nbsp;        return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    public JSONWriter.Context getWriterContext() {
<b class="nc">&nbsp;        if (writerContext == null) {</b>
<b class="nc">&nbsp;            writerContext = JSONFactory.createWriteContext();</b>
&nbsp;        }
<b class="nc">&nbsp;        return writerContext;</b>
&nbsp;    }
&nbsp;
&nbsp;    public JSONPath setWriterContext(JSONWriter.Context writerContext) {
<b class="nc">&nbsp;        this.writerContext = writerContext;</b>
<b class="nc">&nbsp;        return this;</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void set(Object object, Object value);
&nbsp;
&nbsp;    public abstract void set(Object object, Object value, JSONReader.Feature... readerFeatures);
&nbsp;
&nbsp;    public void setCallback(Object object, Function callback) {
<b class="nc">&nbsp;        setCallback(</b>
&nbsp;                object,
&nbsp;                new BiFunctionAdapter(callback)
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    public abstract void setCallback(Object object, BiFunction callback);
&nbsp;
&nbsp;    public abstract void setInt(Object object, int value);
&nbsp;
&nbsp;    public abstract void setLong(Object object, long value);
&nbsp;
&nbsp;    public abstract boolean remove(Object object);
&nbsp;
&nbsp;    public void extract(JSONReader jsonReader, ValueConsumer consumer) {
<b class="nc">&nbsp;        Object object = extract(jsonReader);</b>
<b class="nc">&nbsp;        if (object == null) {</b>
<b class="nc">&nbsp;            consumer.acceptNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (object instanceof Number) {</b>
<b class="nc">&nbsp;            consumer.accept((Number) object);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (object instanceof String) {</b>
<b class="nc">&nbsp;            consumer.accept((String) object);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (object instanceof Boolean) {</b>
<b class="nc">&nbsp;            consumer.accept((Boolean) object);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (object instanceof Map) {</b>
<b class="nc">&nbsp;            consumer.accept((Map) object);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (object instanceof List) {</b>
<b class="nc">&nbsp;            consumer.accept((List) object);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        throw new JSONException(&quot;TODO : &quot; + object.getClass());</b>
&nbsp;    }
&nbsp;
&nbsp;    public void extractScalar(JSONReader jsonReader, ValueConsumer consumer) {
<b class="nc">&nbsp;        Object object = extractScalar(jsonReader);</b>
<b class="nc">&nbsp;        if (object == null) {</b>
<b class="nc">&nbsp;            consumer.acceptNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        String str = object.toString();</b>
<b class="nc">&nbsp;        consumer.accept(str);</b>
&nbsp;    }
&nbsp;
&nbsp;    public Long extractInt64(JSONReader jsonReader) {
<b class="nc">&nbsp;        long value = extractInt64Value(jsonReader);</b>
<b class="nc">&nbsp;        if (jsonReader.wasNull) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        return value;</b>
&nbsp;    }
&nbsp;
&nbsp;    public long extractInt64Value(JSONReader jsonReader) {
<b class="nc">&nbsp;        Object object = extract(jsonReader);</b>
<b class="nc">&nbsp;        if (object == null) {</b>
<b class="nc">&nbsp;            jsonReader.wasNull = true;</b>
<b class="nc">&nbsp;            return 0L;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (object instanceof Number) {</b>
<b class="nc">&nbsp;            return ((Number) object).longValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        java.util.function.Function typeConvert = JSONFactory.getDefaultObjectReaderProvider().getTypeConvert(object.getClass(), long.class);</b>
<b class="nc">&nbsp;        if (typeConvert == null) {</b>
<b class="nc">&nbsp;            throw new JSONException(&quot;can not convert to long : &quot; + object);</b>
&nbsp;        }
<b class="nc">&nbsp;        Object converted = typeConvert.apply(object);</b>
<b class="nc">&nbsp;        return ((Long) converted).longValue();</b>
&nbsp;    }
&nbsp;
&nbsp;    public Integer extractInt32(JSONReader jsonReader) {
<b class="nc">&nbsp;        int intValue = extractInt32Value(jsonReader);</b>
<b class="nc">&nbsp;        if (jsonReader.wasNull) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        return intValue;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int extractInt32Value(JSONReader jsonReader) {
<b class="nc">&nbsp;        Object object = extract(jsonReader);</b>
<b class="nc">&nbsp;        if (object == null) {</b>
<b class="nc">&nbsp;            jsonReader.wasNull = true;</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (object instanceof Number) {</b>
<b class="nc">&nbsp;            return ((Number) object).intValue();</b>
&nbsp;        }
<b class="nc">&nbsp;        java.util.function.Function typeConvert = JSONFactory.getDefaultObjectReaderProvider().getTypeConvert(object.getClass(), int.class);</b>
<b class="nc">&nbsp;        if (typeConvert == null) {</b>
<b class="nc">&nbsp;            throw new JSONException(&quot;can not convert to int : &quot; + object);</b>
&nbsp;        }
<b class="nc">&nbsp;        Object converted = typeConvert.apply(object);</b>
<b class="nc">&nbsp;        return ((Integer) converted).intValue();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Deprecated
&nbsp;    public static JSONPath compile(String path) {
<b class="nc">&nbsp;        return of(path);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONPath compile(String strPath, Class objectClass) {
<b class="nc">&nbsp;        JSONPath path = of(strPath);</b>
<b class="nc">&nbsp;        JSONFactory.JSONPathCompiler compiler = JSONFactory.getDefaultJSONPathCompiler();</b>
<b class="nc">&nbsp;        return compiler.compile(objectClass, path);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONPath of(String path) {
<b class="nc">&nbsp;        if (&quot;#-1&quot;.equals(path)) {</b>
<b class="nc">&nbsp;            return PreviousPath.INSTANCE;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return new JSONPathParser(path)</b>
<b class="nc">&nbsp;                .parse();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONPath of(String path, Feature... features) {
<b class="nc">&nbsp;        if (&quot;#-1&quot;.equals(path)) {</b>
<b class="nc">&nbsp;            return PreviousPath.INSTANCE;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return new JSONPathParser(path)</b>
<b class="nc">&nbsp;                .parse(features);</b>
&nbsp;    }
&nbsp;
&nbsp;    static Operator parseOperator(JSONReader jsonReader) {
&nbsp;        Operator operator;
<b class="nc">&nbsp;        switch (jsonReader.ch) {</b>
&nbsp;            case &#39;&lt;&#39;:
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;=&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    operator = Operator.LE;</b>
<b class="nc">&nbsp;                } else if (jsonReader.ch == &#39;&gt;&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    operator = Operator.NE;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    operator = Operator.LT;</b>
&nbsp;                }
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &#39;=&#39;:
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;~&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    operator = Operator.REG_MATCH;</b>
<b class="nc">&nbsp;                } else if (jsonReader.ch == &#39;=&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    operator = Operator.EQ;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    operator = Operator.EQ;</b>
&nbsp;                }
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &#39;!&#39;:
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;=&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    operator = Operator.NE;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : !&quot; + jsonReader.ch);</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            case &#39;&gt;&#39;:
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;=&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    operator = Operator.GE;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    operator = Operator.GT;</b>
&nbsp;                }
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &#39;l&#39;:
&nbsp;            case &#39;L&#39;: {
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                String fieldName = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                if (&quot;like&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.LIKE;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            }
&nbsp;            case &#39;n&#39;:
&nbsp;            case &#39;N&#39;: {
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                String fieldName = jsonReader.getFieldName();</b>
&nbsp;
<b class="nc">&nbsp;                if (&quot;nin&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.NOT_IN;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (!&quot;not&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                fieldName = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                if (&quot;like&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.NOT_LIKE;</b>
<b class="nc">&nbsp;                } else if (&quot;rlike&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.NOT_RLIKE;</b>
<b class="nc">&nbsp;                } else if (&quot;in&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.NOT_IN;</b>
<b class="nc">&nbsp;                } else if (&quot;between&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.NOT_BETWEEN;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            }
&nbsp;            case &#39;i&#39;:
&nbsp;            case &#39;I&#39;: {
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                String fieldName = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                if (&quot;in&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.IN;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            }
&nbsp;            case &#39;r&#39;:
&nbsp;            case &#39;R&#39;: {
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                String fieldName = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                if (&quot;rlike&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.RLIKE;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            }
&nbsp;            case &#39;b&#39;:
&nbsp;            case &#39;B&#39;: {
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                String fieldName = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                if (&quot;between&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    operator = Operator.BETWEEN;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            }
&nbsp;            case &#39;s&#39;:
&nbsp;            case &#39;S&#39;: {
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                String fieldName = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                if (!&quot;starts&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                fieldName = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                if (!&quot;with&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                }
<b class="nc">&nbsp;                operator = Operator.STARTS_WITH;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
&nbsp;            default: {
<b class="nc">&nbsp;                jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                throw new JSONException(&quot;not support operator : &quot; + jsonReader.getFieldName());</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return operator;</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    enum Operator {</b>
<b class="nc">&nbsp;        EQ,</b>
<b class="nc">&nbsp;        NE,</b>
<b class="nc">&nbsp;        GT,</b>
<b class="nc">&nbsp;        GE,</b>
<b class="nc">&nbsp;        LT,</b>
<b class="nc">&nbsp;        LE,</b>
<b class="nc">&nbsp;        LIKE,</b>
<b class="nc">&nbsp;        NOT_LIKE,</b>
<b class="nc">&nbsp;        RLIKE,</b>
<b class="nc">&nbsp;        NOT_RLIKE,</b>
<b class="nc">&nbsp;        IN,</b>
<b class="nc">&nbsp;        NOT_IN,</b>
<b class="nc">&nbsp;        BETWEEN,</b>
<b class="nc">&nbsp;        NOT_BETWEEN,</b>
<b class="nc">&nbsp;        AND,</b>
<b class="nc">&nbsp;        OR,</b>
<b class="nc">&nbsp;        REG_MATCH,</b>
<b class="nc">&nbsp;        STARTS_WITH,</b>
<b class="nc">&nbsp;        CONTAINS,</b>
<b class="nc">&nbsp;        NOT_CONTAINS</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    abstract static class FilterSegment</b>
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
&nbsp;        abstract boolean apply(Context context, Object object);
&nbsp;    }
&nbsp;
&nbsp;    interface EvalSegment {
&nbsp;    }
&nbsp;
&nbsp;    static final class NameIntOpSegment
&nbsp;            extends NameFilter {
&nbsp;        final Operator operator;
&nbsp;        final long value;
&nbsp;
&nbsp;        public NameIntOpSegment(
&nbsp;                String name,
&nbsp;                long nameHashCode,
&nbsp;                String[] fieldName2,
&nbsp;                long[] fieldNameNameHash2,
&nbsp;                Function expr,
&nbsp;                Operator operator,
&nbsp;                long value) {
<b class="nc">&nbsp;            super(name, nameHashCode, fieldName2, fieldNameNameHash2, expr);</b>
<b class="nc">&nbsp;            this.operator = operator;</b>
<b class="nc">&nbsp;            this.value = value;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            boolean objInt = fieldValue instanceof Boolean</b>
&nbsp;                    || fieldValue instanceof Byte
&nbsp;                    || fieldValue instanceof Short
&nbsp;                    || fieldValue instanceof Integer
&nbsp;                    || fieldValue instanceof Long;
<b class="nc">&nbsp;            if (objInt) {</b>
&nbsp;                long fieldValueInt;
<b class="nc">&nbsp;                if (fieldValue instanceof Boolean) {</b>
<b class="nc">&nbsp;                    fieldValueInt = (Boolean) fieldValue ? 1 : 0;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    fieldValueInt = ((Number) fieldValue).longValue();</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                switch (operator) {</b>
&nbsp;                    case LT:
<b class="nc">&nbsp;                        return fieldValueInt &lt; this.value;</b>
&nbsp;                    case LE:
<b class="nc">&nbsp;                        return fieldValueInt &lt;= this.value;</b>
&nbsp;                    case EQ:
<b class="nc">&nbsp;                        return fieldValueInt == this.value;</b>
&nbsp;                    case NE:
<b class="nc">&nbsp;                        return fieldValueInt != this.value;</b>
&nbsp;                    case GT:
<b class="nc">&nbsp;                        return fieldValueInt &gt; this.value;</b>
&nbsp;                    case GE:
<b class="nc">&nbsp;                        return fieldValueInt &gt;= this.value;</b>
&nbsp;                    default:
<b class="nc">&nbsp;                        throw new UnsupportedOperationException();</b>
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;            int cmp;
<b class="nc">&nbsp;            if (fieldValue instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                cmp = ((BigDecimal) fieldValue)</b>
<b class="nc">&nbsp;                        .compareTo(</b>
<b class="nc">&nbsp;                                BigDecimal.valueOf(value));</b>
<b class="nc">&nbsp;            } else if (fieldValue instanceof BigInteger) {</b>
<b class="nc">&nbsp;                cmp = ((BigInteger) fieldValue)</b>
<b class="nc">&nbsp;                        .compareTo(</b>
<b class="nc">&nbsp;                                BigInteger.valueOf(value));</b>
<b class="nc">&nbsp;            } else if (fieldValue instanceof Float) {</b>
<b class="nc">&nbsp;                cmp = ((Float) fieldValue)</b>
<b class="nc">&nbsp;                        .compareTo(</b>
<b class="nc">&nbsp;                                Float.valueOf(value));</b>
<b class="nc">&nbsp;            } else if (fieldValue instanceof Double) {</b>
<b class="nc">&nbsp;                cmp = ((Double) fieldValue)</b>
<b class="nc">&nbsp;                        .compareTo(</b>
<b class="nc">&nbsp;                                Double.valueOf(value));</b>
<b class="nc">&nbsp;            } else if (fieldValue instanceof String) {</b>
<b class="nc">&nbsp;                String fieldValueStr = (String) fieldValue;</b>
<b class="nc">&nbsp;                if (IOUtils.isNumber(fieldValueStr)) {</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        cmp = Long.valueOf(Long.parseLong(fieldValueStr)).compareTo(Long.valueOf(value));</b>
<b class="nc">&nbsp;                    } catch (Exception ignored) {</b>
<b class="nc">&nbsp;                        cmp = fieldValueStr.compareTo(Long.toString(value));</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    cmp = fieldValueStr.compareTo(Long.toString(value));</b>
&nbsp;                }
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                throw new UnsupportedOperationException();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            switch (operator) {</b>
&nbsp;                case LT:
<b class="nc">&nbsp;                    return cmp &lt; 0;</b>
&nbsp;                case LE:
<b class="nc">&nbsp;                    return cmp &lt;= 0;</b>
&nbsp;                case EQ:
<b class="nc">&nbsp;                    return cmp == 0;</b>
&nbsp;                case NE:
<b class="nc">&nbsp;                    return cmp != 0;</b>
&nbsp;                case GT:
<b class="nc">&nbsp;                    return cmp &gt; 0;</b>
&nbsp;                case GE:
<b class="nc">&nbsp;                    return cmp &gt;= 0;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new UnsupportedOperationException();</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Context context, Object value) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; list.size(); i++) {</b>
<b class="nc">&nbsp;                    Object item = list.get(i);</b>
<b class="nc">&nbsp;                    if (apply(context, item)) {</b>
<b class="nc">&nbsp;                        list.set(i, value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation &quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameDecimalOpSegment
&nbsp;            extends NameFilter {
&nbsp;        final Operator operator;
&nbsp;        final BigDecimal value;
&nbsp;
&nbsp;        public NameDecimalOpSegment(String name, long nameHashCode, Operator operator, BigDecimal value) {
<b class="nc">&nbsp;            super(name, nameHashCode);</b>
<b class="nc">&nbsp;            this.operator = operator;</b>
<b class="nc">&nbsp;            this.value = value;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            if (fieldValue == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
&nbsp;            BigDecimal fieldValueDecimal;
&nbsp;
<b class="nc">&nbsp;            if (fieldValue instanceof Boolean) {</b>
<b class="nc">&nbsp;                fieldValueDecimal = (Boolean) fieldValue ? BigDecimal.ONE : BigDecimal.ZERO;</b>
<b class="nc">&nbsp;            } else if (fieldValue instanceof Byte</b>
&nbsp;                    || fieldValue instanceof Short
&nbsp;                    || fieldValue instanceof Integer
&nbsp;                    || fieldValue instanceof Long) {
<b class="nc">&nbsp;                fieldValueDecimal = BigDecimal.valueOf(</b>
<b class="nc">&nbsp;                        ((Number) fieldValue).longValue()</b>
&nbsp;                );
<b class="nc">&nbsp;            } else if (fieldValue instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                fieldValueDecimal = ((BigDecimal) fieldValue);</b>
<b class="nc">&nbsp;            } else if (fieldValue instanceof BigInteger) {</b>
<b class="nc">&nbsp;                fieldValueDecimal = new BigDecimal((BigInteger) fieldValue);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new UnsupportedOperationException();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int cmp = fieldValueDecimal.compareTo(value);</b>
<b class="nc">&nbsp;            switch (operator) {</b>
&nbsp;                case LT:
<b class="nc">&nbsp;                    return cmp &lt; 0;</b>
&nbsp;                case LE:
<b class="nc">&nbsp;                    return cmp &lt;= 0;</b>
&nbsp;                case EQ:
<b class="nc">&nbsp;                    return cmp == 0;</b>
&nbsp;                case NE:
<b class="nc">&nbsp;                    return cmp != 0;</b>
&nbsp;                case GT:
<b class="nc">&nbsp;                    return cmp &gt; 0;</b>
&nbsp;                case GE:
<b class="nc">&nbsp;                    return cmp &gt;= 0;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new UnsupportedOperationException();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameRLikeSegment
&nbsp;            extends NameFilter {
&nbsp;        final Pattern pattern;
&nbsp;        final boolean not;
&nbsp;
&nbsp;        public NameRLikeSegment(String fieldName, long fieldNameNameHash, Pattern pattern, boolean not) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash);</b>
<b class="nc">&nbsp;            this.pattern = pattern;</b>
<b class="nc">&nbsp;            this.not = not;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            String strPropertyValue = fieldValue.toString();</b>
<b class="nc">&nbsp;            Matcher m = pattern.matcher(strPropertyValue);</b>
<b class="nc">&nbsp;            boolean match = m.matches();</b>
&nbsp;
<b class="nc">&nbsp;            if (not) {</b>
<b class="nc">&nbsp;                match = !match;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return match;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class StartsWithSegment
&nbsp;            extends NameFilter {
&nbsp;        final String prefix;
&nbsp;
&nbsp;        public StartsWithSegment(String fieldName, long fieldNameNameHash, String prefix) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash);</b>
<b class="nc">&nbsp;            this.prefix = prefix;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            String propertyValue = fieldValue.toString();</b>
<b class="nc">&nbsp;            return propertyValue != null &amp;&amp; propertyValue.startsWith(prefix);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class GroupFilter
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
&nbsp;        final boolean and;
&nbsp;        final List&lt;FilterSegment&gt; filters;
&nbsp;
<b class="nc">&nbsp;        public GroupFilter(List&lt;FilterSegment&gt; filters, boolean and) {</b>
<b class="nc">&nbsp;            this.and = and;</b>
<b class="nc">&nbsp;            this.filters = filters;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent == null) {</b>
<b class="nc">&nbsp;                context.root = jsonReader.readAny();</b>
&nbsp;            }
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray(list.size());</b>
<b class="nc">&nbsp;                for (int i = 0, l = list.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                    Object item = list.get(i);</b>
<b class="nc">&nbsp;                    boolean match = and;</b>
<b class="nc">&nbsp;                    for (FilterSegment filter : filters) {</b>
<b class="nc">&nbsp;                        boolean result = filter.apply(context, item);</b>
<b class="nc">&nbsp;                        if (and) {</b>
<b class="nc">&nbsp;                            if (!result) {</b>
<b class="nc">&nbsp;                                match = false;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        } else {
<b class="nc">&nbsp;                            if (result) {</b>
<b class="nc">&nbsp;                                match = true;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                    if (match) {</b>
<b class="nc">&nbsp;                        array.add(item);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.value = array;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            boolean match = and;</b>
<b class="nc">&nbsp;            for (FilterSegment filter : filters) {</b>
<b class="nc">&nbsp;                boolean result = filter.apply(context, object);</b>
<b class="nc">&nbsp;                if (and) {</b>
<b class="nc">&nbsp;                    if (!result) {</b>
<b class="nc">&nbsp;                        match = false;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    if (result) {</b>
<b class="nc">&nbsp;                        match = true;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            if (match) {</b>
<b class="nc">&nbsp;                context.value = object;</b>
&nbsp;            }
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameIntInSegment
&nbsp;            extends NameFilter {
&nbsp;        private final long[] values;
&nbsp;        private final boolean not;
&nbsp;
&nbsp;        public NameIntInSegment(
&nbsp;                String fieldName,
&nbsp;                long fieldNameNameHash,
&nbsp;                String[] fieldName2,
&nbsp;                long[] fieldNameNameHash2,
&nbsp;                Function expr,
&nbsp;                long[] values,
&nbsp;                boolean not) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash, fieldName2, fieldNameNameHash2, expr);</b>
<b class="nc">&nbsp;            this.values = values;</b>
<b class="nc">&nbsp;            this.not = not;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            if (fieldValue instanceof Byte</b>
&nbsp;                    || fieldValue instanceof Short
&nbsp;                    || fieldValue instanceof Integer
&nbsp;                    || fieldValue instanceof Long
&nbsp;            ) {
<b class="nc">&nbsp;                long fieldValueLong = ((Number) fieldValue).longValue();</b>
&nbsp;
<b class="nc">&nbsp;                for (long value : values) {</b>
<b class="nc">&nbsp;                    if (value == fieldValueLong) {</b>
<b class="nc">&nbsp;                        return !not;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (fieldValue instanceof Float</b>
&nbsp;                    || fieldValue instanceof Double
&nbsp;            ) {
<b class="nc">&nbsp;                double fieldValueDouble = ((Number) fieldValue).doubleValue();</b>
&nbsp;
<b class="nc">&nbsp;                for (long value : values) {</b>
<b class="nc">&nbsp;                    if (value == fieldValueDouble) {</b>
<b class="nc">&nbsp;                        return !not;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (fieldValue instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                BigDecimal decimal = (BigDecimal) fieldValue;</b>
<b class="nc">&nbsp;                long longValue = decimal.longValue();</b>
<b class="nc">&nbsp;                for (long value : values) {</b>
<b class="nc">&nbsp;                    if (value == longValue &amp;&amp; decimal.equals(BigDecimal.valueOf(value))) {</b>
<b class="nc">&nbsp;                        return !not;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (fieldValue instanceof BigInteger) {</b>
<b class="nc">&nbsp;                BigInteger bigiInt = (BigInteger) fieldValue;</b>
<b class="nc">&nbsp;                long longValue = bigiInt.longValue();</b>
<b class="nc">&nbsp;                for (long value : values) {</b>
<b class="nc">&nbsp;                    if (value == longValue &amp;&amp; bigiInt.equals(BigInteger.valueOf(value))) {</b>
<b class="nc">&nbsp;                        return !not;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return not;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameLongContainsSegment
&nbsp;            extends NameFilter {
&nbsp;        private final long[] values;
&nbsp;        private final boolean not;
&nbsp;
&nbsp;        public NameLongContainsSegment(
&nbsp;                String fieldName,
&nbsp;                long fieldNameNameHash,
&nbsp;                String[] fieldName2,
&nbsp;                long[] fieldNameNameHash2,
&nbsp;                long[] values, boolean not) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash, fieldName2, fieldNameNameHash2, null);</b>
<b class="nc">&nbsp;            this.values = values;</b>
<b class="nc">&nbsp;            this.not = not;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            if (fieldValue instanceof Collection) {</b>
<b class="nc">&nbsp;                Collection collection = (Collection) fieldValue;</b>
&nbsp;
<b class="nc">&nbsp;                boolean containsAll = true;</b>
<b class="nc">&nbsp;                for (long value : values) {</b>
<b class="nc">&nbsp;                    boolean containsItem = false;</b>
<b class="nc">&nbsp;                    for (Object item : collection) {</b>
&nbsp;                        long longItem;
<b class="nc">&nbsp;                        if (item instanceof Byte</b>
&nbsp;                                || item instanceof Short
&nbsp;                                || item instanceof Integer
&nbsp;                                || item instanceof Long) {
<b class="nc">&nbsp;                            longItem = ((Number) item).longValue();</b>
<b class="nc">&nbsp;                            if (longItem == value) {</b>
<b class="nc">&nbsp;                                containsItem = true;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (item instanceof Float) {</b>
<b class="nc">&nbsp;                            if (value == (Float) item) {</b>
<b class="nc">&nbsp;                                containsItem = true;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (item instanceof Double) {</b>
<b class="nc">&nbsp;                            if (value == (Double) item) {</b>
<b class="nc">&nbsp;                                containsItem = true;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (item instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                            BigDecimal decimal = (BigDecimal) item;</b>
<b class="nc">&nbsp;                            long longValue = decimal.longValue();</b>
<b class="nc">&nbsp;                            if (value == longValue &amp;&amp; decimal.equals(BigDecimal.valueOf(value))) {</b>
<b class="nc">&nbsp;                                containsItem = true;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (item instanceof BigInteger) {</b>
<b class="nc">&nbsp;                            BigInteger bigiInt = (BigInteger) item;</b>
<b class="nc">&nbsp;                            long longValue = bigiInt.longValue();</b>
<b class="nc">&nbsp;                            if (value == longValue &amp;&amp; bigiInt.equals(BigInteger.valueOf(value))) {</b>
<b class="nc">&nbsp;                                containsItem = true;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
&nbsp;
<b class="nc">&nbsp;                    if (!containsItem) {</b>
<b class="nc">&nbsp;                        containsAll = false;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (containsAll) {</b>
<b class="nc">&nbsp;                    return !not;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return not;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameIntBetweenSegment
&nbsp;            extends NameFilter {
&nbsp;        private final long begin;
&nbsp;        private final long end;
&nbsp;        private final boolean not;
&nbsp;
&nbsp;        public NameIntBetweenSegment(String fieldName, long fieldNameNameHash, long begin, long end, boolean not) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash);</b>
<b class="nc">&nbsp;            this.begin = begin;</b>
<b class="nc">&nbsp;            this.end = end;</b>
<b class="nc">&nbsp;            this.not = not;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            if (fieldValue instanceof Byte</b>
&nbsp;                    || fieldValue instanceof Short
&nbsp;                    || fieldValue instanceof Integer
&nbsp;                    || fieldValue instanceof Long
&nbsp;            ) {
<b class="nc">&nbsp;                long fieldValueLong = ((Number) fieldValue).longValue();</b>
&nbsp;
<b class="nc">&nbsp;                if (fieldValueLong &gt;= begin &amp;&amp; fieldValueLong &lt;= end) {</b>
<b class="nc">&nbsp;                    return !not;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (fieldValue instanceof Float</b>
&nbsp;                    || fieldValue instanceof Double
&nbsp;            ) {
<b class="nc">&nbsp;                double fieldValueDouble = ((Number) fieldValue).doubleValue();</b>
&nbsp;
<b class="nc">&nbsp;                if (fieldValueDouble &gt;= begin &amp;&amp; fieldValueDouble &lt;= end) {</b>
<b class="nc">&nbsp;                    return !not;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (fieldValue instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                BigDecimal decimal = (BigDecimal) fieldValue;</b>
<b class="nc">&nbsp;                int cmpBegin = decimal.compareTo(BigDecimal.valueOf(begin));</b>
<b class="nc">&nbsp;                int cmpEnd = decimal.compareTo(BigDecimal.valueOf(end));</b>
&nbsp;
<b class="nc">&nbsp;                if (cmpBegin &gt;= 0 &amp;&amp; cmpEnd &lt;= 0) {</b>
<b class="nc">&nbsp;                    return !not;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (fieldValue instanceof BigInteger) {</b>
<b class="nc">&nbsp;                BigInteger bigInt = (BigInteger) fieldValue;</b>
<b class="nc">&nbsp;                int cmpBegin = bigInt.compareTo(BigInteger.valueOf(begin));</b>
<b class="nc">&nbsp;                int cmpEnd = bigInt.compareTo(BigInteger.valueOf(end));</b>
&nbsp;
<b class="nc">&nbsp;                if (cmpBegin &gt;= 0 &amp;&amp; cmpEnd &lt;= 0) {</b>
<b class="nc">&nbsp;                    return !not;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return not;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class TypeFunction</b>
&nbsp;            implements Function {
<b class="nc">&nbsp;        static final TypeFunction INSTANCE = new TypeFunction();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public Object apply(Object object) {
<b class="nc">&nbsp;            return type(object);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class SizeFunction</b>
&nbsp;            implements Function {
<b class="nc">&nbsp;        static final SizeFunction INSTANCE = new SizeFunction();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public Object apply(Object value) {
<b class="nc">&nbsp;            if (value == null) {</b>
<b class="nc">&nbsp;                return -1;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (value instanceof Collection) {</b>
<b class="nc">&nbsp;                return ((Collection&lt;?&gt;) value).size();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (value.getClass().isArray()) {</b>
<b class="nc">&nbsp;                return Array.getLength(value);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (value instanceof Map) {</b>
<b class="nc">&nbsp;                return ((Map) value).size();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (value instanceof Sequence) {</b>
<b class="nc">&nbsp;                return ((Sequence) value).values.size();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return 1;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    abstract static class NameFilter
&nbsp;            extends FilterSegment {
&nbsp;        final String fieldName;
&nbsp;        final long fieldNameNameHash;
&nbsp;
&nbsp;        final String[] fieldName2;
&nbsp;        final long[] fieldNameNameHash2;
&nbsp;
&nbsp;        final Function function;
&nbsp;
<b class="nc">&nbsp;        public NameFilter(String fieldName, long fieldNameNameHash) {</b>
<b class="nc">&nbsp;            this.fieldName = fieldName;</b>
<b class="nc">&nbsp;            this.fieldNameNameHash = fieldNameNameHash;</b>
<b class="nc">&nbsp;            this.fieldName2 = null;</b>
<b class="nc">&nbsp;            this.fieldNameNameHash2 = null;</b>
<b class="nc">&nbsp;            this.function = null;</b>
&nbsp;        }
&nbsp;
&nbsp;        public NameFilter(String fieldName,
&nbsp;                          long fieldNameNameHash,
&nbsp;                          String[] fieldName2,
&nbsp;                          long[] fieldNameNameHash2,
<b class="nc">&nbsp;                          Function function) {</b>
<b class="nc">&nbsp;            this.fieldName = fieldName;</b>
<b class="nc">&nbsp;            this.fieldNameNameHash = fieldNameNameHash;</b>
<b class="nc">&nbsp;            this.fieldName2 = fieldName2;</b>
<b class="nc">&nbsp;            this.fieldNameNameHash2 = fieldNameNameHash2;</b>
<b class="nc">&nbsp;            this.function = function;</b>
&nbsp;        }
&nbsp;
&nbsp;        abstract boolean apply(Object fieldValue);
&nbsp;
&nbsp;        @Override
&nbsp;        public final void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent == null) {</b>
<b class="nc">&nbsp;                context.root = jsonReader.readAny();</b>
&nbsp;            }
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                for (int i = list.size() - 1; i &gt;= 0; i--) {</b>
<b class="nc">&nbsp;                    Object item = list.get(i);</b>
<b class="nc">&nbsp;                    if (apply(context, item)) {</b>
<b class="nc">&nbsp;                        list.remove(i);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation &quot; + getClass());</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public final void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray(list.size());</b>
<b class="nc">&nbsp;                for (int i = 0, l = list.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                    Object item = list.get(i);</b>
<b class="nc">&nbsp;                    if (apply(context, item)) {</b>
<b class="nc">&nbsp;                        array.add(item);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.value = array;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] list = (Object[]) object;</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray(list.length);</b>
<b class="nc">&nbsp;                for (Object item : list) {</b>
<b class="nc">&nbsp;                    if (apply(context, item)) {</b>
<b class="nc">&nbsp;                        array.add(item);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.value = array;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Sequence) {</b>
<b class="nc">&nbsp;                Sequence sequence = (Sequence) object;</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray();</b>
<b class="nc">&nbsp;                for (Object value : sequence.values) {</b>
<b class="nc">&nbsp;                    if (value instanceof Collection) {</b>
<b class="nc">&nbsp;                        for (Object valueItem : ((Collection&lt;?&gt;) value)) {</b>
<b class="nc">&nbsp;                            if (apply(context, valueItem)) {</b>
<b class="nc">&nbsp;                                array.add(valueItem);</b>
&nbsp;                            }
<b class="nc">&nbsp;                        }</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        if (apply(context, value)) {</b>
<b class="nc">&nbsp;                            array.add(value);</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                context.value = array;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (apply(context, object)) {</b>
<b class="nc">&nbsp;                context.value = object;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public final boolean apply(Context context, Object object) {
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            JSONWriter.Context writerContext = context.path.getWriterContext();</b>
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Object fieldValue = fieldName == null ? object : ((Map&lt;?, ?&gt;) object).get(fieldName);</b>
<b class="nc">&nbsp;                if (fieldValue == null) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (fieldName2 != null) {</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; fieldName2.length; i++) {</b>
<b class="nc">&nbsp;                        String name = fieldName2[i];</b>
<b class="nc">&nbsp;                        if (fieldValue instanceof Map) {</b>
<b class="nc">&nbsp;                            fieldValue = ((Map) fieldValue).get(name);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            ObjectWriter objectWriter2 = writerContext.getObjectWriter(fieldValue.getClass());</b>
<b class="nc">&nbsp;                            if (objectWriter2 instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                                FieldWriter fieldWriter2 = objectWriter2.getFieldWriter(fieldNameNameHash2[i]);</b>
<b class="nc">&nbsp;                                if (fieldWriter2 == null) {</b>
<b class="nc">&nbsp;                                    return false;</b>
&nbsp;                                }
<b class="nc">&nbsp;                                fieldValue = fieldWriter2.getFieldValue(fieldValue);</b>
<b class="nc">&nbsp;                            } else {</b>
<b class="nc">&nbsp;                                return false;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (fieldValue == null) {</b>
<b class="nc">&nbsp;                            return false;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (function != null) {</b>
<b class="nc">&nbsp;                    fieldValue = function.apply(fieldValue);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return apply(fieldValue);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectWriter objectWriter = writerContext.getObjectWriter(object.getClass());</b>
<b class="nc">&nbsp;            if (objectWriter instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                FieldWriter fieldWriter = objectWriter.getFieldWriter(fieldNameNameHash);</b>
<b class="nc">&nbsp;                Object fieldValue = fieldWriter.getFieldValue(object);</b>
&nbsp;
<b class="nc">&nbsp;                if (fieldValue == null) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (fieldName2 != null) {</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; fieldName2.length; i++) {</b>
<b class="nc">&nbsp;                        String name = fieldName2[i];</b>
<b class="nc">&nbsp;                        if (fieldValue instanceof Map) {</b>
<b class="nc">&nbsp;                            fieldValue = ((Map) fieldValue).get(name);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            ObjectWriter objectWriter2 = writerContext.getObjectWriter(fieldValue.getClass());</b>
<b class="nc">&nbsp;                            if (objectWriter2 instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                                FieldWriter fieldWriter2 = objectWriter2.getFieldWriter(fieldNameNameHash2[i]);</b>
<b class="nc">&nbsp;                                if (fieldWriter2 == null) {</b>
<b class="nc">&nbsp;                                    return false;</b>
&nbsp;                                }
<b class="nc">&nbsp;                                fieldValue = fieldWriter2.getFieldValue(fieldValue);</b>
<b class="nc">&nbsp;                            } else {</b>
<b class="nc">&nbsp;                                return false;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (fieldValue == null) {</b>
<b class="nc">&nbsp;                            return false;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (function != null) {</b>
<b class="nc">&nbsp;                    fieldValue = function.apply(fieldValue);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return apply(fieldValue);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (function != null) {</b>
<b class="nc">&nbsp;                Object fieldValue = function.apply(object);</b>
<b class="nc">&nbsp;                return apply(fieldValue);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (fieldName == null) {</b>
<b class="nc">&nbsp;                return apply(object);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameStringOpSegment
&nbsp;            extends NameFilter {
&nbsp;        final Operator operator;
&nbsp;        final String value;
&nbsp;
&nbsp;        public NameStringOpSegment(
&nbsp;                String fieldName,
&nbsp;                long fieldNameNameHash,
&nbsp;                String[] fieldName2,
&nbsp;                long[] fieldNameNameHash2,
&nbsp;                Function expr,
&nbsp;                Operator operator,
&nbsp;                String value
&nbsp;        ) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash, fieldName2, fieldNameNameHash2, expr);</b>
<b class="nc">&nbsp;            this.operator = operator;</b>
<b class="nc">&nbsp;            this.value = value;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            if (!(fieldValue instanceof String)) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int cmp = ((String) fieldValue).compareTo(this.value);</b>
&nbsp;
<b class="nc">&nbsp;            switch (operator) {</b>
&nbsp;                case LT:
<b class="nc">&nbsp;                    return cmp &lt; 0;</b>
&nbsp;                case LE:
<b class="nc">&nbsp;                    return cmp &lt;= 0;</b>
&nbsp;                case EQ:
<b class="nc">&nbsp;                    return cmp == 0;</b>
&nbsp;                case NE:
<b class="nc">&nbsp;                    return cmp != 0;</b>
&nbsp;                case GT:
<b class="nc">&nbsp;                    return cmp &gt; 0;</b>
&nbsp;                case GE:
<b class="nc">&nbsp;                    return cmp &gt;= 0;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new UnsupportedOperationException();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameArrayOpSegment
&nbsp;            extends NameFilter {
&nbsp;        final Operator operator;
&nbsp;        final JSONArray array;
&nbsp;
&nbsp;        public NameArrayOpSegment(
&nbsp;                String fieldName,
&nbsp;                long fieldNameNameHash,
&nbsp;                String[] fieldName2,
&nbsp;                long[] fieldNameNameHash2,
&nbsp;                Function function,
&nbsp;                Operator operator,
&nbsp;                JSONArray array
&nbsp;        ) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash, fieldName2, fieldNameNameHash2, function);</b>
<b class="nc">&nbsp;            this.operator = operator;</b>
<b class="nc">&nbsp;            this.array = array;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            switch (operator) {</b>
&nbsp;                case EQ:
<b class="nc">&nbsp;                    return array.equals(fieldValue);</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + operator);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameObjectOpSegment
&nbsp;            extends NameFilter {
&nbsp;        final Operator operator;
&nbsp;        final JSONObject object;
&nbsp;
&nbsp;        public NameObjectOpSegment(
&nbsp;                String fieldName,
&nbsp;                long fieldNameNameHash,
&nbsp;                String[] fieldName2,
&nbsp;                long[] fieldNameNameHash2,
&nbsp;                Function function,
&nbsp;                Operator operator,
&nbsp;                JSONObject object) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash, fieldName2, fieldNameNameHash2, function);</b>
<b class="nc">&nbsp;            this.operator = operator;</b>
<b class="nc">&nbsp;            this.object = object;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            switch (operator) {</b>
&nbsp;                case EQ:
<b class="nc">&nbsp;                    return object.equals(fieldValue);</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support operator : &quot; + operator);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameStringInSegment
&nbsp;            extends NameFilter {
&nbsp;        private final String[] values;
&nbsp;        private final boolean not;
&nbsp;
&nbsp;        public NameStringInSegment(String fieldName, long fieldNameNameHash, String[] values, boolean not) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash);</b>
<b class="nc">&nbsp;            this.values = values;</b>
<b class="nc">&nbsp;            this.not = not;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            for (String value : values) {</b>
<b class="nc">&nbsp;                if (value == fieldValue) {</b>
<b class="nc">&nbsp;                    return !not;</b>
<b class="nc">&nbsp;                } else if (value != null &amp;&amp; value.equals(fieldValue)) {</b>
<b class="nc">&nbsp;                    return !not;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return not;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameStringContainsSegment
&nbsp;            extends NameFilter {
&nbsp;        private final String[] values;
&nbsp;        private final boolean not;
&nbsp;
&nbsp;        public NameStringContainsSegment(
&nbsp;                String fieldName,
&nbsp;                long fieldNameNameHash,
&nbsp;                String[] fieldName2,
&nbsp;                long[] fieldNameNameHash2,
&nbsp;                String[] values, boolean not) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash, fieldName2, fieldNameNameHash2, null);</b>
<b class="nc">&nbsp;            this.values = values;</b>
<b class="nc">&nbsp;            this.not = not;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Object fieldValue) {
<b class="nc">&nbsp;            if (fieldValue instanceof Collection) {</b>
<b class="nc">&nbsp;                Collection collection = (Collection) fieldValue;</b>
&nbsp;
<b class="nc">&nbsp;                boolean containsAll = true;</b>
<b class="nc">&nbsp;                for (String value : values) {</b>
<b class="nc">&nbsp;                    if (!collection.contains(value)) {</b>
<b class="nc">&nbsp;                        containsAll = false;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (containsAll) {</b>
<b class="nc">&nbsp;                    return !not;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return not;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameMatchFilter
&nbsp;            extends NameFilter {
&nbsp;        final String startsWithValue;
&nbsp;        final String endsWithValue;
&nbsp;        final String[] containsValues;
&nbsp;        final int minLength;
&nbsp;        final boolean not;
&nbsp;
&nbsp;        public NameMatchFilter(
&nbsp;                String fieldName,
&nbsp;                long fieldNameNameHash,
&nbsp;                String startsWithValue,
&nbsp;                String endsWithValue,
&nbsp;                String[] containsValues,
&nbsp;                boolean not) {
<b class="nc">&nbsp;            super(fieldName, fieldNameNameHash);</b>
<b class="nc">&nbsp;            this.startsWithValue = startsWithValue;</b>
<b class="nc">&nbsp;            this.endsWithValue = endsWithValue;</b>
<b class="nc">&nbsp;            this.containsValues = containsValues;</b>
<b class="nc">&nbsp;            this.not = not;</b>
&nbsp;
<b class="nc">&nbsp;            int len = 0;</b>
<b class="nc">&nbsp;            if (startsWithValue != null) {</b>
<b class="nc">&nbsp;                len += startsWithValue.length();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (endsWithValue != null) {</b>
<b class="nc">&nbsp;                len += endsWithValue.length();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (containsValues != null) {</b>
<b class="nc">&nbsp;                for (String item : containsValues) {</b>
<b class="nc">&nbsp;                    len += item.length();</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            this.minLength = len;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        boolean apply(Object arg) {
<b class="nc">&nbsp;            if (!(arg instanceof String)) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String fieldValue = (String) arg;</b>
<b class="nc">&nbsp;            if (fieldValue.length() &lt; minLength) {</b>
<b class="nc">&nbsp;                return not;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int start = 0;</b>
<b class="nc">&nbsp;            if (startsWithValue != null) {</b>
<b class="nc">&nbsp;                if (!fieldValue.startsWith(startsWithValue)) {</b>
<b class="nc">&nbsp;                    return not;</b>
&nbsp;                }
<b class="nc">&nbsp;                start += startsWithValue.length();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (containsValues != null) {</b>
<b class="nc">&nbsp;                for (String containsValue : containsValues) {</b>
<b class="nc">&nbsp;                    int index = fieldValue.indexOf(containsValue, start);</b>
<b class="nc">&nbsp;                    if (index == -1) {</b>
<b class="nc">&nbsp;                        return not;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    start = index + containsValue.length();</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (endsWithValue != null) {</b>
<b class="nc">&nbsp;                if (!fieldValue.endsWith(endsWithValue)) {</b>
<b class="nc">&nbsp;                    return not;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return !not;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class NameExistsFilter
&nbsp;            extends FilterSegment {
&nbsp;        final String name;
&nbsp;        final long nameHashCode;
&nbsp;
<b class="nc">&nbsp;        public NameExistsFilter(String name, long nameHashCode) {</b>
<b class="nc">&nbsp;            this.name = name;</b>
<b class="nc">&nbsp;            this.nameHashCode = nameHashCode;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            JSONArray array = new JSONArray();</b>
<b class="nc">&nbsp;            if (object instanceof List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                for (int i = 0, l = list.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                    Object item = list.get(i);</b>
<b class="nc">&nbsp;                    if (item instanceof Map) {</b>
<b class="nc">&nbsp;                        if (((Map) item).containsKey(name)) {</b>
<b class="nc">&nbsp;                            array.add(item);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.value = array;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                Object value = map.get(name);</b>
<b class="nc">&nbsp;                context.value = value != null ? object : null;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Sequence) {</b>
<b class="nc">&nbsp;                List list = ((Sequence) object).values;</b>
<b class="nc">&nbsp;                for (int i = 0, l = list.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                    Object item = list.get(i);</b>
<b class="nc">&nbsp;                    if (item instanceof Map) {</b>
<b class="nc">&nbsp;                        if (((Map) item).containsKey(name)) {</b>
<b class="nc">&nbsp;                            array.add(item);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.value = new Sequence(array);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String toString() {
<b class="nc">&nbsp;            return &#39;?&#39; + name;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean apply(Context context, Object object) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class PreviousPath
&nbsp;            extends JSONPath {
<b class="nc">&nbsp;        static final PreviousPath INSTANCE = new PreviousPath(&quot;#-1&quot;);</b>
&nbsp;
&nbsp;        PreviousPath(String path) {
<b class="nc">&nbsp;            super(path);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isRef() {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isPrevious() {
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean contains(Object rootObject) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object eval(Object rootObject) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object extract(JSONReader jsonReader) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String extractScalar(JSONReader jsonReader) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object rootObject, Object value) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object rootObject, Object value, JSONReader.Feature... readerFeatures) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Object rootObject, BiFunction callback) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setInt(Object rootObject, int value) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setLong(Object rootObject, long value) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Object rootObject) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class SingleNamePath
&nbsp;            extends JSONPath {
&nbsp;        final long nameHashCode;
&nbsp;        final String name;
&nbsp;
&nbsp;        public SingleNamePath(String path, NameSegment segment, Feature... features) {
<b class="nc">&nbsp;            super(path, features);</b>
<b class="nc">&nbsp;            this.name = segment.name;</b>
<b class="nc">&nbsp;            this.nameHashCode = segment.nameHashCode;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object eval(Object root) {
&nbsp;            Object value;
<b class="nc">&nbsp;            if (root instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) root;</b>
<b class="nc">&nbsp;                value = map.get(name);</b>
<b class="nc">&nbsp;                if (value == null) {</b>
<b class="nc">&nbsp;                    boolean isNum = IOUtils.isNumber(this.name);</b>
<b class="nc">&nbsp;                    Long longValue = null;</b>
&nbsp;
<b class="nc">&nbsp;                    for (Object o : map.entrySet()) {</b>
<b class="nc">&nbsp;                        Map.Entry entry = (Map.Entry) o;</b>
<b class="nc">&nbsp;                        Object entryKey = entry.getKey();</b>
<b class="nc">&nbsp;                        if (entryKey instanceof Enum &amp;&amp; ((Enum&lt;?&gt;) entryKey).name().equals(this.name)) {</b>
<b class="nc">&nbsp;                            value = entry.getValue();</b>
<b class="nc">&nbsp;                            break;</b>
<b class="nc">&nbsp;                        } else if (entryKey instanceof Long) {</b>
<b class="nc">&nbsp;                            if (longValue == null &amp;&amp; isNum) {</b>
<b class="nc">&nbsp;                                longValue = Long.parseLong(this.name);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            if (entryKey.equals(longValue)) {</b>
<b class="nc">&nbsp;                                value = entry.getValue();</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                JSONWriter.Context writerContext = getWriterContext();</b>
<b class="nc">&nbsp;                ObjectWriter objectWriter = writerContext.getObjectWriter(root.getClass());</b>
<b class="nc">&nbsp;                if (objectWriter == null) {</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;                if (fieldWriter == null) {</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                value = fieldWriter.getFieldValue(root);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if ((features &amp; Feature.AlwaysReturnList.mask) != 0) {</b>
<b class="nc">&nbsp;                if (value == null) {</b>
<b class="nc">&nbsp;                    value = new JSONArray();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    value = JSONArray.of(value);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return value;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Object root) {
<b class="nc">&nbsp;            if (root == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (root instanceof Map) {</b>
<b class="nc">&nbsp;                return ((Map&lt;?, ?&gt;) root).remove(name) != null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectReaderProvider provider = getReaderContext().getProvider();</b>
&nbsp;
<b class="nc">&nbsp;            ObjectReader objectReader = provider.getObjectReader(root.getClass());</b>
<b class="nc">&nbsp;            if (objectReader == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            FieldReader fieldReader = objectReader.getFieldReader(nameHashCode);</b>
<b class="nc">&nbsp;            if (fieldReader == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
&nbsp;            try {
<b class="nc">&nbsp;                fieldReader.accept(root, null);</b>
<b class="nc">&nbsp;            } catch (Exception ignored) {</b>
<b class="nc">&nbsp;                return false;</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isRef() {
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean contains(Object root) {
<b class="nc">&nbsp;            if (root instanceof Map) {</b>
<b class="nc">&nbsp;                return ((Map) root).containsKey(name);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectWriterProvider provider = getWriterContext().getProvider();</b>
&nbsp;
<b class="nc">&nbsp;            ObjectWriter objectWriter = provider.getObjectWriter(root.getClass());</b>
<b class="nc">&nbsp;            if (objectWriter == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;            if (fieldWriter == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return fieldWriter.getFieldValue(root) != null;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object rootObject, Object value) {
<b class="nc">&nbsp;            if (rootObject instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) rootObject;</b>
<b class="nc">&nbsp;                map.put(name, value);</b>
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            ObjectReaderProvider provider = getReaderContext().getProvider();</b>
<b class="nc">&nbsp;            ObjectReader objectReader = provider.getObjectReader(rootObject.getClass());</b>
<b class="nc">&nbsp;            FieldReader fieldReader = objectReader.getFieldReader(nameHashCode);</b>
&nbsp;
<b class="nc">&nbsp;            if (fieldReader != null) {</b>
<b class="nc">&nbsp;                if (value != null) {</b>
<b class="nc">&nbsp;                    Class&lt;?&gt; valueClass = value.getClass();</b>
<b class="nc">&nbsp;                    Class fieldClass = fieldReader.fieldClass;</b>
<b class="nc">&nbsp;                    if (valueClass != fieldClass) {</b>
<b class="nc">&nbsp;                        java.util.function.Function typeConvert = provider.getTypeConvert(valueClass, fieldClass);</b>
<b class="nc">&nbsp;                        if (typeConvert != null) {</b>
<b class="nc">&nbsp;                            value = typeConvert.apply(value);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                fieldReader.accept(rootObject, value);</b>
<b class="nc">&nbsp;            } else if (objectReader instanceof ObjectReaderBean) {</b>
<b class="nc">&nbsp;                ((ObjectReaderBean) objectReader).acceptExtra(rootObject, name, value);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object rootObject, Object value, JSONReader.Feature... readerFeatures) {
<b class="nc">&nbsp;            if (rootObject instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) rootObject;</b>
<b class="nc">&nbsp;                Object origin = map.put(name, value);</b>
<b class="nc">&nbsp;                if (origin != null) {</b>
<b class="nc">&nbsp;                    boolean duplicateKeyValueAsArray = false;</b>
<b class="nc">&nbsp;                    for (JSONReader.Feature feature : readerFeatures) {</b>
<b class="nc">&nbsp;                        if (feature == JSONReader.Feature.DuplicateKeyValueAsArray) {</b>
<b class="nc">&nbsp;                            duplicateKeyValueAsArray = true;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (duplicateKeyValueAsArray) {</b>
<b class="nc">&nbsp;                        if (origin instanceof Collection) {</b>
<b class="nc">&nbsp;                            ((Collection) origin).add(value);</b>
<b class="nc">&nbsp;                            map.put(name, value);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            JSONArray array = JSONArray.of(origin, value);</b>
<b class="nc">&nbsp;                            map.put(name, array);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            ObjectReaderProvider provider = getReaderContext().getProvider();</b>
<b class="nc">&nbsp;            ObjectReader objectReader = provider.getObjectReader(rootObject.getClass());</b>
<b class="nc">&nbsp;            FieldReader fieldReader = objectReader.getFieldReader(nameHashCode);</b>
&nbsp;
<b class="nc">&nbsp;            if (value != null) {</b>
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = value.getClass();</b>
<b class="nc">&nbsp;                Class fieldClass = fieldReader.fieldClass;</b>
<b class="nc">&nbsp;                if (valueClass != fieldClass) {</b>
<b class="nc">&nbsp;                    java.util.function.Function typeConvert = provider.getTypeConvert(valueClass, fieldClass);</b>
<b class="nc">&nbsp;                    if (typeConvert != null) {</b>
<b class="nc">&nbsp;                        value = typeConvert.apply(value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            fieldReader.accept(rootObject, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Object object, BiFunction callback) {
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                Object originValue = map.get(name);</b>
<b class="nc">&nbsp;                if (originValue != null || map.containsKey(name)) {</b>
<b class="nc">&nbsp;                    map.put(name, callback.apply(map, originValue));</b>
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Class&lt;?&gt; objectClass = object.getClass();</b>
&nbsp;
<b class="nc">&nbsp;            if (readerContext == null) {</b>
<b class="nc">&nbsp;                readerContext = JSONFactory.createReadContext();</b>
&nbsp;            }
<b class="nc">&nbsp;            FieldReader fieldReader = readerContext.provider</b>
<b class="nc">&nbsp;                    .getObjectReader(objectClass)</b>
<b class="nc">&nbsp;                    .getFieldReader(nameHashCode);</b>
&nbsp;
<b class="nc">&nbsp;            if (writerContext == null) {</b>
<b class="nc">&nbsp;                writerContext = JSONFactory.createWriteContext();</b>
&nbsp;            }
<b class="nc">&nbsp;            FieldWriter fieldWriter = writerContext.provider</b>
<b class="nc">&nbsp;                    .getObjectWriter(objectClass)</b>
<b class="nc">&nbsp;                    .getFieldWriter(nameHashCode);</b>
&nbsp;
<b class="nc">&nbsp;            if (fieldReader != null &amp;&amp; fieldWriter != null) {</b>
<b class="nc">&nbsp;                Object fieldValue = fieldWriter.getFieldValue(object);</b>
<b class="nc">&nbsp;                Object value = callback.apply(object, fieldValue);</b>
<b class="nc">&nbsp;                fieldReader.accept(object, value);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setInt(Object obejct, int value) {
<b class="nc">&nbsp;            if (obejct instanceof Map) {</b>
<b class="nc">&nbsp;                ((Map) obejct).put(name, value);</b>
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            ObjectReaderProvider provider = getReaderContext().getProvider();</b>
<b class="nc">&nbsp;            ObjectReader objectReader = provider.getObjectReader(obejct.getClass());</b>
<b class="nc">&nbsp;            objectReader.setFieldValue(obejct, name, nameHashCode, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setLong(Object object, long value) {
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                ((Map) object).put(name, value);</b>
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            ObjectReaderProvider provider = getReaderContext().getProvider();</b>
<b class="nc">&nbsp;            ObjectReader objectReader = provider.getObjectReader(object.getClass());</b>
<b class="nc">&nbsp;            objectReader.setFieldValue(object, name, nameHashCode, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object extract(JSONReader jsonReader) {
<b class="nc">&nbsp;            if (jsonReader.isJSONB()) {</b>
<b class="nc">&nbsp;                if (jsonReader.isObject()) {</b>
<b class="nc">&nbsp;                    jsonReader.nextIfObjectStart();</b>
<b class="nc">&nbsp;                    while (!jsonReader.nextIfObjectEnd()) {</b>
<b class="nc">&nbsp;                        long nameHashCode = jsonReader.readFieldNameHashCode();</b>
<b class="nc">&nbsp;                        if (nameHashCode == 0) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                        if (!match &amp;&amp; (!jsonReader.isObject()) &amp;&amp; !jsonReader.isArray()) {</b>
<b class="nc">&nbsp;                            jsonReader.skipValue();</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (jsonReader.isNumber()) {</b>
<b class="nc">&nbsp;                            return jsonReader.readNumber();</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if ((features &amp; Feature.AlwaysReturnList.mask) != 0) {</b>
<b class="nc">&nbsp;                    return new JSONArray();</b>
&nbsp;                }
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.nextIfObjectStart()) {</b>
<b class="nc">&nbsp;                while (!jsonReader.nextIfObjectEnd()) {</b>
<b class="nc">&nbsp;                    long nameHashCode = jsonReader.readFieldNameHashCode();</b>
<b class="nc">&nbsp;                    boolean match = nameHashCode == this.nameHashCode;</b>
&nbsp;
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
&nbsp;                    Object val;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readNumber();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;[&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;{&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readString(); //</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            val = null;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if ((features &amp; Feature.AlwaysReturnList.mask) != 0) {</b>
<b class="nc">&nbsp;                        if (val == null) {</b>
<b class="nc">&nbsp;                            val = new JSONArray();</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            val = JSONArray.of(val);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    return val;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if ((features &amp; Feature.AlwaysReturnList.mask) != 0) {</b>
<b class="nc">&nbsp;                return new JSONArray();</b>
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String extractScalar(JSONReader jsonReader) {
<b class="nc">&nbsp;            if (jsonReader.nextIfObjectStart()) {</b>
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    long nameHashCode = jsonReader.readFieldNameHashCode();</b>
&nbsp;
<b class="nc">&nbsp;                    boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                    char ch = jsonReader.ch;</b>
<b class="nc">&nbsp;                    if (!match &amp;&amp; ch != &#39;{&#39; &amp;&amp; ch != &#39;[&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
&nbsp;                    Object val;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readNumber();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;[&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;{&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readString(); //</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            val = null;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    return JSON.toJSONString(val);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public long extractInt64Value(JSONReader jsonReader) {
<b class="nc">&nbsp;            if (jsonReader.nextIfObjectStart()) {</b>
&nbsp;                _for:
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.wasNull = true;</b>
<b class="nc">&nbsp;                        return 0;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    long nameHashCode = jsonReader.readFieldNameHashCode();</b>
&nbsp;
<b class="nc">&nbsp;                    boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;:
<b class="nc">&nbsp;                            return jsonReader.readInt64Value();</b>
&nbsp;                        case &#39;[&#39;:
&nbsp;                        case &#39;{&#39;:
<b class="nc">&nbsp;                            Map object = jsonReader.readObject();</b>
<b class="nc">&nbsp;                            return jsonReader.toLong(object);</b>
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                            String str = jsonReader.readString();</b>
<b class="nc">&nbsp;                            return Long.parseLong(str);</b>
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;:
<b class="nc">&nbsp;                            boolean booleanValue = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                            return booleanValue ? 1L : 0L;</b>
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            jsonReader.wasNull = true;</b>
<b class="nc">&nbsp;                            return 0;</b>
&nbsp;                        case &#39;]&#39;:
<b class="nc">&nbsp;                            jsonReader.next();</b>
<b class="nc">&nbsp;                            break _for;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            jsonReader.wasNull = true;</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int extractInt32Value(JSONReader jsonReader) {
<b class="nc">&nbsp;            if (jsonReader.nextIfObjectStart()) {</b>
&nbsp;                _for:
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.wasNull = true;</b>
<b class="nc">&nbsp;                        return 0;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    long nameHashCode = jsonReader.readFieldNameHashCode();</b>
&nbsp;
<b class="nc">&nbsp;                    boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;:
<b class="nc">&nbsp;                            return jsonReader.readInt32Value();</b>
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                            String str = jsonReader.readString(); //</b>
<b class="nc">&nbsp;                            return Integer.parseInt(str);</b>
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;:
<b class="nc">&nbsp;                            boolean booleanValue = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                            return booleanValue ? 1 : 0;</b>
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            jsonReader.wasNull = true;</b>
<b class="nc">&nbsp;                            return 0;</b>
&nbsp;                        case &#39;]&#39;:
<b class="nc">&nbsp;                            jsonReader.next();</b>
<b class="nc">&nbsp;                            break _for;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            jsonReader.wasNull = true;</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void extractScalar(JSONReader jsonReader, ValueConsumer consumer) {
<b class="nc">&nbsp;            if (jsonReader.nextIfObjectStart()) {</b>
&nbsp;                _for:
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                        consumer.acceptNull();</b>
&nbsp;                        return;
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    long nameHashCode = jsonReader.readFieldNameHashCode();</b>
&nbsp;
<b class="nc">&nbsp;                    boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;: {
<b class="nc">&nbsp;                            jsonReader.readNumber(consumer, false);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;[&#39;: {
<b class="nc">&nbsp;                            List array = jsonReader.readArray();</b>
<b class="nc">&nbsp;                            consumer.accept(array);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;{&#39;: {
<b class="nc">&nbsp;                            Map object = jsonReader.readObject();</b>
<b class="nc">&nbsp;                            consumer.accept(object);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;: {
<b class="nc">&nbsp;                            jsonReader.readString(consumer, false);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;: {
<b class="nc">&nbsp;                            consumer.accept(</b>
<b class="nc">&nbsp;                                    jsonReader.readBoolValue()</b>
&nbsp;                            );
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            consumer.acceptNull();</b>
&nbsp;                            return;
&nbsp;                        case &#39;]&#39;:
<b class="nc">&nbsp;                            jsonReader.next();</b>
<b class="nc">&nbsp;                            break _for;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            consumer.acceptNull();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void extract(JSONReader jsonReader, ValueConsumer consumer) {
<b class="nc">&nbsp;            if (jsonReader.nextIfObjectStart()) {</b>
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                        consumer.acceptNull();</b>
&nbsp;                        return;
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    long nameHashCode = jsonReader.readFieldNameHashCode();</b>
&nbsp;
<b class="nc">&nbsp;                    boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;: {
<b class="nc">&nbsp;                            jsonReader.readNumber(consumer, true);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;[&#39;: {
<b class="nc">&nbsp;                            List array = jsonReader.readArray();</b>
<b class="nc">&nbsp;                            consumer.accept(array);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;{&#39;: {
<b class="nc">&nbsp;                            Map object = jsonReader.readObject();</b>
<b class="nc">&nbsp;                            consumer.accept(object);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;: {
<b class="nc">&nbsp;                            jsonReader.readString(consumer, true);</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;: {
<b class="nc">&nbsp;                            consumer.accept(</b>
<b class="nc">&nbsp;                                    jsonReader.readBoolValue()</b>
&nbsp;                            );
&nbsp;                            return;
&nbsp;                        }
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            consumer.acceptNull();</b>
&nbsp;                            return;
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            consumer.acceptNull();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class RootPath
&nbsp;            extends JSONPath {
<b class="nc">&nbsp;        static final RootPath INSTANCE = new RootPath();</b>
&nbsp;
&nbsp;        protected RootPath() {
<b class="nc">&nbsp;            super(&quot;$&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isRef() {
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean contains(Object object) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object eval(Object object) {
<b class="nc">&nbsp;            return object;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object extract(JSONReader jsonReader) {
<b class="nc">&nbsp;            if (jsonReader == null) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
<b class="nc">&nbsp;            return jsonReader.readAny();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String extractScalar(JSONReader jsonReader) {
<b class="nc">&nbsp;            Object any = jsonReader.readAny();</b>
<b class="nc">&nbsp;            return JSON.toJSONString(any);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object object, Object value) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object object, Object value, JSONReader.Feature... readerFeatures) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Object object, BiFunction callback) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setInt(Object object, int value) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setLong(Object object, long value) {
<b class="nc">&nbsp;            throw new UnsupportedOperationException();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Object object) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class SingleSegmentPath
&nbsp;            extends JSONPath {
&nbsp;        final Segment segment;
&nbsp;        final boolean ref;
&nbsp;
&nbsp;        public SingleSegmentPath(Segment segment, String path, Feature... features) {
<b class="nc">&nbsp;            super(path, features);</b>
<b class="nc">&nbsp;            this.segment = segment;</b>
<b class="nc">&nbsp;            this.ref = segment instanceof IndexSegment || segment instanceof NameSegment;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Object root) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
<b class="nc">&nbsp;            return segment.remove(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean contains(Object root) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
<b class="nc">&nbsp;            return segment.contains(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isRef() {
<b class="nc">&nbsp;            return ref;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object eval(Object root) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
<b class="nc">&nbsp;            segment.eval(context);</b>
<b class="nc">&nbsp;            return context.value;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object root, Object value) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
<b class="nc">&nbsp;            segment.set(context, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object root, Object value, JSONReader.Feature... readerFeatures) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
<b class="nc">&nbsp;            segment.set(context, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Object root, BiFunction callback) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
<b class="nc">&nbsp;            segment.setCallback(context, callback);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setInt(Object root, int value) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
<b class="nc">&nbsp;            segment.setInt(context, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setLong(Object root, long value) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
<b class="nc">&nbsp;            segment.setLong(context, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object extract(JSONReader jsonReader) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            if (segment instanceof EvalSegment) {</b>
<b class="nc">&nbsp;                context.root = jsonReader.readAny();</b>
<b class="nc">&nbsp;                segment.eval(context);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                segment.accept(jsonReader, context);</b>
&nbsp;            }
<b class="nc">&nbsp;            return context.value;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String extractScalar(JSONReader jsonReader) {
<b class="nc">&nbsp;            Context context = new Context(this, null, segment, null, 0);</b>
<b class="nc">&nbsp;            segment.accept(jsonReader, context);</b>
<b class="nc">&nbsp;            return JSON.toJSONString(context.value);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static class TwoSegmentPath
&nbsp;            extends JSONPath {
&nbsp;        final Segment first;
&nbsp;        final Segment second;
&nbsp;        final boolean ref;
&nbsp;
&nbsp;        public TwoSegmentPath(String path, Segment first, Segment second, Feature... features) {
<b class="nc">&nbsp;            super(path, features);</b>
<b class="nc">&nbsp;            this.first = first;</b>
<b class="nc">&nbsp;            this.second = second;</b>
<b class="nc">&nbsp;            this.ref = (first instanceof IndexSegment || first instanceof NameSegment)</b>
&nbsp;                    &amp;&amp; (second instanceof IndexSegment || second instanceof NameSegment);
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Object root) {
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            context0.root = root;</b>
<b class="nc">&nbsp;            first.eval(context0);</b>
<b class="nc">&nbsp;            if (context0.value == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
<b class="nc">&nbsp;            return second.remove(context1);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean contains(Object root) {
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            context0.root = root;</b>
<b class="nc">&nbsp;            first.eval(context0);</b>
<b class="nc">&nbsp;            if (context0.value == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
<b class="nc">&nbsp;            return second.contains(context1);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isRef() {
<b class="nc">&nbsp;            return ref;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object eval(Object root) {
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            context0.root = root;</b>
<b class="nc">&nbsp;            first.eval(context0);</b>
<b class="nc">&nbsp;            if (context0.value == null) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
<b class="nc">&nbsp;            second.eval(context1);</b>
<b class="nc">&nbsp;            Object contextValue = context1.value;</b>
<b class="nc">&nbsp;            if ((features &amp; Feature.AlwaysReturnList.mask) != 0) {</b>
<b class="nc">&nbsp;                if (contextValue == null) {</b>
<b class="nc">&nbsp;                    contextValue = new JSONArray();</b>
<b class="nc">&nbsp;                } else if (!(contextValue instanceof List)) {</b>
<b class="nc">&nbsp;                    contextValue = JSONArray.of(contextValue);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return contextValue;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object root, Object value) {
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            context0.root = root;</b>
<b class="nc">&nbsp;            first.eval(context0);</b>
<b class="nc">&nbsp;            if (context0.value == null) {</b>
&nbsp;                Object emptyValue;
<b class="nc">&nbsp;                if (second instanceof IndexSegment) {</b>
<b class="nc">&nbsp;                    emptyValue = new JSONArray();</b>
<b class="nc">&nbsp;                } else if (second instanceof NameSegment) {</b>
<b class="nc">&nbsp;                    emptyValue = new JSONObject();</b>
&nbsp;                } else {
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                context0.value = emptyValue;</b>
<b class="nc">&nbsp;                if (root instanceof Map &amp;&amp; first instanceof NameSegment) {</b>
<b class="nc">&nbsp;                    ((Map) root).put(((NameSegment) first).name, emptyValue);</b>
<b class="nc">&nbsp;                } else if (root instanceof List &amp;&amp; first instanceof IndexSegment) {</b>
<b class="nc">&nbsp;                    ((List) root).set(((IndexSegment) first).index, emptyValue);</b>
<b class="nc">&nbsp;                } else if (root != null) {</b>
<b class="nc">&nbsp;                    Class&lt;?&gt; parentObjectClass = root.getClass();</b>
<b class="nc">&nbsp;                    JSONReader.Context readerContext = getReaderContext();</b>
<b class="nc">&nbsp;                    ObjectReader&lt;?&gt; objectReader = readerContext.getObjectReader(parentObjectClass);</b>
<b class="nc">&nbsp;                    if (first instanceof NameSegment) {</b>
<b class="nc">&nbsp;                        FieldReader fieldReader = objectReader.getFieldReader(((NameSegment) first).nameHashCode);</b>
<b class="nc">&nbsp;                        if (fieldReader != null) {</b>
<b class="nc">&nbsp;                            ObjectReader fieldObjectReader = fieldReader.getObjectReader(readerContext);</b>
<b class="nc">&nbsp;                            Object fieldValue = fieldObjectReader.createInstance();</b>
<b class="nc">&nbsp;                            fieldReader.accept(root, fieldValue);</b>
<b class="nc">&nbsp;                            context0.value = fieldValue;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
<b class="nc">&nbsp;            second.set(context1, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object root, Object value, JSONReader.Feature... readerFeatures) {
<b class="nc">&nbsp;            long features = 0;</b>
<b class="nc">&nbsp;            for (JSONReader.Feature feature : readerFeatures) {</b>
<b class="nc">&nbsp;                features |= feature.mask;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, features);</b>
<b class="nc">&nbsp;            context0.root = root;</b>
<b class="nc">&nbsp;            first.eval(context0);</b>
<b class="nc">&nbsp;            if (context0.value == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, features);</b>
<b class="nc">&nbsp;            second.set(context1, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Object root, BiFunction callback) {
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            context0.root = root;</b>
<b class="nc">&nbsp;            first.eval(context0);</b>
<b class="nc">&nbsp;            if (context0.value == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
<b class="nc">&nbsp;            second.setCallback(context1, callback);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setInt(Object root, int value) {
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            context0.root = root;</b>
<b class="nc">&nbsp;            first.eval(context0);</b>
<b class="nc">&nbsp;            if (context0.value == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
<b class="nc">&nbsp;            second.setInt(context1, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setLong(Object root, long value) {
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            context0.root = root;</b>
<b class="nc">&nbsp;            first.eval(context0);</b>
<b class="nc">&nbsp;            if (context0.value == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
<b class="nc">&nbsp;            second.setLong(context1, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object extract(JSONReader jsonReader) {
<b class="nc">&nbsp;            if (jsonReader == null) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            first.accept(jsonReader, context0);</b>
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
&nbsp;
<b class="nc">&nbsp;            if (context0.eval) {</b>
<b class="nc">&nbsp;                second.eval(context1);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                second.accept(jsonReader, context1);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Object contextValue = context1.value;</b>
&nbsp;
<b class="nc">&nbsp;            if ((features &amp; Feature.AlwaysReturnList.mask) != 0) {</b>
<b class="nc">&nbsp;                if (contextValue == null) {</b>
<b class="nc">&nbsp;                    contextValue = new JSONArray();</b>
<b class="nc">&nbsp;                } else if (!(contextValue instanceof List)) {</b>
<b class="nc">&nbsp;                    contextValue = JSONArray.of(contextValue);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return contextValue;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String extractScalar(JSONReader jsonReader) {
<b class="nc">&nbsp;            Context context0 = new Context(this, null, first, second, 0);</b>
<b class="nc">&nbsp;            first.accept(jsonReader, context0);</b>
&nbsp;
<b class="nc">&nbsp;            Context context1 = new Context(this, context0, second, null, 0);</b>
<b class="nc">&nbsp;            second.accept(jsonReader, context1);</b>
&nbsp;
<b class="nc">&nbsp;            return JSON.toJSONString(context1.value);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class MultiSegmentPath</b>
&nbsp;            extends JSONPath {
&nbsp;        final List&lt;Segment&gt; segments;
&nbsp;        final boolean ref;
&nbsp;
&nbsp;        private MultiSegmentPath(String path, List&lt;Segment&gt; segments, Feature... features) {
<b class="nc">&nbsp;            super(path, features);</b>
<b class="nc">&nbsp;            this.segments = segments;</b>
&nbsp;
<b class="nc">&nbsp;            boolean ref = true;</b>
<b class="nc">&nbsp;            for (int i = 0, l = segments.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                if (segment instanceof IndexSegment || segment instanceof NameSegment) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                ref = false;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
<b class="nc">&nbsp;            this.ref = ref;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Object root) {
<b class="nc">&nbsp;            Context context = null;</b>
&nbsp;
<b class="nc">&nbsp;            int size = segments.size();</b>
<b class="nc">&nbsp;            if (size == 0) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            for (int i = 0; i &lt; size; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                Segment nextSegment = null;</b>
<b class="nc">&nbsp;                int nextIndex = i + 1;</b>
<b class="nc">&nbsp;                if (nextIndex &lt; size) {</b>
<b class="nc">&nbsp;                    nextSegment = segments.get(nextIndex);</b>
&nbsp;                }
<b class="nc">&nbsp;                context = new Context(this, context, segment, nextSegment, 0);</b>
<b class="nc">&nbsp;                if (i == 0) {</b>
<b class="nc">&nbsp;                    context.root = root;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (i == size - 1) {</b>
<b class="nc">&nbsp;                    return segment.remove(context);</b>
&nbsp;                }
<b class="nc">&nbsp;                segment.eval(context);</b>
&nbsp;
<b class="nc">&nbsp;                if (context.value == null) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean contains(Object root) {
<b class="nc">&nbsp;            Context context = null;</b>
&nbsp;
<b class="nc">&nbsp;            int size = segments.size();</b>
<b class="nc">&nbsp;            if (size == 0) {</b>
<b class="nc">&nbsp;                return root != null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            for (int i = 0; i &lt; size; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                Segment nextSegment = null;</b>
<b class="nc">&nbsp;                int nextIndex = i + 1;</b>
<b class="nc">&nbsp;                if (nextIndex &lt; size) {</b>
<b class="nc">&nbsp;                    nextSegment = segments.get(nextIndex);</b>
&nbsp;                }
<b class="nc">&nbsp;                context = new Context(this, context, segment, nextSegment, 0);</b>
<b class="nc">&nbsp;                if (i == 0) {</b>
<b class="nc">&nbsp;                    context.root = root;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (i == size - 1) {</b>
<b class="nc">&nbsp;                    return segment.contains(context);</b>
&nbsp;                }
<b class="nc">&nbsp;                segment.eval(context);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isRef() {
<b class="nc">&nbsp;            return ref;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object eval(Object root) {
<b class="nc">&nbsp;            Context context = null;</b>
&nbsp;
<b class="nc">&nbsp;            int size = segments.size();</b>
<b class="nc">&nbsp;            if (size == 0) {</b>
<b class="nc">&nbsp;                return root;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            for (int i = 0; i &lt; size; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                Segment nextSegment = null;</b>
<b class="nc">&nbsp;                int nextIndex = i + 1;</b>
<b class="nc">&nbsp;                if (nextIndex &lt; size) {</b>
<b class="nc">&nbsp;                    nextSegment = segments.get(nextIndex);</b>
&nbsp;                }
<b class="nc">&nbsp;                context = new Context(this, context, segment, nextSegment, 0);</b>
<b class="nc">&nbsp;                if (i == 0) {</b>
<b class="nc">&nbsp;                    context.root = root;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                segment.eval(context);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Object contextValue = context.value;</b>
<b class="nc">&nbsp;            if ((context.path.features &amp; Feature.AlwaysReturnList.mask) != 0) {</b>
<b class="nc">&nbsp;                if (contextValue == null) {</b>
<b class="nc">&nbsp;                    contextValue = new JSONArray();</b>
<b class="nc">&nbsp;                } else if (!(contextValue instanceof List)) {</b>
<b class="nc">&nbsp;                    contextValue = JSONArray.of(contextValue);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return contextValue;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object root, Object value) {
<b class="nc">&nbsp;            Context context = null;</b>
<b class="nc">&nbsp;            int size = segments.size();</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; size - 1; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                Segment nextSegment = null;</b>
<b class="nc">&nbsp;                int nextIndex = i + 1;</b>
<b class="nc">&nbsp;                if (nextIndex &lt; size) {</b>
<b class="nc">&nbsp;                    nextSegment = segments.get(nextIndex);</b>
&nbsp;                }
<b class="nc">&nbsp;                context = new Context(this, context, segment, nextSegment, 0L);</b>
<b class="nc">&nbsp;                if (i == 0) {</b>
<b class="nc">&nbsp;                    context.root = root;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                segment.eval(context);</b>
<b class="nc">&nbsp;                if (context.value == null &amp;&amp; nextSegment != null) {</b>
<b class="nc">&nbsp;                    if (value == null) {</b>
&nbsp;                        return;
&nbsp;                    }
&nbsp;
&nbsp;                    Object parentObject;
<b class="nc">&nbsp;                    if (i == 0) {</b>
<b class="nc">&nbsp;                        parentObject = root;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        parentObject = context.parent.value;</b>
&nbsp;                    }
&nbsp;
&nbsp;                    Object emptyValue;
<b class="nc">&nbsp;                    if (nextSegment instanceof IndexSegment) {</b>
<b class="nc">&nbsp;                        emptyValue = new JSONArray();</b>
<b class="nc">&nbsp;                    } else if (nextSegment instanceof NameSegment) {</b>
<b class="nc">&nbsp;                        emptyValue = new JSONObject();</b>
&nbsp;                    } else {
&nbsp;                        return;
&nbsp;                    }
<b class="nc">&nbsp;                    context.value = emptyValue;</b>
&nbsp;
<b class="nc">&nbsp;                    if (parentObject instanceof Map &amp;&amp; segment instanceof NameSegment) {</b>
<b class="nc">&nbsp;                        ((Map) parentObject).put(((NameSegment) segment).name, emptyValue);</b>
<b class="nc">&nbsp;                    } else if (parentObject instanceof List &amp;&amp; segment instanceof IndexSegment) {</b>
<b class="nc">&nbsp;                        List list = (List) parentObject;</b>
<b class="nc">&nbsp;                        int index = ((IndexSegment) segment).index;</b>
<b class="nc">&nbsp;                        if (index == list.size()) {</b>
<b class="nc">&nbsp;                            list.add(emptyValue);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            list.set(index, emptyValue);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    } else if (parentObject != null) {</b>
<b class="nc">&nbsp;                        Class&lt;?&gt; parentObjectClass = parentObject.getClass();</b>
<b class="nc">&nbsp;                        JSONReader.Context readerContext = getReaderContext();</b>
<b class="nc">&nbsp;                        ObjectReader&lt;?&gt; objectReader = readerContext.getObjectReader(parentObjectClass);</b>
<b class="nc">&nbsp;                        if (segment instanceof NameSegment) {</b>
<b class="nc">&nbsp;                            FieldReader fieldReader = objectReader.getFieldReader(((NameSegment) segment).nameHashCode);</b>
<b class="nc">&nbsp;                            if (fieldReader != null) {</b>
<b class="nc">&nbsp;                                ObjectReader fieldObjectReader = fieldReader.getObjectReader(readerContext);</b>
<b class="nc">&nbsp;                                Object fieldValue = fieldObjectReader.createInstance();</b>
<b class="nc">&nbsp;                                fieldReader.accept(parentObject, fieldValue);</b>
<b class="nc">&nbsp;                                context.value = fieldValue;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            context = new Context(this, context, segments.get(0), null, 0L);</b>
<b class="nc">&nbsp;            context.root = root;</b>
&nbsp;
<b class="nc">&nbsp;            Segment segment = segments.get(size - 1);</b>
<b class="nc">&nbsp;            segment.set(context, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Object root, Object value, JSONReader.Feature... readerFeatures) {
<b class="nc">&nbsp;            long features = 0;</b>
<b class="nc">&nbsp;            for (JSONReader.Feature feature : readerFeatures) {</b>
<b class="nc">&nbsp;                features |= feature.mask;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Context context = null;</b>
<b class="nc">&nbsp;            int size = segments.size();</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; size - 1; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                Segment nextSegment = null;</b>
<b class="nc">&nbsp;                int nextIndex = i + 1;</b>
<b class="nc">&nbsp;                if (nextIndex &lt; size) {</b>
<b class="nc">&nbsp;                    nextSegment = segments.get(nextIndex);</b>
&nbsp;                }
<b class="nc">&nbsp;                context = new Context(this, context, segment, nextSegment, features);</b>
<b class="nc">&nbsp;                if (i == 0) {</b>
<b class="nc">&nbsp;                    context.root = root;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                segment.eval(context);</b>
&nbsp;            }
<b class="nc">&nbsp;            context = new Context(this, context, segments.get(0), null, features);</b>
<b class="nc">&nbsp;            context.root = root;</b>
&nbsp;
<b class="nc">&nbsp;            Segment segment = segments.get(size - 1);</b>
<b class="nc">&nbsp;            segment.set(context, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Object root, BiFunction callback) {
<b class="nc">&nbsp;            Context context = null;</b>
<b class="nc">&nbsp;            int size = segments.size();</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; size - 1; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                Segment nextSegment = null;</b>
<b class="nc">&nbsp;                int nextIndex = i + 1;</b>
<b class="nc">&nbsp;                if (nextIndex &lt; size) {</b>
<b class="nc">&nbsp;                    nextSegment = segments.get(nextIndex);</b>
&nbsp;                }
<b class="nc">&nbsp;                context = new Context(this, context, segment, nextSegment, 0);</b>
<b class="nc">&nbsp;                if (i == 0) {</b>
<b class="nc">&nbsp;                    context.root = root;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                segment.eval(context);</b>
&nbsp;            }
<b class="nc">&nbsp;            context = new Context(this, context, segments.get(0), null, 0);</b>
<b class="nc">&nbsp;            context.root = root;</b>
&nbsp;
<b class="nc">&nbsp;            Segment segment = segments.get(size - 1);</b>
<b class="nc">&nbsp;            segment.setCallback(context, callback);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setInt(Object rootObject, int value) {
<b class="nc">&nbsp;            set(rootObject, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setLong(Object rootObject, long value) {
<b class="nc">&nbsp;            set(rootObject, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object extract(JSONReader jsonReader) {
<b class="nc">&nbsp;            if (jsonReader == null) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int size = segments.size();</b>
<b class="nc">&nbsp;            if (size == 0) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            boolean eval = false;</b>
<b class="nc">&nbsp;            Context context = null;</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; size; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                Segment nextSegment = null;</b>
&nbsp;
<b class="nc">&nbsp;                int nextIndex = i + 1;</b>
<b class="nc">&nbsp;                if (nextIndex &lt; size) {</b>
<b class="nc">&nbsp;                    nextSegment = segments.get(nextIndex);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                context = new Context(this, context, segment, nextSegment, 0);</b>
<b class="nc">&nbsp;                if (eval) {</b>
<b class="nc">&nbsp;                    segment.eval(context);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    segment.accept(jsonReader, context);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (context.eval) {</b>
<b class="nc">&nbsp;                    eval = true;</b>
<b class="nc">&nbsp;                    if (context.value == null) {</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Object value = context.value;</b>
<b class="nc">&nbsp;            if (value instanceof Sequence) {</b>
<b class="nc">&nbsp;                value = ((Sequence) value).values;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if ((features &amp; Feature.AlwaysReturnList.mask) != 0) {</b>
<b class="nc">&nbsp;                if (value == null) {</b>
<b class="nc">&nbsp;                    value = new JSONArray();</b>
<b class="nc">&nbsp;                } else if (!(value instanceof List)) {</b>
<b class="nc">&nbsp;                    value = JSONArray.of(value);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return value;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String extractScalar(JSONReader jsonReader) {
<b class="nc">&nbsp;            int size = segments.size();</b>
<b class="nc">&nbsp;            if (size == 0) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            boolean eval = false;</b>
<b class="nc">&nbsp;            Context context = null;</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; size; i++) {</b>
<b class="nc">&nbsp;                Segment segment = segments.get(i);</b>
<b class="nc">&nbsp;                Segment nextSegment = null;</b>
&nbsp;
<b class="nc">&nbsp;                int nextIndex = i + 1;</b>
<b class="nc">&nbsp;                if (nextIndex &lt; size) {</b>
<b class="nc">&nbsp;                    nextSegment = segments.get(nextIndex);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                context = new Context(this, context, segment, nextSegment, 0);</b>
<b class="nc">&nbsp;                if (eval) {</b>
<b class="nc">&nbsp;                    segment.eval(context);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    segment.accept(jsonReader, context);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (context.eval) {</b>
<b class="nc">&nbsp;                    eval = true;</b>
<b class="nc">&nbsp;                    if (context.value == null) {</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return JSON.toJSONString(context.value);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class Context {
&nbsp;        final JSONPath path;
&nbsp;        final Context parent;
&nbsp;        final Segment current;
&nbsp;        final Segment next;
&nbsp;        final long readerFeatures;
&nbsp;        Object root;
&nbsp;        Object value;
&nbsp;
&nbsp;        boolean eval;
&nbsp;
<b class="nc">&nbsp;        Context(JSONPath path, Context parent, Segment current, Segment next, long readerFeatures) {</b>
<b class="nc">&nbsp;            this.path = path;</b>
<b class="nc">&nbsp;            this.current = current;</b>
<b class="nc">&nbsp;            this.next = next;</b>
<b class="nc">&nbsp;            this.parent = parent;</b>
<b class="nc">&nbsp;            this.readerFeatures = readerFeatures;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    abstract static class Segment {</b>
&nbsp;        public abstract void accept(JSONReader jsonReader, Context context);
&nbsp;
&nbsp;        public abstract void eval(Context context);
&nbsp;
&nbsp;        public boolean contains(Context context) {
<b class="nc">&nbsp;            eval(context);</b>
<b class="nc">&nbsp;            return context.value != null;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean remove(Context context) {
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation &quot; + getClass());</b>
&nbsp;        }
&nbsp;
&nbsp;        public void set(Context context, Object value) {
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation &quot; + getClass());</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setCallback(Context context, BiFunction callback) {
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation &quot; + getClass());</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setInt(Context context, int value) {
<b class="nc">&nbsp;            set(context, Integer.valueOf(value));</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setLong(Context context, long value) {
<b class="nc">&nbsp;            set(context, Long.valueOf(value));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class EntrySetSegment</b>
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
<b class="nc">&nbsp;        static final EntrySetSegment INSTANCE = new EntrySetSegment();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (jsonReader.isObject()) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray();</b>
<b class="nc">&nbsp;                while (!jsonReader.nextIfObjectEnd()) {</b>
<b class="nc">&nbsp;                    String fieldName = jsonReader.readFieldName();</b>
<b class="nc">&nbsp;                    Object value = jsonReader.readAny();</b>
<b class="nc">&nbsp;                    array.add(</b>
<b class="nc">&nbsp;                            JSONObject.of(&quot;key&quot;, fieldName, &quot;value&quot;, value)</b>
&nbsp;                    );
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                context.value = array;</b>
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray(map.size());</b>
<b class="nc">&nbsp;                for (Iterator&lt;Map.Entry&gt; it = ((Map) object).entrySet().iterator(); it.hasNext(); ) {</b>
<b class="nc">&nbsp;                    Map.Entry entry = it.next();</b>
<b class="nc">&nbsp;                    array.add(</b>
<b class="nc">&nbsp;                            JSONObject.of(&quot;key&quot;, entry.getKey(), &quot;value&quot;, entry.getValue())</b>
&nbsp;                    );
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                context.value = array;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class KeysSegment</b>
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
<b class="nc">&nbsp;        static final KeysSegment INSTANCE = new KeysSegment();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (jsonReader.isObject()) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray();</b>
<b class="nc">&nbsp;                while (!jsonReader.nextIfObjectEnd()) {</b>
<b class="nc">&nbsp;                    String fieldName = jsonReader.readFieldName();</b>
<b class="nc">&nbsp;                    array.add(fieldName);</b>
<b class="nc">&nbsp;                    jsonReader.skipValue();</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                context.value = array;</b>
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                context.value = new JSONArray(((Map&lt;?, ?&gt;) object).keySet());</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class ValuesSegment</b>
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
<b class="nc">&nbsp;        static final ValuesSegment INSTANCE = new ValuesSegment();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                context.value = null;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                context.value = new JSONArray(((Map&lt;?, ?&gt;) object).values());</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class LengthSegment</b>
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
<b class="nc">&nbsp;        static final LengthSegment INSTANCE = new LengthSegment();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent == null) {</b>
<b class="nc">&nbsp;                context.root = jsonReader.readAny();</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object value = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (value == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int length = 1;</b>
<b class="nc">&nbsp;            if (value instanceof Collection) {</b>
<b class="nc">&nbsp;                length = ((Collection&lt;?&gt;) value).size();</b>
<b class="nc">&nbsp;            } else if (value.getClass().isArray()) {</b>
<b class="nc">&nbsp;                length = Array.getLength(value);</b>
<b class="nc">&nbsp;            } else if (value instanceof Map) {</b>
<b class="nc">&nbsp;                length = ((Map&lt;?, ?&gt;) value).size();</b>
<b class="nc">&nbsp;            } else if (value instanceof String) {</b>
<b class="nc">&nbsp;                length = ((String) value).length();</b>
<b class="nc">&nbsp;            } else if (value instanceof Sequence) {</b>
<b class="nc">&nbsp;                length = ((Sequence) value).values.size();</b>
&nbsp;            }
<b class="nc">&nbsp;            context.value = length;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static FunctionSegment FUNCTION_TYPE = new FunctionSegment(JSONPath::type);</b>
<b class="nc">&nbsp;    static FunctionSegment FUNCTION_DOUBLE = new FunctionSegment(new ToDouble(null));</b>
<b class="nc">&nbsp;    static FunctionSegment FUNCTION_FLOOR = new FunctionSegment(JSONPath::floor);</b>
<b class="nc">&nbsp;    static FunctionSegment FUNCTION_CEIL = new FunctionSegment(JSONPath::ceil);</b>
<b class="nc">&nbsp;    static FunctionSegment FUNCTION_ABS = new FunctionSegment(JSONPath::abs);</b>
<b class="nc">&nbsp;    static FunctionSegment FUNCTION_NEGATIVE = new FunctionSegment(JSONPath::negative);</b>
<b class="nc">&nbsp;    static FunctionSegment FUNCTION_EXISTS = new FunctionSegment(JSONPath::exists);</b>
&nbsp;
&nbsp;    static final class FunctionSegment
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
&nbsp;        final Function function;
&nbsp;
<b class="nc">&nbsp;        public FunctionSegment(Function function) {</b>
<b class="nc">&nbsp;            this.function = function;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent == null) {</b>
<b class="nc">&nbsp;                context.root = jsonReader.readAny();</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object value = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            context.value = function.apply(value);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static String type(Object value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            return &quot;null&quot;;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Collection) {</b>
<b class="nc">&nbsp;            return &quot;array&quot;;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Number) {</b>
<b class="nc">&nbsp;            return &quot;number&quot;;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Boolean) {</b>
<b class="nc">&nbsp;            return &quot;boolean&quot;;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof String</b>
&nbsp;                || value instanceof UUID
&nbsp;                || value instanceof Enum) {
<b class="nc">&nbsp;            return &quot;string&quot;;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return &quot;object&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    static Object floor(Object value) {
<b class="nc">&nbsp;        if (value instanceof Double) {</b>
<b class="nc">&nbsp;            return Math.floor((Double) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Float) {</b>
<b class="nc">&nbsp;            return Math.floor((Float) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof BigDecimal) {</b>
<b class="nc">&nbsp;            return ((BigDecimal) value).setScale(0, RoundingMode.FLOOR);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof List) {</b>
<b class="nc">&nbsp;            List list = (List) value;</b>
<b class="nc">&nbsp;            for (int i = 0, l = list.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                Object item = list.get(i);</b>
<b class="nc">&nbsp;                if (item instanceof Double) {</b>
<b class="nc">&nbsp;                    list.set(i, Math.floor((Double) item));</b>
<b class="nc">&nbsp;                } else if (item instanceof Float) {</b>
<b class="nc">&nbsp;                    list.set(i, Math.floor((Float) item));</b>
<b class="nc">&nbsp;                } else if (item instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                    list.set(i, ((BigDecimal) item).setScale(0, RoundingMode.FLOOR));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return value;</b>
&nbsp;    }
&nbsp;
&nbsp;    static Object ceil(Object value) {
<b class="nc">&nbsp;        if (value instanceof Double) {</b>
<b class="nc">&nbsp;            return Math.ceil((Double) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Float) {</b>
<b class="nc">&nbsp;            return Math.ceil((Float) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof BigDecimal) {</b>
<b class="nc">&nbsp;            return ((BigDecimal) value).setScale(0, RoundingMode.CEILING);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof List) {</b>
<b class="nc">&nbsp;            List list = (List) value;</b>
<b class="nc">&nbsp;            for (int i = 0, l = list.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                Object item = list.get(i);</b>
<b class="nc">&nbsp;                if (item instanceof Double) {</b>
<b class="nc">&nbsp;                    list.set(i, Math.floor((Double) item));</b>
<b class="nc">&nbsp;                } else if (item instanceof Float) {</b>
<b class="nc">&nbsp;                    list.set(i, Math.floor((Float) item));</b>
<b class="nc">&nbsp;                } else if (item instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                    list.set(i, ((BigDecimal) item).setScale(0, RoundingMode.FLOOR));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return value;</b>
&nbsp;    }
&nbsp;
&nbsp;    static Object exists(Object value) {
<b class="nc">&nbsp;        return value != null;</b>
&nbsp;    }
&nbsp;
&nbsp;    static Object negative(Object value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Integer) {</b>
<b class="nc">&nbsp;            return -((Integer) value).intValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Long) {</b>
<b class="nc">&nbsp;            return -((Long) value).longValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Byte) {</b>
<b class="nc">&nbsp;            return -((Byte) value).byteValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Short) {</b>
<b class="nc">&nbsp;            return -((Short) value).shortValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Double) {</b>
<b class="nc">&nbsp;            return -((Double) value).doubleValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Float) {</b>
<b class="nc">&nbsp;            return -((Float) value).floatValue();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof BigDecimal) {</b>
<b class="nc">&nbsp;            return ((BigDecimal) value).negate();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof BigInteger) {</b>
<b class="nc">&nbsp;            return ((BigInteger) value).negate();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof List) {</b>
<b class="nc">&nbsp;            List list = (List) value;</b>
<b class="nc">&nbsp;            JSONArray values = new JSONArray(list.size());</b>
<b class="nc">&nbsp;            for (int i = 0, l = list.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                Object item = list.get(i);</b>
&nbsp;                Object negativeItem;
<b class="nc">&nbsp;                if (item instanceof Double) {</b>
<b class="nc">&nbsp;                    negativeItem = -((Double) item).doubleValue();</b>
<b class="nc">&nbsp;                } else if (item instanceof Float) {</b>
<b class="nc">&nbsp;                    negativeItem = -((Float) item).floatValue();</b>
<b class="nc">&nbsp;                } else if (item instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                    negativeItem = ((BigDecimal) item).negate();</b>
<b class="nc">&nbsp;                } else if (item instanceof BigInteger) {</b>
<b class="nc">&nbsp;                    negativeItem = ((BigInteger) item).negate();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    negativeItem = item;</b>
&nbsp;                }
<b class="nc">&nbsp;                values.add(negativeItem);</b>
&nbsp;            }
<b class="nc">&nbsp;            return values;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        throw new JSONException(&quot;abs not support &quot; + value);</b>
&nbsp;    }
&nbsp;
&nbsp;    static Object abs(Object value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Integer) {</b>
<b class="nc">&nbsp;            return Math.abs((Integer) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Long) {</b>
<b class="nc">&nbsp;            return Math.abs((Long) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Byte) {</b>
<b class="nc">&nbsp;            return Math.abs((Byte) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Short) {</b>
<b class="nc">&nbsp;            return Math.abs((Short) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Double) {</b>
<b class="nc">&nbsp;            return Math.abs((Double) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof Float) {</b>
<b class="nc">&nbsp;            return Math.abs((Float) value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof BigDecimal) {</b>
<b class="nc">&nbsp;            return ((BigDecimal) value).abs();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof BigInteger) {</b>
<b class="nc">&nbsp;            return ((BigInteger) value).abs();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value instanceof List) {</b>
<b class="nc">&nbsp;            List list = (List) value;</b>
&nbsp;
<b class="nc">&nbsp;            JSONArray values = new JSONArray(list.size());</b>
<b class="nc">&nbsp;            for (int i = 0, l = list.size(); i &lt; l; i++) {</b>
<b class="nc">&nbsp;                Object item = list.get(i);</b>
&nbsp;                Object absItem;
<b class="nc">&nbsp;                if (item instanceof Double) {</b>
<b class="nc">&nbsp;                    absItem = Math.abs((Double) item);</b>
<b class="nc">&nbsp;                } else if (item instanceof Float) {</b>
<b class="nc">&nbsp;                    absItem = Math.abs((Float) item);</b>
<b class="nc">&nbsp;                } else if (item instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                    absItem = ((BigDecimal) item).abs();</b>
<b class="nc">&nbsp;                } else if (item instanceof BigInteger) {</b>
<b class="nc">&nbsp;                    absItem = ((BigInteger) item).abs();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    absItem = item;</b>
&nbsp;                }
<b class="nc">&nbsp;                values.add(absItem);</b>
&nbsp;            }
<b class="nc">&nbsp;            return values;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        throw new JSONException(&quot;abs not support &quot; + value);</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class MinSegment</b>
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
<b class="nc">&nbsp;        static final MinSegment INSTANCE = new MinSegment();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object value = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (value == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Object min = null;</b>
<b class="nc">&nbsp;            if (value instanceof Collection) {</b>
<b class="nc">&nbsp;                for (Object item : (Collection) value) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (min == null) {</b>
<b class="nc">&nbsp;                        min = item;</b>
<b class="nc">&nbsp;                    } else if (TypeUtils.compare(min, item) &gt; 0) {</b>
<b class="nc">&nbsp;                        min = item;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            } else if (value instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) value;</b>
<b class="nc">&nbsp;                for (Object item : array) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (min == null) {</b>
<b class="nc">&nbsp;                        min = item;</b>
<b class="nc">&nbsp;                    } else if (TypeUtils.compare(min, item) &gt; 0) {</b>
<b class="nc">&nbsp;                        min = item;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            } else if (value instanceof Sequence) {</b>
<b class="nc">&nbsp;                for (Object item : ((Sequence) value).values) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (min == null) {</b>
<b class="nc">&nbsp;                        min = item;</b>
<b class="nc">&nbsp;                    } else if (TypeUtils.compare(min, item) &gt; 0) {</b>
<b class="nc">&nbsp;                        min = item;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new UnsupportedOperationException();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            context.value = min;</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class MaxSegment</b>
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
<b class="nc">&nbsp;        static final MaxSegment INSTANCE = new MaxSegment();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object value = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (value == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Object max = null;</b>
<b class="nc">&nbsp;            if (value instanceof Collection) {</b>
<b class="nc">&nbsp;                for (Object item : (Collection) value) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (max == null) {</b>
<b class="nc">&nbsp;                        max = item;</b>
<b class="nc">&nbsp;                    } else if (TypeUtils.compare(max, item) &lt; 0) {</b>
<b class="nc">&nbsp;                        max = item;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            } else if (value instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) value;</b>
<b class="nc">&nbsp;                for (Object item : array) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (max == null) {</b>
<b class="nc">&nbsp;                        max = item;</b>
<b class="nc">&nbsp;                    } else if (TypeUtils.compare(max, item) &lt; 0) {</b>
<b class="nc">&nbsp;                        max = item;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            } else if (value instanceof Sequence) {</b>
<b class="nc">&nbsp;                for (Object item : ((Sequence) value).values) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (max == null) {</b>
<b class="nc">&nbsp;                        max = item;</b>
<b class="nc">&nbsp;                    } else if (TypeUtils.compare(max, item) &lt; 0) {</b>
<b class="nc">&nbsp;                        max = item;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new UnsupportedOperationException();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            context.value = max;</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class SumSegment</b>
&nbsp;            extends Segment
&nbsp;            implements EvalSegment {
<b class="nc">&nbsp;        static final SumSegment INSTANCE = new SumSegment();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            eval(context);</b>
&nbsp;        }
&nbsp;
&nbsp;        static Number add(Number a, Number b) {
<b class="nc">&nbsp;            boolean aIsInt = a instanceof Byte || a instanceof Short || a instanceof Integer || a instanceof Long;</b>
<b class="nc">&nbsp;            boolean bIsInt = b instanceof Byte || b instanceof Short || b instanceof Integer || b instanceof Long;</b>
<b class="nc">&nbsp;            if (aIsInt &amp;&amp; bIsInt) {</b>
<b class="nc">&nbsp;                return a.longValue() + b.longValue();</b>
&nbsp;            }
<b class="nc">&nbsp;            throw new JSONException(&quot;not support operation&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object value = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (value == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Number sum = 0;</b>
<b class="nc">&nbsp;            if (value instanceof Collection) {</b>
<b class="nc">&nbsp;                for (Object item : (Collection) value) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    sum = add(sum, (Number) item);</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            } else if (value instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) value;</b>
<b class="nc">&nbsp;                for (Object item : array) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    sum = add(sum, (Number) item);</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (value instanceof Sequence) {</b>
<b class="nc">&nbsp;                for (Object item : ((Sequence) value).values) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    sum = add(sum, (Number) item);</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new UnsupportedOperationException();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            context.value = sum;</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class SelfSegment
&nbsp;            extends Segment {
<b class="nc">&nbsp;        static final SelfSegment INSTANCE = new SelfSegment();</b>
&nbsp;
<b class="nc">&nbsp;        protected SelfSegment() {</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            context.value = jsonReader.readAny();</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
<b class="nc">&nbsp;            context.value = object;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class RootSegment
&nbsp;            extends Segment {
<b class="nc">&nbsp;        static final RootSegment INSTANCE = new RootSegment();</b>
&nbsp;
<b class="nc">&nbsp;        protected RootSegment() {</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent != null) {</b>
<b class="nc">&nbsp;                throw new JSONException(&quot;not support operation&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            context.value = jsonReader.readAny();</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.root;
<b class="nc">&nbsp;            context.value = object;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static class NameSegment
&nbsp;            extends Segment {
<b class="nc">&nbsp;        static final long HASH_NAME = Fnv.hashCode64(&quot;name&quot;);</b>
<b class="nc">&nbsp;        static final long HASH_ORDINAL = Fnv.hashCode64(&quot;ordinal&quot;);</b>
&nbsp;
&nbsp;        final String name;
&nbsp;        final long nameHashCode;
&nbsp;
<b class="nc">&nbsp;        public NameSegment(String name, long nameHashCode) {</b>
<b class="nc">&nbsp;            this.name = name;</b>
<b class="nc">&nbsp;            this.nameHashCode = nameHashCode;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Context context) {
<b class="nc">&nbsp;            set(context, null);</b>
<b class="nc">&nbsp;            return context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean contains(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                return ((Map&lt;?, ?&gt;) object).containsKey(name);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Collection) {</b>
<b class="nc">&nbsp;                for (Object item : (Collection) object) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (item instanceof Map) {</b>
<b class="nc">&nbsp;                        if (((Map&lt;?, ?&gt;) item).get(name) != null) {</b>
<b class="nc">&nbsp;                            return true;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    ObjectWriter&lt;?&gt; objectWriter = context.path</b>
<b class="nc">&nbsp;                            .getWriterContext()</b>
<b class="nc">&nbsp;                            .getObjectWriter(item.getClass());</b>
<b class="nc">&nbsp;                    if (objectWriter instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                        FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;                        if (fieldWriter != null) {</b>
<b class="nc">&nbsp;                            if (fieldWriter.getFieldValue(item) != null) {</b>
<b class="nc">&nbsp;                                return true;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Sequence) {</b>
<b class="nc">&nbsp;                Sequence sequence = (Sequence) object;</b>
<b class="nc">&nbsp;                for (Object item : sequence.values) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (item instanceof Map) {</b>
<b class="nc">&nbsp;                        if (((Map&lt;?, ?&gt;) item).get(name) != null) {</b>
<b class="nc">&nbsp;                            return true;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    ObjectWriter&lt;?&gt; objectWriter = context.path</b>
<b class="nc">&nbsp;                            .getWriterContext()</b>
<b class="nc">&nbsp;                            .getObjectWriter(item.getClass());</b>
<b class="nc">&nbsp;                    if (objectWriter instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                        FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;                        if (fieldWriter != null) {</b>
<b class="nc">&nbsp;                            if (fieldWriter.getFieldValue(item) != null) {</b>
<b class="nc">&nbsp;                                return true;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) object;</b>
<b class="nc">&nbsp;                for (Object item : array) {</b>
<b class="nc">&nbsp;                    if (item == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (item instanceof Map) {</b>
<b class="nc">&nbsp;                        if (((Map) item).get(name) != null) {</b>
<b class="nc">&nbsp;                            return true;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    ObjectWriter&lt;?&gt; objectWriter = context.path</b>
<b class="nc">&nbsp;                            .getWriterContext()</b>
<b class="nc">&nbsp;                            .getObjectWriter(item.getClass());</b>
<b class="nc">&nbsp;                    if (objectWriter instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                        FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;                        if (fieldWriter != null) {</b>
<b class="nc">&nbsp;                            if (fieldWriter.getFieldValue(item) != null) {</b>
<b class="nc">&nbsp;                                return true;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectWriter&lt;?&gt; objectWriter = context.path</b>
<b class="nc">&nbsp;                    .getWriterContext()</b>
<b class="nc">&nbsp;                    .getObjectWriter(object.getClass());</b>
<b class="nc">&nbsp;            if (objectWriter instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;                if (fieldWriter != null) {</b>
<b class="nc">&nbsp;                    return fieldWriter.getFieldValue(object) != null;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                Object value = map.get(name);</b>
<b class="nc">&nbsp;                if (value == null) {</b>
<b class="nc">&nbsp;                    boolean isNum = IOUtils.isNumber(this.name);</b>
<b class="nc">&nbsp;                    Long longValue = null;</b>
&nbsp;
<b class="nc">&nbsp;                    for (Object o : map.entrySet()) {</b>
<b class="nc">&nbsp;                        Map.Entry entry = (Map.Entry) o;</b>
<b class="nc">&nbsp;                        Object entryKey = entry.getKey();</b>
<b class="nc">&nbsp;                        if (entryKey instanceof Enum &amp;&amp; ((Enum&lt;?&gt;) entryKey).name().equals(this.name)) {</b>
<b class="nc">&nbsp;                            value = entry.getValue();</b>
<b class="nc">&nbsp;                            break;</b>
<b class="nc">&nbsp;                        } else if (entryKey instanceof Long) {</b>
<b class="nc">&nbsp;                            if (longValue == null &amp;&amp; isNum) {</b>
<b class="nc">&nbsp;                                longValue = Long.parseLong(this.name);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            if (entryKey.equals(longValue)) {</b>
<b class="nc">&nbsp;                                value = entry.getValue();</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                context.value = value;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Collection) {</b>
<b class="nc">&nbsp;                Collection&lt;?&gt; collection = (Collection&lt;?&gt;) object;</b>
<b class="nc">&nbsp;                int size = collection.size();</b>
<b class="nc">&nbsp;                Collection values = null; // = new JSONArray(collection.size());</b>
<b class="nc">&nbsp;                for (Object item : collection) {</b>
<b class="nc">&nbsp;                    if (item instanceof Map) {</b>
<b class="nc">&nbsp;                        Object val = ((Map&lt;?, ?&gt;) item).get(name);</b>
<b class="nc">&nbsp;                        if (val == null) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        if (val instanceof Collection) {</b>
<b class="nc">&nbsp;                            if (size == 1) {</b>
<b class="nc">&nbsp;                                values = (Collection) val;</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                if (values == null) {</b>
<b class="nc">&nbsp;                                    values = new JSONArray(size);</b>
&nbsp;                                }
<b class="nc">&nbsp;                                values.addAll((Collection) val);</b>
&nbsp;                            }
&nbsp;                        } else {
<b class="nc">&nbsp;                            if (values == null) {</b>
<b class="nc">&nbsp;                                values = new JSONArray(size);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            values.add(val);</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                context.value = values;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Sequence) {</b>
<b class="nc">&nbsp;                List sequence = ((Sequence) object).values;</b>
<b class="nc">&nbsp;                JSONArray values = new JSONArray(sequence.size());</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; sequence.size(); i++) {</b>
<b class="nc">&nbsp;                    Object item = sequence.get(i);</b>
<b class="nc">&nbsp;                    context.value = item;</b>
<b class="nc">&nbsp;                    Context itemContext = new Context(context.path, context, context.current, context.next, context.readerFeatures);</b>
<b class="nc">&nbsp;                    eval(itemContext);</b>
<b class="nc">&nbsp;                    Object val = itemContext.value;</b>
&nbsp;
<b class="nc">&nbsp;                    if (val == null) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (val instanceof Collection) {</b>
<b class="nc">&nbsp;                        values.addAll((Collection) val);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        values.add(val);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (context.next != null) {</b>
<b class="nc">&nbsp;                    context.value = new Sequence(values);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    context.value = values;</b>
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            JSONWriter.Context writerContext = context.path.getWriterContext();</b>
<b class="nc">&nbsp;            ObjectWriter&lt;?&gt; objectWriter = writerContext.getObjectWriter(object.getClass());</b>
<b class="nc">&nbsp;            if (objectWriter instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;                if (fieldWriter != null) {</b>
<b class="nc">&nbsp;                    context.value = fieldWriter.getFieldValue(object);</b>
&nbsp;                }
&nbsp;
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (nameHashCode == HASH_NAME &amp;&amp; object instanceof Enum) {</b>
<b class="nc">&nbsp;                context.value = ((Enum&lt;?&gt;) object).name();</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (nameHashCode == HASH_ORDINAL &amp;&amp; object instanceof Enum) {</b>
<b class="nc">&nbsp;                context.value = ((Enum&lt;?&gt;) object).ordinal();</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof String) {</b>
<b class="nc">&nbsp;                String str = (String) object;</b>
<b class="nc">&nbsp;                if (!str.isEmpty() &amp;&amp; str.charAt(0) == &#39;{&#39;) {</b>
<b class="nc">&nbsp;                    context.value =</b>
<b class="nc">&nbsp;                            JSONPath.of(&quot;$.&quot; + name)</b>
<b class="nc">&nbsp;                                    .extract(</b>
<b class="nc">&nbsp;                                            JSONReader.of(str));</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                context.value = null;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Number || object instanceof Boolean) {</b>
<b class="nc">&nbsp;                context.value = null;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;not support : &quot; + object.getClass());</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Context context, Object value) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                Object origin = map.put(name, value);</b>
<b class="nc">&nbsp;                if (origin != null) {</b>
<b class="nc">&nbsp;                    if ((context.readerFeatures &amp; JSONReader.Feature.DuplicateKeyValueAsArray.mask) != 0) {</b>
<b class="nc">&nbsp;                        if (origin instanceof Collection) {</b>
<b class="nc">&nbsp;                            ((Collection) origin).add(value);</b>
<b class="nc">&nbsp;                            map.put(name, value);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            JSONArray array = JSONArray.of(origin, value);</b>
<b class="nc">&nbsp;                            map.put(name, array);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectReaderProvider provider = context.path.getReaderContext().getProvider();</b>
<b class="nc">&nbsp;            ObjectReader objectReader = provider.getObjectReader(object.getClass());</b>
<b class="nc">&nbsp;            FieldReader fieldReader = objectReader.getFieldReader(nameHashCode);</b>
<b class="nc">&nbsp;            if (fieldReader == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (value != null) {</b>
<b class="nc">&nbsp;                Class&lt;?&gt; valueClass = value.getClass();</b>
<b class="nc">&nbsp;                Class fieldClass = fieldReader.fieldClass;</b>
<b class="nc">&nbsp;                if (valueClass != fieldClass) {</b>
<b class="nc">&nbsp;                    java.util.function.Function typeConvert = provider.getTypeConvert(valueClass, fieldClass);</b>
<b class="nc">&nbsp;                    if (typeConvert != null) {</b>
<b class="nc">&nbsp;                        value = typeConvert.apply(value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            fieldReader.accept(object, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Context context, BiFunction callback) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                Object origin = map.get(name);</b>
<b class="nc">&nbsp;                if (origin != null) {</b>
<b class="nc">&nbsp;                    Object applyValue = callback.apply(map, origin);</b>
<b class="nc">&nbsp;                    map.put(name, applyValue);</b>
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectReaderProvider provider = context.path.getReaderContext().getProvider();</b>
&nbsp;
<b class="nc">&nbsp;            ObjectReader objectReader = provider.getObjectReader(object.getClass());</b>
<b class="nc">&nbsp;            ObjectWriter objectWriter = context.path</b>
<b class="nc">&nbsp;                    .getWriterContext()</b>
<b class="nc">&nbsp;                    .getProvider()</b>
<b class="nc">&nbsp;                    .getObjectWriter(object.getClass());</b>
&nbsp;
<b class="nc">&nbsp;            FieldReader fieldReader = objectReader.getFieldReader(nameHashCode);</b>
<b class="nc">&nbsp;            FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;            if (fieldReader == null || fieldWriter == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Object fieldValue = fieldWriter.getFieldValue(object);</b>
<b class="nc">&nbsp;            Object applyValue = callback.apply(object, fieldValue);</b>
<b class="nc">&nbsp;            fieldReader.accept(object, applyValue);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent != null</b>
&nbsp;                    &amp;&amp; (context.parent.eval
&nbsp;                    || context.parent.current instanceof FilterSegment
&nbsp;                    || context.parent.current instanceof MultiIndexSegment)
&nbsp;            ) {
<b class="nc">&nbsp;                eval(context);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.isJSONB()) {</b>
<b class="nc">&nbsp;                if (jsonReader.nextIfObjectStart()) {</b>
<b class="nc">&nbsp;                    for (int i = 0; ; ++i) {</b>
<b class="nc">&nbsp;                        if (jsonReader.nextIfObjectEnd()) {</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        long nameHashCode = jsonReader.readFieldNameHashCode();</b>
<b class="nc">&nbsp;                        if (nameHashCode == 0) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                        if (!match) {</b>
<b class="nc">&nbsp;                            jsonReader.skipValue();</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (jsonReader.isArray() || jsonReader.isObject()) {</b>
<b class="nc">&nbsp;                            if (context.next != null) {</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        context.value = jsonReader.readAny();</b>
<b class="nc">&nbsp;                        context.eval = true;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                    return;
<b class="nc">&nbsp;                } else if (jsonReader.isArray()</b>
&nbsp;                        &amp;&amp; context.parent != null
&nbsp;                        &amp;&amp; context.parent.current instanceof AllSegment) {
<b class="nc">&nbsp;                    List values = new JSONArray();</b>
<b class="nc">&nbsp;                    int itemCnt = jsonReader.startArray();</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; itemCnt; i++) {</b>
<b class="nc">&nbsp;                        if (jsonReader.nextIfMatch(BC_OBJECT)) {</b>
<b class="nc">&nbsp;                            for (int j = 0; ; j++) {</b>
<b class="nc">&nbsp;                                if (jsonReader.nextIfMatch(BC_OBJECT_END)) {</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                }
&nbsp;
<b class="nc">&nbsp;                                long nameHashCode = jsonReader.readFieldNameHashCode();</b>
<b class="nc">&nbsp;                                boolean match = nameHashCode == this.nameHashCode;</b>
&nbsp;
<b class="nc">&nbsp;                                if (!match) {</b>
<b class="nc">&nbsp;                                    jsonReader.skipValue();</b>
<b class="nc">&nbsp;                                    continue;</b>
&nbsp;                                }
&nbsp;
<b class="nc">&nbsp;                                if (jsonReader.isArray() || jsonReader.isObject()) {</b>
<b class="nc">&nbsp;                                    if (context.next != null) {</b>
<b class="nc">&nbsp;                                        break;</b>
&nbsp;                                    }
&nbsp;                                }
&nbsp;
<b class="nc">&nbsp;                                values.add(jsonReader.readAny());</b>
&nbsp;                            }
&nbsp;                        } else {
<b class="nc">&nbsp;                            jsonReader.skipValue();</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    context.value = values;</b>
<b class="nc">&nbsp;                    context.eval = true;</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.nextIfObjectStart()) {</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
&nbsp;                    // return object;
&nbsp;                }
&nbsp;
&nbsp;                _for:
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.nextIfObjectEnd()) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    long nameHashCode = jsonReader.readFieldNameHashCode();</b>
<b class="nc">&nbsp;                    boolean match = nameHashCode == this.nameHashCode;</b>
&nbsp;
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                            jsonReader.next();</b>
&nbsp;                        }
&nbsp;                        continue;
&nbsp;                    }
&nbsp;
&nbsp;                    Object val;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;:
<b class="nc">&nbsp;                            jsonReader.readNumber0();</b>
<b class="nc">&nbsp;                            val = jsonReader.getNumber();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;[&#39;:
<b class="nc">&nbsp;                            if (context.next != null &amp;&amp; !(context.next instanceof EvalSegment)</b>
&nbsp;                                    &amp;&amp; !(context.next instanceof NameSegment)
&nbsp;                                    &amp;&amp; !(context.next instanceof AllSegment)) {
<b class="nc">&nbsp;                                break _for;</b>
&nbsp;                            }
<b class="nc">&nbsp;                            val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                            context.eval = true;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;{&#39;:
<b class="nc">&nbsp;                            if (context.next != null</b>
&nbsp;                                    &amp;&amp; !(context.next instanceof EvalSegment)
&nbsp;                                    &amp;&amp; !(context.next instanceof AllSegment)) {
<b class="nc">&nbsp;                                break _for;</b>
&nbsp;                            }
<b class="nc">&nbsp;                            val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                            context.eval = true;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readString();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            val = null;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    context.value = val;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (jsonReader.ch == &#39;[&#39; &amp;&amp; context.parent != null &amp;&amp; context.parent.current instanceof AllSegment) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                List values = new JSONArray();</b>
<b class="nc">&nbsp;                while (jsonReader.ch != EOI) {</b>
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;{&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
&nbsp;
&nbsp;                        _for:
&nbsp;                        for (; ; ) {
<b class="nc">&nbsp;                            if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                                jsonReader.next();</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;
<b class="nc">&nbsp;                            long nameHashCode = jsonReader.readFieldNameHashCode();</b>
<b class="nc">&nbsp;                            boolean match = nameHashCode == this.nameHashCode;</b>
&nbsp;
<b class="nc">&nbsp;                            if (!match) {</b>
<b class="nc">&nbsp;                                jsonReader.skipValue();</b>
<b class="nc">&nbsp;                                if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                                    jsonReader.next();</b>
&nbsp;                                }
&nbsp;                                continue;
&nbsp;                            }
&nbsp;
&nbsp;                            Object val;
<b class="nc">&nbsp;                            switch (jsonReader.ch) {</b>
&nbsp;                                case &#39;-&#39;:
&nbsp;                                case &#39;+&#39;:
&nbsp;                                case &#39;0&#39;:
&nbsp;                                case &#39;1&#39;:
&nbsp;                                case &#39;2&#39;:
&nbsp;                                case &#39;3&#39;:
&nbsp;                                case &#39;4&#39;:
&nbsp;                                case &#39;5&#39;:
&nbsp;                                case &#39;6&#39;:
&nbsp;                                case &#39;7&#39;:
&nbsp;                                case &#39;8&#39;:
&nbsp;                                case &#39;9&#39;:
&nbsp;                                case &#39;.&#39;:
<b class="nc">&nbsp;                                    jsonReader.readNumber0();</b>
<b class="nc">&nbsp;                                    val = jsonReader.getNumber();</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                case &#39;[&#39;:
<b class="nc">&nbsp;                                    if (context.next != null) {</b>
<b class="nc">&nbsp;                                        break _for;</b>
&nbsp;                                    }
<b class="nc">&nbsp;                                    val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                case &#39;{&#39;:
<b class="nc">&nbsp;                                    if (context.next != null) {</b>
<b class="nc">&nbsp;                                        break _for;</b>
&nbsp;                                    }
<b class="nc">&nbsp;                                    val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                case &#39;&quot;&#39;:
&nbsp;                                case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                                    val = jsonReader.readString();</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                case &#39;t&#39;:
&nbsp;                                case &#39;f&#39;:
<b class="nc">&nbsp;                                    val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                case &#39;n&#39;:
<b class="nc">&nbsp;                                    jsonReader.readNull();</b>
<b class="nc">&nbsp;                                    val = null;</b>
<b class="nc">&nbsp;                                    break;</b>
&nbsp;                                default:
<b class="nc">&nbsp;                                    throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            values.add(val);</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                context.value = values;</b>
&nbsp;            }/* else if (jsonReader.ch == JSONReader.EOI) {
&nbsp;                return;
&nbsp;            }*/
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String toString() {
<b class="nc">&nbsp;            return name;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class CycleNameSegment
&nbsp;            extends Segment {
<b class="nc">&nbsp;        static final long HASH_STAR = Fnv.hashCode64(&quot;*&quot;);</b>
&nbsp;        final String name;
&nbsp;        final long nameHashCode;
&nbsp;
<b class="nc">&nbsp;        public CycleNameSegment(String name, long nameHashCode) {</b>
<b class="nc">&nbsp;            this.name = name;</b>
<b class="nc">&nbsp;            this.nameHashCode = nameHashCode;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String toString() {
<b class="nc">&nbsp;            return &quot;..&quot; + name;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Context context) {
<b class="nc">&nbsp;            set(context, null);</b>
<b class="nc">&nbsp;            return context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            List values = new JSONArray();</b>
&nbsp;
<b class="nc">&nbsp;            MapLoop action = new MapLoop(context, values);</b>
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                map.forEach(action);</b>
<b class="nc">&nbsp;            } else if (object instanceof Collection) {</b>
<b class="nc">&nbsp;                ((Collection&lt;?&gt;) object).forEach(action);</b>
<b class="nc">&nbsp;            } else if (object != null) {</b>
<b class="nc">&nbsp;                ObjectWriter&lt;?&gt; objectWriter = context.path</b>
<b class="nc">&nbsp;                        .getWriterContext()</b>
<b class="nc">&nbsp;                        .getObjectWriter(object.getClass());</b>
<b class="nc">&nbsp;                if (objectWriter instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                    action.accept(object);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (values.size() == 1 &amp;&amp; values.get(0) instanceof Collection) {</b>
<b class="nc">&nbsp;                context.value = values.get(0);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                context.value = values;</b>
&nbsp;            }
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Context context, Object value) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            LoopSet action = new LoopSet(context, value);</b>
<b class="nc">&nbsp;            action.accept(object);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Context context, BiFunction callback) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            LoopCallback action = new LoopCallback(context, callback);</b>
<b class="nc">&nbsp;            action.accept(object);</b>
&nbsp;        }
&nbsp;
&nbsp;        class MapLoop
&nbsp;                implements BiConsumer, Consumer {
&nbsp;            final Context context;
&nbsp;            final List values;
&nbsp;
<b class="nc">&nbsp;            public MapLoop(Context context, List values) {</b>
<b class="nc">&nbsp;                this.context = context;</b>
<b class="nc">&nbsp;                this.values = values;</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void accept(Object key, Object value) {
<b class="nc">&nbsp;                if (name.equals(key)) {</b>
<b class="nc">&nbsp;                    values.add(value);</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (value instanceof Map) {</b>
<b class="nc">&nbsp;                    ((Map&lt;?, ?&gt;) value).forEach(this);</b>
<b class="nc">&nbsp;                } else if (value instanceof List) {</b>
<b class="nc">&nbsp;                    ((List&lt;?&gt;) value).forEach(this);</b>
<b class="nc">&nbsp;                } else if (nameHashCode == HASH_STAR) {</b>
<b class="nc">&nbsp;                    values.add(value);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void accept(Object value) {
<b class="nc">&nbsp;                if (value == null) {</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (value instanceof Map) {</b>
<b class="nc">&nbsp;                    ((Map&lt;?, ?&gt;) value).forEach(this);</b>
<b class="nc">&nbsp;                } else if (value instanceof List) {</b>
<b class="nc">&nbsp;                    ((List&lt;?&gt;) value).forEach(this);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    ObjectWriter&lt;?&gt; objectWriter = context.path</b>
<b class="nc">&nbsp;                            .getWriterContext()</b>
<b class="nc">&nbsp;                            .getObjectWriter(value.getClass());</b>
<b class="nc">&nbsp;                    if (objectWriter instanceof ObjectWriterAdapter) {</b>
<b class="nc">&nbsp;                        FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;                        if (fieldWriter != null) {</b>
<b class="nc">&nbsp;                            Object fieldValue = fieldWriter.getFieldValue(value);</b>
<b class="nc">&nbsp;                            if (fieldValue != null) {</b>
<b class="nc">&nbsp;                                values.add(fieldValue);</b>
&nbsp;                            }
&nbsp;                            return;
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        for (int i = 0; i &lt; objectWriter.getFieldWriters().size(); i++) {</b>
<b class="nc">&nbsp;                            fieldWriter = objectWriter.getFieldWriters().get(i);</b>
<b class="nc">&nbsp;                            Object fieldValue = fieldWriter.getFieldValue(value);</b>
<b class="nc">&nbsp;                            accept(fieldValue);</b>
&nbsp;                        }
&nbsp;
&nbsp;                        return;
<b class="nc">&nbsp;                    } else if (nameHashCode == HASH_STAR) {</b>
<b class="nc">&nbsp;                        values.add(value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        class LoopSet {
&nbsp;            final Context context;
&nbsp;            final Object value;
&nbsp;
<b class="nc">&nbsp;            public LoopSet(Context context, Object value) {</b>
<b class="nc">&nbsp;                this.context = context;</b>
<b class="nc">&nbsp;                this.value = value;</b>
&nbsp;            }
&nbsp;
&nbsp;            public void accept(Object object) {
<b class="nc">&nbsp;                if (object instanceof Map) {</b>
<b class="nc">&nbsp;                    for (Map.Entry entry : (Iterable&lt;Map.Entry&gt;) ((Map) object).entrySet()) {</b>
<b class="nc">&nbsp;                        if (name.equals(entry.getKey())) {</b>
<b class="nc">&nbsp;                            entry.setValue(value);</b>
<b class="nc">&nbsp;                            context.eval = true;</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            Object entryValue = entry.getValue();</b>
<b class="nc">&nbsp;                            if (entryValue != null) {</b>
<b class="nc">&nbsp;                                accept(entryValue);</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                } else if (object instanceof Collection) {</b>
<b class="nc">&nbsp;                    for (Object item : ((List&lt;?&gt;) object)) {</b>
<b class="nc">&nbsp;                        accept(item);</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    Class&lt;?&gt; entryValueClass = object.getClass();</b>
<b class="nc">&nbsp;                    ObjectReader objectReader = JSONFactory.getDefaultObjectReaderProvider().getObjectReader(entryValueClass);</b>
<b class="nc">&nbsp;                    if (objectReader instanceof ObjectReaderBean) {</b>
<b class="nc">&nbsp;                        FieldReader fieldReader = objectReader.getFieldReader(nameHashCode);</b>
<b class="nc">&nbsp;                        if (fieldReader != null) {</b>
<b class="nc">&nbsp;                            fieldReader.accept(object, value);</b>
<b class="nc">&nbsp;                            context.eval = true;</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    ObjectWriter objectWriter = JSONFactory.getDefaultObjectWriterProvider().getObjectWriter(entryValueClass);</b>
<b class="nc">&nbsp;                    List&lt;FieldWriter&gt; fieldWriters = objectWriter.getFieldWriters();</b>
<b class="nc">&nbsp;                    for (FieldWriter fieldWriter : fieldWriters) {</b>
<b class="nc">&nbsp;                        Object fieldValue = fieldWriter.getFieldValue(object);</b>
<b class="nc">&nbsp;                        accept(fieldValue);</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        class LoopCallback {
&nbsp;            final Context context;
&nbsp;            final BiFunction callback;
&nbsp;
<b class="nc">&nbsp;            public LoopCallback(Context context, BiFunction callback) {</b>
<b class="nc">&nbsp;                this.context = context;</b>
<b class="nc">&nbsp;                this.callback = callback;</b>
&nbsp;            }
&nbsp;
&nbsp;            public void accept(Object object) {
<b class="nc">&nbsp;                if (object instanceof Map) {</b>
<b class="nc">&nbsp;                    for (Map.Entry entry : (Iterable&lt;Map.Entry&gt;) ((Map) object).entrySet()) {</b>
<b class="nc">&nbsp;                        Object entryValue = entry.getValue();</b>
<b class="nc">&nbsp;                        if (name.equals(entry.getKey())) {</b>
<b class="nc">&nbsp;                            Object applyValue = callback.apply(object, entryValue);</b>
<b class="nc">&nbsp;                            entry.setValue(applyValue);</b>
<b class="nc">&nbsp;                            context.eval = true;</b>
<b class="nc">&nbsp;                        } else {</b>
<b class="nc">&nbsp;                            if (entryValue != null) {</b>
<b class="nc">&nbsp;                                accept(entryValue);</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                } else if (object instanceof Collection) {</b>
<b class="nc">&nbsp;                    for (Object item : ((List&lt;?&gt;) object)) {</b>
<b class="nc">&nbsp;                        accept(item);</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    Class&lt;?&gt; entryValueClass = object.getClass();</b>
<b class="nc">&nbsp;                    ObjectReader objectReader = JSONFactory.getDefaultObjectReaderProvider().getObjectReader(entryValueClass);</b>
<b class="nc">&nbsp;                    ObjectWriter objectWriter = JSONFactory.getDefaultObjectWriterProvider().getObjectWriter(entryValueClass);</b>
<b class="nc">&nbsp;                    if (objectReader instanceof ObjectReaderBean) {</b>
<b class="nc">&nbsp;                        FieldReader fieldReader = objectReader.getFieldReader(nameHashCode);</b>
<b class="nc">&nbsp;                        FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCode);</b>
<b class="nc">&nbsp;                        if (fieldWriter != null &amp;&amp; fieldReader != null) {</b>
<b class="nc">&nbsp;                            Object fieldValue = fieldWriter.getFieldValue(object);</b>
<b class="nc">&nbsp;                            fieldValue = callback.apply(object, fieldValue);</b>
<b class="nc">&nbsp;                            fieldReader.accept(object, fieldValue);</b>
<b class="nc">&nbsp;                            context.eval = true;</b>
&nbsp;                            return;
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    List&lt;FieldWriter&gt; fieldWriters = objectWriter.getFieldWriters();</b>
<b class="nc">&nbsp;                    for (FieldWriter fieldWriter : fieldWriters) {</b>
<b class="nc">&nbsp;                        Object fieldValue = fieldWriter.getFieldValue(object);</b>
<b class="nc">&nbsp;                        accept(fieldValue);</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            List values = new JSONArray();</b>
<b class="nc">&nbsp;            accept(jsonReader, context, values);</b>
<b class="nc">&nbsp;            context.value = values;</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void accept(JSONReader jsonReader, Context context, List&lt;Object&gt; values) {
<b class="nc">&nbsp;            if (jsonReader.isJSONB()) {</b>
<b class="nc">&nbsp;                if (jsonReader.nextIfMatch(BC_OBJECT)) {</b>
<b class="nc">&nbsp;                    while (!jsonReader.nextIfMatch(BC_OBJECT_END)) {</b>
<b class="nc">&nbsp;                        long nameHashCode = jsonReader.readFieldNameHashCode();</b>
<b class="nc">&nbsp;                        if (nameHashCode == 0) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                        if (match) {</b>
<b class="nc">&nbsp;                            if (jsonReader.isArray()) {</b>
<b class="nc">&nbsp;                                values.addAll(jsonReader.readArray());</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                values.add(jsonReader.readAny());</b>
&nbsp;                            }
<b class="nc">&nbsp;                        } else if (jsonReader.isObject() || jsonReader.isArray()) {</b>
<b class="nc">&nbsp;                            accept(jsonReader, context, values);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            jsonReader.skipValue();</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (jsonReader.isArray()) {</b>
<b class="nc">&nbsp;                    int itemCnt = jsonReader.startArray();</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; itemCnt; i++) {</b>
<b class="nc">&nbsp;                        if (jsonReader.isObject() || jsonReader.isArray()) {</b>
<b class="nc">&nbsp;                            accept(jsonReader, context, values);</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else {</b>
<b class="nc">&nbsp;                    jsonReader.skipValue();</b>
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;{&#39;) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
&nbsp;                _for:
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    long nameHashCode = jsonReader.readFieldNameHashCode();</b>
&nbsp;
<b class="nc">&nbsp;                    boolean match = nameHashCode == this.nameHashCode;</b>
<b class="nc">&nbsp;                    char ch = jsonReader.ch;</b>
<b class="nc">&nbsp;                    if (!match &amp;&amp; ch != &#39;{&#39; &amp;&amp; ch != &#39;[&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
&nbsp;                    Object val;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;:
<b class="nc">&nbsp;                            jsonReader.readNumber0();</b>
<b class="nc">&nbsp;                            val = jsonReader.getNumber();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;[&#39;:
&nbsp;                        case &#39;{&#39;:
<b class="nc">&nbsp;                            if (match) {</b>
<b class="nc">&nbsp;                                val = ch == &#39;[&#39; ? jsonReader.readArray() : jsonReader.readObject();</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
<b class="nc">&nbsp;                            accept(jsonReader, context, values);</b>
<b class="nc">&nbsp;                            continue _for;</b>
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readString();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            val = null;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (val instanceof Collection) {</b>
<b class="nc">&nbsp;                        values.addAll((Collection) val);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        values.add(val);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (jsonReader.ch == &#39;[&#39;) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
&nbsp;
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;{&#39; || jsonReader.ch == &#39;[&#39;) {</b>
<b class="nc">&nbsp;                        accept(jsonReader, context, values);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                jsonReader.skipValue();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class IndexSegment
&nbsp;            extends Segment {
<b class="nc">&nbsp;        static final IndexSegment ZERO = new IndexSegment(0);</b>
<b class="nc">&nbsp;        static final IndexSegment ONE = new IndexSegment(1);</b>
<b class="nc">&nbsp;        static final IndexSegment TWO = new IndexSegment(2);</b>
&nbsp;
<b class="nc">&nbsp;        static final IndexSegment LAST = new IndexSegment(-1);</b>
&nbsp;
&nbsp;        final int index;
&nbsp;
<b class="nc">&nbsp;        public IndexSegment(int index) {</b>
<b class="nc">&nbsp;            this.index = index;</b>
&nbsp;        }
&nbsp;
&nbsp;        static IndexSegment of(int index) {
<b class="nc">&nbsp;            if (index == 0) {</b>
<b class="nc">&nbsp;                return ZERO;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (index == 1) {</b>
<b class="nc">&nbsp;                return ONE;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (index == 2) {</b>
<b class="nc">&nbsp;                return TWO;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (index == -1) {</b>
<b class="nc">&nbsp;                return LAST;</b>
&nbsp;            }
<b class="nc">&nbsp;            return new IndexSegment(index);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; list.size()) {</b>
<b class="nc">&nbsp;                        context.value = list.get(index);</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int itemIndex = list.size() + this.index;</b>
<b class="nc">&nbsp;                    if (itemIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        context.value = list.get(itemIndex);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if ((object instanceof SortedSet || object instanceof LinkedHashSet)</b>
<b class="nc">&nbsp;                    || (index == 0 &amp;&amp; object instanceof Collection &amp;&amp; ((Collection&lt;?&gt;) object).size() == 1)</b>
&nbsp;            ) {
<b class="nc">&nbsp;                Collection collection = (Collection) object;</b>
<b class="nc">&nbsp;                int i = 0;</b>
<b class="nc">&nbsp;                for (Iterator it = collection.iterator(); it.hasNext(); ++i) {</b>
<b class="nc">&nbsp;                    Object item = it.next();</b>
<b class="nc">&nbsp;                    if (i == index) {</b>
<b class="nc">&nbsp;                        context.value = item;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; array.length) {</b>
<b class="nc">&nbsp;                        context.value = array[index];</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int itemIndex = array.length + this.index;</b>
<b class="nc">&nbsp;                    if (itemIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        context.value = array[itemIndex];</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Class objectClass = object.getClass();</b>
<b class="nc">&nbsp;            if (objectClass.isArray()) {</b>
<b class="nc">&nbsp;                int length = Array.getLength(object);</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; length) {</b>
<b class="nc">&nbsp;                        context.value = Array.get(object, index);</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int itemIndex = length + this.index;</b>
<b class="nc">&nbsp;                    if (itemIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        context.value = Array.get(object, itemIndex);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Sequence) {</b>
<b class="nc">&nbsp;                List sequence = ((Sequence) object).values;</b>
<b class="nc">&nbsp;                JSONArray values = new JSONArray(sequence.size());</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; sequence.size(); i++) {</b>
<b class="nc">&nbsp;                    Object item = sequence.get(i);</b>
<b class="nc">&nbsp;                    context.value = item;</b>
<b class="nc">&nbsp;                    Context itemContext = new Context(context.path, context, context.current, context.next, context.readerFeatures);</b>
<b class="nc">&nbsp;                    eval(itemContext);</b>
<b class="nc">&nbsp;                    values.add(itemContext.value);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (context.next != null) {</b>
<b class="nc">&nbsp;                    context.value = new Sequence(values);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    context.value = values;</b>
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (Map.class.isAssignableFrom(objectClass)) {</b>
<b class="nc">&nbsp;                Object value = eval((Map) object);</b>
<b class="nc">&nbsp;                context.value = value;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
&nbsp;            // lax mode
<b class="nc">&nbsp;            if (index == 0) {</b>
<b class="nc">&nbsp;                context.value = object;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;jsonpath not support operate : &quot; + context.path + &quot;, objectClass&quot; + objectClass.getName());</b>
&nbsp;        }
&nbsp;
&nbsp;        private Object eval(Map object) {
<b class="nc">&nbsp;            Map map = object;</b>
<b class="nc">&nbsp;            Object value = map.get(index);</b>
<b class="nc">&nbsp;            if (value == null) {</b>
<b class="nc">&nbsp;                value = map.get(Integer.toString(index));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (value == null) {</b>
<b class="nc">&nbsp;                int size = map.size();</b>
<b class="nc">&nbsp;                Iterator it = map.entrySet().iterator();</b>
<b class="nc">&nbsp;                if (size == 1 || map instanceof LinkedHashMap || map instanceof SortedMap) {</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt;= index &amp;&amp; i &lt; size &amp;&amp; it.hasNext(); ++i) {</b>
<b class="nc">&nbsp;                        Map.Entry entry = (Map.Entry) it.next();</b>
<b class="nc">&nbsp;                        Object entryKey = entry.getKey();</b>
<b class="nc">&nbsp;                        Object entryValue = entry.getValue();</b>
<b class="nc">&nbsp;                        if (entryKey instanceof Long) {</b>
<b class="nc">&nbsp;                            if (entryKey.equals(Long.valueOf(index))) {</b>
<b class="nc">&nbsp;                                value = entryValue;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        } else {
<b class="nc">&nbsp;                            if (i == index) {</b>
<b class="nc">&nbsp;                                value = entryValue;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    for (int i = 0; i &lt;= index &amp;&amp; i &lt; map.size() &amp;&amp; it.hasNext(); ++i) {</b>
<b class="nc">&nbsp;                        Map.Entry entry = (Map.Entry) it.next();</b>
<b class="nc">&nbsp;                        Object entryKey = entry.getKey();</b>
<b class="nc">&nbsp;                        Object entryValue = entry.getValue();</b>
<b class="nc">&nbsp;                        if (entryKey instanceof Long) {</b>
<b class="nc">&nbsp;                            if (entryKey.equals(Long.valueOf(index))) {</b>
<b class="nc">&nbsp;                                value = entryValue;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return value;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Context context, Object value) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &gt; list.size()) {</b>
<b class="nc">&nbsp;                        for (int i = list.size(); i &lt; index; ++i) {</b>
<b class="nc">&nbsp;                            list.add(null);</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                    if (index &lt; list.size()) {</b>
<b class="nc">&nbsp;                        list.set(index, value);</b>
<b class="nc">&nbsp;                    } else if (index &lt;= list.size()) {</b>
<b class="nc">&nbsp;                        list.add(value);</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int itemIndex = list.size() + this.index;</b>
<b class="nc">&nbsp;                    if (itemIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        list.set(itemIndex, value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    array[index] = value;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    array[array.length + index] = value;</b>
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object != null &amp;&amp; object.getClass().isArray()) {</b>
<b class="nc">&nbsp;                int length = Array.getLength(object);</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; length) {</b>
<b class="nc">&nbsp;                        Array.set(object, index, value);</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int arrayIndex = length + index;</b>
<b class="nc">&nbsp;                    if (arrayIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        Array.set(object, arrayIndex, value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setCallback(Context context, BiFunction callback) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; list.size()) {</b>
<b class="nc">&nbsp;                        Object value = list.get(index);</b>
<b class="nc">&nbsp;                        value = callback.apply(object, value);</b>
<b class="nc">&nbsp;                        list.set(index, value);</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    int itemIndex = list.size() + this.index;</b>
<b class="nc">&nbsp;                    if (itemIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        Object value = list.get(index);</b>
<b class="nc">&nbsp;                        value = callback.apply(object, value);</b>
<b class="nc">&nbsp;                        list.set(itemIndex, value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; array.length) {</b>
<b class="nc">&nbsp;                        Object value = array[index];</b>
<b class="nc">&nbsp;                        value = callback.apply(object, value);</b>
<b class="nc">&nbsp;                        array[index] = value;</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    Object value = array[index];</b>
<b class="nc">&nbsp;                    value = callback.apply(object, value);</b>
<b class="nc">&nbsp;                    array[array.length + index] = value;</b>
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object != null &amp;&amp; object.getClass().isArray()) {</b>
<b class="nc">&nbsp;                int length = Array.getLength(object);</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; length) {</b>
<b class="nc">&nbsp;                        Object value = Array.get(object, index);</b>
<b class="nc">&nbsp;                        value = callback.apply(object, value);</b>
<b class="nc">&nbsp;                        Array.set(object, index, value);</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    int arrayIndex = length + index;</b>
<b class="nc">&nbsp;                    if (arrayIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        Object value = Array.get(object, index);</b>
<b class="nc">&nbsp;                        value = callback.apply(object, value);</b>
<b class="nc">&nbsp;                        Array.set(object, arrayIndex, value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; list.size()) {</b>
<b class="nc">&nbsp;                        list.remove(index);</b>
<b class="nc">&nbsp;                        return true;</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int itemIndex = list.size() + this.index;</b>
<b class="nc">&nbsp;                    if (itemIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        list.remove(itemIndex);</b>
<b class="nc">&nbsp;                        return true;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setInt(Context context, int value) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
<b class="nc">&nbsp;            if (object instanceof int[]) {</b>
<b class="nc">&nbsp;                int[] array = (int[]) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; array.length) {</b>
<b class="nc">&nbsp;                        array[index] = value;</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int arrayIndex = array.length + index;</b>
<b class="nc">&nbsp;                    if (arrayIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        array[arrayIndex] = value;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof long[]) {</b>
<b class="nc">&nbsp;                long[] array = (long[]) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; array.length) {</b>
<b class="nc">&nbsp;                        array[index] = value;</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int arrayIndex = array.length + index;</b>
<b class="nc">&nbsp;                    if (arrayIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        array[arrayIndex] = value;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            set(context, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setLong(Context context, long value) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
<b class="nc">&nbsp;            if (object instanceof int[]) {</b>
<b class="nc">&nbsp;                int[] array = (int[]) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; array.length) {</b>
<b class="nc">&nbsp;                        array[index] = (int) value;</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int arrayIndex = array.length + index;</b>
<b class="nc">&nbsp;                    if (arrayIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        array[arrayIndex] = (int) value;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof long[]) {</b>
<b class="nc">&nbsp;                long[] array = (long[]) object;</b>
<b class="nc">&nbsp;                if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                    if (index &lt; array.length) {</b>
<b class="nc">&nbsp;                        array[index] = value;</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    int arrayIndex = array.length + index;</b>
<b class="nc">&nbsp;                    if (arrayIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                        array[arrayIndex] = value;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            set(context, value);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent != null</b>
&nbsp;                    &amp;&amp; (context.parent.eval
&nbsp;                    || (context.parent.current instanceof CycleNameSegment &amp;&amp; context.next == null))
&nbsp;            ) {
<b class="nc">&nbsp;                eval(context);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.isJSONB()) {</b>
<b class="nc">&nbsp;                int itemCnt = jsonReader.startArray();</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; itemCnt; i++) {</b>
<b class="nc">&nbsp;                    boolean match = index == i;</b>
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (jsonReader.isArray() || jsonReader.isObject()) {</b>
<b class="nc">&nbsp;                        if (context.next != null) {</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    context.value = jsonReader.readAny();</b>
<b class="nc">&nbsp;                    context.eval = true;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;{&#39;) {</b>
<b class="nc">&nbsp;                Map object = jsonReader.readObject();</b>
<b class="nc">&nbsp;                context.value = eval(object);</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            jsonReader.next();</b>
&nbsp;            _for:
<b class="nc">&nbsp;            for (int i = 0; jsonReader.ch != EOI; ++i) {</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                boolean match = index == -1 || index == i;</b>
&nbsp;
<b class="nc">&nbsp;                if (!match) {</b>
<b class="nc">&nbsp;                    jsonReader.skipValue();</b>
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
&nbsp;                    }
&nbsp;                    continue;
&nbsp;                }
&nbsp;
&nbsp;                Object val;
<b class="nc">&nbsp;                switch (jsonReader.ch) {</b>
&nbsp;                    case &#39;-&#39;:
&nbsp;                    case &#39;+&#39;:
&nbsp;                    case &#39;0&#39;:
&nbsp;                    case &#39;1&#39;:
&nbsp;                    case &#39;2&#39;:
&nbsp;                    case &#39;3&#39;:
&nbsp;                    case &#39;4&#39;:
&nbsp;                    case &#39;5&#39;:
&nbsp;                    case &#39;6&#39;:
&nbsp;                    case &#39;7&#39;:
&nbsp;                    case &#39;8&#39;:
&nbsp;                    case &#39;9&#39;:
&nbsp;                    case &#39;.&#39;:
<b class="nc">&nbsp;                        jsonReader.readNumber0();</b>
<b class="nc">&nbsp;                        val = jsonReader.getNumber();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;[&#39;:
<b class="nc">&nbsp;                        if (context.next != null &amp;&amp; !(context.next instanceof EvalSegment)) {</b>
<b class="nc">&nbsp;                            break _for;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;{&#39;:
<b class="nc">&nbsp;                        if (context.next != null &amp;&amp; !(context.next instanceof EvalSegment)) {</b>
<b class="nc">&nbsp;                            break _for;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;&quot;&#39;:
&nbsp;                    case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readString();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;t&#39;:
&nbsp;                    case &#39;f&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;n&#39;:
<b class="nc">&nbsp;                        jsonReader.readNull();</b>
<b class="nc">&nbsp;                        val = null;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    default:
<b class="nc">&nbsp;                        throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (index == -1) {</b>
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                        context.value = val;</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    context.value = val;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String toString() {
<b class="nc">&nbsp;            int size = (index &lt; 0) ? IOUtils.stringSize(-index) + 1 : IOUtils.stringSize(index);</b>
<b class="nc">&nbsp;            byte[] bytes = new byte[size + 2];</b>
<b class="nc">&nbsp;            bytes[0] = &#39;[&#39;;</b>
<b class="nc">&nbsp;            IOUtils.getChars(index, bytes.length - 1, bytes);</b>
<b class="nc">&nbsp;            bytes[bytes.length - 1] = &#39;]&#39;;</b>
&nbsp;
&nbsp;            String str;
<b class="nc">&nbsp;            if (STRING_CREATOR_JDK11 != null) {</b>
<b class="nc">&nbsp;                str = STRING_CREATOR_JDK11.apply(bytes, LATIN1);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                str = new String(bytes, StandardCharsets.US_ASCII);</b>
&nbsp;            }
<b class="nc">&nbsp;            return str;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    static final class RandomIndexSegment</b>
&nbsp;            extends Segment {
<b class="nc">&nbsp;        public static final RandomIndexSegment INSTANCE = new RandomIndexSegment();</b>
&nbsp;
&nbsp;        Random random;
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent != null</b>
&nbsp;                    &amp;&amp; (context.parent.eval
&nbsp;                    || (context.parent.current instanceof CycleNameSegment &amp;&amp; context.next == null))) {
<b class="nc">&nbsp;                eval(context);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.isJSONB()) {</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray();</b>
&nbsp;
&nbsp;                {
<b class="nc">&nbsp;                    int itemCnt = jsonReader.startArray();</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; itemCnt; i++) {</b>
<b class="nc">&nbsp;                        array.add(jsonReader.readAny());</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
&nbsp;                // lazy init for graalvm
<b class="nc">&nbsp;                if (random == null) {</b>
<b class="nc">&nbsp;                    random = new Random();</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                int index = Math.abs(random.nextInt()) % array.size();</b>
<b class="nc">&nbsp;                context.value = array.get(index);</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            JSONArray array = new JSONArray();</b>
<b class="nc">&nbsp;            jsonReader.next();</b>
<b class="nc">&nbsp;            for (int i = 0; jsonReader.ch != EOI; ++i) {</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;
&nbsp;                Object val;
<b class="nc">&nbsp;                switch (jsonReader.ch) {</b>
&nbsp;                    case &#39;-&#39;:
&nbsp;                    case &#39;+&#39;:
&nbsp;                    case &#39;0&#39;:
&nbsp;                    case &#39;1&#39;:
&nbsp;                    case &#39;2&#39;:
&nbsp;                    case &#39;3&#39;:
&nbsp;                    case &#39;4&#39;:
&nbsp;                    case &#39;5&#39;:
&nbsp;                    case &#39;6&#39;:
&nbsp;                    case &#39;7&#39;:
&nbsp;                    case &#39;8&#39;:
&nbsp;                    case &#39;9&#39;:
&nbsp;                    case &#39;.&#39;:
<b class="nc">&nbsp;                        jsonReader.readNumber0();</b>
<b class="nc">&nbsp;                        val = jsonReader.getNumber();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;[&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;{&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;&quot;&#39;:
&nbsp;                    case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readString();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;t&#39;:
&nbsp;                    case &#39;f&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;n&#39;:
<b class="nc">&nbsp;                        jsonReader.readNull();</b>
<b class="nc">&nbsp;                        val = null;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    default:
<b class="nc">&nbsp;                        throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                array.add(val);</b>
&nbsp;            }
&nbsp;
&nbsp;            // lazy init for graalvm
<b class="nc">&nbsp;            if (random == null) {</b>
<b class="nc">&nbsp;                random = new Random();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            int index = Math.abs(random.nextInt()) % array.size();</b>
<b class="nc">&nbsp;            context.value = array.get(index);</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                if (list.isEmpty()) {</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
&nbsp;                // lazy init for graalvm
<b class="nc">&nbsp;                if (random == null) {</b>
<b class="nc">&nbsp;                    random = new Random();</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                int randomIndex = Math.abs(random.nextInt()) % list.size();</b>
<b class="nc">&nbsp;                context.value = list.get(randomIndex);</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) object;</b>
<b class="nc">&nbsp;                if (array.length == 0) {</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
&nbsp;                // lazy init for graalvm
<b class="nc">&nbsp;                if (random == null) {</b>
<b class="nc">&nbsp;                    random = new Random();</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                int randomIndex = random.nextInt() % array.length;</b>
<b class="nc">&nbsp;                context.value = array[randomIndex];</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class RangeIndexSegment
&nbsp;            extends Segment {
&nbsp;        final int begin;
&nbsp;        final int end;
&nbsp;
<b class="nc">&nbsp;        public RangeIndexSegment(int begin, int end) {</b>
<b class="nc">&nbsp;            this.begin = begin;</b>
<b class="nc">&nbsp;            this.end = end;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            List result = new JSONArray();</b>
&nbsp;
<b class="nc">&nbsp;            if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                for (int i = 0, size = list.size(); i &lt; size; i++) {</b>
&nbsp;                    boolean match;
<b class="nc">&nbsp;                    if (begin &gt;= 0) {</b>
<b class="nc">&nbsp;                        match = i &gt;= begin &amp;&amp; i &lt; end;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        int ni = i - size;</b>
<b class="nc">&nbsp;                        match = ni &gt;= begin &amp;&amp; ni &lt; end;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (match) {</b>
<b class="nc">&nbsp;                        result.add(list.get(i));</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.value = result;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Object[]) {</b>
<b class="nc">&nbsp;                Object[] array = (Object[]) object;</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; array.length; i++) {</b>
<b class="nc">&nbsp;                    boolean match = i &gt;= begin &amp;&amp; i &lt;= end</b>
&nbsp;                            || i - array.length &gt; begin &amp;&amp; i - array.length &lt;= end;
<b class="nc">&nbsp;                    if (match) {</b>
<b class="nc">&nbsp;                        result.add(array[i]);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                context.value = result;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent != null</b>
&nbsp;                    &amp;&amp; (context.parent.eval
&nbsp;                    || (context.parent.current instanceof CycleNameSegment &amp;&amp; context.next == null))
&nbsp;            ) {
<b class="nc">&nbsp;                eval(context);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.isJSONB()) {</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray();</b>
&nbsp;
&nbsp;                {
<b class="nc">&nbsp;                    int itemCnt = jsonReader.startArray();</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; itemCnt; i++) {</b>
<b class="nc">&nbsp;                        boolean match = begin &lt; 0 || i &gt;= begin &amp;&amp; i &lt; end;</b>
&nbsp;
<b class="nc">&nbsp;                        if (!match) {</b>
<b class="nc">&nbsp;                            jsonReader.skipValue();</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        array.add(</b>
<b class="nc">&nbsp;                                jsonReader.readAny());</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (begin &lt; 0) {</b>
<b class="nc">&nbsp;                    for (int size = array.size(), i = size - 1; i &gt;= 0; i--) {</b>
<b class="nc">&nbsp;                        int ni = i - size;</b>
<b class="nc">&nbsp;                        if (ni &lt; begin || ni &gt;= end) {</b>
<b class="nc">&nbsp;                            array.remove(i);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                context.value = array;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            JSONArray array = new JSONArray();</b>
<b class="nc">&nbsp;            jsonReader.next();</b>
<b class="nc">&nbsp;            for (int i = 0; jsonReader.ch != EOI; ++i) {</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                boolean match = begin &lt; 0 || i &gt;= begin &amp;&amp; i &lt; end;</b>
&nbsp;
<b class="nc">&nbsp;                if (!match) {</b>
<b class="nc">&nbsp;                    jsonReader.skipValue();</b>
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
&nbsp;                    }
&nbsp;                    continue;
&nbsp;                }
&nbsp;
&nbsp;                Object val;
<b class="nc">&nbsp;                switch (jsonReader.ch) {</b>
&nbsp;                    case &#39;-&#39;:
&nbsp;                    case &#39;+&#39;:
&nbsp;                    case &#39;0&#39;:
&nbsp;                    case &#39;1&#39;:
&nbsp;                    case &#39;2&#39;:
&nbsp;                    case &#39;3&#39;:
&nbsp;                    case &#39;4&#39;:
&nbsp;                    case &#39;5&#39;:
&nbsp;                    case &#39;6&#39;:
&nbsp;                    case &#39;7&#39;:
&nbsp;                    case &#39;8&#39;:
&nbsp;                    case &#39;9&#39;:
&nbsp;                    case &#39;.&#39;:
<b class="nc">&nbsp;                        jsonReader.readNumber0();</b>
<b class="nc">&nbsp;                        val = jsonReader.getNumber();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;[&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;{&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;&quot;&#39;:
&nbsp;                    case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readString();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;t&#39;:
&nbsp;                    case &#39;f&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;n&#39;:
<b class="nc">&nbsp;                        jsonReader.readNull();</b>
<b class="nc">&nbsp;                        val = null;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    default:
<b class="nc">&nbsp;                        throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                array.add(val);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (begin &lt; 0) {</b>
<b class="nc">&nbsp;                for (int size = array.size(), i = size - 1; i &gt;= 0; i--) {</b>
<b class="nc">&nbsp;                    int ni = i - size;</b>
<b class="nc">&nbsp;                    if (ni &lt; begin || ni &gt;= end) {</b>
<b class="nc">&nbsp;                        array.remove(i);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            context.value = array;</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void set(Context context, Object value) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                for (int i = 0, size = list.size(); i &lt; size; i++) {</b>
&nbsp;                    boolean match;
<b class="nc">&nbsp;                    if (begin &gt;= 0) {</b>
<b class="nc">&nbsp;                        match = i &gt;= begin &amp;&amp; i &lt; end;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        int ni = i - size;</b>
<b class="nc">&nbsp;                        match = ni &gt;= begin &amp;&amp; ni &lt; end;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (match) {</b>
<b class="nc">&nbsp;                        list.set(i, value);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation &quot; + getClass());</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                int removeCount = 0;</b>
<b class="nc">&nbsp;                for (int size = list.size(), i = size - 1; i &gt;= 0; i--) {</b>
&nbsp;                    boolean match;
<b class="nc">&nbsp;                    if (begin &gt;= 0) {</b>
<b class="nc">&nbsp;                        match = i &gt;= begin &amp;&amp; i &lt; end;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        int ni = i - size;</b>
<b class="nc">&nbsp;                        match = ni &gt;= begin &amp;&amp; ni &lt; end;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (match) {</b>
<b class="nc">&nbsp;                        list.remove(i);</b>
<b class="nc">&nbsp;                        removeCount++;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                return removeCount &gt; 0;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation &quot; + getClass());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class MultiIndexSegment
&nbsp;            extends Segment {
&nbsp;        final int[] indexes;
&nbsp;
<b class="nc">&nbsp;        public MultiIndexSegment(int[] indexes) {</b>
&nbsp;//            Arrays.sort(indexes);
<b class="nc">&nbsp;            this.indexes = indexes;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            List result = new JSONArray();</b>
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Sequence) {</b>
<b class="nc">&nbsp;                List list = ((Sequence) object).values;</b>
&nbsp;
<b class="nc">&nbsp;                for (Object item : list) {</b>
<b class="nc">&nbsp;                    context.value = item;</b>
<b class="nc">&nbsp;                    Context itemContext = new Context(context.path, context, context.current, context.next, context.readerFeatures);</b>
<b class="nc">&nbsp;                    eval(itemContext);</b>
<b class="nc">&nbsp;                    Object value = itemContext.value;</b>
&nbsp;
<b class="nc">&nbsp;                    if (value instanceof Collection) {</b>
<b class="nc">&nbsp;                        result.addAll((Collection) value);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        result.add(value);</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                context.value = result;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            for (int index : indexes) {</b>
&nbsp;                Object value;
&nbsp;
<b class="nc">&nbsp;                if (object instanceof java.util.List) {</b>
<b class="nc">&nbsp;                    List list = (List) object;</b>
&nbsp;
<b class="nc">&nbsp;                    if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                        if (index &lt; list.size()) {</b>
<b class="nc">&nbsp;                            value = list.get(index);</b>
&nbsp;                        } else {
&nbsp;                            continue;
&nbsp;                        }
&nbsp;                    } else {
<b class="nc">&nbsp;                        int itemIndex = list.size() + index;</b>
<b class="nc">&nbsp;                        if (itemIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                            value = list.get(itemIndex);</b>
&nbsp;                        } else {
&nbsp;                            continue;
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                } else if (object instanceof Object[]) {</b>
<b class="nc">&nbsp;                    Object[] array = (Object[]) object;</b>
<b class="nc">&nbsp;                    if (index &gt;= 0) {</b>
<b class="nc">&nbsp;                        if (index &lt; array.length) {</b>
<b class="nc">&nbsp;                            value = array[index];</b>
&nbsp;                        } else {
&nbsp;                            continue;
&nbsp;                        }
&nbsp;                    } else {
<b class="nc">&nbsp;                        int itemIndex = array.length + index;</b>
<b class="nc">&nbsp;                        if (itemIndex &gt;= 0) {</b>
<b class="nc">&nbsp;                            value = array[itemIndex];</b>
&nbsp;                        } else {
&nbsp;                            continue;
&nbsp;                        }
&nbsp;                    }
&nbsp;                } else {
&nbsp;                    continue;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (value instanceof Collection) {</b>
<b class="nc">&nbsp;                    result.addAll((Collection) value);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    result.add(value);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            context.value = result;</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent != null</b>
&nbsp;                    &amp;&amp; context.parent.current instanceof CycleNameSegment
&nbsp;                    &amp;&amp; context.next == null) {
<b class="nc">&nbsp;                eval(context);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.isJSONB()) {</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray();</b>
<b class="nc">&nbsp;                int itemCnt = jsonReader.startArray();</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; itemCnt; i++) {</b>
<b class="nc">&nbsp;                    boolean match = Arrays.binarySearch(indexes, i) &gt;= 0;</b>
<b class="nc">&nbsp;                    if (!match) {</b>
<b class="nc">&nbsp;                        jsonReader.skipValue();</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    array.add(jsonReader.readAny());</b>
&nbsp;                }
<b class="nc">&nbsp;                context.value = array;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            JSONArray array = new JSONArray();</b>
&nbsp;
<b class="nc">&nbsp;            jsonReader.next();</b>
<b class="nc">&nbsp;            for (int i = 0; jsonReader.ch != EOI; ++i) {</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                boolean match = Arrays.binarySearch(indexes, i) &gt;= 0;</b>
&nbsp;
<b class="nc">&nbsp;                if (!match) {</b>
<b class="nc">&nbsp;                    jsonReader.skipValue();</b>
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
&nbsp;                    }
&nbsp;                    continue;
&nbsp;                }
&nbsp;
&nbsp;                Object val;
<b class="nc">&nbsp;                switch (jsonReader.ch) {</b>
&nbsp;                    case &#39;-&#39;:
&nbsp;                    case &#39;+&#39;:
&nbsp;                    case &#39;0&#39;:
&nbsp;                    case &#39;1&#39;:
&nbsp;                    case &#39;2&#39;:
&nbsp;                    case &#39;3&#39;:
&nbsp;                    case &#39;4&#39;:
&nbsp;                    case &#39;5&#39;:
&nbsp;                    case &#39;6&#39;:
&nbsp;                    case &#39;7&#39;:
&nbsp;                    case &#39;8&#39;:
&nbsp;                    case &#39;9&#39;:
&nbsp;                    case &#39;.&#39;:
<b class="nc">&nbsp;                        jsonReader.readNumber0();</b>
<b class="nc">&nbsp;                        val = jsonReader.getNumber();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;[&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;{&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;&quot;&#39;:
&nbsp;                    case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readString();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;t&#39;:
&nbsp;                    case &#39;f&#39;:
<b class="nc">&nbsp;                        val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &#39;n&#39;:
<b class="nc">&nbsp;                        jsonReader.readNull();</b>
<b class="nc">&nbsp;                        val = null;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    default:
<b class="nc">&nbsp;                        throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                array.add(val);</b>
&nbsp;            }
<b class="nc">&nbsp;            context.value = array;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class MultiNameSegment
&nbsp;            extends Segment {
&nbsp;        final String[] names;
&nbsp;        final long[] nameHashCodes;
&nbsp;        final Set&lt;String&gt; nameSet;
&nbsp;
<b class="nc">&nbsp;        public MultiNameSegment(String[] names) {</b>
<b class="nc">&nbsp;            this.names = names;</b>
<b class="nc">&nbsp;            this.nameHashCodes = new long[names.length];</b>
<b class="nc">&nbsp;            this.nameSet = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; names.length; i++) {</b>
<b class="nc">&nbsp;                nameHashCodes[i] = Fnv.hashCode64(names[i]);</b>
<b class="nc">&nbsp;                nameSet.add(names[i]);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray(names.length);</b>
<b class="nc">&nbsp;                for (String name : names) {</b>
<b class="nc">&nbsp;                    Object value = map.get(name);</b>
<b class="nc">&nbsp;                    array.add(value);</b>
&nbsp;                }
<b class="nc">&nbsp;                context.value = array;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Collection) {</b>
&nbsp;                // skip
<b class="nc">&nbsp;                context.value = object;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectWriterProvider provider = context.path.getWriterContext().getProvider();</b>
<b class="nc">&nbsp;            ObjectWriter objectWriter = provider.getObjectWriter(object.getClass());</b>
&nbsp;
<b class="nc">&nbsp;            JSONArray array = new JSONArray(names.length);</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; names.length; i++) {</b>
<b class="nc">&nbsp;                FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCodes[i]);</b>
<b class="nc">&nbsp;                Object fieldValue = null;</b>
<b class="nc">&nbsp;                if (fieldWriter != null) {</b>
<b class="nc">&nbsp;                    fieldValue = fieldWriter.getFieldValue(object);</b>
&nbsp;                }
<b class="nc">&nbsp;                array.add(fieldValue);</b>
&nbsp;            }
<b class="nc">&nbsp;            context.value = array;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent != null</b>
&nbsp;                    &amp;&amp; (context.parent.eval
&nbsp;                    || context.parent.current instanceof FilterSegment
&nbsp;                    || context.parent.current instanceof MultiIndexSegment)
&nbsp;            ) {
<b class="nc">&nbsp;                eval(context);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Object object = jsonReader.readAny();</b>
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray(names.length);</b>
<b class="nc">&nbsp;                for (String name : names) {</b>
<b class="nc">&nbsp;                    Object value = map.get(name);</b>
<b class="nc">&nbsp;                    array.add(value);</b>
&nbsp;                }
<b class="nc">&nbsp;                context.value = array;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Collection) {</b>
&nbsp;                // skip
<b class="nc">&nbsp;                context.value = object;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectWriterProvider provider = context.path.getWriterContext().getProvider();</b>
<b class="nc">&nbsp;            ObjectWriter objectWriter = provider.getObjectWriter(object.getClass());</b>
&nbsp;
<b class="nc">&nbsp;            JSONArray array = new JSONArray(names.length);</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; names.length; i++) {</b>
<b class="nc">&nbsp;                FieldWriter fieldWriter = objectWriter.getFieldWriter(nameHashCodes[i]);</b>
<b class="nc">&nbsp;                Object fieldValue = null;</b>
<b class="nc">&nbsp;                if (fieldWriter != null) {</b>
<b class="nc">&nbsp;                    fieldValue = fieldWriter.getFieldValue(object);</b>
&nbsp;                }
<b class="nc">&nbsp;                array.add(fieldValue);</b>
&nbsp;            }
<b class="nc">&nbsp;            context.value = array;</b>
&nbsp;            return;
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class AllSegment
&nbsp;            extends Segment {
<b class="nc">&nbsp;        static final AllSegment INSTANCE = new AllSegment(false);</b>
<b class="nc">&nbsp;        static final AllSegment INSTANCE_ARRAY = new AllSegment(true);</b>
&nbsp;
&nbsp;        final boolean array;
&nbsp;
<b class="nc">&nbsp;        AllSegment(boolean array) {</b>
<b class="nc">&nbsp;            this.array = array;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void eval(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object == null) {</b>
<b class="nc">&nbsp;                context.value = null;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                Map map = (Map) object;</b>
<b class="nc">&nbsp;                JSONArray array = new JSONArray(map.size());</b>
<b class="nc">&nbsp;                for (Object value : map.values()) {</b>
<b class="nc">&nbsp;                    if (this.array &amp;&amp; value instanceof Collection) {</b>
<b class="nc">&nbsp;                        array.addAll((Collection) value);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        array.add(value);</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                if (context.next != null) {</b>
<b class="nc">&nbsp;                    context.value = new Sequence(array);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    context.value = array;</b>
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof List) {</b>
<b class="nc">&nbsp;                List list = (List) object;</b>
<b class="nc">&nbsp;                JSONArray values = new JSONArray(list.size());</b>
<b class="nc">&nbsp;                if (context.next == null &amp;&amp; !array) {</b>
<b class="nc">&nbsp;                    for (Object item : list) {</b>
<b class="nc">&nbsp;                        if (item instanceof Map) {</b>
<b class="nc">&nbsp;                            values.addAll(((Map&lt;?, ?&gt;) item).values());</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            values.add(item);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                    context.value = values;</b>
<b class="nc">&nbsp;                    context.eval = true;</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (context.next != null) {</b>
<b class="nc">&nbsp;                    context.value = new Sequence(list);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    context.value = object;</b>
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Collection) {</b>
&nbsp;                // skip
<b class="nc">&nbsp;                context.value = object;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Sequence) {</b>
<b class="nc">&nbsp;                List list = ((Sequence) object).values;</b>
<b class="nc">&nbsp;                JSONArray values = new JSONArray(list.size());</b>
<b class="nc">&nbsp;                if (context.next == null &amp;&amp; !array) {</b>
<b class="nc">&nbsp;                    for (Object item : list) {</b>
<b class="nc">&nbsp;                        if (item instanceof Map) {</b>
<b class="nc">&nbsp;                            values.addAll(((Map&lt;?, ?&gt;) item).values());</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            values.add(item);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                    context.value = values;</b>
<b class="nc">&nbsp;                    context.eval = true;</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (context.next != null) {</b>
<b class="nc">&nbsp;                    context.value = new Sequence(list);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    context.value = object;</b>
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ObjectWriterProvider provider = context.path.getWriterContext().getProvider();</b>
<b class="nc">&nbsp;            ObjectWriter objectWriter = provider.getObjectWriter(object.getClass());</b>
<b class="nc">&nbsp;            List&lt;FieldWriter&gt; fieldWriters = objectWriter.getFieldWriters();</b>
<b class="nc">&nbsp;            int size = fieldWriters.size();</b>
<b class="nc">&nbsp;            JSONArray array = new JSONArray(size);</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; size; i++) {</b>
<b class="nc">&nbsp;                Object fieldValue = fieldWriters.get(i).getFieldValue(object);</b>
<b class="nc">&nbsp;                array.add(fieldValue);</b>
&nbsp;            }
<b class="nc">&nbsp;            context.value = array;</b>
<b class="nc">&nbsp;            context.eval = true;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean remove(Context context) {
<b class="nc">&nbsp;            Object object = context.parent == null</b>
&nbsp;                    ? context.root
&nbsp;                    : context.parent.value;
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Map) {</b>
<b class="nc">&nbsp;                ((Map&lt;?, ?&gt;) object).clear();</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (object instanceof Collection) {</b>
<b class="nc">&nbsp;                ((Collection&lt;?&gt;) object).clear();</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;UnsupportedOperation &quot; + getClass());</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void accept(JSONReader jsonReader, Context context) {
<b class="nc">&nbsp;            if (context.parent != null &amp;&amp; context.parent.eval) {</b>
<b class="nc">&nbsp;                eval(context);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.isJSONB()) {</b>
<b class="nc">&nbsp;                List&lt;Object&gt; values = new JSONArray();</b>
<b class="nc">&nbsp;                if (jsonReader.nextIfMatch(BC_OBJECT)) {</b>
<b class="nc">&nbsp;                    while (!jsonReader.nextIfMatch(BC_OBJECT_END)) {</b>
<b class="nc">&nbsp;                        if (jsonReader.skipName()) {</b>
<b class="nc">&nbsp;                            Object val = jsonReader.readAny();</b>
&nbsp;
<b class="nc">&nbsp;                            if (array &amp;&amp; val instanceof Collection) {</b>
<b class="nc">&nbsp;                                values.addAll((Collection) val);</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                values.add(val);</b>
&nbsp;                            }
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    context.value = values;</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (jsonReader.isArray() &amp;&amp; context.next != null) {</b>
&nbsp;                    // skip
&nbsp;                    return;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            boolean alwaysReturnList = context.next == null &amp;&amp; (context.path.features &amp; Feature.AlwaysReturnList.mask) != 0;</b>
<b class="nc">&nbsp;            List&lt;Object&gt; values = new JSONArray();</b>
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.nextIfMatch(&#39;{&#39;)) {</b>
&nbsp;                _for:
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;}&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    jsonReader.skipName();</b>
&nbsp;                    Object val;
<b class="nc">&nbsp;                    switch (jsonReader.ch) {</b>
&nbsp;                        case &#39;-&#39;:
&nbsp;                        case &#39;+&#39;:
&nbsp;                        case &#39;0&#39;:
&nbsp;                        case &#39;1&#39;:
&nbsp;                        case &#39;2&#39;:
&nbsp;                        case &#39;3&#39;:
&nbsp;                        case &#39;4&#39;:
&nbsp;                        case &#39;5&#39;:
&nbsp;                        case &#39;6&#39;:
&nbsp;                        case &#39;7&#39;:
&nbsp;                        case &#39;8&#39;:
&nbsp;                        case &#39;9&#39;:
<b class="nc">&nbsp;                            jsonReader.readNumber0();</b>
<b class="nc">&nbsp;                            val = jsonReader.getNumber();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;[&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readArray();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;{&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readObject();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;&quot;&#39;:
&nbsp;                        case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readString();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;t&#39;:
&nbsp;                        case &#39;f&#39;:
<b class="nc">&nbsp;                            val = jsonReader.readBoolValue();</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;n&#39;:
<b class="nc">&nbsp;                            jsonReader.readNull();</b>
<b class="nc">&nbsp;                            val = null;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case &#39;]&#39;:
<b class="nc">&nbsp;                            jsonReader.next();</b>
<b class="nc">&nbsp;                            break _for;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (val instanceof Collection) {</b>
<b class="nc">&nbsp;                        if (alwaysReturnList) {</b>
<b class="nc">&nbsp;                            values.add(val);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            values.addAll((Collection) val);</b>
&nbsp;                        }
&nbsp;                    } else {
<b class="nc">&nbsp;                        values.add(val);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                context.value = values;</b>
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;[&#39;) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
&nbsp;                for (; ; ) {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    Object value = jsonReader.readAny();</b>
<b class="nc">&nbsp;                    if (context.next == null &amp;&amp; value instanceof Map) {</b>
<b class="nc">&nbsp;                        values.addAll(((Map&lt;?, ?&gt;) value).values());</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        values.add(value);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;,&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;
<b class="nc">&nbsp;                if (context.next != null) {</b>
<b class="nc">&nbsp;                    context.value = new Sequence(values);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    context.value = values;</b>
&nbsp;                }
<b class="nc">&nbsp;                context.eval = true;</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            throw new JSONException(&quot;TODO&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static final class BiFunctionAdapter
&nbsp;            implements BiFunction {
&nbsp;        private final Function function;
&nbsp;
<b class="nc">&nbsp;        BiFunctionAdapter(Function function) {</b>
<b class="nc">&nbsp;            this.function = function;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object apply(Object o1, Object o2) {
<b class="nc">&nbsp;            return function.apply(o2);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static class Sequence {
&nbsp;        final List values;
&nbsp;
<b class="nc">&nbsp;        public Sequence(List values) {</b>
<b class="nc">&nbsp;            this.values = values;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static class JSONPathParser {
&nbsp;        final String path;
&nbsp;        final JSONReader jsonReader;
&nbsp;
&nbsp;        boolean dollar;
&nbsp;        boolean lax;
&nbsp;        boolean strict;
&nbsp;
&nbsp;        int segmentIndex;
&nbsp;        Segment first;
&nbsp;        Segment second;
&nbsp;
&nbsp;        List&lt;Segment&gt; segments;
&nbsp;
&nbsp;        boolean negative;
&nbsp;
<b class="nc">&nbsp;        public JSONPathParser(String str) {</b>
<b class="nc">&nbsp;            this.jsonReader = JSONReader.of(this.path = str, PARSE_CONTEXT);</b>
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;l&#39; &amp;&amp; jsonReader.nextIfMatchIdent(&#39;l&#39;, &#39;a&#39;, &#39;x&#39;)) {</b>
<b class="nc">&nbsp;                lax = true;</b>
<b class="nc">&nbsp;            } else if (jsonReader.ch == &#39;s&#39; &amp;&amp; jsonReader.nextIfMatchIdent(&#39;s&#39;, &#39;t&#39;, &#39;r&#39;, &#39;i&#39;, &#39;c&#39;, &#39;t&#39;)) {</b>
<b class="nc">&nbsp;                strict = true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;-&#39;) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                negative = true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;$&#39;) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                dollar = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        JSONPath parse(Feature... features) {
<b class="nc">&nbsp;            if (dollar &amp;&amp; jsonReader.ch == EOI) {</b>
<b class="nc">&nbsp;                if (negative) {</b>
<b class="nc">&nbsp;                    return new SingleSegmentPath(FUNCTION_NEGATIVE, path);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return RootPath.INSTANCE;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;e&#39; &amp;&amp; jsonReader.nextIfMatchIdent(&#39;e&#39;, &#39;x&#39;, &#39;i&#39;, &#39;s&#39;, &#39;t&#39;, &#39;s&#39;)) {</b>
<b class="nc">&nbsp;                if (!jsonReader.nextIfMatch(&#39;(&#39;)) {</b>
<b class="nc">&nbsp;                    throw new JSONException(&quot;syntax error &quot; + path);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;@&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;.&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(&quot;syntax error &quot; + path);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                char ch = jsonReader.ch;</b>
&nbsp;                Segment segment;
<b class="nc">&nbsp;                if ((ch &gt;= &#39;a&#39; &amp;&amp; ch &lt;= &#39;z&#39;) || (ch &gt;= &#39;A&#39; &amp;&amp; ch &lt;= &#39;Z&#39;) || ch == &#39;_&#39; || ch == &#39;@&#39;) {</b>
<b class="nc">&nbsp;                    segment = parseProperty();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    throw new JSONException(&quot;syntax error &quot; + path);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                    throw new JSONException(&quot;syntax error &quot; + path);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return new TwoSegmentPath(path, segment, FUNCTION_EXISTS);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            while (jsonReader.ch != EOI) {</b>
&nbsp;                final Segment segment;
&nbsp;
<b class="nc">&nbsp;                char ch = jsonReader.ch;</b>
<b class="nc">&nbsp;                if (ch == &#39;.&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    segment = parseProperty();</b>
<b class="nc">&nbsp;                } else if (jsonReader.ch == &#39;[&#39;) {</b>
<b class="nc">&nbsp;                    segment = parseArrayAccess();</b>
<b class="nc">&nbsp;                } else if ((ch &gt;= &#39;a&#39; &amp;&amp; ch &lt;= &#39;z&#39;) || (ch &gt;= &#39;A&#39; &amp;&amp; ch &lt;= &#39;Z&#39;) || ch == &#39;_&#39;) {</b>
<b class="nc">&nbsp;                    segment = parseProperty();</b>
<b class="nc">&nbsp;                } else if (ch == &#39;?&#39;) {</b>
<b class="nc">&nbsp;                    if (dollar &amp;&amp; segmentIndex == 0) {</b>
<b class="nc">&nbsp;                        first = RootSegment.INSTANCE;</b>
<b class="nc">&nbsp;                        segmentIndex++;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    segment = parseFilter();</b>
<b class="nc">&nbsp;                } else if (ch == &#39;@&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    segment = SelfSegment.INSTANCE;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support &quot; + ch);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (segmentIndex == 0) {</b>
<b class="nc">&nbsp;                    first = segment;</b>
<b class="nc">&nbsp;                } else if (segmentIndex == 1) {</b>
<b class="nc">&nbsp;                    second = segment;</b>
<b class="nc">&nbsp;                } else if (segmentIndex == 2) {</b>
<b class="nc">&nbsp;                    segments = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                    segments.add(first);</b>
<b class="nc">&nbsp;                    segments.add(second);</b>
<b class="nc">&nbsp;                    segments.add(segment);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    segments.add(segment);</b>
&nbsp;                }
<b class="nc">&nbsp;                segmentIndex++;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            if (negative) {</b>
<b class="nc">&nbsp;                if (segmentIndex == 1) {</b>
<b class="nc">&nbsp;                    second = FUNCTION_NEGATIVE;</b>
<b class="nc">&nbsp;                } else if (segmentIndex == 2) {</b>
<b class="nc">&nbsp;                    segments = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                    segments.add(first);</b>
<b class="nc">&nbsp;                    segments.add(second);</b>
<b class="nc">&nbsp;                    segments.add(FUNCTION_NEGATIVE);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    segments.add(FUNCTION_NEGATIVE);</b>
&nbsp;                }
<b class="nc">&nbsp;                segmentIndex++;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (segmentIndex == 1) {</b>
<b class="nc">&nbsp;                if (first instanceof NameSegment) {</b>
<b class="nc">&nbsp;                    return new SingleNamePath(path, (NameSegment) first, features);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return new SingleSegmentPath(first, path, features);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (segmentIndex == 2) {</b>
<b class="nc">&nbsp;                return new TwoSegmentPath(path, first, second, features);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return new MultiSegmentPath(path, segments, features);</b>
&nbsp;        }
&nbsp;
&nbsp;        private Segment parseArrayAccess() {
<b class="nc">&nbsp;            jsonReader.next();</b>
&nbsp;
&nbsp;            Segment segment;
<b class="nc">&nbsp;            switch (jsonReader.ch) {</b>
&nbsp;                case &#39;-&#39;:
&nbsp;                case &#39;0&#39;:
&nbsp;                case &#39;1&#39;:
&nbsp;                case &#39;2&#39;:
&nbsp;                case &#39;3&#39;:
&nbsp;                case &#39;4&#39;:
&nbsp;                case &#39;5&#39;:
&nbsp;                case &#39;6&#39;:
&nbsp;                case &#39;7&#39;:
&nbsp;                case &#39;8&#39;:
&nbsp;                case &#39;9&#39;: {
<b class="nc">&nbsp;                    int index = jsonReader.readInt32Value();</b>
<b class="nc">&nbsp;                    boolean last = false;</b>
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;:&#39;) {</b>
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        if (jsonReader.ch == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                            segment = new RangeIndexSegment(index, index &gt;= 0 ? Integer.MAX_VALUE : 0);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            int end = jsonReader.readInt32Value();</b>
<b class="nc">&nbsp;                            segment = new RangeIndexSegment(index, end);</b>
<b class="nc">&nbsp;                        }</b>
<b class="nc">&nbsp;                    } else if (jsonReader.isNumber() || (last = jsonReader.nextIfMatchIdent(&#39;l&#39;, &#39;a&#39;, &#39;s&#39;, &#39;t&#39;))) {</b>
<b class="nc">&nbsp;                        List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                        list.add(index);</b>
<b class="nc">&nbsp;                        if (last) {</b>
<b class="nc">&nbsp;                            list.add(-1);</b>
<b class="nc">&nbsp;                            jsonReader.nextIfMatch(&#39;,&#39;);</b>
&nbsp;                        }
&nbsp;
&nbsp;                        while (true) {
<b class="nc">&nbsp;                            if (jsonReader.isNumber()) {</b>
<b class="nc">&nbsp;                                index = jsonReader.readInt32Value();</b>
<b class="nc">&nbsp;                                list.add(index);</b>
<b class="nc">&nbsp;                            } else if (jsonReader.nextIfMatchIdent(&#39;l&#39;, &#39;a&#39;, &#39;s&#39;, &#39;t&#39;)) {</b>
<b class="nc">&nbsp;                                list.add(-1);</b>
<b class="nc">&nbsp;                                jsonReader.nextIfMatch(&#39;,&#39;);</b>
&nbsp;                            } else {
&nbsp;                                break;
&nbsp;                            }
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        int[] indics = new int[list.size()];</b>
<b class="nc">&nbsp;                        for (int i = 0; i &lt; list.size(); i++) {</b>
<b class="nc">&nbsp;                            indics[i] = list.get(i);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        segment = new MultiIndexSegment(indics);</b>
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        segment = IndexSegment.of(index);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;                case &#39;*&#39;:
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    segment = AllSegment.INSTANCE_ARRAY;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case &#39;:&#39;: {
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    int end = jsonReader.ch == &#39;]&#39; ? 0 : jsonReader.readInt32Value();</b>
&nbsp;
<b class="nc">&nbsp;                    if (end &gt; 0) {</b>
<b class="nc">&nbsp;                        segment = new RangeIndexSegment(0, end);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        segment = new RangeIndexSegment(Integer.MIN_VALUE, end);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;                case &#39;&quot;&#39;:
&nbsp;                case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                    String name = jsonReader.readString();</b>
<b class="nc">&nbsp;                    if (jsonReader.current() == &#39;]&#39;) {</b>
<b class="nc">&nbsp;                        segment = new NameSegment(name, Fnv.hashCode64(name));</b>
<b class="nc">&nbsp;                    } else if (jsonReader.isString()) {</b>
<b class="nc">&nbsp;                        List&lt;String&gt; names = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                        names.add(name);</b>
&nbsp;                        do {
<b class="nc">&nbsp;                            names.add(jsonReader.readString());</b>
<b class="nc">&nbsp;                        } while (jsonReader.isString());</b>
<b class="nc">&nbsp;                        String[] nameArray = new String[names.size()];</b>
<b class="nc">&nbsp;                        names.toArray(nameArray);</b>
<b class="nc">&nbsp;                        segment = new MultiNameSegment(nameArray);</b>
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        throw new JSONException(&quot;TODO : &quot; + jsonReader.current());</b>
&nbsp;                    }
&nbsp;                    break;
&nbsp;                case &#39;?&#39;:
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    segment = parseFilter();</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case &#39;r&#39;: {
<b class="nc">&nbsp;                    String fieldName = jsonReader.readFieldNameUnquote();</b>
<b class="nc">&nbsp;                    if (&quot;randomIndex&quot;.equals(fieldName)) {</b>
<b class="nc">&nbsp;                        if (!jsonReader.nextIfMatch(&#39;(&#39;)</b>
<b class="nc">&nbsp;                                || !jsonReader.nextIfMatch(&#39;)&#39;)</b>
&nbsp;                                || !(jsonReader.ch == (&#39;]&#39;))) {
<b class="nc">&nbsp;                            throw new JSONException(&quot;not support : &quot; + fieldName);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        segment = RandomIndexSegment.INSTANCE;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    throw new JSONException(&quot;not support : &quot; + fieldName);</b>
&nbsp;                }
&nbsp;                case &#39;l&#39;: {
<b class="nc">&nbsp;                    String fieldName = jsonReader.readFieldNameUnquote();</b>
<b class="nc">&nbsp;                    if (&quot;last&quot;.equals(fieldName)) {</b>
<b class="nc">&nbsp;                        segment = IndexSegment.of(-1);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        throw new JSONException(&quot;not support : &quot; + fieldName);</b>
&nbsp;                    }
&nbsp;                    break;
&nbsp;                }
&nbsp;                default:
<b class="nc">&nbsp;                    throw new JSONException(&quot;TODO : &quot; + jsonReader.current());</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (!jsonReader.nextIfMatch(&#39;]&#39;)) {</b>
<b class="nc">&nbsp;                throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return segment;</b>
&nbsp;        }
&nbsp;
&nbsp;        private Segment parseProperty() {
&nbsp;            final Segment segment;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;*&#39;) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                segment = AllSegment.INSTANCE;</b>
<b class="nc">&nbsp;            } else if (jsonReader.ch == &#39;.&#39;) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;*&#39;) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    segment = new CycleNameSegment(&quot;*&quot;, Fnv.hashCode64(&quot;*&quot;));</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    long hashCode = jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                    String name = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                    segment = new CycleNameSegment(name, hashCode);</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            } else {
<b class="nc">&nbsp;                boolean isNum = jsonReader.isNumber();</b>
<b class="nc">&nbsp;                long hashCode = jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                String name = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                if (isNum) {</b>
<b class="nc">&nbsp;                    if (name.length() &gt; 9) {</b>
<b class="nc">&nbsp;                        isNum = false;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        for (int i = 0; i &lt; name.length(); ++i) {</b>
<b class="nc">&nbsp;                            char ch = name.charAt(i);</b>
<b class="nc">&nbsp;                            if (ch &lt; &#39;0&#39; || ch &gt; &#39;9&#39;) {</b>
<b class="nc">&nbsp;                                isNum = false;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                IndexSegment indexSegment = null;</b>
<b class="nc">&nbsp;                if (isNum) {</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        int index = Integer.parseInt(name);</b>
<b class="nc">&nbsp;                        indexSegment = IndexSegment.of(index);</b>
<b class="nc">&nbsp;                    } catch (NumberFormatException ignored) {</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (indexSegment != null) {</b>
<b class="nc">&nbsp;                    segment = indexSegment;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    if (jsonReader.ch == &#39;(&#39;) {</b>
<b class="nc">&nbsp;                        switch (name) {</b>
&nbsp;                            case &quot;length&quot;:
&nbsp;                            case &quot;size&quot;:
<b class="nc">&nbsp;                                segment = LengthSegment.INSTANCE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;keys&quot;:
<b class="nc">&nbsp;                                segment = KeysSegment.INSTANCE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;values&quot;:
<b class="nc">&nbsp;                                segment = ValuesSegment.INSTANCE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;entrySet&quot;:
<b class="nc">&nbsp;                                segment = EntrySetSegment.INSTANCE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;min&quot;:
<b class="nc">&nbsp;                                segment = MinSegment.INSTANCE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;max&quot;:
<b class="nc">&nbsp;                                segment = MaxSegment.INSTANCE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;sum&quot;:
<b class="nc">&nbsp;                                segment = SumSegment.INSTANCE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;type&quot;:
<b class="nc">&nbsp;                                segment = FUNCTION_TYPE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;floor&quot;:
<b class="nc">&nbsp;                                segment = FUNCTION_FLOOR;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;ceil&quot;:
&nbsp;                            case &quot;ceiling&quot;:
<b class="nc">&nbsp;                                segment = FUNCTION_CEIL;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;double&quot;:
<b class="nc">&nbsp;                                segment = FUNCTION_DOUBLE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;abs&quot;:
<b class="nc">&nbsp;                                segment = FUNCTION_ABS;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case &quot;negative&quot;:
<b class="nc">&nbsp;                                segment = FUNCTION_NEGATIVE;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            default:
<b class="nc">&nbsp;                                throw new JSONException(&quot;not support syntax, path : &quot; + path);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        jsonReader.next();</b>
<b class="nc">&nbsp;                        if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                            throw new JSONException(&quot;not support syntax, path : &quot; + path);</b>
&nbsp;                        }
&nbsp;                    } else {
<b class="nc">&nbsp;                        segment = new NameSegment(name, hashCode);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return segment;</b>
&nbsp;        }
&nbsp;
&nbsp;        Segment parseFilterRest(Segment segment) {
&nbsp;            boolean and;
<b class="nc">&nbsp;            switch (jsonReader.ch) {</b>
&nbsp;                case &#39;&amp;&#39;:
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;&amp;&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
<b class="nc">&nbsp;                    and = true;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case &#39;|&#39;:
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;|&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
<b class="nc">&nbsp;                    and = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case &#39;a&#39;:
&nbsp;                case &#39;A&#39;: {
<b class="nc">&nbsp;                    String fieldName = jsonReader.readFieldNameUnquote();</b>
<b class="nc">&nbsp;                    if (!&quot;and&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(&quot;syntax error : &quot; + fieldName);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    and = true;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;                case &#39;o&#39;:
&nbsp;                case &#39;O&#39;: {
<b class="nc">&nbsp;                    String fieldName = jsonReader.readFieldNameUnquote();</b>
<b class="nc">&nbsp;                    if (!&quot;or&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(&quot;syntax error : &quot; + fieldName);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    and = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;                default:
<b class="nc">&nbsp;                    throw new JSONException(&quot;TODO : &quot; + jsonReader.ch);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Segment right = parseFilter();</b>
<b class="nc">&nbsp;            if (segment instanceof GroupFilter) {</b>
<b class="nc">&nbsp;                GroupFilter group = (GroupFilter) segment;</b>
<b class="nc">&nbsp;                if (group.and == and) {</b>
<b class="nc">&nbsp;                    group.filters.add((FilterSegment) right);</b>
<b class="nc">&nbsp;                    return group;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            List&lt;FilterSegment&gt; filters = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            filters.add((FilterSegment) segment);</b>
<b class="nc">&nbsp;            filters.add((FilterSegment) right);</b>
<b class="nc">&nbsp;            return new GroupFilter(filters, and);</b>
&nbsp;        }
&nbsp;
&nbsp;        Segment parseFilter() {
<b class="nc">&nbsp;            boolean parentheses = jsonReader.nextIfMatch(&#39;(&#39;);</b>
&nbsp;
<b class="nc">&nbsp;            boolean at = jsonReader.ch == &#39;@&#39;;</b>
<b class="nc">&nbsp;            if (at) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;            } else if (jsonReader.nextIfMatchIdent(&#39;e&#39;, &#39;x&#39;, &#39;i&#39;, &#39;s&#39;, &#39;t&#39;, &#39;s&#39;)) {</b>
<b class="nc">&nbsp;                if (!jsonReader.nextIfMatch(&#39;(&#39;)) {</b>
<b class="nc">&nbsp;                    throw new JSONException(jsonReader.info(&quot;exists&quot;));</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (jsonReader.nextIfMatch(&#39;@&#39;)) {</b>
<b class="nc">&nbsp;                    if (jsonReader.nextIfMatch(&#39;.&#39;)) {</b>
<b class="nc">&nbsp;                        long hashCode = jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                        String fieldName = jsonReader.getFieldName();</b>
&nbsp;
<b class="nc">&nbsp;                        if (jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                            if (parentheses) {</b>
<b class="nc">&nbsp;                                if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                                    throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                                }
&nbsp;                            }
<b class="nc">&nbsp;                            NameExistsFilter segment = new NameExistsFilter(fieldName, hashCode);</b>
<b class="nc">&nbsp;                            return segment;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            boolean starts = jsonReader.nextIfMatchIdent(&#39;s&#39;, &#39;t&#39;, &#39;a&#39;, &#39;r&#39;, &#39;t&#39;, &#39;s&#39;);</b>
<b class="nc">&nbsp;            if ((at &amp;&amp; starts) || (jsonReader.ch != &#39;.&#39; &amp;&amp; !JSONReader.isFirstIdentifier(jsonReader.ch))) {</b>
<b class="nc">&nbsp;                if (!at) {</b>
<b class="nc">&nbsp;                    throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                }
&nbsp;
&nbsp;                Operator operator;
<b class="nc">&nbsp;                if (starts) {</b>
<b class="nc">&nbsp;                    jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                    String fieldName = jsonReader.getFieldName();</b>
<b class="nc">&nbsp;                    if (!&quot;with&quot;.equalsIgnoreCase(fieldName)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(&quot;not support operator : &quot; + fieldName);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    operator = Operator.STARTS_WITH;</b>
<b class="nc">&nbsp;                } else {</b>
<b class="nc">&nbsp;                    operator = parseOperator(jsonReader);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                Segment segment = null;</b>
<b class="nc">&nbsp;                if (jsonReader.isNumber()) {</b>
<b class="nc">&nbsp;                    Number number = jsonReader.readNumber();</b>
<b class="nc">&nbsp;                    if (number instanceof Integer || number instanceof Long) {</b>
<b class="nc">&nbsp;                        segment = new NameIntOpSegment(null, 0, null, null, null, operator, number.longValue());</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if (jsonReader.isString()) {</b>
<b class="nc">&nbsp;                    String string = jsonReader.readString();</b>
&nbsp;
<b class="nc">&nbsp;                    switch (operator) {</b>
&nbsp;                        case STARTS_WITH:
<b class="nc">&nbsp;                            segment = new StartsWithSegment(null, 0, string);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new JSONException(&quot;syntax error, &quot; + string);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                while (jsonReader.ch == &#39;&amp;&#39; || jsonReader.ch == &#39;|&#39;) {</b>
<b class="nc">&nbsp;                    segment = parseFilterRest(segment);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (segment != null) {</b>
<b class="nc">&nbsp;                    if (parentheses) {</b>
<b class="nc">&nbsp;                        if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                            throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                    return segment;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (at) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            long hashCode = jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;            String fieldName = jsonReader.getFieldName();</b>
&nbsp;
<b class="nc">&nbsp;            if (parentheses) {</b>
<b class="nc">&nbsp;                if (jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                    NameExistsFilter segment = new NameExistsFilter(fieldName, hashCode);</b>
<b class="nc">&nbsp;                    return segment;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String functionName = null;</b>
&nbsp;
<b class="nc">&nbsp;            long[] hashCode2 = null;</b>
<b class="nc">&nbsp;            String[] fieldName2 = null;</b>
<b class="nc">&nbsp;            while (jsonReader.ch == &#39;.&#39;) {</b>
<b class="nc">&nbsp;                jsonReader.next();</b>
<b class="nc">&nbsp;                long hash = jsonReader.readFieldNameHashCodeUnquote();</b>
<b class="nc">&nbsp;                String str = jsonReader.getFieldName();</b>
&nbsp;
<b class="nc">&nbsp;                if (jsonReader.ch == &#39;(&#39;) {</b>
<b class="nc">&nbsp;                    functionName = str;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (hashCode2 == null) {</b>
<b class="nc">&nbsp;                    hashCode2 = new long[]{hash};</b>
<b class="nc">&nbsp;                    fieldName2 = new String[]{str};</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    hashCode2 = Arrays.copyOf(hashCode2, hashCode2.length + 1);</b>
<b class="nc">&nbsp;                    hashCode2[hashCode2.length - 1] = hash;</b>
<b class="nc">&nbsp;                    fieldName2 = Arrays.copyOf(fieldName2, fieldName2.length + 1);</b>
<b class="nc">&nbsp;                    fieldName2[fieldName2.length - 1] = str;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;
<b class="nc">&nbsp;            Operator operator = null;</b>
<b class="nc">&nbsp;            Function function = null;</b>
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;(&#39;) {</b>
<b class="nc">&nbsp;                if (functionName == null) {</b>
<b class="nc">&nbsp;                    functionName = fieldName;</b>
<b class="nc">&nbsp;                    fieldName = null;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                switch (functionName) {</b>
&nbsp;                    case &quot;type&quot;:
<b class="nc">&nbsp;                        hashCode = 0;</b>
<b class="nc">&nbsp;                        function = TypeFunction.INSTANCE;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &quot;size&quot;:
<b class="nc">&nbsp;                        hashCode = 0;</b>
<b class="nc">&nbsp;                        function = SizeFunction.INSTANCE;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case &quot;contains&quot;:
<b class="nc">&nbsp;                        hashCode = 0;</b>
<b class="nc">&nbsp;                        operator = Operator.CONTAINS;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    default:
<b class="nc">&nbsp;                        throw new JSONException(&quot;syntax error, function not support &quot; + fieldName);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (function != null) {</b>
<b class="nc">&nbsp;                    jsonReader.next();</b>
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(&quot;syntax error, function &quot; + functionName);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (operator == null) {</b>
<b class="nc">&nbsp;                operator = parseOperator(jsonReader);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            switch (operator) {</b>
&nbsp;                case REG_MATCH:
&nbsp;                case RLIKE:
&nbsp;                case NOT_RLIKE: {
&nbsp;                    String regex;
&nbsp;                    boolean ignoreCase;
<b class="nc">&nbsp;                    if (jsonReader.isString()) {</b>
<b class="nc">&nbsp;                        regex = jsonReader.readString();</b>
<b class="nc">&nbsp;                        ignoreCase = false;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        regex = jsonReader.readPattern();</b>
<b class="nc">&nbsp;                        ignoreCase = jsonReader.nextIfMatch(&#39;i&#39;);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    Pattern pattern = ignoreCase</b>
<b class="nc">&nbsp;                            ? Pattern.compile(regex, Pattern.CASE_INSENSITIVE)</b>
<b class="nc">&nbsp;                            : Pattern.compile(regex);</b>
&nbsp;
<b class="nc">&nbsp;                    Segment segment = new NameRLikeSegment(fieldName, hashCode, pattern, operator == Operator.NOT_RLIKE);</b>
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    return segment;</b>
&nbsp;                }
&nbsp;                case IN:
&nbsp;                case NOT_IN: {
<b class="nc">&nbsp;                    if (jsonReader.ch != &#39;(&#39;) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
<b class="nc">&nbsp;                    jsonReader.next();</b>
&nbsp;
&nbsp;                    Segment segment;
<b class="nc">&nbsp;                    if (jsonReader.isString()) {</b>
<b class="nc">&nbsp;                        List&lt;String&gt; list = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                        while (jsonReader.isString()) {</b>
<b class="nc">&nbsp;                            list.add(jsonReader.readString());</b>
&nbsp;                        }
<b class="nc">&nbsp;                        String[] strArray = new String[list.size()];</b>
<b class="nc">&nbsp;                        list.toArray(strArray);</b>
<b class="nc">&nbsp;                        segment = new NameStringInSegment(</b>
&nbsp;                                fieldName,
&nbsp;                                hashCode,
&nbsp;                                strArray,
&nbsp;                                operator == Operator.NOT_IN
&nbsp;                        );
<b class="nc">&nbsp;                    } else if (jsonReader.isNumber()) {</b>
<b class="nc">&nbsp;                        List&lt;Number&gt; list = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                        while (jsonReader.isNumber()) {</b>
<b class="nc">&nbsp;                            list.add(jsonReader.readNumber());</b>
&nbsp;                        }
<b class="nc">&nbsp;                        long[] values = new long[list.size()];</b>
<b class="nc">&nbsp;                        for (int i = 0; i &lt; list.size(); i++) {</b>
<b class="nc">&nbsp;                            values[i] = list.get(i).longValue();</b>
&nbsp;                        }
<b class="nc">&nbsp;                        segment = new NameIntInSegment(fieldName, hashCode, fieldName2, hashCode2, function, values, operator == Operator.NOT_IN);</b>
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    return segment;</b>
&nbsp;                }
&nbsp;                case CONTAINS: {
<b class="nc">&nbsp;                    if (jsonReader.ch != &#39;(&#39;) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
<b class="nc">&nbsp;                    jsonReader.next();</b>
&nbsp;
&nbsp;                    Segment segment;
<b class="nc">&nbsp;                    if (jsonReader.isString()) {</b>
<b class="nc">&nbsp;                        List&lt;String&gt; list = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                        while (jsonReader.isString()) {</b>
<b class="nc">&nbsp;                            list.add(jsonReader.readString());</b>
&nbsp;                        }
<b class="nc">&nbsp;                        String[] strArray = new String[list.size()];</b>
<b class="nc">&nbsp;                        list.toArray(strArray);</b>
<b class="nc">&nbsp;                        segment = new NameStringContainsSegment(</b>
&nbsp;                                fieldName,
&nbsp;                                hashCode,
&nbsp;                                fieldName2,
&nbsp;                                hashCode2,
&nbsp;                                strArray,
&nbsp;                                operator == Operator.NOT_CONTAINS
&nbsp;                        );
<b class="nc">&nbsp;                    } else if (jsonReader.isNumber()) {</b>
<b class="nc">&nbsp;                        List&lt;Number&gt; list = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                        while (jsonReader.isNumber()) {</b>
<b class="nc">&nbsp;                            list.add(jsonReader.readNumber());</b>
&nbsp;                        }
<b class="nc">&nbsp;                        long[] values = new long[list.size()];</b>
<b class="nc">&nbsp;                        for (int i = 0; i &lt; list.size(); i++) {</b>
<b class="nc">&nbsp;                            values[i] = list.get(i).longValue();</b>
&nbsp;                        }
<b class="nc">&nbsp;                        segment = new NameLongContainsSegment(</b>
&nbsp;                                fieldName,
&nbsp;                                hashCode,
&nbsp;                                fieldName2,
&nbsp;                                hashCode2,
&nbsp;                                values,
&nbsp;                                operator == Operator.NOT_CONTAINS
&nbsp;                        );
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    return segment;</b>
&nbsp;                }
&nbsp;                case BETWEEN:
&nbsp;                case NOT_BETWEEN: {
&nbsp;                    Segment segment;
<b class="nc">&nbsp;                    if (jsonReader.isNumber()) {</b>
<b class="nc">&nbsp;                        Number begin = jsonReader.readNumber();</b>
<b class="nc">&nbsp;                        String and = jsonReader.readFieldNameUnquote();</b>
<b class="nc">&nbsp;                        if (!&quot;and&quot;.equalsIgnoreCase(and)) {</b>
<b class="nc">&nbsp;                            throw new JSONException(&quot;syntax error, &quot; + and);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        Number end = jsonReader.readNumber();</b>
<b class="nc">&nbsp;                        segment = new NameIntBetweenSegment(fieldName, hashCode, begin.longValue(), end.longValue(), operator == Operator.NOT_BETWEEN);</b>
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (parentheses) {</b>
<b class="nc">&nbsp;                        if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                            throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    return segment;</b>
&nbsp;                }
&nbsp;                default:
&nbsp;                    break;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Segment segment = null;</b>
<b class="nc">&nbsp;            switch (jsonReader.ch) {</b>
&nbsp;                case &#39;-&#39;:
&nbsp;                case &#39;+&#39;:
&nbsp;                case &#39;0&#39;:
&nbsp;                case &#39;1&#39;:
&nbsp;                case &#39;2&#39;:
&nbsp;                case &#39;3&#39;:
&nbsp;                case &#39;4&#39;:
&nbsp;                case &#39;5&#39;:
&nbsp;                case &#39;6&#39;:
&nbsp;                case &#39;7&#39;:
&nbsp;                case &#39;8&#39;:
&nbsp;                case &#39;9&#39;: {
<b class="nc">&nbsp;                    Number number = jsonReader.readNumber();</b>
<b class="nc">&nbsp;                    if (number instanceof Integer || number instanceof Long) {</b>
<b class="nc">&nbsp;                        segment = new NameIntOpSegment(fieldName, hashCode, fieldName2, hashCode2, function, operator, number.longValue());</b>
<b class="nc">&nbsp;                    } else if (number instanceof BigDecimal) {</b>
<b class="nc">&nbsp;                        segment = new NameDecimalOpSegment(fieldName, hashCode, operator, (BigDecimal) number);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                    }
&nbsp;                    break;
&nbsp;                }
&nbsp;                case &#39;&quot;&#39;:
&nbsp;                case &#39;\&#39;&#39;: {
<b class="nc">&nbsp;                    String strVal = jsonReader.readString();</b>
<b class="nc">&nbsp;                    int p0 = strVal.indexOf(&#39;%&#39;);</b>
<b class="nc">&nbsp;                    if (p0 == -1) {</b>
<b class="nc">&nbsp;                        if (operator == Operator.LIKE) {</b>
<b class="nc">&nbsp;                            operator = Operator.EQ;</b>
<b class="nc">&nbsp;                        } else if (operator == Operator.NOT_LIKE) {</b>
<b class="nc">&nbsp;                            operator = Operator.NE;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (operator == Operator.LIKE || operator == Operator.NOT_LIKE) {</b>
<b class="nc">&nbsp;                        String[] items = strVal.split(&quot;%&quot;);</b>
&nbsp;
<b class="nc">&nbsp;                        String startsWithValue = null;</b>
<b class="nc">&nbsp;                        String endsWithValue = null;</b>
<b class="nc">&nbsp;                        String[] containsValues = null;</b>
<b class="nc">&nbsp;                        if (p0 == 0) {</b>
<b class="nc">&nbsp;                            if (strVal.charAt(strVal.length() - 1) == &#39;%&#39;) {</b>
<b class="nc">&nbsp;                                containsValues = new String[items.length - 1];</b>
<b class="nc">&nbsp;                                System.arraycopy(items, 1, containsValues, 0, containsValues.length);</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                endsWithValue = items[items.length - 1];</b>
<b class="nc">&nbsp;                                if (items.length &gt; 2) {</b>
<b class="nc">&nbsp;                                    containsValues = new String[items.length - 2];</b>
<b class="nc">&nbsp;                                    System.arraycopy(items, 1, containsValues, 0, containsValues.length);</b>
&nbsp;                                }
&nbsp;                            }
<b class="nc">&nbsp;                        } else if (strVal.charAt(strVal.length() - 1) == &#39;%&#39;) {</b>
<b class="nc">&nbsp;                            if (items.length == 1) {</b>
<b class="nc">&nbsp;                                startsWithValue = items[0];</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                containsValues = items;</b>
&nbsp;                            }
&nbsp;                        } else {
<b class="nc">&nbsp;                            if (items.length == 1) {</b>
<b class="nc">&nbsp;                                startsWithValue = items[0];</b>
<b class="nc">&nbsp;                            } else if (items.length == 2) {</b>
<b class="nc">&nbsp;                                startsWithValue = items[0];</b>
<b class="nc">&nbsp;                                endsWithValue = items[1];</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                startsWithValue = items[0];</b>
<b class="nc">&nbsp;                                endsWithValue = items[items.length - 1];</b>
<b class="nc">&nbsp;                                containsValues = new String[items.length - 2];</b>
<b class="nc">&nbsp;                                System.arraycopy(items, 1, containsValues, 0, containsValues.length);</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                        segment = new NameMatchFilter(</b>
&nbsp;                                fieldName,
&nbsp;                                hashCode,
&nbsp;                                startsWithValue,
&nbsp;                                endsWithValue,
&nbsp;                                containsValues,
&nbsp;                                operator == Operator.NOT_LIKE
&nbsp;                        );
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        segment = new NameStringOpSegment(fieldName, hashCode, fieldName2, hashCode2, function, operator, strVal);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;                case &#39;t&#39;: {
<b class="nc">&nbsp;                    String ident = jsonReader.readFieldNameUnquote();</b>
<b class="nc">&nbsp;                    if (&quot;true&quot;.equalsIgnoreCase(ident)) {</b>
<b class="nc">&nbsp;                        segment = new NameIntOpSegment(fieldName, hashCode, fieldName2, hashCode2, function, operator, 1);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                    break;
&nbsp;                }
&nbsp;                case &#39;f&#39;: {
<b class="nc">&nbsp;                    String ident = jsonReader.readFieldNameUnquote();</b>
<b class="nc">&nbsp;                    if (&quot;false&quot;.equalsIgnoreCase(ident)) {</b>
<b class="nc">&nbsp;                        segment = new NameIntOpSegment(fieldName, hashCode, fieldName2, hashCode2, function, operator, 0);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                    break;
&nbsp;                }
&nbsp;                case &#39;[&#39;: {
<b class="nc">&nbsp;                    JSONArray array = jsonReader.read(JSONArray.class);</b>
<b class="nc">&nbsp;                    segment = new NameArrayOpSegment(fieldName, hashCode, fieldName2, hashCode2, function, operator, array);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;                case &#39;{&#39;: {
<b class="nc">&nbsp;                    JSONObject object = jsonReader.read(JSONObject.class);</b>
<b class="nc">&nbsp;                    segment = new NameObjectOpSegment(fieldName, hashCode, fieldName2, hashCode2, function, operator, object);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;                default:
<b class="nc">&nbsp;                    throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (jsonReader.ch == &#39;&amp;&#39; || jsonReader.ch == &#39;|&#39; || jsonReader.ch == &#39;a&#39; || jsonReader.ch == &#39;o&#39;) {</b>
<b class="nc">&nbsp;                segment = parseFilterRest(segment);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (parentheses) {</b>
<b class="nc">&nbsp;                if (!jsonReader.nextIfMatch(&#39;)&#39;)) {</b>
<b class="nc">&nbsp;                    throw new JSONException(jsonReader.info(&quot;jsonpath syntax error&quot;));</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return segment;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    public enum Feature {</b>
<b class="nc">&nbsp;        AlwaysReturnList(1);</b>
&nbsp;        public final long mask;
&nbsp;
<b class="nc">&nbsp;        Feature(long mask) {</b>
<b class="nc">&nbsp;            this.mask = mask;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-09 20:17</div>
</div>
</body>
</html>
