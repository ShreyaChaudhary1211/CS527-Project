


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > JSONWriter</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">com.alibaba.fastjson2</a>
</div>

<h1>Coverage Summary for Class: JSONWriter (com.alibaba.fastjson2)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">JSONWriter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/104)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/498)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/496)
  </span>
</td>
</tr>
  <tr>
    <td class="name">JSONWriter$Context</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/43)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/113)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/152)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONWriter$Feature</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (3/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (45/45)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JSONWriter$Path</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/298)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/161)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    1.9%
  </span>
  <span class="absValue">
    (3/156)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/909)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    5.3%
  </span>
  <span class="absValue">
    (45/854)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package com.alibaba.fastjson2;
&nbsp;
&nbsp;import com.alibaba.fastjson2.filter.*;
&nbsp;import com.alibaba.fastjson2.util.IOUtils;
&nbsp;import com.alibaba.fastjson2.util.TypeUtils;
&nbsp;import com.alibaba.fastjson2.writer.FieldWriter;
&nbsp;import com.alibaba.fastjson2.writer.ObjectWriter;
&nbsp;import com.alibaba.fastjson2.writer.ObjectWriterProvider;
&nbsp;
&nbsp;import java.io.*;
&nbsp;import java.lang.reflect.GenericArrayType;
&nbsp;import java.lang.reflect.ParameterizedType;
&nbsp;import java.lang.reflect.Type;
&nbsp;import java.math.BigDecimal;
&nbsp;import java.math.BigInteger;
&nbsp;import java.nio.charset.Charset;
&nbsp;import java.nio.charset.StandardCharsets;
&nbsp;import java.text.DecimalFormat;
&nbsp;import java.time.*;
&nbsp;import java.time.format.DateTimeFormatter;
&nbsp;import java.util.*;
&nbsp;
&nbsp;import static com.alibaba.fastjson2.JSONFactory.*;
&nbsp;import static com.alibaba.fastjson2.JSONWriter.Feature.*;
&nbsp;import static com.alibaba.fastjson2.util.JDKUtils.*;
&nbsp;
&nbsp;public abstract class JSONWriter
&nbsp;        implements Closeable {
<b class="nc">&nbsp;    static final char[] DIGITS = {&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;, &#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;};</b>
&nbsp;
&nbsp;    public final Context context;
&nbsp;    public final boolean utf8;
&nbsp;    public final boolean utf16;
&nbsp;    public final boolean jsonb;
&nbsp;    public final boolean useSingleQuote;
&nbsp;    public final SymbolTable symbolTable;
&nbsp;
&nbsp;    protected final Charset charset;
&nbsp;    protected final char quote;
&nbsp;    protected final int maxArraySize;
&nbsp;
&nbsp;    protected boolean startObject;
&nbsp;    protected int level;
&nbsp;    protected int off;
&nbsp;    protected Object rootObject;
&nbsp;    protected IdentityHashMap&lt;Object, Path&gt; refs;
&nbsp;    protected Path path;
&nbsp;    protected String lastReference;
&nbsp;    protected boolean pretty;
&nbsp;    protected int indent;
&nbsp;
&nbsp;    protected JSONWriter(
&nbsp;            Context context,
&nbsp;            SymbolTable symbolTable,
&nbsp;            boolean jsonb,
&nbsp;            Charset charset
<b class="nc">&nbsp;    ) {</b>
<b class="nc">&nbsp;        this.context = context;</b>
<b class="nc">&nbsp;        this.symbolTable = symbolTable;</b>
<b class="nc">&nbsp;        this.charset = charset;</b>
<b class="nc">&nbsp;        this.jsonb = jsonb;</b>
<b class="nc">&nbsp;        this.utf8 = !jsonb &amp;&amp; charset == StandardCharsets.UTF_8;</b>
<b class="nc">&nbsp;        this.utf16 = !jsonb &amp;&amp; charset == StandardCharsets.UTF_16;</b>
<b class="nc">&nbsp;        this.useSingleQuote = !jsonb &amp;&amp; (context.features &amp; Feature.UseSingleQuotes.mask) != 0;</b>
&nbsp;
<b class="nc">&nbsp;        quote = useSingleQuote ? &#39;\&#39;&#39; : &#39;&quot;&#39;;</b>
&nbsp;
&nbsp;        // 64M or 1G
<b class="nc">&nbsp;        maxArraySize = (context.features &amp; LargeObject.mask) != 0 ? 1073741824 : 67108864;</b>
<b class="nc">&nbsp;        pretty = (context.features &amp; PrettyFormat.mask) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final Charset getCharset() {
<b class="nc">&nbsp;        return charset;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isUTF8() {
<b class="nc">&nbsp;        return utf8;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isUTF16() {
<b class="nc">&nbsp;        return utf16;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isIgnoreNoneSerializable() {
<b class="nc">&nbsp;        return (context.features &amp; Feature.IgnoreNoneSerializable.mask) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isIgnoreNoneSerializable(Object object) {
<b class="nc">&nbsp;        return (context.features &amp; Feature.IgnoreNoneSerializable.mask) != 0</b>
&nbsp;                &amp;&amp; object != null
<b class="nc">&nbsp;                &amp;&amp; !Serializable.class.isAssignableFrom(object.getClass());</b>
&nbsp;    }
&nbsp;
&nbsp;    public final SymbolTable getSymbolTable() {
<b class="nc">&nbsp;        return symbolTable;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void config(Feature... features) {
<b class="nc">&nbsp;        context.config(features);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void config(Feature feature, boolean state) {
<b class="nc">&nbsp;        context.config(feature, state);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final Context getContext() {
<b class="nc">&nbsp;        return context;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final int level() {
<b class="nc">&nbsp;        return level;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void setRootObject(Object rootObject) {
<b class="nc">&nbsp;        this.rootObject = rootObject;</b>
<b class="nc">&nbsp;        this.path = JSONWriter.Path.ROOT;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final String setPath(String name, Object object) {
<b class="nc">&nbsp;        if ((context.features &amp; Feature.ReferenceDetection.mask) == 0</b>
&nbsp;                || object == Collections.EMPTY_LIST
&nbsp;                || object == Collections.EMPTY_SET
&nbsp;        ) {
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        this.path = new Path(this.path, name);</b>
&nbsp;
&nbsp;        Path previous;
<b class="nc">&nbsp;        if (object == rootObject) {</b>
<b class="nc">&nbsp;            previous = Path.ROOT;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            if (refs == null || (previous = refs.get(object)) == null) {</b>
<b class="nc">&nbsp;                if (refs == null) {</b>
<b class="nc">&nbsp;                    refs = new IdentityHashMap(8);</b>
&nbsp;                }
<b class="nc">&nbsp;                refs.put(object, this.path);</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return previous.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public final String setPath(FieldWriter fieldWriter, Object object) {
<b class="nc">&nbsp;        if ((context.features &amp; Feature.ReferenceDetection.mask) == 0</b>
&nbsp;                || object == Collections.EMPTY_LIST
&nbsp;                || object == Collections.EMPTY_SET
&nbsp;        ) {
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        this.path = this.path == Path.ROOT</b>
<b class="nc">&nbsp;                ? fieldWriter.getRootParentPath()</b>
<b class="nc">&nbsp;                : fieldWriter.getPath(path);</b>
&nbsp;
&nbsp;        Path previous;
<b class="nc">&nbsp;        if (object == rootObject) {</b>
<b class="nc">&nbsp;            previous = Path.ROOT;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            if (refs == null || (previous = refs.get(object)) == null) {</b>
<b class="nc">&nbsp;                if (refs == null) {</b>
<b class="nc">&nbsp;                    refs = new IdentityHashMap(8);</b>
&nbsp;                }
<b class="nc">&nbsp;                refs.put(object, this.path);</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return previous.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public final String setPath(int index, Object object) {
<b class="nc">&nbsp;        if ((context.features &amp; Feature.ReferenceDetection.mask) == 0</b>
&nbsp;                || object == Collections.EMPTY_LIST
&nbsp;                || object == Collections.EMPTY_SET
&nbsp;        ) {
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        this.path = index == 0</b>
<b class="nc">&nbsp;                ? (path.child0 != null ? path.child0 : (path.child0 = new Path(path, index)))</b>
<b class="nc">&nbsp;                : index == 1</b>
<b class="nc">&nbsp;                ? (path.child1 != null ? path.child1 : (path.child1 = new Path(path, index)))</b>
<b class="nc">&nbsp;                : new Path(path, index);</b>
&nbsp;
&nbsp;        Path previous;
<b class="nc">&nbsp;        if (object == rootObject) {</b>
<b class="nc">&nbsp;            previous = Path.ROOT;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            if (refs == null || (previous = refs.get(object)) == null) {</b>
<b class="nc">&nbsp;                if (refs == null) {</b>
<b class="nc">&nbsp;                    refs = new IdentityHashMap(8);</b>
&nbsp;                }
<b class="nc">&nbsp;                refs.put(object, this.path);</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return previous.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void popPath(Object object) {
<b class="nc">&nbsp;        if (this.path == null</b>
&nbsp;                || (context.features &amp; Feature.ReferenceDetection.mask) == 0
&nbsp;                || object == Collections.EMPTY_LIST
&nbsp;                || object == Collections.EMPTY_SET
&nbsp;        ) {
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        this.path = this.path.parent;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean hasFilter() {
<b class="nc">&nbsp;        return context.hasFilter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean hasFilter(long feature) {
<b class="nc">&nbsp;        return context.hasFilter || (context.features &amp; feature) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean hasFilter(boolean containsNoneFieldGetter) {
<b class="nc">&nbsp;        return context.hasFilter || containsNoneFieldGetter &amp;&amp; (context.features &amp; IgnoreNonFieldGetter.mask) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isWriteNulls() {
<b class="nc">&nbsp;        return (context.features &amp; Feature.WriteNulls.mask) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isRefDetect() {
<b class="nc">&nbsp;        return (context.features &amp; Feature.ReferenceDetection.mask) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isUseSingleQuotes() {
<b class="nc">&nbsp;        return useSingleQuote;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isRefDetect(Object object) {
<b class="nc">&nbsp;        return (context.features &amp; Feature.ReferenceDetection.mask) != 0</b>
&nbsp;                &amp;&amp; object != null
<b class="nc">&nbsp;                &amp;&amp; !ObjectWriterProvider.isNotReferenceDetect(object.getClass());</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean containsReference(Object value) {
<b class="nc">&nbsp;        return refs != null &amp;&amp; refs.containsKey(value);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean removeReference(Object value) {
<b class="nc">&nbsp;        return this.refs != null &amp;&amp; this.refs.remove(value) != null;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isBeanToArray() {
<b class="nc">&nbsp;        return (context.features &amp; Feature.BeanToArray.mask) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isEnabled(Feature feature) {
<b class="nc">&nbsp;        return (context.features &amp; feature.mask) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isEnabled(long feature) {
<b class="nc">&nbsp;        return (context.features &amp; feature) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final long getFeatures() {
<b class="nc">&nbsp;        return context.features;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final long getFeatures(long features) {
<b class="nc">&nbsp;        return context.features | features;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isIgnoreErrorGetter() {
<b class="nc">&nbsp;        return (context.features &amp; Feature.IgnoreErrorGetter.mask) != 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isWriteTypeInfo(Object object, Class fieldClass) {
<b class="nc">&nbsp;        long features = context.features;</b>
<b class="nc">&nbsp;        if ((features &amp; Feature.WriteClassName.mask) == 0) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (object == null) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Class objectClass = object.getClass();</b>
<b class="nc">&nbsp;        if (objectClass == fieldClass) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.NotWriteHashMapArrayListClassName.mask) != 0) {</b>
<b class="nc">&nbsp;            if (objectClass == HashMap.class || objectClass == ArrayList.class) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return (features &amp; Feature.NotWriteRootClassName.mask) == 0</b>
&nbsp;                || object != this.rootObject;
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isWriteTypeInfo(Object object, Type fieldType) {
<b class="nc">&nbsp;        long features = context.features;</b>
<b class="nc">&nbsp;        if ((features &amp; Feature.WriteClassName.mask) == 0</b>
&nbsp;                || object == null
&nbsp;        ) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Class objectClass = object.getClass();</b>
<b class="nc">&nbsp;        Class fieldClass = null;</b>
<b class="nc">&nbsp;        if (fieldType instanceof Class) {</b>
<b class="nc">&nbsp;            fieldClass = (Class) fieldType;</b>
<b class="nc">&nbsp;        } else if (fieldType instanceof GenericArrayType) {</b>
<b class="nc">&nbsp;            if (isWriteTypeInfoGenericArray((GenericArrayType) fieldType, objectClass)) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (fieldType instanceof ParameterizedType) {</b>
<b class="nc">&nbsp;            Type rawType = ((ParameterizedType) fieldType).getRawType();</b>
<b class="nc">&nbsp;            if (rawType instanceof Class) {</b>
<b class="nc">&nbsp;                fieldClass = (Class) rawType;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (objectClass == fieldClass) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.NotWriteHashMapArrayListClassName.mask) != 0) {</b>
<b class="nc">&nbsp;            if (objectClass == HashMap.class || objectClass == ArrayList.class) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return (features &amp; Feature.NotWriteRootClassName.mask) == 0</b>
&nbsp;                || object != this.rootObject;
&nbsp;    }
&nbsp;
&nbsp;    private static boolean isWriteTypeInfoGenericArray(GenericArrayType fieldType, Class objectClass) {
<b class="nc">&nbsp;        Type componentType = fieldType.getGenericComponentType();</b>
<b class="nc">&nbsp;        if (componentType instanceof ParameterizedType) {</b>
<b class="nc">&nbsp;            componentType = ((ParameterizedType) componentType).getRawType();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (objectClass.isArray()) {</b>
<b class="nc">&nbsp;            return objectClass.getComponentType().equals(componentType);</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isWriteTypeInfo(Object object) {
<b class="nc">&nbsp;        long features = context.features;</b>
<b class="nc">&nbsp;        if ((features &amp; Feature.WriteClassName.mask) == 0) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.NotWriteHashMapArrayListClassName.mask) != 0</b>
&nbsp;                &amp;&amp; object != null) {
<b class="nc">&nbsp;            Class objectClass = object.getClass();</b>
<b class="nc">&nbsp;            if (objectClass == HashMap.class || objectClass == ArrayList.class) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return (features &amp; Feature.NotWriteRootClassName.mask) == 0</b>
&nbsp;                || object != this.rootObject;
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isWriteTypeInfo(Object object, Type fieldType, long features) {
<b class="nc">&nbsp;        features |= context.features;</b>
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.WriteClassName.mask) == 0) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (object == null) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Class objectClass = object.getClass();</b>
<b class="nc">&nbsp;        Class fieldClass = null;</b>
<b class="nc">&nbsp;        if (fieldType instanceof Class) {</b>
<b class="nc">&nbsp;            fieldClass = (Class) fieldType;</b>
<b class="nc">&nbsp;        } else if (fieldType instanceof ParameterizedType) {</b>
<b class="nc">&nbsp;            Type rawType = ((ParameterizedType) fieldType).getRawType();</b>
<b class="nc">&nbsp;            if (rawType instanceof Class) {</b>
<b class="nc">&nbsp;                fieldClass = (Class) rawType;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (objectClass == fieldClass) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.NotWriteHashMapArrayListClassName.mask) != 0) {</b>
<b class="nc">&nbsp;            if (objectClass == HashMap.class) {</b>
<b class="nc">&nbsp;                if (fieldClass == null || fieldClass == Object.class || fieldClass == Map.class || fieldClass == AbstractMap.class) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (objectClass == ArrayList.class) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return (features &amp; Feature.NotWriteRootClassName.mask) == 0</b>
&nbsp;                || object != this.rootObject;
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isWriteTypeInfo(Object object, Class fieldClass, long features) {
<b class="nc">&nbsp;        if (object == null) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Class objectClass = object.getClass();</b>
<b class="nc">&nbsp;        if (objectClass == fieldClass) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        features |= context.features;</b>
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.WriteClassName.mask) == 0) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.NotWriteHashMapArrayListClassName.mask) != 0) {</b>
<b class="nc">&nbsp;            if (objectClass == HashMap.class) {</b>
<b class="nc">&nbsp;                if (fieldClass == null || fieldClass == Object.class || fieldClass == Map.class || fieldClass == AbstractMap.class) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (objectClass == ArrayList.class) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return (features &amp; Feature.NotWriteRootClassName.mask) == 0</b>
&nbsp;                || object != this.rootObject;
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isWriteMapTypeInfo(Object object, Class fieldClass, long features) {
<b class="nc">&nbsp;        if (object == null) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Class objectClass = object.getClass();</b>
<b class="nc">&nbsp;        if (objectClass == fieldClass) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        features |= context.features;</b>
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.WriteClassName.mask) == 0) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.NotWriteHashMapArrayListClassName.mask) != 0) {</b>
<b class="nc">&nbsp;            if (objectClass == HashMap.class) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return (features &amp; Feature.NotWriteRootClassName.mask) == 0 || object != this.rootObject;</b>
&nbsp;    }
&nbsp;
&nbsp;    public final boolean isWriteTypeInfo(Object object, long features) {
<b class="nc">&nbsp;        features |= context.features;</b>
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.WriteClassName.mask) == 0) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((features &amp; Feature.NotWriteHashMapArrayListClassName.mask) != 0) {</b>
<b class="nc">&nbsp;            if (object != null) {</b>
<b class="nc">&nbsp;                Class objectClass = object.getClass();</b>
<b class="nc">&nbsp;                if (objectClass == HashMap.class || objectClass == ArrayList.class) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return (features &amp; Feature.NotWriteRootClassName.mask) == 0</b>
&nbsp;                || object != this.rootObject;
&nbsp;    }
&nbsp;
&nbsp;    public final ObjectWriter getObjectWriter(Class objectClass) {
<b class="nc">&nbsp;        boolean fieldBased = (context.features &amp; Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;        return context.provider.getObjectWriter(objectClass, objectClass, fieldBased);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final ObjectWriter getObjectWriter(Type objectType, Class objectClass) {
<b class="nc">&nbsp;        boolean fieldBased = (context.features &amp; Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;        return context.provider.getObjectWriter(objectType, objectClass, fieldBased);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter of() {
<b class="nc">&nbsp;        JSONWriter.Context writeContext = new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider);</b>
&nbsp;        JSONWriter jsonWriter;
<b class="nc">&nbsp;        if (JVM_VERSION == 8) {</b>
<b class="nc">&nbsp;            if (FIELD_STRING_VALUE != null &amp;&amp; !ANDROID &amp;&amp; !OPENJ9) {</b>
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK8UF(writeContext);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK8(writeContext);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if ((defaultWriterFeatures &amp; Feature.OptimizedForAscii.mask) != 0) {</b>
<b class="nc">&nbsp;            if (STRING_VALUE != null) {</b>
<b class="nc">&nbsp;                if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF8 != null) {</b>
<b class="nc">&nbsp;                    jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF8.apply(writeContext);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    jsonWriter = new JSONWriterUTF8JDK9(writeContext);</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF8(writeContext);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF16 != null) {</b>
<b class="nc">&nbsp;                jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF16.apply(writeContext);</b>
<b class="nc">&nbsp;            } else if (FIELD_STRING_VALUE != null &amp;&amp; STRING_CODER != null &amp;&amp; STRING_VALUE != null &amp;&amp; UNSAFE_SUPPORT) {</b>
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK9UF(writeContext);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16(writeContext);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return jsonWriter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter of(ObjectWriterProvider provider, Feature... features) {
<b class="nc">&nbsp;        Context context = new Context(provider);</b>
<b class="nc">&nbsp;        context.config(features);</b>
<b class="nc">&nbsp;        return of(context);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter of(Context writeContext) {
<b class="nc">&nbsp;        if (writeContext == null) {</b>
<b class="nc">&nbsp;            writeContext = JSONFactory.createWriteContext();</b>
&nbsp;        }
&nbsp;
&nbsp;        JSONWriter jsonWriter;
<b class="nc">&nbsp;        if (JVM_VERSION == 8) {</b>
<b class="nc">&nbsp;            if (FIELD_STRING_VALUE != null &amp;&amp; !ANDROID &amp;&amp; !OPENJ9) {</b>
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK8UF(writeContext);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK8(writeContext);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if ((writeContext.features &amp; Feature.OptimizedForAscii.mask) != 0) {</b>
<b class="nc">&nbsp;            if (STRING_VALUE != null) {</b>
<b class="nc">&nbsp;                if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF8 != null) {</b>
<b class="nc">&nbsp;                    jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF8.apply(writeContext);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    jsonWriter = new JSONWriterUTF8JDK9(writeContext);</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF8(writeContext);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF16 != null) {</b>
<b class="nc">&nbsp;                jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF16.apply(writeContext);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16(writeContext);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return jsonWriter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter of(Feature... features) {
<b class="nc">&nbsp;        Context writeContext = JSONFactory.createWriteContext(features);</b>
&nbsp;        JSONWriter jsonWriter;
<b class="nc">&nbsp;        if (JVM_VERSION == 8) {</b>
<b class="nc">&nbsp;            if (FIELD_STRING_VALUE != null &amp;&amp; !ANDROID &amp;&amp; !OPENJ9) {</b>
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK8UF(writeContext);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK8(writeContext);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if ((writeContext.features &amp; Feature.OptimizedForAscii.mask) != 0) {</b>
<b class="nc">&nbsp;            if (STRING_VALUE != null) {</b>
<b class="nc">&nbsp;                if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF8 != null) {</b>
<b class="nc">&nbsp;                    jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF8.apply(writeContext);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    jsonWriter = new JSONWriterUTF8JDK9(writeContext);</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF8(writeContext);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF16 != null) {</b>
<b class="nc">&nbsp;                jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF16.apply(writeContext);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16(writeContext);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return jsonWriter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofUTF16(Feature... features) {
<b class="nc">&nbsp;        Context writeContext = JSONFactory.createWriteContext(features);</b>
&nbsp;        JSONWriter jsonWriter;
<b class="nc">&nbsp;        if (JVM_VERSION == 8) {</b>
<b class="nc">&nbsp;            if (FIELD_STRING_VALUE != null &amp;&amp; !ANDROID &amp;&amp; !OPENJ9) {</b>
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK8UF(writeContext);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16JDK8(writeContext);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF16 != null) {</b>
<b class="nc">&nbsp;                jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF16.apply(writeContext);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF16(writeContext);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return jsonWriter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofJSONB() {
<b class="nc">&nbsp;        return new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider),
&nbsp;                null
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofJSONB(JSONWriter.Context context) {
<b class="nc">&nbsp;        return new JSONWriterJSONB(context, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofJSONB(JSONWriter.Context context, SymbolTable symbolTable) {
<b class="nc">&nbsp;        return new JSONWriterJSONB(context, symbolTable);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofJSONB(Feature... features) {
<b class="nc">&nbsp;        return new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider, features),
&nbsp;                null
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofJSONB(SymbolTable symbolTable) {
<b class="nc">&nbsp;        return new JSONWriterJSONB(</b>
&nbsp;                new JSONWriter.Context(JSONFactory.defaultObjectWriterProvider),
&nbsp;                symbolTable
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofPretty() {
<b class="nc">&nbsp;        return of(PrettyFormat);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofPretty(JSONWriter writer) {
<b class="nc">&nbsp;        if (!writer.pretty) {</b>
<b class="nc">&nbsp;            writer.pretty = true;</b>
<b class="nc">&nbsp;            writer.context.features |= PrettyFormat.mask;</b>
&nbsp;        }
<b class="nc">&nbsp;        return writer;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofUTF8() {
<b class="nc">&nbsp;        Context context = createWriteContext();</b>
&nbsp;        JSONWriter jsonWriter;
<b class="nc">&nbsp;        if (STRING_VALUE != null) {</b>
<b class="nc">&nbsp;            if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF8 != null) {</b>
<b class="nc">&nbsp;                jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF8.apply(context);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF8JDK9(context);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            jsonWriter = new JSONWriterUTF8(context);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return jsonWriter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofUTF8(JSONWriter.Context context) {
&nbsp;        JSONWriter jsonWriter;
<b class="nc">&nbsp;        if (STRING_VALUE != null) {</b>
<b class="nc">&nbsp;            if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF8 != null) {</b>
<b class="nc">&nbsp;                jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF8.apply(context);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF8JDK9(context);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            jsonWriter = new JSONWriterUTF8(context);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return jsonWriter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static JSONWriter ofUTF8(Feature... features) {
<b class="nc">&nbsp;        Context context = createWriteContext(features);</b>
&nbsp;
&nbsp;        JSONWriter jsonWriter;
<b class="nc">&nbsp;        if (STRING_VALUE != null) {</b>
<b class="nc">&nbsp;            if (INCUBATOR_VECTOR_WRITER_CREATOR_UTF8 != null) {</b>
<b class="nc">&nbsp;                jsonWriter = INCUBATOR_VECTOR_WRITER_CREATOR_UTF8.apply(context);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                jsonWriter = new JSONWriterUTF8JDK9(context);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            jsonWriter = new JSONWriterUTF8(context);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return jsonWriter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeBinary(byte[] bytes) {
<b class="nc">&nbsp;        if (bytes == null) {</b>
<b class="nc">&nbsp;            writeArrayNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((context.features &amp; Feature.WriteByteArrayAsBase64.mask) != 0) {</b>
<b class="nc">&nbsp;            writeBase64(bytes);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        startArray();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; bytes.length; i++) {</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                writeComma();</b>
&nbsp;            }
<b class="nc">&nbsp;            writeInt32(bytes[i]);</b>
&nbsp;        }
<b class="nc">&nbsp;        endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeBase64(byte[] bytes);
&nbsp;
&nbsp;    public abstract void writeHex(byte[] bytes);
&nbsp;
&nbsp;    protected abstract void write0(char ch);
&nbsp;
&nbsp;    public abstract void writeRaw(String str);
&nbsp;
&nbsp;    public abstract void writeRaw(byte[] bytes);
&nbsp;
&nbsp;    public void writeRaw(byte b) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeNameRaw(byte[] bytes, int offset, int len) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeRaw(char[] chars) {
<b class="nc">&nbsp;        writeRaw(chars, 0, chars.length);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeRaw(char[] chars, int off, int charslen) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeChar(char ch);
&nbsp;
&nbsp;    public abstract void writeRaw(char ch);
&nbsp;
&nbsp;    public void writeRaw(char c0, char c1) {
<b class="nc">&nbsp;        writeRaw(c0);</b>
<b class="nc">&nbsp;        writeRaw(c1);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeNameRaw(byte[] bytes);
&nbsp;
&nbsp;    public void writeSymbol(int symbol) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeNameRaw(byte[] name, long nameHash) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeNameRaw(char[] chars);
&nbsp;
&nbsp;    public abstract void writeNameRaw(char[] bytes, int offset, int len);
&nbsp;
&nbsp;    public void writeName(String name) {
<b class="nc">&nbsp;        if (startObject) {</b>
<b class="nc">&nbsp;            startObject = false;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeComma();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        boolean unquote = (context.features &amp; UnquoteFieldName.mask) != 0;</b>
<b class="nc">&nbsp;        if (unquote &amp;&amp; (name.indexOf(quote) &gt;= 0 || name.indexOf(&#39;\\&#39;) &gt;= 0)) {</b>
<b class="nc">&nbsp;            unquote = false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (unquote) {</b>
<b class="nc">&nbsp;            writeRaw(name);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        writeString(name);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeName(long name) {
<b class="nc">&nbsp;        if (startObject) {</b>
<b class="nc">&nbsp;            startObject = false;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeComma();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        writeInt64(name);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeName(int name) {
<b class="nc">&nbsp;        if (startObject) {</b>
<b class="nc">&nbsp;            startObject = false;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeComma();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        writeInt32(name);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeNameAny(Object name) {
<b class="nc">&nbsp;        if (startObject) {</b>
<b class="nc">&nbsp;            startObject = false;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeComma();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        writeAny(name);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void startObject();
&nbsp;
&nbsp;    public abstract void endObject();
&nbsp;
&nbsp;    public abstract void startArray();
&nbsp;
&nbsp;    public void startArray(int size) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void startArray(Object array, int size) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void endArray();
&nbsp;
&nbsp;    public abstract void writeComma();
&nbsp;
&nbsp;    public abstract void writeColon();
&nbsp;
&nbsp;    public void writeInt16(short[] value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            writeArrayNull();</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        startArray();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; value.length; i++) {</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                writeComma();</b>
&nbsp;            }
<b class="nc">&nbsp;            writeInt16(value[i]);</b>
&nbsp;        }
<b class="nc">&nbsp;        endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeInt8(byte value);
&nbsp;
&nbsp;    public abstract void writeInt16(short value);
&nbsp;
&nbsp;    public abstract void writeInt32(int[] value);
&nbsp;
&nbsp;    public abstract void writeInt32(int value);
&nbsp;
&nbsp;    public abstract void writeInt64(long i);
&nbsp;
&nbsp;    public void writeMillis(long i) {
<b class="nc">&nbsp;        writeInt64(i);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeInt64(long[] value);
&nbsp;
&nbsp;    public abstract void writeFloat(float value);
&nbsp;
&nbsp;    public final void writeFloat(float value, DecimalFormat format) {
<b class="nc">&nbsp;        if (format == null || jsonb) {</b>
<b class="nc">&nbsp;            writeFloat(value);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        String str = format.format(value);</b>
<b class="nc">&nbsp;        writeRaw(str);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeFloat(float[] value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            writeNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        startArray();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; value.length; i++) {</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                writeComma();</b>
&nbsp;            }
<b class="nc">&nbsp;            writeFloat(value[i]);</b>
&nbsp;        }
<b class="nc">&nbsp;        endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeFloat(float[] value, DecimalFormat format) {
<b class="nc">&nbsp;        if (format == null || jsonb) {</b>
<b class="nc">&nbsp;            writeFloat(value);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            writeNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        startArray();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; value.length; i++) {</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                writeComma();</b>
&nbsp;            }
<b class="nc">&nbsp;            String str = format.format(value[i]);</b>
<b class="nc">&nbsp;            writeRaw(str);</b>
&nbsp;        }
<b class="nc">&nbsp;        endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeFloat(Float value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            writeNumberNull();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeDouble(value);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeDouble(double value);
&nbsp;
&nbsp;    public final void writeDouble(double value, DecimalFormat format) {
<b class="nc">&nbsp;        if (format == null || jsonb) {</b>
<b class="nc">&nbsp;            writeDouble(value);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        String str = format.format(value);</b>
<b class="nc">&nbsp;        writeRaw(str);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeDoubleArray(double value0, double value1) {
<b class="nc">&nbsp;        startArray();</b>
<b class="nc">&nbsp;        writeDouble(value0);</b>
<b class="nc">&nbsp;        writeComma();</b>
<b class="nc">&nbsp;        writeDouble(value1);</b>
<b class="nc">&nbsp;        endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeDouble(double[] value, DecimalFormat format) {
<b class="nc">&nbsp;        if (format == null || jsonb) {</b>
<b class="nc">&nbsp;            writeDouble(value);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            writeNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        startArray();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; value.length; i++) {</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                writeComma();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String str = format.format(value[i]);</b>
<b class="nc">&nbsp;            writeRaw(str);</b>
&nbsp;        }
<b class="nc">&nbsp;        endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeDouble(double[] value);
&nbsp;
&nbsp;    public void writeBool(boolean value) {
<b class="nc">&nbsp;        if ((context.features &amp; Feature.WriteBooleanAsNumber.mask) != 0) {</b>
<b class="nc">&nbsp;            write0(value ? &#39;1&#39; : &#39;0&#39;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeRaw(value ? &quot;true&quot; : &quot;false&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void writeBool(boolean[] value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            writeArrayNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        startArray();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; value.length; i++) {</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                writeComma();</b>
&nbsp;            }
<b class="nc">&nbsp;            writeBool(value[i]);</b>
&nbsp;        }
<b class="nc">&nbsp;        endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeNull() {
<b class="nc">&nbsp;        writeRaw(&quot;null&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeStringNull() {
&nbsp;        String raw;
<b class="nc">&nbsp;        if ((this.context.features &amp; (Feature.NullAsDefaultValue.mask | Feature.WriteNullStringAsEmpty.mask)) != 0) {</b>
<b class="nc">&nbsp;            raw = (this.context.features &amp; Feature.UseSingleQuotes.mask) != 0 ? &quot;&#39;&#39;&quot; : &quot;\&quot;\&quot;&quot;;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            raw = &quot;null&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        writeRaw(raw);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeArrayNull() {
&nbsp;        String raw;
<b class="nc">&nbsp;        if ((this.context.features &amp; (Feature.NullAsDefaultValue.mask | Feature.WriteNullListAsEmpty.mask)) != 0) {</b>
<b class="nc">&nbsp;            raw = &quot;[]&quot;;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            raw = &quot;null&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        writeRaw(raw);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeNumberNull() {
<b class="nc">&nbsp;        if ((this.context.features &amp; (Feature.NullAsDefaultValue.mask | Feature.WriteNullNumberAsZero.mask)) != 0) {</b>
<b class="nc">&nbsp;            writeInt32(0);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeNull();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public final void writeBooleanNull() {
<b class="nc">&nbsp;        if ((this.context.features &amp; (Feature.NullAsDefaultValue.mask | Feature.WriteNullBooleanAsFalse.mask)) != 0) {</b>
<b class="nc">&nbsp;            writeBool(false);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeNull();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public final void writeDecimal(BigDecimal value) {
<b class="nc">&nbsp;        writeDecimal(value, 0, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeDecimal(BigDecimal value, long features) {
<b class="nc">&nbsp;        writeDecimal(value, features, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeDecimal(BigDecimal value, long features, DecimalFormat format);
&nbsp;
&nbsp;    public void writeEnum(Enum e) {
<b class="nc">&nbsp;        if (e == null) {</b>
<b class="nc">&nbsp;            writeNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((context.features &amp; Feature.WriteEnumUsingToString.mask) != 0) {</b>
<b class="nc">&nbsp;            writeString(e.toString());</b>
<b class="nc">&nbsp;        } else if ((context.features &amp; Feature.WriteEnumsUsingName.mask) != 0) {</b>
<b class="nc">&nbsp;            writeString(e.name());</b>
&nbsp;        } else {
<b class="nc">&nbsp;            writeInt32(e.ordinal());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public final void writeBigInt(BigInteger value) {
<b class="nc">&nbsp;        writeBigInt(value, 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeBigInt(BigInteger value, long features);
&nbsp;
&nbsp;    public abstract void writeUUID(UUID value);
&nbsp;
&nbsp;    public final void checkAndWriteTypeName(Object object, Class fieldClass) {
<b class="nc">&nbsp;        long features = context.features;</b>
&nbsp;        Class objectClass;
<b class="nc">&nbsp;        if ((features &amp; Feature.WriteClassName.mask) == 0</b>
&nbsp;                || object == null
<b class="nc">&nbsp;                || (objectClass = object.getClass()) == fieldClass</b>
&nbsp;                || ((features &amp; Feature.NotWriteHashMapArrayListClassName.mask) != 0 &amp;&amp; (objectClass == HashMap.class || objectClass == ArrayList.class))
&nbsp;                || ((features &amp; Feature.NotWriteRootClassName.mask) != 0 &amp;&amp; object == this.rootObject)
&nbsp;        ) {
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        writeTypeName(TypeUtils.getTypeName(objectClass));</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeTypeName(String typeName) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean writeTypeName(byte[] typeName, long typeNameHash) {
<b class="nc">&nbsp;        throw new JSONException(&quot;UnsupportedOperation&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public final void writeString(Reader reader) {
<b class="nc">&nbsp;        writeRaw(quote);</b>
&nbsp;
&nbsp;        try {
<b class="nc">&nbsp;            char[] chars = new char[2048];</b>
&nbsp;            for (; ; ) {
<b class="nc">&nbsp;                int len = reader.read(chars, 0, chars.length);</b>
<b class="nc">&nbsp;                if (len &lt; 0) {</b>
&nbsp;                    break;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (len &gt; 0) {</b>
<b class="nc">&nbsp;                    writeString(chars, 0, len, false);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        } catch (Exception ex) {</b>
<b class="nc">&nbsp;            throw new JSONException(&quot;read string from reader error&quot;, ex);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        writeRaw(quote);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeString(String str);
&nbsp;
&nbsp;    public abstract void writeStringLatin1(byte[] value);
&nbsp;
&nbsp;    public abstract void writeStringUTF16(byte[] value);
&nbsp;
&nbsp;    public void writeString(List&lt;String&gt; list) {
<b class="nc">&nbsp;        startArray();</b>
<b class="nc">&nbsp;        for (int i = 0, size = list.size(); i &lt; size; i++) {</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                writeComma();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String str = list.get(i);</b>
<b class="nc">&nbsp;            writeString(str);</b>
&nbsp;        }
<b class="nc">&nbsp;        endArray();</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeString(String[] strings);
&nbsp;
&nbsp;    public void writeSymbol(String string) {
<b class="nc">&nbsp;        writeString(string);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeString(char[] chars);
&nbsp;
&nbsp;    public abstract void writeString(char[] chars, int off, int len);
&nbsp;
&nbsp;    public abstract void writeString(char[] chars, int off, int len, boolean quote);
&nbsp;
&nbsp;    public abstract void writeLocalDate(LocalDate date);
&nbsp;
&nbsp;    protected final boolean writeLocalDateWithFormat(LocalDate date, Context context) {
<b class="nc">&nbsp;        if (context.dateFormatUnixTime || context.dateFormatMillis) {</b>
<b class="nc">&nbsp;            LocalDateTime dateTime = LocalDateTime.of(date, LocalTime.MIN);</b>
<b class="nc">&nbsp;            long millis = dateTime.atZone(context.getZoneId())</b>
<b class="nc">&nbsp;                    .toInstant()</b>
<b class="nc">&nbsp;                    .toEpochMilli();</b>
<b class="nc">&nbsp;            writeInt64(context.dateFormatMillis ? millis : millis / 1000);</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        DateTimeFormatter formatter = context.getDateFormatter();</b>
<b class="nc">&nbsp;        if (formatter != null) {</b>
&nbsp;            String str;
<b class="nc">&nbsp;            if (context.isDateFormatHasHour()) {</b>
<b class="nc">&nbsp;                str = formatter.format(LocalDateTime.of(date, LocalTime.MIN));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                str = formatter.format(date);</b>
&nbsp;            }
<b class="nc">&nbsp;            writeString(str);</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeLocalDateTime(LocalDateTime dateTime);
&nbsp;
&nbsp;    public abstract void writeLocalTime(LocalTime time);
&nbsp;
&nbsp;    public abstract void writeZonedDateTime(ZonedDateTime dateTime);
&nbsp;
&nbsp;    public abstract void writeOffsetDateTime(OffsetDateTime dateTime);
&nbsp;
&nbsp;    public void writeInstant(Instant instant) {
<b class="nc">&nbsp;        if (instant == null) {</b>
<b class="nc">&nbsp;            writeNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        String str = DateTimeFormatter.ISO_INSTANT.format(instant);</b>
<b class="nc">&nbsp;        writeString(str);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeDateTime14(
&nbsp;            int year,
&nbsp;            int month,
&nbsp;            int dayOfMonth,
&nbsp;            int hour,
&nbsp;            int minute,
&nbsp;            int second);
&nbsp;
&nbsp;    public abstract void writeDateTime19(
&nbsp;            int year,
&nbsp;            int month,
&nbsp;            int dayOfMonth,
&nbsp;            int hour,
&nbsp;            int minute,
&nbsp;            int second);
&nbsp;
&nbsp;    public abstract void writeDateTimeISO8601(
&nbsp;            int year,
&nbsp;            int month,
&nbsp;            int dayOfMonth,
&nbsp;            int hour,
&nbsp;            int minute,
&nbsp;            int second,
&nbsp;            int millis,
&nbsp;            int offsetSeconds,
&nbsp;            boolean timeZone
&nbsp;    );
&nbsp;
&nbsp;    public abstract void writeDateYYYMMDD8(int year, int month, int dayOfMonth);
&nbsp;
&nbsp;    public abstract void writeDateYYYMMDD10(int year, int month, int dayOfMonth);
&nbsp;
&nbsp;    public abstract void writeTimeHHMMSS8(int hour, int minute, int second);
&nbsp;
&nbsp;    public void write(List array) {
<b class="nc">&nbsp;        if (array == null) {</b>
<b class="nc">&nbsp;            this.writeArrayNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        final long NONE_DIRECT_FEATURES = ReferenceDetection.mask</b>
&nbsp;                | PrettyFormat.mask
&nbsp;                | NotWriteEmptyArray.mask
&nbsp;                | NotWriteDefaultValue.mask;
&nbsp;
<b class="nc">&nbsp;        if ((context.features &amp; NONE_DIRECT_FEATURES) != 0) {</b>
<b class="nc">&nbsp;            ObjectWriter objectWriter = context.getObjectWriter(array.getClass());</b>
<b class="nc">&nbsp;            objectWriter.write(this, array, null, null, 0);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        write0(&#39;[&#39;);</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; array.size(); i++) {</b>
<b class="nc">&nbsp;            Object item = array.get(i);</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                write0(&#39;,&#39;);</b>
&nbsp;            }
<b class="nc">&nbsp;            writeAny(item);</b>
&nbsp;        }
<b class="nc">&nbsp;        write0(&#39;]&#39;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void write(Map map) {
<b class="nc">&nbsp;        if (map == null) {</b>
<b class="nc">&nbsp;            this.writeNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        final long NONE_DIRECT_FEATURES = ReferenceDetection.mask</b>
&nbsp;                | PrettyFormat.mask
&nbsp;                | NotWriteEmptyArray.mask
&nbsp;                | NotWriteDefaultValue.mask;
&nbsp;
<b class="nc">&nbsp;        if ((context.features &amp; NONE_DIRECT_FEATURES) != 0) {</b>
<b class="nc">&nbsp;            ObjectWriter objectWriter = context.getObjectWriter(map.getClass());</b>
<b class="nc">&nbsp;            objectWriter.write(this, map, null, null, 0);</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        write0(&#39;{&#39;);</b>
<b class="nc">&nbsp;        boolean first = true;</b>
<b class="nc">&nbsp;        for (Map.Entry o : (Iterable&lt;Map.Entry&gt;) map.entrySet()) {</b>
<b class="nc">&nbsp;            if (!first) {</b>
<b class="nc">&nbsp;                write0(&#39;,&#39;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            writeAny(</b>
<b class="nc">&nbsp;                    o.getKey());</b>
<b class="nc">&nbsp;            write0(&#39;:&#39;);</b>
<b class="nc">&nbsp;            writeAny(</b>
<b class="nc">&nbsp;                    o.getValue());</b>
&nbsp;
<b class="nc">&nbsp;            first = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        write0(&#39;}&#39;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void write(JSONObject map) {
<b class="nc">&nbsp;        write((Map) map);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void writeAny(Object value) {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            writeNull();</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Class&lt;?&gt; valueClass = value.getClass();</b>
<b class="nc">&nbsp;        ObjectWriter objectWriter = context.getObjectWriter(valueClass, valueClass);</b>
<b class="nc">&nbsp;        objectWriter.write(this, value, null, null, 0);</b>
&nbsp;    }
&nbsp;
&nbsp;    public abstract void writeReference(String path);
&nbsp;
&nbsp;    @Override
&nbsp;    public abstract void close();
&nbsp;
&nbsp;    public abstract int size();
&nbsp;
&nbsp;    public abstract byte[] getBytes();
&nbsp;
&nbsp;    public abstract byte[] getBytes(Charset charset);
&nbsp;
&nbsp;    public void flushTo(java.io.Writer to) {
&nbsp;        try {
<b class="nc">&nbsp;            String json = this.toString();</b>
<b class="nc">&nbsp;            to.write(json);</b>
<b class="nc">&nbsp;            off = 0;</b>
<b class="nc">&nbsp;        } catch (IOException e) {</b>
<b class="nc">&nbsp;            throw new JSONException(&quot;flushTo error&quot;, e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public abstract int flushTo(OutputStream to) throws IOException;
&nbsp;
&nbsp;    public abstract int flushTo(OutputStream out, Charset charset) throws IOException;
&nbsp;
&nbsp;    public static final class Context {
<b class="nc">&nbsp;        static final ZoneId DEFAULT_ZONE_ID = ZoneId.systemDefault();</b>
&nbsp;
&nbsp;        public final ObjectWriterProvider provider;
&nbsp;        DateTimeFormatter dateFormatter;
&nbsp;        String dateFormat;
&nbsp;        Locale locale;
&nbsp;        boolean dateFormatMillis;
&nbsp;        boolean dateFormatISO8601;
&nbsp;        boolean dateFormatUnixTime;
&nbsp;        boolean formatyyyyMMddhhmmss19;
&nbsp;        boolean formatHasDay;
&nbsp;        boolean formatHasHour;
&nbsp;        long features;
&nbsp;        ZoneId zoneId;
<b class="nc">&nbsp;        int maxLevel = 2048;</b>
&nbsp;        boolean hasFilter;
&nbsp;        PropertyPreFilter propertyPreFilter;
&nbsp;        PropertyFilter propertyFilter;
&nbsp;        NameFilter nameFilter;
&nbsp;        ValueFilter valueFilter;
&nbsp;        BeforeFilter beforeFilter;
&nbsp;        AfterFilter afterFilter;
&nbsp;        LabelFilter labelFilter;
&nbsp;        ContextValueFilter contextValueFilter;
&nbsp;        ContextNameFilter contextNameFilter;
&nbsp;
<b class="nc">&nbsp;        public Context(ObjectWriterProvider provider) {</b>
<b class="nc">&nbsp;            if (provider == null) {</b>
<b class="nc">&nbsp;                throw new IllegalArgumentException(&quot;objectWriterProvider must not null&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            this.features = defaultWriterFeatures;</b>
<b class="nc">&nbsp;            this.provider = provider;</b>
&nbsp;
<b class="nc">&nbsp;            String format = defaultWriterFormat;</b>
<b class="nc">&nbsp;            if (format != null) {</b>
<b class="nc">&nbsp;                setDateFormat(format);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        public Context(Feature... features) {</b>
<b class="nc">&nbsp;            this.features = defaultWriterFeatures;</b>
<b class="nc">&nbsp;            this.provider = JSONFactory.getDefaultObjectWriterProvider();</b>
&nbsp;
<b class="nc">&nbsp;            String format = defaultWriterFormat;</b>
<b class="nc">&nbsp;            if (format != null) {</b>
<b class="nc">&nbsp;                setDateFormat(format);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            for (Feature feature : features) {</b>
<b class="nc">&nbsp;                this.features |= feature.mask;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        public Context(String format, Feature... features) {</b>
<b class="nc">&nbsp;            this.features = defaultWriterFeatures;</b>
<b class="nc">&nbsp;            this.provider = JSONFactory.getDefaultObjectWriterProvider();</b>
&nbsp;
<b class="nc">&nbsp;            for (Feature feature : features) {</b>
<b class="nc">&nbsp;                this.features |= feature.mask;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (format == null) {</b>
<b class="nc">&nbsp;                format = defaultWriterFormat;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (format != null) {</b>
<b class="nc">&nbsp;                setDateFormat(format);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        public Context(ObjectWriterProvider provider, Feature... features) {</b>
<b class="nc">&nbsp;            if (provider == null) {</b>
<b class="nc">&nbsp;                throw new IllegalArgumentException(&quot;objectWriterProvider must not null&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            this.features = defaultWriterFeatures;</b>
<b class="nc">&nbsp;            this.provider = provider;</b>
&nbsp;
<b class="nc">&nbsp;            for (Feature feature : features) {</b>
<b class="nc">&nbsp;                this.features |= feature.mask;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String format = defaultWriterFormat;</b>
<b class="nc">&nbsp;            if (format != null) {</b>
<b class="nc">&nbsp;                setDateFormat(format);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public long getFeatures() {
<b class="nc">&nbsp;            return features;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isEnabled(Feature feature) {
<b class="nc">&nbsp;            return (this.features &amp; feature.mask) != 0;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isEnabled(long feature) {
<b class="nc">&nbsp;            return (this.features &amp; feature) != 0;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void config(Feature... features) {
<b class="nc">&nbsp;            for (Feature feature : features) {</b>
<b class="nc">&nbsp;                this.features |= feature.mask;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public void config(Feature feature, boolean state) {
<b class="nc">&nbsp;            if (state) {</b>
<b class="nc">&nbsp;                features |= feature.mask;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                features &amp;= ~feature.mask;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public void configFilter(Filter... filters) {
<b class="nc">&nbsp;            for (Filter filter : filters) {</b>
<b class="nc">&nbsp;                if (filter instanceof NameFilter) {</b>
<b class="nc">&nbsp;                    if (this.nameFilter == null) {</b>
<b class="nc">&nbsp;                        this.nameFilter = (NameFilter) filter;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        this.nameFilter = NameFilter.compose(this.nameFilter, (NameFilter) filter);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (filter instanceof ValueFilter) {</b>
<b class="nc">&nbsp;                    if (this.valueFilter == null) {</b>
<b class="nc">&nbsp;                        this.valueFilter = (ValueFilter) filter;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        this.valueFilter = ValueFilter.compose(this.valueFilter, (ValueFilter) filter);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (filter instanceof PropertyFilter) {</b>
<b class="nc">&nbsp;                    this.propertyFilter = (PropertyFilter) filter;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (filter instanceof PropertyPreFilter) {</b>
<b class="nc">&nbsp;                    this.propertyPreFilter = (PropertyPreFilter) filter;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (filter instanceof BeforeFilter) {</b>
<b class="nc">&nbsp;                    this.beforeFilter = (BeforeFilter) filter;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (filter instanceof AfterFilter) {</b>
<b class="nc">&nbsp;                    this.afterFilter = (AfterFilter) filter;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (filter instanceof LabelFilter) {</b>
<b class="nc">&nbsp;                    this.labelFilter = (LabelFilter) filter;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (filter instanceof ContextValueFilter) {</b>
<b class="nc">&nbsp;                    this.contextValueFilter = (ContextValueFilter) filter;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (filter instanceof ContextNameFilter) {</b>
<b class="nc">&nbsp;                    this.contextNameFilter = (ContextNameFilter) filter;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            hasFilter = propertyPreFilter != null</b>
&nbsp;                    || propertyFilter != null
&nbsp;                    || nameFilter != null
&nbsp;                    || valueFilter != null
&nbsp;                    || beforeFilter != null
&nbsp;                    || afterFilter != null
&nbsp;                    || labelFilter != null
&nbsp;                    || contextValueFilter != null
&nbsp;                    || contextNameFilter != null;
&nbsp;        }
&nbsp;
&nbsp;        public &lt;T&gt; ObjectWriter&lt;T&gt; getObjectWriter(Class&lt;T&gt; objectType) {
<b class="nc">&nbsp;            boolean fieldBased = (features &amp; Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;            return provider.getObjectWriter(objectType, objectType, fieldBased);</b>
&nbsp;        }
&nbsp;
&nbsp;        public &lt;T&gt; ObjectWriter&lt;T&gt; getObjectWriter(Type objectType, Class&lt;T&gt; objectClass) {
<b class="nc">&nbsp;            boolean fieldBased = (features &amp; Feature.FieldBased.mask) != 0;</b>
<b class="nc">&nbsp;            return provider.getObjectWriter(objectType, objectClass, fieldBased);</b>
&nbsp;        }
&nbsp;
&nbsp;        public ObjectWriterProvider getProvider() {
<b class="nc">&nbsp;            return provider;</b>
&nbsp;        }
&nbsp;
&nbsp;        public ZoneId getZoneId() {
<b class="nc">&nbsp;            if (zoneId == null) {</b>
<b class="nc">&nbsp;                zoneId = DEFAULT_ZONE_ID;</b>
&nbsp;            }
<b class="nc">&nbsp;            return zoneId;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setZoneId(ZoneId zoneId) {
<b class="nc">&nbsp;            this.zoneId = zoneId;</b>
&nbsp;        }
&nbsp;
&nbsp;        public String getDateFormat() {
<b class="nc">&nbsp;            return dateFormat;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isDateFormatMillis() {
<b class="nc">&nbsp;            return dateFormatMillis;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isDateFormatUnixTime() {
<b class="nc">&nbsp;            return dateFormatUnixTime;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isDateFormatISO8601() {
<b class="nc">&nbsp;            return dateFormatISO8601;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isDateFormatHasDay() {
<b class="nc">&nbsp;            return formatHasDay;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isDateFormatHasHour() {
<b class="nc">&nbsp;            return formatHasHour;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isFormatyyyyMMddhhmmss19() {
<b class="nc">&nbsp;            return formatyyyyMMddhhmmss19;</b>
&nbsp;        }
&nbsp;
&nbsp;        public DateTimeFormatter getDateFormatter() {
<b class="nc">&nbsp;            if (dateFormatter == null &amp;&amp; dateFormat != null &amp;&amp; !dateFormatMillis &amp;&amp; !dateFormatISO8601 &amp;&amp; !dateFormatUnixTime) {</b>
<b class="nc">&nbsp;                dateFormatter = locale == null</b>
<b class="nc">&nbsp;                        ? DateTimeFormatter.ofPattern(dateFormat)</b>
<b class="nc">&nbsp;                        : DateTimeFormatter.ofPattern(dateFormat, locale);</b>
&nbsp;            }
<b class="nc">&nbsp;            return dateFormatter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setDateFormat(String dateFormat) {
<b class="nc">&nbsp;            if (dateFormat == null || !dateFormat.equals(this.dateFormat)) {</b>
<b class="nc">&nbsp;                dateFormatter = null;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (dateFormat != null &amp;&amp; !dateFormat.isEmpty()) {</b>
<b class="nc">&nbsp;                boolean dateFormatMillis = false, dateFormatISO8601 = false, dateFormatUnixTime = false, formatHasDay = false, formatHasHour = false, formatyyyyMMddhhmmss19 = false;</b>
<b class="nc">&nbsp;                switch (dateFormat) {</b>
&nbsp;                    case &quot;millis&quot;:
<b class="nc">&nbsp;                        dateFormatMillis = true;</b>
&nbsp;                        break;
&nbsp;                    case &quot;iso8601&quot;:
<b class="nc">&nbsp;                        dateFormatMillis = false;</b>
<b class="nc">&nbsp;                        dateFormatISO8601 = true;</b>
&nbsp;                        break;
&nbsp;                    case &quot;unixtime&quot;:
<b class="nc">&nbsp;                        dateFormatMillis = false;</b>
<b class="nc">&nbsp;                        dateFormatUnixTime = true;</b>
&nbsp;                        break;
&nbsp;                    case &quot;yyyy-MM-ddTHH:mm:ss&quot;:
<b class="nc">&nbsp;                        dateFormat = &quot;yyyy-MM-dd&#39;T&#39;HH:mm:ss&quot;;</b>
<b class="nc">&nbsp;                        formatHasDay = true;</b>
<b class="nc">&nbsp;                        formatHasHour = true;</b>
&nbsp;                        break;
&nbsp;                    case &quot;yyyy-MM-dd HH:mm:ss&quot;:
<b class="nc">&nbsp;                        formatyyyyMMddhhmmss19 = true;</b>
<b class="nc">&nbsp;                        formatHasDay = true;</b>
<b class="nc">&nbsp;                        formatHasHour = true;</b>
&nbsp;                        break;
&nbsp;                    default:
<b class="nc">&nbsp;                        dateFormatMillis = false;</b>
<b class="nc">&nbsp;                        formatHasDay = dateFormat.contains(&quot;d&quot;);</b>
<b class="nc">&nbsp;                        formatHasHour = dateFormat.contains(&quot;H&quot;);</b>
&nbsp;                        break;
&nbsp;                }
<b class="nc">&nbsp;                this.dateFormatMillis = dateFormatMillis;</b>
<b class="nc">&nbsp;                this.dateFormatISO8601 = dateFormatISO8601;</b>
<b class="nc">&nbsp;                this.dateFormatUnixTime = dateFormatUnixTime;</b>
<b class="nc">&nbsp;                this.formatHasDay = formatHasDay;</b>
<b class="nc">&nbsp;                this.formatHasHour = formatHasHour;</b>
<b class="nc">&nbsp;                this.formatyyyyMMddhhmmss19 = formatyyyyMMddhhmmss19;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            this.dateFormat = dateFormat;</b>
&nbsp;        }
&nbsp;
&nbsp;        public PropertyPreFilter getPropertyPreFilter() {
<b class="nc">&nbsp;            return propertyPreFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setPropertyPreFilter(PropertyPreFilter propertyPreFilter) {
<b class="nc">&nbsp;            this.propertyPreFilter = propertyPreFilter;</b>
<b class="nc">&nbsp;            if (propertyPreFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public NameFilter getNameFilter() {
<b class="nc">&nbsp;            return nameFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setNameFilter(NameFilter nameFilter) {
<b class="nc">&nbsp;            this.nameFilter = nameFilter;</b>
<b class="nc">&nbsp;            if (nameFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public ValueFilter getValueFilter() {
<b class="nc">&nbsp;            return valueFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setValueFilter(ValueFilter valueFilter) {
<b class="nc">&nbsp;            this.valueFilter = valueFilter;</b>
<b class="nc">&nbsp;            if (valueFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public ContextValueFilter getContextValueFilter() {
<b class="nc">&nbsp;            return contextValueFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setContextValueFilter(ContextValueFilter contextValueFilter) {
<b class="nc">&nbsp;            this.contextValueFilter = contextValueFilter;</b>
<b class="nc">&nbsp;            if (contextValueFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public ContextNameFilter getContextNameFilter() {
<b class="nc">&nbsp;            return contextNameFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setContextNameFilter(ContextNameFilter contextNameFilter) {
<b class="nc">&nbsp;            this.contextNameFilter = contextNameFilter;</b>
<b class="nc">&nbsp;            if (contextNameFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public PropertyFilter getPropertyFilter() {
<b class="nc">&nbsp;            return propertyFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setPropertyFilter(PropertyFilter propertyFilter) {
<b class="nc">&nbsp;            this.propertyFilter = propertyFilter;</b>
<b class="nc">&nbsp;            if (propertyFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public AfterFilter getAfterFilter() {
<b class="nc">&nbsp;            return afterFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setAfterFilter(AfterFilter afterFilter) {
<b class="nc">&nbsp;            this.afterFilter = afterFilter;</b>
<b class="nc">&nbsp;            if (afterFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public BeforeFilter getBeforeFilter() {
<b class="nc">&nbsp;            return beforeFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setBeforeFilter(BeforeFilter beforeFilter) {
<b class="nc">&nbsp;            this.beforeFilter = beforeFilter;</b>
<b class="nc">&nbsp;            if (beforeFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public LabelFilter getLabelFilter() {
<b class="nc">&nbsp;            return labelFilter;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setLabelFilter(LabelFilter labelFilter) {
<b class="nc">&nbsp;            this.labelFilter = labelFilter;</b>
<b class="nc">&nbsp;            if (labelFilter != null) {</b>
<b class="nc">&nbsp;                hasFilter = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    public enum Feature {</b>
<b class="fc">&nbsp;        FieldBased(1),</b>
<b class="fc">&nbsp;        IgnoreNoneSerializable(1 &lt;&lt; 1),</b>
<b class="fc">&nbsp;        ErrorOnNoneSerializable(1 &lt;&lt; 2),</b>
<b class="fc">&nbsp;        BeanToArray(1 &lt;&lt; 3),</b>
<b class="fc">&nbsp;        WriteNulls(1 &lt;&lt; 4),</b>
<b class="fc">&nbsp;        WriteMapNullValue(1 &lt;&lt; 4),</b>
<b class="fc">&nbsp;        BrowserCompatible(1 &lt;&lt; 5),</b>
<b class="fc">&nbsp;        NullAsDefaultValue(1 &lt;&lt; 6),</b>
<b class="fc">&nbsp;        WriteBooleanAsNumber(1 &lt;&lt; 7),</b>
<b class="fc">&nbsp;        WriteNonStringValueAsString(1 &lt;&lt; 8),</b>
<b class="fc">&nbsp;        WriteClassName(1 &lt;&lt; 9),</b>
<b class="fc">&nbsp;        NotWriteRootClassName(1 &lt;&lt; 10),</b>
<b class="fc">&nbsp;        NotWriteHashMapArrayListClassName(1 &lt;&lt; 11),</b>
<b class="fc">&nbsp;        NotWriteDefaultValue(1 &lt;&lt; 12),</b>
<b class="fc">&nbsp;        WriteEnumsUsingName(1 &lt;&lt; 13),</b>
<b class="fc">&nbsp;        WriteEnumUsingToString(1 &lt;&lt; 14),</b>
<b class="fc">&nbsp;        IgnoreErrorGetter(1 &lt;&lt; 15),</b>
<b class="fc">&nbsp;        PrettyFormat(1 &lt;&lt; 16),</b>
<b class="fc">&nbsp;        ReferenceDetection(1 &lt;&lt; 17),</b>
<b class="fc">&nbsp;        WriteNameAsSymbol(1 &lt;&lt; 18),</b>
<b class="fc">&nbsp;        WriteBigDecimalAsPlain(1 &lt;&lt; 19),</b>
<b class="fc">&nbsp;        UseSingleQuotes(1 &lt;&lt; 20),</b>
<b class="fc">&nbsp;        MapSortField(1 &lt;&lt; 21),</b>
<b class="fc">&nbsp;        WriteNullListAsEmpty(1 &lt;&lt; 22),</b>
&nbsp;        /**
&nbsp;         * @since 1.1
&nbsp;         */
<b class="fc">&nbsp;        WriteNullStringAsEmpty(1 &lt;&lt; 23),</b>
&nbsp;        /**
&nbsp;         * @since 1.1
&nbsp;         */
<b class="fc">&nbsp;        WriteNullNumberAsZero(1 &lt;&lt; 24),</b>
&nbsp;        /**
&nbsp;         * @since 1.1
&nbsp;         */
<b class="fc">&nbsp;        WriteNullBooleanAsFalse(1 &lt;&lt; 25),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.7
&nbsp;         */
<b class="fc">&nbsp;        NotWriteEmptyArray(1 &lt;&lt; 26),</b>
<b class="fc">&nbsp;        WriteNonStringKeyAsString(1 &lt;&lt; 27),</b>
&nbsp;        /**
&nbsp;         * @since 2.0.11
&nbsp;         */
<b class="fc">&nbsp;        WritePairAsJavaBean(1L &lt;&lt; 28),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.12
&nbsp;         */
<b class="fc">&nbsp;        OptimizedForAscii(1L &lt;&lt; 29),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.12
&nbsp;         * Feature that specifies that all characters beyond 7-bit ASCII range (i.e. code points of 128 and above) need to be output using format-specific escapes (for JSON, backslash escapes),
&nbsp;         * if format uses escaping mechanisms (which is generally true for textual formats but not for binary formats).
&nbsp;         * Feature is disabled by default.
&nbsp;         */
<b class="fc">&nbsp;        EscapeNoneAscii(1L &lt;&lt; 30),</b>
&nbsp;        /**
&nbsp;         * @since 2.0.13
&nbsp;         */
<b class="fc">&nbsp;        WriteByteArrayAsBase64(1L &lt;&lt; 31),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.13
&nbsp;         */
<b class="fc">&nbsp;        IgnoreNonFieldGetter(1L &lt;&lt; 32),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.16
&nbsp;         */
<b class="fc">&nbsp;        LargeObject(1L &lt;&lt; 33),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.17
&nbsp;         */
<b class="fc">&nbsp;        WriteLongAsString(1L &lt;&lt; 34),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.20
&nbsp;         */
<b class="fc">&nbsp;        BrowserSecure(1L &lt;&lt; 35),</b>
<b class="fc">&nbsp;        WriteEnumUsingOrdinal(1L &lt;&lt; 36),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.30
&nbsp;         */
<b class="fc">&nbsp;        WriteThrowableClassName(1L &lt;&lt; 37),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.33
&nbsp;         */
<b class="fc">&nbsp;        UnquoteFieldName(1L &lt;&lt; 38),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.34
&nbsp;         */
<b class="fc">&nbsp;        NotWriteSetClassName(1L &lt;&lt; 39),</b>
&nbsp;
&nbsp;        /**
&nbsp;         * @since 2.0.34
&nbsp;         */
<b class="fc">&nbsp;        NotWriteNumberClassName(1L &lt;&lt; 40);</b>
&nbsp;
&nbsp;        public final long mask;
&nbsp;
<b class="fc">&nbsp;        Feature(long mask) {</b>
<b class="fc">&nbsp;            this.mask = mask;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static final class Path {
<b class="nc">&nbsp;        public static final Path ROOT = new Path(null, &quot;$&quot;);</b>
&nbsp;
&nbsp;        public final Path parent;
&nbsp;        final String name;
&nbsp;        final int index;
&nbsp;        String fullPath;
&nbsp;
&nbsp;        Path child0;
&nbsp;        Path child1;
&nbsp;
<b class="nc">&nbsp;        public Path(Path parent, String name) {</b>
<b class="nc">&nbsp;            this.parent = parent;</b>
<b class="nc">&nbsp;            this.name = name;</b>
<b class="nc">&nbsp;            this.index = -1;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        public Path(Path parent, int index) {</b>
<b class="nc">&nbsp;            this.parent = parent;</b>
<b class="nc">&nbsp;            this.name = null;</b>
<b class="nc">&nbsp;            this.index = index;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean equals(Object o) {
<b class="nc">&nbsp;            if (this == o) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (o == null || getClass() != o.getClass()) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Path path = (Path) o;</b>
<b class="nc">&nbsp;            return index == path.index &amp;&amp; Objects.equals(parent, path.parent) &amp;&amp; Objects.equals(name, path.name);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int hashCode() {
<b class="nc">&nbsp;            return Objects.hash(parent, name, index);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String toString() {
<b class="nc">&nbsp;            if (fullPath != null) {</b>
<b class="nc">&nbsp;                return fullPath;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            byte[] buf = new byte[16];</b>
<b class="nc">&nbsp;            int off = 0;</b>
&nbsp;
<b class="nc">&nbsp;            int level = 0;</b>
<b class="nc">&nbsp;            Path[] items = new Path[4];</b>
<b class="nc">&nbsp;            for (Path p = this; p != null; p = p.parent) {</b>
<b class="nc">&nbsp;                if (items.length == level) {</b>
<b class="nc">&nbsp;                    items = Arrays.copyOf(items, items.length + 4);</b>
&nbsp;                }
<b class="nc">&nbsp;                items[level] = p;</b>
<b class="nc">&nbsp;                level++;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            boolean ascii = true;</b>
&nbsp;
<b class="nc">&nbsp;            for (int i = level - 1; i &gt;= 0; i--) {</b>
<b class="nc">&nbsp;                Path item = items[i];</b>
<b class="nc">&nbsp;                String name = item.name;</b>
<b class="nc">&nbsp;                if (name == null) {</b>
<b class="nc">&nbsp;                    int intValue = item.index;</b>
<b class="nc">&nbsp;                    int intValueSize = IOUtils.stringSize(intValue);</b>
<b class="nc">&nbsp;                    while (off + intValueSize + 2 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                        int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                        buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    buf[off++] = &#39;[&#39;;</b>
<b class="nc">&nbsp;                    IOUtils.getChars(intValue, off + intValueSize, buf);</b>
<b class="nc">&nbsp;                    off += intValueSize;</b>
<b class="nc">&nbsp;                    buf[off++] = &#39;]&#39;;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    if (off + 1 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                        int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                        buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (i != level - 1) {</b>
<b class="nc">&nbsp;                        buf[off++] = &#39;.&#39;;</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (JVM_VERSION == 8) {</b>
<b class="nc">&nbsp;                        char[] chars = getCharArray(name);</b>
<b class="nc">&nbsp;                        for (int j = 0; j &lt; chars.length; j++) {</b>
<b class="nc">&nbsp;                            char ch = chars[j];</b>
<b class="nc">&nbsp;                            switch (ch) {</b>
&nbsp;                                case &#39;/&#39;:
&nbsp;                                case &#39;:&#39;:
&nbsp;                                case &#39;;&#39;:
&nbsp;                                case &#39;`&#39;:
&nbsp;                                case &#39;.&#39;:
&nbsp;                                case &#39;~&#39;:
&nbsp;                                case &#39;!&#39;:
&nbsp;                                case &#39;@&#39;:
&nbsp;                                case &#39;#&#39;:
&nbsp;                                case &#39;%&#39;:
&nbsp;                                case &#39;^&#39;:
&nbsp;                                case &#39;&amp;&#39;:
&nbsp;                                case &#39;*&#39;:
&nbsp;                                case &#39;[&#39;:
&nbsp;                                case &#39;]&#39;:
&nbsp;                                case &#39;&lt;&#39;:
&nbsp;                                case &#39;&gt;&#39;:
&nbsp;                                case &#39;?&#39;:
&nbsp;                                case &#39;(&#39;:
&nbsp;                                case &#39;)&#39;:
&nbsp;                                case &#39;-&#39;:
&nbsp;                                case &#39;+&#39;:
&nbsp;                                case &#39;=&#39;:
&nbsp;                                case &#39;\\&#39;:
&nbsp;                                case &#39;&quot;&#39;:
&nbsp;                                case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                                    if (off + 1 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                                        int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                        buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                    }
<b class="nc">&nbsp;                                    buf[off++] = &#39;\\&#39;;</b>
<b class="nc">&nbsp;                                    buf[off++] = (byte) ch;</b>
&nbsp;                                    break;
&nbsp;                                default:
<b class="nc">&nbsp;                                    if ((ch &gt;= 0x0001) &amp;&amp; (ch &lt;= 0x007F)) {</b>
<b class="nc">&nbsp;                                        if (off == buf.length) {</b>
<b class="nc">&nbsp;                                            int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                            buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                        }
<b class="nc">&nbsp;                                        buf[off++] = (byte) ch;</b>
<b class="nc">&nbsp;                                    } else if (ch &gt;= &#39;\uD800&#39; &amp;&amp; ch &lt; (&#39;\uDFFF&#39; + 1)) { //  //Character.isSurrogate(c)</b>
<b class="nc">&nbsp;                                        ascii = false;</b>
&nbsp;                                        final int uc;
<b class="nc">&nbsp;                                        if (ch &lt; &#39;\uDBFF&#39; + 1) { // Character.isHighSurrogate(c)</b>
<b class="nc">&nbsp;                                            if (name.length() - i &lt; 2) {</b>
<b class="nc">&nbsp;                                                uc = -1;</b>
&nbsp;                                            } else {
<b class="nc">&nbsp;                                                char d = name.charAt(i + 1);</b>
&nbsp;                                                // d &gt;= &#39;\uDC00&#39; &amp;&amp; d &lt; (&#39;\uDFFF&#39; + 1)
<b class="nc">&nbsp;                                                if (d &gt;= &#39;\uDC00&#39; &amp;&amp; d &lt; (&#39;\uDFFF&#39; + 1)) { // Character.isLowSurrogate(d)</b>
<b class="nc">&nbsp;                                                    uc = ((ch &lt;&lt; 10) + d) + (0x010000 - (&#39;\uD800&#39; &lt;&lt; 10) - &#39;\uDC00&#39;); // Character.toCodePoint(c, d)</b>
&nbsp;                                                } else {
&nbsp;//                            throw new JSONException(&quot;encodeUTF8 error&quot;, new MalformedInputException(1));
<b class="nc">&nbsp;                                                    buf[off++] = (byte) &#39;?&#39;;</b>
&nbsp;                                                    continue;
&nbsp;                                                }
&nbsp;                                            }
&nbsp;                                        } else {
&nbsp;                                            //
&nbsp;                                            // Character.isLowSurrogate(c)
<b class="nc">&nbsp;                                            buf[off++] = (byte) &#39;?&#39;;</b>
&nbsp;                                            continue;
&nbsp;//                        throw new JSONException(&quot;encodeUTF8 error&quot;, new MalformedInputException(1));
&nbsp;                                        }
&nbsp;
<b class="nc">&nbsp;                                        if (uc &lt; 0) {</b>
<b class="nc">&nbsp;                                            if (off == buf.length) {</b>
<b class="nc">&nbsp;                                                int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                                buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                            }
<b class="nc">&nbsp;                                            buf[off++] = (byte) &#39;?&#39;;</b>
&nbsp;                                        } else {
<b class="nc">&nbsp;                                            if (off + 3 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                                                int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                                buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                            }
<b class="nc">&nbsp;                                            buf[off++] = (byte) (0xf0 | ((uc &gt;&gt; 18)));</b>
<b class="nc">&nbsp;                                            buf[off++] = (byte) (0x80 | ((uc &gt;&gt; 12) &amp; 0x3f));</b>
<b class="nc">&nbsp;                                            buf[off++] = (byte) (0x80 | ((uc &gt;&gt; 6) &amp; 0x3f));</b>
<b class="nc">&nbsp;                                            buf[off++] = (byte) (0x80 | (uc &amp; 0x3f));</b>
<b class="nc">&nbsp;                                            j++; // 2 chars</b>
&nbsp;                                        }
<b class="nc">&nbsp;                                    } else if (ch &gt; 0x07FF) {</b>
<b class="nc">&nbsp;                                        if (off + 2 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                                            int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                            buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                        }
<b class="nc">&nbsp;                                        ascii = false;</b>
&nbsp;
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0xE0 | ((ch &gt;&gt; 12) &amp; 0x0F));</b>
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0x80 | ((ch &gt;&gt; 6) &amp; 0x3F));</b>
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0x80 | ((ch) &amp; 0x3F));</b>
&nbsp;                                    } else {
<b class="nc">&nbsp;                                        if (off + 1 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                                            int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                            buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                        }
<b class="nc">&nbsp;                                        ascii = false;</b>
&nbsp;
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0xC0 | ((ch &gt;&gt; 6) &amp; 0x1F));</b>
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0x80 | ((ch) &amp; 0x3F));</b>
&nbsp;                                    }
&nbsp;                                    break;
&nbsp;                            }
&nbsp;                        }
&nbsp;                    } else {
<b class="nc">&nbsp;                        for (int j = 0; j &lt; name.length(); j++) {</b>
<b class="nc">&nbsp;                            char ch = name.charAt(j);</b>
<b class="nc">&nbsp;                            switch (ch) {</b>
&nbsp;                                case &#39;/&#39;:
&nbsp;                                case &#39;:&#39;:
&nbsp;                                case &#39;;&#39;:
&nbsp;                                case &#39;`&#39;:
&nbsp;                                case &#39;.&#39;:
&nbsp;                                case &#39;~&#39;:
&nbsp;                                case &#39;!&#39;:
&nbsp;                                case &#39;@&#39;:
&nbsp;                                case &#39;#&#39;:
&nbsp;                                case &#39;%&#39;:
&nbsp;                                case &#39;^&#39;:
&nbsp;                                case &#39;&amp;&#39;:
&nbsp;                                case &#39;*&#39;:
&nbsp;                                case &#39;[&#39;:
&nbsp;                                case &#39;]&#39;:
&nbsp;                                case &#39;&lt;&#39;:
&nbsp;                                case &#39;&gt;&#39;:
&nbsp;                                case &#39;?&#39;:
&nbsp;                                case &#39;(&#39;:
&nbsp;                                case &#39;)&#39;:
&nbsp;                                case &#39;-&#39;:
&nbsp;                                case &#39;+&#39;:
&nbsp;                                case &#39;=&#39;:
&nbsp;                                case &#39;\\&#39;:
&nbsp;                                case &#39;&quot;&#39;:
&nbsp;                                case &#39;\&#39;&#39;:
<b class="nc">&nbsp;                                    if (off + 1 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                                        int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                        buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                    }
<b class="nc">&nbsp;                                    buf[off++] = &#39;\\&#39;;</b>
<b class="nc">&nbsp;                                    buf[off++] = (byte) ch;</b>
&nbsp;                                    break;
&nbsp;                                default:
<b class="nc">&nbsp;                                    if ((ch &gt;= 0x0001) &amp;&amp; (ch &lt;= 0x007F)) {</b>
<b class="nc">&nbsp;                                        if (off == buf.length) {</b>
<b class="nc">&nbsp;                                            int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                            buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                        }
<b class="nc">&nbsp;                                        buf[off++] = (byte) ch;</b>
<b class="nc">&nbsp;                                    } else if (ch &gt;= &#39;\uD800&#39; &amp;&amp; ch &lt; (&#39;\uDFFF&#39; + 1)) { //  //Character.isSurrogate(c)</b>
<b class="nc">&nbsp;                                        ascii = false;</b>
&nbsp;                                        final int uc;
<b class="nc">&nbsp;                                        if (ch &lt; &#39;\uDBFF&#39; + 1) { // Character.isHighSurrogate(c)</b>
<b class="nc">&nbsp;                                            if (name.length() - i &lt; 2) {</b>
<b class="nc">&nbsp;                                                uc = -1;</b>
&nbsp;                                            } else {
<b class="nc">&nbsp;                                                char d = name.charAt(i + 1);</b>
&nbsp;                                                // d &gt;= &#39;\uDC00&#39; &amp;&amp; d &lt; (&#39;\uDFFF&#39; + 1)
<b class="nc">&nbsp;                                                if (d &gt;= &#39;\uDC00&#39; &amp;&amp; d &lt; (&#39;\uDFFF&#39; + 1)) { // Character.isLowSurrogate(d)</b>
<b class="nc">&nbsp;                                                    uc = ((ch &lt;&lt; 10) + d) + (0x010000 - (&#39;\uD800&#39; &lt;&lt; 10) - &#39;\uDC00&#39;); // Character.toCodePoint(c, d)</b>
&nbsp;                                                } else {
&nbsp;//                            throw new JSONException(&quot;encodeUTF8 error&quot;, new MalformedInputException(1));
<b class="nc">&nbsp;                                                    buf[off++] = (byte) &#39;?&#39;;</b>
&nbsp;                                                    continue;
&nbsp;                                                }
&nbsp;                                            }
&nbsp;                                        } else {
&nbsp;                                            //
&nbsp;                                            // Character.isLowSurrogate(c)
<b class="nc">&nbsp;                                            buf[off++] = (byte) &#39;?&#39;;</b>
&nbsp;                                            continue;
&nbsp;//                        throw new JSONException(&quot;encodeUTF8 error&quot;, new MalformedInputException(1));
&nbsp;                                        }
&nbsp;
<b class="nc">&nbsp;                                        if (uc &lt; 0) {</b>
<b class="nc">&nbsp;                                            if (off == buf.length) {</b>
<b class="nc">&nbsp;                                                int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                                buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                            }
&nbsp;
<b class="nc">&nbsp;                                            buf[off++] = (byte) &#39;?&#39;;</b>
&nbsp;                                        } else {
<b class="nc">&nbsp;                                            if (off + 3 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                                                int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                                buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                            }
&nbsp;
<b class="nc">&nbsp;                                            buf[off++] = (byte) (0xf0 | ((uc &gt;&gt; 18)));</b>
<b class="nc">&nbsp;                                            buf[off++] = (byte) (0x80 | ((uc &gt;&gt; 12) &amp; 0x3f));</b>
<b class="nc">&nbsp;                                            buf[off++] = (byte) (0x80 | ((uc &gt;&gt; 6) &amp; 0x3f));</b>
<b class="nc">&nbsp;                                            buf[off++] = (byte) (0x80 | (uc &amp; 0x3f));</b>
<b class="nc">&nbsp;                                            j++; // 2 chars</b>
&nbsp;                                        }
<b class="nc">&nbsp;                                    } else if (ch &gt; 0x07FF) {</b>
<b class="nc">&nbsp;                                        if (off + 2 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                                            int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                            buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                        }
<b class="nc">&nbsp;                                        ascii = false;</b>
&nbsp;
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0xE0 | ((ch &gt;&gt; 12) &amp; 0x0F));</b>
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0x80 | ((ch &gt;&gt; 6) &amp; 0x3F));</b>
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0x80 | ((ch) &amp; 0x3F));</b>
&nbsp;                                    } else {
<b class="nc">&nbsp;                                        if (off + 1 &gt;= buf.length) {</b>
<b class="nc">&nbsp;                                            int newCapacity = buf.length + (buf.length &gt;&gt; 1);</b>
<b class="nc">&nbsp;                                            buf = Arrays.copyOf(buf, newCapacity);</b>
&nbsp;                                        }
<b class="nc">&nbsp;                                        ascii = false;</b>
&nbsp;
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0xC0 | ((ch &gt;&gt; 6) &amp; 0x1F));</b>
<b class="nc">&nbsp;                                        buf[off++] = (byte) (0x80 | ((ch) &amp; 0x3F));</b>
&nbsp;                                    }
&nbsp;                                    break;
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (ascii) {</b>
<b class="nc">&nbsp;                if (STRING_CREATOR_JDK11 != null) {</b>
&nbsp;                    byte[] bytes;
<b class="nc">&nbsp;                    if (off == buf.length) {</b>
<b class="nc">&nbsp;                        bytes = buf;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        bytes = new byte[off];</b>
<b class="nc">&nbsp;                        System.arraycopy(buf, 0, bytes, 0, off);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return fullPath = STRING_CREATOR_JDK11.apply(bytes, LATIN1);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (STRING_CREATOR_JDK8 != null) {</b>
<b class="nc">&nbsp;                    char[] chars = new char[off];</b>
<b class="nc">&nbsp;                    for (int i = 0; i &lt; off; i++) {</b>
<b class="nc">&nbsp;                        chars[i] = (char) buf[i];</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return fullPath = STRING_CREATOR_JDK8.apply(chars, Boolean.TRUE);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return fullPath = new String(buf, 0, off, ascii ? StandardCharsets.ISO_8859_1 : StandardCharsets.UTF_8);</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-04-09 22:42</div>
</div>
</body>
</html>
